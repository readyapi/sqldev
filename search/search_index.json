{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"SQLDev","text":"<p> SQLDev, SQL databases in Python, designed for simplicity, compatibility, and robustness. </p> <p> <p>Documentation: https://sqldev.khulnasoft.com</p> <p>Source Code: https://github.com/readyapi/sqldev</p> <p>SQLDev is a library for interacting with SQL databases from Python code, with Python objects. It is designed to be intuitive, easy to use, highly compatible, and robust.</p> <p>SQLDev is based on Python type annotations, and powered by Pydantic and SQLAlchemy.</p> <p>The key features are:</p> <ul> <li>Intuitive to write: Great editor support. Completion everywhere. Less time debugging. Designed to be easy to use and learn. Less time reading docs.</li> <li>Easy to use: It has sensible defaults and does a lot of work underneath to simplify the code you write.</li> <li>Compatible: It is designed to be compatible with ReadyAPI, Pydantic, and SQLAlchemy.</li> <li>Extensible: You have all the power of SQLAlchemy and Pydantic underneath.</li> <li>Short: Minimize code duplication. A single type annotation does a lot of work. No need to duplicate models in SQLAlchemy and Pydantic.</li> </ul>"},{"location":"#sponsors","title":"Sponsors","text":""},{"location":"#sql-databases-in-readyapi","title":"SQL Databases in ReadyAPI","text":"<p>SQLDev is designed to simplify interacting with SQL databases in ReadyAPI applications, it was created by the same author. \ud83d\ude01</p> <p>It combines SQLAlchemy and Pydantic and tries to simplify the code you write as much as possible, allowing you to reduce the code duplication to a minimum, but while getting the best developer experience possible.</p> <p>SQLDev is, in fact, a thin layer on top of Pydantic and SQLAlchemy, carefully designed to be compatible with both.</p>"},{"location":"#requirements","title":"Requirements","text":"<p>A recent and currently supported version of Python.</p> <p>As SQLDev is based on Pydantic and SQLAlchemy, it requires them. They will be automatically installed when you install SQLDev.</p>"},{"location":"#installation","title":"Installation","text":"<p>Make sure you create a virtual environment, activate it, and then install SQLDev, for example with:</p> <pre><code>$ pip install sqldev\n---&gt; 100%\nSuccessfully installed sqldev\n</code></pre>"},{"location":"#example","title":"Example","text":"<p>For an introduction to databases, SQL, and everything else, see the SQLDev documentation.</p> <p>Here's a quick example. \u2728</p>"},{"location":"#a-sql-table","title":"A SQL Table","text":"<p>Imagine you have a SQL table called <code>hero</code> with:</p> <ul> <li><code>id</code></li> <li><code>name</code></li> <li><code>secret_name</code></li> <li><code>age</code></li> </ul> <p>And you want it to have this data:</p> id name secret_name age 1 Deadpond Dive Wilson null 2 Spider-Boy Pedro Parqueador null 3 Rusty-Man Tommy Sharp 48"},{"location":"#create-a-sqldev-model","title":"Create a SQLDev Model","text":"<p>Then you could create a SQLDev model like this:</p> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n</code></pre> <p>That class <code>Hero</code> is a SQLDev model, the equivalent of a SQL table in Python code.</p> <p>And each of those class attributes is equivalent to each table column.</p>"},{"location":"#create-rows","title":"Create Rows","text":"<p>Then you could create each row of the table as an instance of the model:</p> <pre><code>hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\nhero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\nhero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n</code></pre> <p>This way, you can use conventional Python code with classes and instances that represent tables and rows, and that way communicate with the SQL database.</p>"},{"location":"#editor-support","title":"Editor Support","text":"<p>Everything is designed for you to get the best developer experience possible, with the best editor support.</p> <p>Including autocompletion:</p> <p></p> <p>And inline errors:</p> <p></p>"},{"location":"#write-to-the-database","title":"Write to the Database","text":"<p>You can learn a lot more about SQLDev by quickly following the tutorial, but if you need a taste right now of how to put all that together and save to the database, you can do this:</p> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nhero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\nhero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\nhero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n\nengine = create_engine(\"sqlite:///database.db\")\n\n\nSQLDev.metadata.create_all(engine)\n\nwith Session(engine) as session:\n    session.add(hero_1)\n    session.add(hero_2)\n    session.add(hero_3)\n    session.commit()\n</code></pre> <p>That will save a SQLite database with the 3 heroes.</p>"},{"location":"#select-from-the-database","title":"Select from the Database","text":"<p>Then you could write queries to select from that same database, for example with:</p> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nengine = create_engine(\"sqlite:///database.db\")\n\nwith Session(engine) as session:\n    statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n    hero = session.exec(statement).first()\n    print(hero)\n</code></pre>"},{"location":"#editor-support-everywhere","title":"Editor Support Everywhere","text":"<p>SQLDev was carefully designed to give you the best developer experience and editor support, even after selecting data from the database:</p> <p></p>"},{"location":"#sqlalchemy-and-pydantic","title":"SQLAlchemy and Pydantic","text":"<p>That class <code>Hero</code> is a SQLDev model.</p> <p>But at the same time, \u2728 it is a SQLAlchemy model \u2728. So, you can combine it and use it with other SQLAlchemy models, or you could easily migrate applications with SQLAlchemy to SQLDev.</p> <p>And at the same time, \u2728 it is also a Pydantic model \u2728. You can use inheritance with it to define all your data models while avoiding code duplication. That makes it very easy to use with ReadyAPI.</p>"},{"location":"#license","title":"License","text":"<p>This project is licensed under the terms of the MIT license.</p>"},{"location":"alternatives/","title":"Alternatives, Inspiration and Comparisons","text":"<p>Coming soon...</p>"},{"location":"contributing/","title":"Contributing","text":"<p>First, you might want to see the basic ways to help SQLDev and get help.</p>"},{"location":"contributing/#developing","title":"Developing","text":"<p>If you already cloned the sqldev repository and you want to deep dive in the code, here are some guidelines to set up your environment.</p>"},{"location":"contributing/#virtual-environment","title":"Virtual Environment","text":"<p>Follow the instructions to create and activate a virtual environment for the internal code of <code>sqldev</code>.</p>"},{"location":"contributing/#install-requirements-using-pip","title":"Install Requirements Using <code>pip</code>","text":"<p>After activating the environment, install the required packages:</p> <pre><code>$ pip install -r requirements.txt\n\n---&gt; 100%\n</code></pre> <p>It will install all the dependencies and your local SQLDev in your local environment.</p>"},{"location":"contributing/#using-your-local-sqldev","title":"Using your Local SQLDev","text":"<p>If you create a Python file that imports and uses SQLDev, and run it with the Python from your local environment, it will use your cloned local SQLDev source code.</p> <p>And if you update that local SQLDev source code when you run that Python file again, it will use the fresh version of SQLDev you just edited.</p> <p>That way, you don't have to \"install\" your local version to be able to test every change.</p> <p>\"Technical Details\"</p> <p>This only happens when you install using this included <code>requirements.txt</code> instead of running <code>pip install sqldev</code> directly.</p> <p>That is because inside the <code>requirements.txt</code> file, the local version of SQLDev is marked to be installed in \"editable\" mode, with the <code>-e</code> option.</p>"},{"location":"contributing/#format","title":"Format","text":"<p>There is a script that you can run that will format and clean all your code:</p> <pre><code>$ bash scripts/format.sh\n</code></pre> <p>It will also auto-sort all your imports.</p>"},{"location":"contributing/#tests","title":"Tests","text":"<p>There is a script that you can run locally to test all the code and generate coverage reports in HTML:</p> <pre><code>$ bash scripts/test-cov-html.sh\n</code></pre> <p>This command generates a directory <code>./htmlcov/</code>, if you open the file <code>./htmlcov/index.html</code> in your browser, you can explore interactively the regions of code that are covered by the tests, and notice if there is any region missing.</p>"},{"location":"contributing/#docs","title":"Docs","text":"<p>First, make sure you set up your environment as described above, that will install all the requirements.</p>"},{"location":"contributing/#docs-live","title":"Docs Live","text":"<p>During local development, there is a script that builds the site and checks for any changes, live-reloading:</p> <pre><code>$ python ./scripts/docs.py live\n\n&lt;span style=\"color: green;\"&gt;[INFO]&lt;/span&gt; Serving on http://127.0.0.1:8008\n&lt;span style=\"color: green;\"&gt;[INFO]&lt;/span&gt; Start watching changes\n&lt;span style=\"color: green;\"&gt;[INFO]&lt;/span&gt; Start detecting changes\n</code></pre> <p>It will serve the documentation on <code>http://127.0.0.1:8008</code>.</p> <p>That way, you can edit the documentation/source files and see the changes live.</p> <p>Tip</p> <p>Alternatively, you can perform the same steps that scripts does manually.</p> <p>Go into the docs director at <code>docs/</code>:</p> <pre><code>$ cd docs/\n</code></pre> <p>Then run <code>mkdocs</code> in that directory:</p> <pre><code>$ mkdocs serve --dev-addr 8008\n</code></pre>"},{"location":"contributing/#cligenius-cli-optional","title":"Cligenius CLI (Optional)","text":"<p>The instructions here show you how to use the script at <code>./scripts/docs.py</code> with the <code>python</code> program directly.</p> <p>But you can also use Cligenius CLI, and you will get autocompletion in your terminal for the commands after installing completion.</p> <p>If you install Cligenius CLI, you can install completion with:</p> <pre><code>$ cligenius --install-completion\n\nzsh completion installed in /home/user/.bashrc.\nCompletion will take effect once you restart the terminal.\n</code></pre>"},{"location":"contributing/#docs-structure","title":"Docs Structure","text":"<p>The documentation uses MkDocs.</p> <p>And there are extra tools/scripts in place in <code>./scripts/docs.py</code>.</p> <p>Tip</p> <p>You don't need to see the code in <code>./scripts/docs.py</code>, you just use it in the command line.</p> <p>All the documentation is in Markdown format in the directory <code>./docs</code>.</p> <p>Many of the tutorials have blocks of code.</p> <p>In most of the cases, these blocks of code are actual complete applications that can be run as is.</p> <p>In fact, those blocks of code are not written inside the Markdown, they are Python files in the <code>./docs_src/</code> directory.</p> <p>And those Python files are included/injected in the documentation when generating the site.</p>"},{"location":"contributing/#docs-for-tests","title":"Docs for Tests","text":"<p>Most of the tests actually run against the example source files in the documentation.</p> <p>This helps to make sure that:</p> <ul> <li>The documentation is up-to-date.</li> <li>The documentation examples can be run as is.</li> <li>Most of the features are covered by the documentation, ensured by test coverage.</li> </ul>"},{"location":"databases/","title":"Intro to Databases","text":"<p>Info</p> <p>Are you a seasoned developer and already know everything about databases? \ud83e\udd13</p> <p>Then you can skip to the next sections right away.</p> <p>If you don't know everything about databases, here's a quick overview.</p> <p>You can always study much more on your own later.</p> <p>But this should help you start using databases and being productive with SQLDev. \ud83d\ude80</p>"},{"location":"databases/#what-is-a-database","title":"What is a Database","text":"<p>So, what is a database?</p> <p>A database is a system to store and manage data in a structured and very efficient way.</p> <p>Tip</p> <p>It's very common to abbreviate the word \"database\" as \"DB\".</p> <p>As there's a lot of information about databases, and it can get very technical and academic, I'll give you a quick overview about some of the main concepts here.</p> <p>I'll even tell you a bit about different types of databases, including the ones not covered by SQLDev (\"NoSQL\" databases).</p>"},{"location":"databases/#why-use-a-database","title":"Why Use a Database","text":"<p>When starting to program, it might not be obvious why having a database apart from the code for your program is a good idea. Let's start with that.</p> <p>Tip</p> <p>If that's obvious to you, just continue in the next section below. \ud83d\udc47</p> <p>In your code you already have variables, dictionaries, lists, etc. They all store data in some way already. Why would you need to have a separate database?</p> <p>If you look closely, your code is static, it doesn't really change over time once you run it. Of course, you change the code frequently, adding features, etc, but once you start Python running your code, the program stays as it was when you started it. And if you change the code, the program will only change once you run it again.</p> <p>And even if you change things in variables, once the program terminates, all that data that was in memory is gone. \ud83d\udd25</p> <p>In most of the cases, the objective of your program is to do something with data outside of the program.</p> <ul> <li>It could be just moving files from one place to the other.</li> <li>Or it could be taking data from the user in the terminal and showing it differently.</li> <li>Or a web API that takes some data and process it in some way, etc.</li> </ul> <p>In most cases, the data comes from outside the program or ends outside the program (for example, shown on the screen, in a file, etc).</p> <p>In many cases, you need your program to be able to create and store data, read it, update it, delete it, etc.</p> <p>You could do all that by reading and writing to files from your code. And that works in simple cases. But for most complex systems with data that is a bit more complex that strategy is not very efficient. And you would have to deal with a lot of caveats, keeping the data in sync, making sure it is safely stored, etc.</p> <p>Databases are designed to solve these problems, making the process of handling data much more efficient, and independent of your code. \u2728</p>"},{"location":"databases/#how-to-interact-with-a-database","title":"How to Interact with a Database","text":"<p>There are many databases of many types.</p>"},{"location":"databases/#a-single-file-database","title":"A single file database","text":"<p>A database could be a single file called <code>heroes.db</code>, managed with code in a very efficient way. An example would be SQLite, more about that on a bit.</p> <p></p>"},{"location":"databases/#a-server-database","title":"A server database","text":"<p>A database could also be a system running as an application on a server, handling multiple files internally in optimized formats.</p> <p>Like a web server, but communicating in a custom and very efficient way. That is the most common type of database interaction.</p> <p>In this case, your code would talk to this server application instead of reading or modifying files directly.</p> <p>The database could be located in a different server/machine:</p> <p></p> <p>Or the database could be located in the same server/machine:</p> <p></p> <p>The most important aspect of these types of databases is that your code doesn't read or modify the files containing the data directly.</p> <p>Instead, your code communicates with the database application and that database application is the one that actually reads and modifies its data files. This is because this database application is normally much more efficient than what your code could be.</p> <p>Some examples of databases that work like this could be PostgreSQL, MySQL, or MongoDB.</p>"},{"location":"databases/#distributed-servers","title":"Distributed servers","text":"<p>In some cases, the database could even be a group of server applications running on different machines, working together and communicating between them to be more efficient and handle more data.</p> <p>In this case, your code would talk to one or more of these server applications running on different machines.</p> <p></p> <p>Most of the databases that work as server applications also support multiple servers in one way or another.</p> <p>Having distributed systems also creates additional challenges, so there's a high chance that you would first interact with a single server application or one based on a single file.</p>"},{"location":"databases/#sql-databases","title":"SQL Databases","text":"<p>We already talked about the different ways to interact with a database and how they handle files, etc. That applies to most or all of the databases.</p> <p>But there's another way to categorize databases that is very important. As you can imagine, there are many types of databases and many databases in each group. But in general, they can be separated in two big groups: \"SQL Databases\" and \"NoSQL Databases\".</p> <p>We will get to why the name \"SQL\" in a bit, but first, let's see what is it all about.</p>"},{"location":"databases/#sqldev-for-sql-databases","title":"SQLDev for SQL Databases","text":"<p>SQLDev is a tool to help you with SQL Databases.</p> <p>It cannot help you much with NoSQL Databases. Nevertheless, I'll explain a bit about them here.</p>"},{"location":"databases/#invent-sql-databases","title":"Invent SQL Databases","text":"<p>A long time ago, some smart people realized that a great way to store data was putting it in different tables.</p> <p>And by \"table\" I mean just data in a grid, with different columns and rows, pretty much like a single spreadsheet.</p> <p>Each row would represent a specific item or record. And each column would represent a specific attribute or field of that record.</p>"},{"location":"databases/#an-example-of-a-big-table","title":"An example of a big table","text":"<p>Let's imagine that we need to store some data about heroes.</p> <p>If we worked with a single table to store our heroes, it could be like this:</p> idnamesecret_nameageteamheadquarters 1DeadpondDive WilsonnullZ-FactorSister Margaret's Bar 2Spider-BoyPedro ParqueadornullPreventersSharp Tower 3Rusty-ManTommy Sharp48PreventersSharp Tower <p>That's probably what we would have to do with a single table, for example, with a single spreadsheet.</p> <p>But there are some problems with this. Let's check some.</p>"},{"location":"databases/#single-table-problems","title":"Single table problems","text":"<p>Imagine that they decided to rename the \"Sharp Tower\" to \"Preventers Tower\".</p> <p>Now we would have to update that in two places.</p> <p>What happens if our code starts to update that name in one place and suddenly there's a power outage and the computer goes off?</p> <p>We could end up with inconsistent information, having one place saying \"Preventers Tower\" and the other one saying \"Sharp Tower\":</p> idnamesecret_nameageteamheadquarters 1DeadpondDive WilsonnullZ-ForceSister Margaret's Bar 2Spider-BoyPedro ParqueadornullPreventersPreventers Tower \u2705 3Rusty-ManTommy Sharp48PreventersSharp Tower \ud83d\udea8 <p>And now imagine that we need to add a new hero called \"Mahjong\" that is part of the team \"Z-Force\".</p> <p>We could forget the name of the team and end up adding \"Mahjong\" with an invalid team name, for example \"Y-Force\".</p> idnamesecret_nameageteamheadquarters 1DeadpondDive WilsonnullZ-ForceSister Margaret's Bar 2Spider-BoyPedro ParqueadornullPreventersPreventers Tower 3Rusty-ManTommy Sharp48PreventersSharp Tower 4MahjongNeena Thurgirl31Y-Force \ud83d\udea8Sister Margaret's Bar <p>And what if a single hero belongs to two teams? We wouldn't have an easy way to put this into a single big table.</p>"},{"location":"databases/#multiple-tables","title":"Multiple tables","text":"<p>But these and other problems could be solved better by having the data in multiple tables.</p> <p>So, instead of having a single table with all the data, we could have one table for the heroes and one for teams, and a way to connect one with the other.</p> <p>The table for the teams could look like this:</p> idnameheadquarters 1PreventersSharp Tower 2Z-ForceSister Margaret's Bar <p>Now, the table for the heroes would look almost the same. But remember that we mentioned that we need a way to connect the two tables?</p> <p>The table for the heroes would now have another column <code>team_id</code>. This column shows the relationship from each row (from each hero) to the team they belong to.</p> idnamesecret_nameageteam_id \u2728 1DeadpondDive Wilsonnull2 \u2728 2Spider-BoyPedro Parqueadornull1 \u2728 3Rusty-ManTommy Sharp481 \u2728"},{"location":"databases/#identifications-primary-key","title":"Identifications - Primary Key","text":"<p>In the example above, each one of the rows has an <code>id</code>. Each ID is unique per table and identifies that particular row.</p> <p>These SQL databases require having a unique way to identify each row in a table. It could be a combination of columns that is unique, but commonly it is just one single column. This is called the \"primary key\" of the table.</p> <p>The primary key is frequently a single column, commonly it's just an integer generated automatically by the database, and in many cases, the column is simply called <code>id</code>.</p> <p>This primary key, in this case the column <code>id</code>, has to be unique per table. But two different tables could have the same ID. For example, above, both tables have the ID <code>2</code> for two different rows, one for \"Z-Force\" in one table and one for \"Spider-Boy\" in the other table, but that's still okay as long as there's a single one per table.</p>"},{"location":"databases/#relationships-foreign-key","title":"Relationships - Foreign Key","text":"<p>Each row in a table has a single primary key (in our example a single column <code>id</code>).</p> <p>For example, the table for the teams has the ID <code>1</code> for the team <code>Preventers</code> and the ID <code>2</code> for the team <code>Z-Force</code>.</p> <p>As these primary key IDs can uniquely identify each row on the table for teams, we can now go to the table for heroes and refer to those IDs in the table for teams.</p> <p></p> <p>So, in the table for heroes, we use the <code>team_id</code> column to define a relationship to the foreign table for teams. Each value in the <code>team_id</code> column on the table with heroes will be the same value as the <code>id</code> column of one row in the table with teams.</p> <p>In the table for heroes we have a primary key that is the <code>id</code>. But we also have another column <code>team_id</code> that refers to a key in a foreign table. There's a technical term for that too, the <code>team_id</code> is a \"foreign key\".</p>"},{"location":"databases/#relations-and-relational-databases","title":"Relations and Relational Databases","text":"<p>The technical and academic term for each one of these tables is a \"relation\".</p> <p>You might hear that term a lot when talking about these databases.</p> <p>It doesn't have the meaning that you would use in English of something being related to something else, even though each of these tables is actually \"related\" to the others.</p> <p>The technical term relation just refers to each one of these tables.</p> <p>And because of this technical term, these SQL Databases are also called Relational Databases (in fact, that is the technically correct term). But it still just refers to these databases made with multiple tables.</p>"},{"location":"databases/#sql-the-language","title":"SQL - The Language","text":"<p>After developing these ideas of how to store data in multiple tables they also created a language that could be used to interact with them.</p> <p>The language is called SQL, the name comes from for Structured Query Language.</p> <p>Nevertheless, the language is not only used to query for data. It is also used to create records/rows, to update them, to delete them. And to manipulate the database, create tables, etc.</p> <p>This language is supported by all these databases that handle multiple tables, that's why they are called SQL Databases. Although, each database has small variations in the SQL language they support (dialect).</p> <p>Let's imagine that the table holding the heroes is called the <code>hero</code> table. An example of a SQL query to get all the data from it could look like:</p> <pre><code>SELECT *\nFROM hero;\n</code></pre> <p>And that SQL query would return the table:</p> idnamesecret_nameageteam_id 1DeadpondDive Wilsonnull2 2Spider-BoyPedro Parqueadornull1 3Rusty-ManTommy Sharp481"},{"location":"databases/#sqldev-for-sql","title":"SQLDev for SQL","text":"<p>SQLDev is a library that helps you write Python code with regular Python objects, and then it transfers that to SQL statements that it sends to a SQL Database.</p> <p>Next, it receives the data and puts it in Python objects that you can continue to use in your code.</p> <p>I'll tell you more about SQL, SQLDev, how to use them, and how they are related in the next sections.</p> <p>Technical Details</p> <p>SQLDev is built on top of SQLAlchemy. It is, in fact, just SQLAlchemy and Pydantic mixed together with some sugar on top.</p>"},{"location":"databases/#nosql-databases","title":"NoSQL Databases","text":"<p>Although SQL Databases are the oldest and most commonly used type of database, there's another (very interesting) category, the one of NoSQL Databases.</p> <p>NoSQL Databases covers a wide range of different sub-types, including key-value stores, document stores, graph databases, and more.</p> <p>SQLDev can only help you with SQL Databases. So, that's what we'll talk about in the rest of the documentation.</p>"},{"location":"db-to-code/","title":"Database to Code (ORMs)","text":"<p>Here I'll tell you how SQLDev interacts with the database, why you would want to use it (or use a similar tool), and how it relates to SQL.</p>"},{"location":"db-to-code/#sql-inline-in-code","title":"SQL Inline in Code","text":"<p>Let's check this example of a simple SQL query to get all the data from the <code>hero</code> table:</p> <pre><code>SELECT *\nFROM hero;\n</code></pre> <p>And that SQL query would return the table:</p> idnamesecret_nameageteam_id 1DeadpondDive Wilsonnull2 2Spider-BoyPedro Parqueadornull1 3Rusty-ManTommy Sharp481 <p>This SQL language has a little caveat. It was not designed to be mixed with normal code in a programming language like Python. \ud83d\udea8</p> <p>So, if you are working with Python, the simplest option would be to put SQL code inside a string, and send that string directly to the database.</p> <pre><code>statement = \"SELECT * FROM hero;\"\n\nresults = database.execute(statement)\n</code></pre> <p>But in that case, you wouldn't have editor support, inline errors, autocompletion, etc. Because for the editor, the SQL statement is just a string of text. If you have an error, the editor wouldn't be able to help. \ud83d\ude14</p> <p>And even more importantly, in most of the cases, you would send the SQL strings with modifications and parameters. For example, to get the data for a specific item ID, a range of dates, etc.</p> <p>And in most cases, the parameters your code uses to query or modify the data in the database come, in some way, from an external user.</p> <p>For example, check this SQL query:</p> <pre><code>SELECT *\nFROM hero\nWHERE id = 2;\n</code></pre> <p>It is using the ID parameter <code>2</code>. That number <code>2</code> probably comes, in some way, from a user input.</p> <p>The user is probably, in some way, telling your application:</p> <p>Hey, I want to get the hero with ID:</p> <pre><code>2\n</code></pre> <p>And the result would be this table (with a single row):</p> idnamesecret_nameageteam_id 2Spider-BoyPedro Parqueadornull1"},{"location":"db-to-code/#sql-injection","title":"SQL Injection","text":"<p>But let's say that your code takes whatever the external user provides and puts it inside the SQL string before sending it to the database. Something like this:</p> <pre><code># Never do this! \ud83d\udea8 Continue reading.\n\nuser_id = input(\"Type the user ID: \")\n\nstatement = f\"SELECT * FROM hero WHERE id = {user_id};\"\n\nresults = database.execute(statement)\n</code></pre> <p>If the external user is actually an attacker, they could send you a malicious SQL string that does something terrible like deleting all the records. That's called a \"SQL Injection\".</p> <p>For example, imagine that this new attacker user says:</p> <p>Hey, I want to get the hero with ID:</p> <pre><code>2; DROP TABLE hero\n</code></pre> <p>Then the code above that takes the user input and puts it in SQL would actually send this to the database:</p> <pre><code>SELECT * FROM hero WHERE id = 2; DROP TABLE hero;\n</code></pre> <p>Check that section added at the end. That's another entire SQL statement:</p> <pre><code>DROP TABLE hero;\n</code></pre> <p>That is how you tell the database in SQL to delete the entire table <code>hero</code>.</p> <p>Nooooo! We lost all the data in the <code>hero</code> table! \ud83d\udca5\ud83d\ude31</p>"},{"location":"db-to-code/#sql-sanitization","title":"SQL Sanitization","text":"<p>The process of making sure that whatever the external user sends is safe to use in the SQL string is called sanitization.</p> <p>It comes by default in SQLDev (thanks to SQLAlchemy). And many other similar tools would also provide that functionality among many other features.</p> <p>Now you are ready for a  joke from xkcd:</p> <p></p>"},{"location":"db-to-code/#sql-with-sqldev","title":"SQL with SQLDev","text":"<p>With SQLDev, instead of writing SQL statements directly, you use Python classes and objects to interact with the database.</p> <p>For example, you could ask the database for the same hero with ID <code>2</code> with this code:</p> <pre><code>user_id = input(\"Type the user ID: \")\n\nsession.exec(\n    select(Hero).where(Hero.id == user_id)\n).all()\n</code></pre> <p>If the user provides this ID:</p> <pre><code>2\n</code></pre> <p>...the result would be this table (with a single row):</p> idnamesecret_nameageteam_id 2Spider-BoyPedro Parqueadornull1"},{"location":"db-to-code/#preventing-sql-injections","title":"Preventing SQL Injections","text":"<p>If the user is an attacker and tries to send this as the \"ID\":</p> <pre><code>2; DROP TABLE hero\n</code></pre> <p>Then SQLDev will convert that to a literal string <code>\"2; DROP TABLE hero\"</code>.</p> <p>And then, it will tell the SQL Database to try to find a record with that exact ID instead of injecting the attack.</p> <p>The difference in the final SQL statement is subtle, but it changes the meaning completely:</p> <pre><code>SELECT * FROM hero WHERE id = \"2; DROP TABLE hero;\";\n</code></pre> <p>Tip</p> <p>Notice the double quotes (<code>\"</code>) making it a string instead of more raw SQL.</p> <p>The database will not find any record with that ID:</p> <pre><code>\"2; DROP TABLE hero;\"\n</code></pre> <p>Then the database will send an empty table as the result because it didn't find any record with that ID.</p> <p>Then your code will continue to execute and calmly tell the user that it couldn't find anything.</p> <p>But we never deleted the <code>hero</code> table. \ud83c\udf89</p> <p>Info</p> <p>Of course, there are also other ways to do SQL data sanitization without using a tool like SQLDev, but it's still a nice feature you get by default.</p>"},{"location":"db-to-code/#editor-support","title":"Editor Support","text":"<p>Check that Python snippet above again.</p> <p>Because we are using standard Python classes and objects, your editor will be able to provide you with autocompletion, inline errors, etc.</p> <p>For example, let's say you wanted to query the database to find a hero based on the secret identity.</p> <p>Maybe you don't remember how you named the column. Maybe it was:</p> <ul> <li><code>secret_identity</code>?</li> </ul> <p>...or was it:</p> <ul> <li><code>secretidentity</code>?</li> </ul> <p>...or:</p> <ul> <li><code>private_name</code>?</li> <li><code>secret_name</code>?</li> <li><code>secretname</code>?</li> </ul> <p>If you type that in SQL strings in your code, your editor won't be able to help you:</p> <pre><code>statement = \"SELECT * FROM hero WHERE secret_identity = 'Dive Wilson';\"\n\nresults = database.execute(statement)\n</code></pre> <p>...your editor will see that as a long string with some text inside, and it will not be able to autocomplete or detect the error in <code>secret_identity</code>.</p> <p>But if you use common Python classes and objects, your editor will be able to help you:</p> <pre><code>database.execute(\n    select(Hero).where(Hero.secret_name == \"Dive Wilson\")\n).all()\n</code></pre> <p></p>"},{"location":"db-to-code/#orms-and-sql","title":"ORMs and SQL","text":"<p>These types of libraries like SQLDev (and of course, SQLAlchemy) that translate between SQL and code with classes and objects are called ORMs.</p> <p>ORM means Object-Relational Mapper.</p> <p>This is a very common term, but it also comes from quite technical and academical concepts \ud83d\udc69\u200d\ud83c\udf93:</p> <ul> <li>Object: refers to code with classes and instances, normally called \"Object Oriented Programming\", that's why the \"Object\" part.</li> </ul> <p>For example this class is part of that Object Oriented Programming:</p> <pre><code>class Hero(SQLDev):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n</code></pre> <ul> <li>Relational: refers to the SQL Databases. Remember that they are also called Relational Databases, because each of those tables is also called a \"relation\"? That's where the \"Relational\" comes from.</li> </ul> <p>For example this Relation or table:</p> idnamesecret_nameageteam_id 1DeadpondDive Wilsonnull2 2Spider-BoyPedro Parqueadornull1 3Rusty-ManTommy Sharp481 <ul> <li>Mapper: this comes from Math, when there's something that can convert from some set of things to another, that's called a \"mapping function\". That's where the Mapper comes from.</li> </ul> <p></p> <p>We could also write a mapping function in Python that converts from the set of lowercase letters to the set of uppercase letters, like this:</p> <pre><code>def map_lower_to_upper(value: str):\n    return value.upper()\n</code></pre> <p>It's actually a simple idea with a very academic and mathematical name. \ud83d\ude05</p> <p>So, an ORM is a library that translates from SQL to code, and from code to SQL. All using classes and objects.</p> <p>There are many ORMs available apart from SQLDev, you can read more about some of them in Alternatives, Inspiration and Comparisons</p>"},{"location":"db-to-code/#sql-table-names","title":"SQL Table Names","text":"<p>Technical Background</p> <p>This is a bit of boring background for SQL purists. Feel free to skip this section. \ud83d\ude09</p> <p>When working with pure SQL, it's common to name the tables in plural. So, the table would be named <code>heroes</code> instead of <code>hero</code>, because it could contain multiple rows, each with one hero.</p> <p>Nevertheless, SQLDev and many other similar tools can generate a table name automatically from your code, as you will see later in the tutorial.</p> <p>But this name will be derived from a class name. And it's common practice to use singular names for classes (e.g. <code>class Hero</code>, instead of <code>class Heroes</code>). Using singular names for classes like <code>class Hero</code> also makes your code more intuitive.</p> <p>You will see your own code a lot more than the internal table names, so it's probably better to keep the code/class convention than the SQL convention.</p> <p>So, to keep things consistent, I'll keep using the same table names that SQLDev would have generated.</p> <p>Tip</p> <p>You can also override the table name. You can read about it in the Advanced User Guide.</p>"},{"location":"environment-variables/","title":"Environment Variables","text":"<p>Before we jump into code, let's cover a bit some of the basics that we'll need to understand how to work with Python (and programming) in general. Let's check a bit about environment variables.</p> <p>Tip</p> <p>If you already know what \"environment variables\" are and how to use them, feel free to skip this.</p> <p>An environment variable (also known as \"env var\") is a variable that lives outside of the Python code, in the operating system, and could be read by your Python code (or by other programs as well).</p> <p>Environment variables could be useful for handling application settings, as part of the installation of Python, etc.</p>"},{"location":"environment-variables/#create-and-use-env-vars","title":"Create and Use Env Vars","text":"<p>You can create and use environment variables in the shell (terminal), without needing Python:</p> Linux, macOS, Windows BashWindows PowerShell <pre><code>// You could create an env var MY_NAME with\n$ export MY_NAME=\"Wade Wilson\"\n\n// Then you could use it with other programs, like\n$ echo \"Hello $MY_NAME\"\n\nHello Wade Wilson\n</code></pre> <pre><code>// Create an env var MY_NAME\n$ $Env:MY_NAME = \"Wade Wilson\"\n\n// Use it with other programs, like\n$ echo \"Hello $Env:MY_NAME\"\n\nHello Wade Wilson\n</code></pre>"},{"location":"environment-variables/#read-env-vars-in-python","title":"Read env vars in Python","text":"<p>You could also create environment variables outside of Python, in the terminal (or with any other method), and then read them in Python.</p> <p>For example you could have a file <code>main.py</code> with:</p> <pre><code>import os\n\nname = os.getenv(\"MY_NAME\", \"World\")\nprint(f\"Hello {name} from Python\")\n</code></pre> <p>Tip</p> <p>The second argument to <code>os.getenv()</code> is the default value to return.</p> <p>If not provided, it's <code>None</code> by default, here we provide <code>\"World\"</code> as the default value to use.</p> <p>Then you could call that Python program:</p> Linux, macOS, Windows BashWindows PowerShell <pre><code>// Here we don't set the env var yet\n$ python main.py\n\n// As we didn't set the env var, we get the default value\n\nHello World from Python\n\n// But if we create an environment variable first\n$ export MY_NAME=\"Wade Wilson\"\n\n// And then call the program again\n$ python main.py\n\n// Now it can read the environment variable\n\nHello Wade Wilson from Python\n</code></pre> <pre><code>// Here we don't set the env var yet\n$ python main.py\n\n// As we didn't set the env var, we get the default value\n\nHello World from Python\n\n// But if we create an environment variable first\n$ $Env:MY_NAME = \"Wade Wilson\"\n\n// And then call the program again\n$ python main.py\n\n// Now it can read the environment variable\n\nHello Wade Wilson from Python\n</code></pre> <p>As environment variables can be set outside of the code, but can be read by the code, and don't have to be stored (committed to <code>git</code>) with the rest of the files, it's common to use them for configurations or settings.</p> <p>You can also create an environment variable only for a specific program invocation, that is only available to that program, and only for its duration.</p> <p>To do that, create it right before the program itself, on the same line:</p> <pre><code>// Create an env var MY_NAME in line for this program call\n$ MY_NAME=\"Wade Wilson\" python main.py\n\n// Now it can read the environment variable\n\nHello Wade Wilson from Python\n\n// The env var no longer exists afterwards\n$ python main.py\n\nHello World from Python\n</code></pre> <p>Tip</p> <p>You can read more about it at The Twelve-Factor App: Config.</p>"},{"location":"environment-variables/#types-and-validation","title":"Types and Validation","text":"<p>These environment variables can only handle text strings, as they are external to Python and have to be compatible with other programs and the rest of the system (and even with different operating systems, as Linux, Windows, macOS).</p> <p>That means that any value read in Python from an environment variable will be a <code>str</code>, and any conversion to a different type or any validation has to be done in code.</p>"},{"location":"environment-variables/#path-environment-variable","title":"<code>PATH</code> Environment Variable","text":"<p>There is a special environment variable called <code>PATH</code> that is used by the operating systems (Linux, macOS, Windows) to find programs to run.</p> <p>The value of the variable <code>PATH</code> is a long string that is made of directories separated by a colon <code>:</code> on Linux and macOS, and by a semicolon <code>;</code> on Windows.</p> <p>For example, the <code>PATH</code> environment variable could look like this:</p> Linux, macOSWindows <pre><code>/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin\n</code></pre> <p>This means that the system should look for programs in the directories:</p> <ul> <li><code>/usr/local/bin</code></li> <li><code>/usr/bin</code></li> <li><code>/bin</code></li> <li><code>/usr/sbin</code></li> <li><code>/sbin</code></li> </ul> <pre><code>C:\\Program Files\\Python312\\Scripts;C:\\Program Files\\Python312;C:\\Windows\\System32\n</code></pre> <p>This means that the system should look for programs in the directories:</p> <ul> <li><code>C:\\Program Files\\Python312\\Scripts</code></li> <li><code>C:\\Program Files\\Python312</code></li> <li><code>C:\\Windows\\System32</code></li> </ul> <p>When you type a command in the terminal, the operating system looks for the program in each of those directories listed in the <code>PATH</code> environment variable.</p> <p>For example, when you type <code>python</code> in the terminal, the operating system looks for a program called <code>python</code> in the first directory in that list.</p> <p>If it finds it, then it will use it. Otherwise it keeps looking in the other directories.</p>"},{"location":"environment-variables/#installing-python-and-updating-the-path","title":"Installing Python and Updating the <code>PATH</code>","text":"<p>When you install Python, you might be asked if you want to update the <code>PATH</code> environment variable.</p> Linux, macOSWindows <p>Let's say you install Python and it ends up in a directory <code>/opt/custompython/bin</code>.</p> <p>If you say yes to update the <code>PATH</code> environment variable, then the installer will add <code>/opt/custompython/bin</code> to the <code>PATH</code> environment variable.</p> <p>It could look like this:</p> <pre><code>/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/opt/custompython/bin\n</code></pre> <p>This way, when you type <code>python</code> in the terminal, the system will find the Python program in <code>/opt/custompython/bin</code> (the last directory) and use that one.</p> <p>Let's say you install Python and it ends up in a directory <code>C:\\opt\\custompython\\bin</code>.</p> <p>If you say yes to update the <code>PATH</code> environment variable, then the installer will add <code>C:\\opt\\custompython\\bin</code> to the <code>PATH</code> environment variable.</p> <pre><code>C:\\Program Files\\Python312\\Scripts;C:\\Program Files\\Python312;C:\\Windows\\System32;C:\\opt\\custompython\\bin\n</code></pre> <p>This way, when you type <code>python</code> in the terminal, the system will find the Python program in <code>C:\\opt\\custompython\\bin</code> (the last directory) and use that one.</p> <p>This way, when you type <code>python</code> in the terminal, the system will find the Python program in <code>/opt/custompython/bin</code> (the last directory) and use that one.</p> <p>So, if you type:</p> <pre><code>$ python\n</code></pre> Linux, macOSWindows <p>The system will find the <code>python</code> program in <code>/opt/custompython/bin</code> and run it.</p> <p>It would be roughly equivalent to typing:</p> <pre><code>$ /opt/custompython/bin/python\n</code></pre> <p>The system will find the <code>python</code> program in <code>C:\\opt\\custompython\\bin\\python</code> and run it.</p> <p>It would be roughly equivalent to typing:</p> <pre><code>$ C:\\opt\\custompython\\bin\\python\n</code></pre> <p>This information will be useful when learning about Virtual Environments.</p>"},{"location":"environment-variables/#conclusion","title":"Conclusion","text":"<p>With this you should have a basic understanding of what environment variables are and how to use them in Python.</p> <p>You can also read more about them in the Wikipedia for Environment Variable.</p> <p>In many cases it's not very obvious how environment variables would be useful and applicable right away. But they keep showing up in many different scenarios when you are developing, so it's good to know about them.</p> <p>For example, you will need this information in the next section, about Virtual Environments.</p>"},{"location":"features/","title":"Features","text":""},{"location":"features/#designed-for-readyapi","title":"Designed for ReadyAPI","text":"<p>SQLDev was created by the same author of ReadyAPI.</p> <p></p> <p>It follows the same design and ideas, and it was created to be the most intuitive way to interact with SQL databases in ReadyAPI applications.</p> <p>Nevertheless, SQLDev is completely independent of ReadyAPI and can be used with any other type of application. You can still benefit from its features.</p>"},{"location":"features/#just-modern-python","title":"Just Modern Python","text":"<p>It's all based on standard modern Python type annotations. No new syntax to learn. Just standard modern Python.</p> <p>If you need a 2 minute refresher of how to use Python types (even if you don't use SQLDev or ReadyAPI), check the ReadyAPI tutorial section: Python types intro.</p> <p>You will also see a 20 seconds refresher on the section Tutorial - User Guide: First Steps.</p>"},{"location":"features/#editor-support","title":"Editor support","text":"<p>SQLDev was designed to be easy and intuitive to use to ensure the best development experience, with autocompletion everywhere.</p> <p>Here's how your editor might help you:</p> <ul> <li>in Visual Studio Code:</li> </ul> <p></p> <ul> <li>in PyCharm:</li> </ul> <p></p> <p>You will get completion for everything while writing the minimum amount of code.</p> <p>You won't need to keep guessing the types of different attributes in your models, if they could be <code>None</code>, etc. Your editor will be able to help you with everything because SQLDev is based on standard Python type annotations.</p> <p>SQLDev adopts PEP 681 for Python type annotations to ensure the best developer experience, so you will get inline errors and autocompletion even while creating new model instances.</p> <p></p>"},{"location":"features/#short","title":"Short","text":"<p>SQLDev has sensible defaults for everything, with optional configurations everywhere.</p> <p>But by default, it all \"just works\".</p> <p>You can start with the simplest (and most intuitive) type annotations for your data.</p> <p>And later, you can fine-tune everything with all the power of SQLAlchemy and Pydantic.</p>"},{"location":"features/#based-on-pydantic","title":"Based on Pydantic","text":"<p>SQLDev is based on Pydantic and keeps the same design, syntax, and ideas.</p> <p>Underneath, \u2728 a SQLDev model is also a Pydantic model. \u2728</p> <p>There was a lot of research and effort dedicated to make it that way.</p> <p>That means you get all of Pydantic's features, including automatic data validation, serialization, and documentation. You can use SQLDev in the same way you can use Pydantic.</p> <p>You can even create SQLDev models that do not represent SQL tables. In that case, they would be the same as Pydantic models.</p> <p>This is useful, in particular, because now you can create a SQL database model that inherits from another non-SQL model. You can use that to reduce code duplication a lot. It will also make your code more consistent, improve editor support, etc.</p> <p>This makes it the perfect combination for working with SQL databases in ReadyAPI applications. \ud83d\ude80</p> <p>You will learn more about combining different models later in the tutorial.</p>"},{"location":"features/#based-on-sqlalchemy","title":"Based on SQLAlchemy","text":"<p>SQLDev is also based on SQLAlchemy and uses it for everything.</p> <p>Underneath, \u2728 a SQLDev model is also a SQLAlchemy model. \u2728</p> <p>There was a lot of research and effort dedicated to make it that way. In particular, there was a lot of effort and experimentation in making a single model be both a SQLAlchemy model and a Pydantic model at the same time.</p> <p>That means that you get all the power, robustness, and certainty of SQLAlchemy, the most widely used database library in Python.</p> <p>SQLDev provides its own utilities to improve the developer experience, but underneath, it uses all of SQLAlchemy.</p> <p>You can even combine SQLDev models with SQLAlchemy models.</p> <p>SQLDev is designed to satisfy the most common use cases and to be as simple and convenient as possible for those cases, providing the best developer experience.</p> <p>But when you have more exotic use cases that require more complex features, you can still plug SQLAlchemy directly into SQLDev and use all its features in your code.</p>"},{"location":"features/#tested","title":"Tested","text":"<ul> <li>100% test coverage (currently 97%, reaching 100% in the coming days/weeks).</li> <li>100% type annotated code base.</li> </ul>"},{"location":"help/","title":"Help SQLDev - Get Help","text":"<p>Do you like SQLDev?</p> <p>Would you like to help SQLDev, other users, and the author?</p> <p>Or would you like to get help with SQLDev?</p> <p>There are very simple ways to help (several involve just one or two clicks).</p> <p>And there are several ways to get help too.</p>"},{"location":"help/#subscribe-to-the-readyapi-and-friends-newsletter","title":"Subscribe to the ReadyAPI and Friends newsletter","text":"<p>You can subscribe to the (infrequent) ReadyAPI and friends newsletter to stay updated about:</p> <ul> <li>News about ReadyAPI and friends, including SQLDev \ud83d\ude80</li> <li>Guides \ud83d\udcdd</li> <li>Features \u2728</li> <li>Breaking changes \ud83d\udea8</li> <li>Tips and tricks \u2705</li> </ul>"},{"location":"help/#star-sqldev-in-github","title":"Star SQLDev in GitHub","text":"<p>You can \"star\" SQLDev in GitHub (clicking the star button at the top right): https://github.com/readyapi/sqldev. \u2b50\ufe0f</p> <p>By adding a star, other users will be able to find it more easily and see that it has been already useful for others.</p>"},{"location":"help/#watch-the-github-repository-for-releases","title":"Watch the GitHub repository for releases","text":"<p>You can \"watch\" SQLDev in GitHub (clicking the \"watch\" button at the top right): https://github.com/readyapi/sqldev. \ud83d\udc40</p> <p>There you can select \"Releases only\".</p> <p>By doing it, you will receive notifications (in your email) whenever there's a new release (a new version) of SQLDev with bug fixes and new features.</p>"},{"location":"help/#connect-with-the-author","title":"Connect with the author","text":"<p>You can connect with me (KhulnaSoft DevOps / <code>khulnasoft</code>), the author.</p> <p>You can:</p> <ul> <li>Follow me on GitHub.<ul> <li>See other Open Source projects I have created that could help you.</li> <li>Follow me to see when I create a new Open Source project.</li> </ul> </li> <li>Follow me on Twitter.<ul> <li>Tell me how you use SQLDev (I love to hear that).</li> <li>Hear when I make announcements or release new tools.</li> </ul> </li> <li>Connect with me on Linkedin.<ul> <li>Hear when I make announcements or release new tools (although I use Twitter more often \ud83e\udd37\u200d\u2642).</li> </ul> </li> <li>Read what I write (or follow me) on Dev.to or Medium.<ul> <li>Read other ideas, articles, and read about tools I have created.</li> <li>Follow me to read when I publish something new.</li> </ul> </li> </ul>"},{"location":"help/#tweet-about-sqldev","title":"Tweet about SQLDev","text":"<p>Tweet about SQLDev and let me and others know why you like it. \ud83c\udf89</p> <p>I love to hear about how SQLDev is being used, what you have liked in it, in which project/company are you using it, etc.</p>"},{"location":"help/#help-others-with-questions-in-github","title":"Help others with questions in GitHub","text":"<p>You can try and help others with their questions in:</p> <ul> <li>GitHub Discussions</li> <li>GitHub Issues</li> </ul> <p>In many cases you might already know the answer for those questions. \ud83e\udd13</p> <p>Just remember, the most important point is: try to be kind. People come with their frustrations and in many cases don't ask in the best way, but try as best as you can to be kind. \ud83e\udd17</p> <p>The idea is for the SQLDev community to be kind and welcoming. At the same time, don't accept bullying or disrespectful behavior towards others. We have to take care of each other.</p> <p>Here's how to help others with questions (in discussions or issues):</p>"},{"location":"help/#understand-the-question","title":"Understand the question","text":"<ul> <li> <p>Check if you can understand what is the purpose and use case of the person asking.</p> </li> <li> <p>Then check if the question (the vast majority are questions) is clear.</p> </li> <li> <p>In many cases the question asked is about an imaginary solution from the user, but there might be a better one. If you can understand the problem and use case better, you might be able to suggest a better alternative solution.</p> </li> <li> <p>If you can't understand the question, ask for more details.</p> </li> </ul>"},{"location":"help/#reproduce-the-problem","title":"Reproduce the problem","text":"<p>For most of the cases and most of the questions there's something related to the person's original code.</p> <p>In many cases they will only copy a fragment of the code, but that's not enough to reproduce the problem.</p> <ul> <li> <p>You can ask them to provide a minimal, reproducible, example, that you can copy-paste and run locally to see the same error or behavior they are seeing, or to understand their use case better.</p> </li> <li> <p>If you are feeling too generous, you can try to create an example like that yourself, just based on the description of the problem. Just have in mind that this might take a lot of time and it might be better to ask them to clarify the problem first.</p> </li> </ul>"},{"location":"help/#suggest-solutions","title":"Suggest solutions","text":"<ul> <li> <p>After being able to understand the question, you can give them a possible answer.</p> </li> <li> <p>In many cases, it's better to understand their underlying problem or use case, because there might be a better way to solve it than what they are trying to do.</p> </li> </ul>"},{"location":"help/#ask-to-close","title":"Ask to close","text":"<p>If they reply, there's a high chance you would have solved their problem, congrats, you're a hero! \ud83e\uddb8</p> <ul> <li> <p>Now, if that solved their problem, you can ask them to:</p> <ul> <li>In GitHub Discussions: mark the comment as the answer.</li> <li>In GitHub Issues: close the issue**.</li> </ul> </li> </ul>"},{"location":"help/#watch-the-github-repository","title":"Watch the GitHub repository","text":"<p>You can \"watch\" SQLDev in GitHub (clicking the \"watch\" button at the top right): https://github.com/readyapi/sqldev. \ud83d\udc40</p> <p>If you select \"Watching\" instead of \"Releases only\" you will receive notifications when someone creates a new issue or question. You can also specify that you only want to be notified about new issues, or discussions, or PRs, etc.</p> <p>Then you can try and help them solve those questions.</p>"},{"location":"help/#ask-questions","title":"Ask Questions","text":"<p>You can create a new question in the GitHub repository, for example to:</p> <ul> <li>Ask a question or ask about a problem.</li> <li>Suggest a new feature.</li> </ul> <p>Note: if you do it, then I'm going to ask you to also help others. \ud83d\ude09</p>"},{"location":"help/#review-pull-requests","title":"Review Pull Requests","text":"<p>You can help me review pull requests from others.</p> <p>Again, please try your best to be kind. \ud83e\udd17</p> <p>Here's what to have in mind and how to review a pull request:</p>"},{"location":"help/#understand-the-problem","title":"Understand the problem","text":"<ul> <li> <p>First, make sure you understand the problem that the pull request is trying to solve. It might have a longer discussion in a GitHub Discussion or issue.</p> </li> <li> <p>There's also a good chance that the pull request is not actually needed because the problem can be solved in a different way. Then you can suggest or ask about that.</p> </li> </ul>"},{"location":"help/#dont-worry-about-style","title":"Don't worry about style","text":"<ul> <li> <p>Don't worry too much about things like commit message styles, I will squash and merge customizing the commit manually.</p> </li> <li> <p>Also don't worry about style rules, there are already automatized tools checking that.</p> </li> </ul> <p>And if there's any other style or consistency need, I'll ask directly for that, or I'll add commits on top with the needed changes.</p>"},{"location":"help/#check-the-code","title":"Check the code","text":"<ul> <li> <p>Check and read the code, see if it makes sense, run it locally and see if it actually solves the problem.</p> </li> <li> <p>Then comment saying that you did that, that's how I will know you really checked it.</p> </li> </ul> <p>Info</p> <p>Unfortunately, I can't simply trust PRs that just have several approvals.</p> <p>Several times it has happened that there are PRs with 3, 5 or more approvals, probably because the description is appealing, but when I check the PRs, they are actually broken, have a bug, or don't solve the problem they claim to solve. \ud83d\ude05</p> <p>So, it's really important that you actually read and run the code, and let me know in the comments that you did. \ud83e\udd13</p> <ul> <li>If the PR can be simplified in a way, you can ask for that, but there's no need to be too picky, there might be a lot of subjective points of view (and I will have my own as well \ud83d\ude48), so it's better if you can focus on the fundamental things.</li> </ul>"},{"location":"help/#tests","title":"Tests","text":"<ul> <li> <p>Help me check that the PR has tests.</p> </li> <li> <p>Check that the tests fail before the PR. \ud83d\udea8</p> </li> <li> <p>Then check that the tests pass after the PR. \u2705</p> </li> <li> <p>Many PRs don't have tests, you can remind them to add tests, or you can even suggest some tests yourself. That's one of the things that consume most time and you can help a lot with that.</p> </li> <li> <p>Then also comment what you tried, that way I'll know that you checked it. \ud83e\udd13</p> </li> </ul>"},{"location":"help/#create-a-pull-request","title":"Create a Pull Request","text":"<p>You can contribute to the source code with Pull Requests, for example:</p> <ul> <li>To fix a typo you found on the documentation.</li> <li>To propose new documentation sections.</li> <li>To fix an existing issue/bug.<ul> <li>Make sure to add tests.</li> </ul> </li> <li>To add a new feature.<ul> <li>Make sure to add tests.</li> <li>Make sure to add documentation if it's relevant.</li> </ul> </li> </ul>"},{"location":"help/#help-maintain-sqldev","title":"Help Maintain SQLDev","text":"<p>Help me maintain SQLDev! \ud83e\udd13</p> <p>There's a lot of work to do, and for most of it, YOU can do it.</p> <p>The main tasks that you can do right now are:</p> <ul> <li>Help others with questions in GitHub (see the section above).</li> <li>Review Pull Requests (see the section above).</li> </ul> <p>Those two tasks are what consume time the most. That's the main work of maintaining SQLDev.</p> <p>If you can help me with that, you are helping me maintain SQLDev and making sure it keeps advancing faster and better. \ud83d\ude80</p>"},{"location":"help/#join-the-chat","title":"Join the chat","text":"<p>Join the \ud83d\udc65 ReadyAPI and Friends Discord chat server \ud83d\udc65 and hang out with others in the community. There's a <code>#sqldev</code> channel.</p> <p>Tip</p> <p>For questions, ask them in GitHub Discussions, there's a much better chance you will receive help there.</p> <p>Use the chat only for other general conversations.</p>"},{"location":"help/#dont-use-the-chat-for-questions","title":"Don't use the chat for questions","text":"<p>Have in mind that as chats allow more \"free conversation\", it's easy to ask questions that are too general and more difficult to answer, so, you might not receive answers.</p> <p>In GitHub, the template will guide you to write the right question so that you can more easily get a good answer, or even solve the problem yourself even before asking. And in GitHub I can make sure I always answer everything, even if it takes some time. I can't personally do that with the chat. \ud83d\ude05</p> <p>Conversations in the chat are also not as easily searchable as in GitHub, so questions and answers might get lost in the conversation.</p> <p>On the other side, there are thousands of users in the chat, so there's a high chance you'll find someone to talk to there, almost all the time. \ud83d\ude04</p>"},{"location":"help/#sponsor-the-author","title":"Sponsor the author","text":"<p>You can also financially support the author (me) through GitHub sponsors.</p> <p>There you could buy me a coffee \u2615\ufe0f to say thanks. \ud83d\ude04</p>"},{"location":"help/#sponsor-the-tools-that-power-sqldev","title":"Sponsor the tools that power SQLDev","text":"<p>As you have seen in the documentation, SQLDev stands on the shoulders of giants, Pydantic and SQLAlchemy.</p> <p>You can also sponsor:</p> <ul> <li>Samuel Colvin (Pydantic)</li> <li>SQLAlchemy</li> </ul> <p>Thanks! \ud83d\ude80</p>"},{"location":"install/","title":"Install SQLDev","text":"<p>Create a project directory, create a virtual environment, activate it, and then install SQLDev, for example with:</p> <pre><code>$ pip install sqldev\n---&gt; 100%\nSuccessfully installed sqldev pydantic sqlalchemy\n</code></pre> <p>As SQLDev is built on top of SQLAlchemy and Pydantic, when you install <code>sqldev</code> they will also be automatically installed.</p>"},{"location":"install/#install-db-browser-for-sqlite","title":"Install DB Browser for SQLite","text":"<p>Remember that SQLite is a simple database in a single file?</p> <p>For most of the tutorial I'll use SQLite for the examples.</p> <p>Python has integrated support for SQLite, it is a single file read and processed from Python. And it doesn't need an External Database Server, so it will be perfect for learning.</p> <p>In fact, SQLite is perfectly capable of handling quite big applications. At some point you might want to migrate to a server-based database like PostgreSQL (which is also free). But for now we'll stick to SQLite.</p> <p>Through the tutorial I will show you SQL fragments, and Python examples. And I hope (and expect \ud83e\uddd0) you to actually run them, and verify that the database is working as expected and showing you the same data.</p> <p>To be able to explore the SQLite file yourself, independent of Python code (and probably at the same time), I recommend you use DB Browser for SQLite.</p> <p>It's a great and simple program to interact with SQLite databases (SQLite files) in a nice user interface.</p> <p></p> <p>Go ahead and Install DB Browser for SQLite, it's free.</p>"},{"location":"install/#next-steps","title":"Next Steps","text":"<p>Okay, let's get going! On the next section we'll start the Tutorial - User Guide. \ud83d\ude80</p>"},{"location":"management-tasks/","title":"Repository Management Tasks","text":"<p>These are the tasks that can be performed to manage the SQLDev repository by team members.</p> <p>Tip</p> <p>This section is useful only to a handful of people, team members with permissions to manage the repository. You can probably skip it. \ud83d\ude09</p> <p>...so, you are a team member of SQLDev? Wow, you are so cool! \ud83d\ude0e</p> <p>You can help with everything on Help SQLDev - Get Help the same ways as external contributors. But additionally, there are some tasks that only you (as part of the team) can perform.</p> <p>Here are the general instructions for the tasks you can perform.</p> <p>Thanks a lot for your help. \ud83d\ude47</p>"},{"location":"management-tasks/#be-nice","title":"Be Nice","text":"<p>First of all, be nice. \ud83d\ude0a</p> <p>You probably are super nice if you were added to the team, but it's worth mentioning it. \ud83e\udd13</p>"},{"location":"management-tasks/#when-things-are-difficult","title":"When Things are Difficult","text":"<p>When things are great, everything is easier, so that doesn't need much instructions. But when things are difficult, here are some guidelines.</p> <p>Try to find the good side. In general, if people are not being unfriendly, try to thank their effort and interest, even if you disagree with the main subject (discussion, PR), just thank them for being interested in the project, or for having dedicated some time to try to do something.</p> <p>It's difficult to convey emotion in text, use emojis to help. \ud83d\ude05</p> <p>In discussions and PRs, in many cases, people bring their frustration and show it without filter, in many cases exaggerating, complaining, being entitled, etc. That's really not nice, and when it happens, it lowers our priority to solve their problems. But still, try to breath, and be gentle with your answers.</p> <p>Try to avoid using bitter sarcasm or potentially passive-aggressive comments. If something is wrong, it's better to be direct (try to be gentle) than sarcastic.</p> <p>Try to be as specific and objective as possible, avoid generalizations.</p> <p>For conversations that are more difficult, for example to reject a PR, you can ask me (@khulnasoft) to handle it directly.</p>"},{"location":"management-tasks/#edit-pr-titles","title":"Edit PR Titles","text":"<ul> <li>Edit the PR title to start with an emoji from gitmoji.<ul> <li>Use the emoji character, not the GitHub code. So, use <code>\ud83d\udc1b</code> instead of <code>:bug:</code>. This is so that it shows up correctly outside of GitHub, for example in the release notes.</li> </ul> </li> <li>Start the title with a verb. For example <code>Add</code>, <code>Refactor</code>, <code>Fix</code>, etc. This way the title will say the action that the PR does. Like <code>Add support for teleporting</code>, instead of <code>Teleporting wasn't working, so this PR fixes it</code>.</li> <li>Edit the text of the PR title to start in \"imperative\", like giving an order. So, instead of <code>Adding support for teleporting</code> use <code>Add support for teleporting</code>.</li> <li>Try to make the title descriptive about what it achieves. If it's a feature, try to describe it, for example <code>Add support for teleporting</code> instead of <code>Create TeleportAdapter class</code>.</li> <li>Do not finish the title with a period (<code>.</code>).</li> </ul> <p>Once the PR is merged, a GitHub Action (latest-changes) will use the PR title to update the latest changes automatically.</p> <p>So, having a nice PR title will not only look nice in GitHub, but also in the release notes. \ud83d\udcdd</p>"},{"location":"management-tasks/#add-labels-to-prs","title":"Add Labels to PRs","text":"<p>The same GitHub Action latest-changes uses one label in the PR to decide the section in the release notes to put this PR in.</p> <p>Make sure you use a supported label from the latest-changes list of labels:</p> <ul> <li><code>breaking</code>: Breaking Changes<ul> <li>Existing code will break if they update the version without changing their code. This rarely happens, so this label is not frequently used.</li> </ul> </li> <li><code>security</code>: Security Fixes<ul> <li>This is for security fixes, like vulnerabilities. It would almost never be used.</li> </ul> </li> <li><code>feature</code>: Features<ul> <li>New features, adding support for things that didn't exist before.</li> </ul> </li> <li><code>bug</code>: Fixes<ul> <li>Something that was supported didn't work, and this fixes it. There are many PRs that claim to be bug fixes because the user is doing something in an unexpected way that is not supported, but they considered it what should be supported by default. Many of these are actually features or refactors. But in some cases there's an actual bug.</li> </ul> </li> <li><code>refactor</code>: Refactors<ul> <li>This is normally for changes to the internal code that don't change the behavior. Normally it improves maintainability, or enables future features, etc.</li> </ul> </li> <li><code>upgrade</code>: Upgrades<ul> <li>This is for upgrades to direct dependencies from the project, or extra optional dependencies, normally in <code>pyproject.toml</code>. So, things that would affect final users, they would end up receiving the upgrade in their code base once they update. But this is not for upgrades to internal dependencies used for development, testing, docs, etc. Those internal dependencies, normally in <code>requirements.txt</code> files or GitHub Action versions should be marked as <code>internal</code>, not <code>upgrade</code>.</li> </ul> </li> <li><code>docs</code>: Docs<ul> <li>Changes in docs. This includes updating the docs, fixing typos. But it doesn't include changes to translations.</li> <li>You can normally quickly detect it by going to the \"Files changed\" tab in the PR and checking if the updated file(s) starts with <code>docs/en/docs</code>. The original version of the docs is always in English, so in <code>docs/en/docs</code>.</li> </ul> </li> <li><code>internal</code>: Internal<ul> <li>Use this for changes that only affect how the repo is managed. For example upgrades to internal dependencies, changes in GitHub Actions or scripts, etc.</li> </ul> </li> </ul> <p>Tip</p> <p>Some tools like Dependabot, will add some labels, like <code>dependencies</code>, but have in mind that this label is not used by the <code>latest-changes</code> GitHub Action, so it won't be used in the release notes. Please make sure one of the labels above is added.</p>"},{"location":"management-tasks/#review-prs","title":"Review PRs","text":"<p>If a PR doesn't explain what it does or why, ask for more information.</p> <p>A PR should have a specific use case that it is solving.</p> <ul> <li>If the PR is for a feature, it should have docs.<ul> <li>Unless it's a feature we want to discourage, like support for a corner case that we don't want users to use.</li> </ul> </li> <li>The docs should include a source example file, not write Python directly in Markdown.</li> <li>If the source example(s) file can have different syntax for Python 3.8, 3.9, 3.10, there should be different versions of the file, and they should be shown in tabs in the docs.</li> <li>There should be tests testing the source example.</li> <li>Before the PR is applied, the new tests should fail.</li> <li>After applying the PR, the new tests should pass.</li> <li>Coverage should stay at 100%.</li> <li>If you see the PR makes sense, or we discussed it and considered it should be accepted, you can add commits on top of the PR to tweak it, to add docs, tests, format, refactor, remove extra files, etc.</li> <li>Feel free to comment in the PR to ask for more information, to suggest changes, etc.</li> <li>Once you think the PR is ready, move it in the internal GitHub project for me to review it.</li> </ul>"},{"location":"management-tasks/#dependabot-prs","title":"Dependabot PRs","text":"<p>Dependabot will create PRs to update dependencies for several things, and those PRs all look similar, but some are way more delicate than others.</p> <ul> <li>If the PR is for a direct dependency, so, Dependabot is modifying <code>pyproject.toml</code>, don't merge it. \ud83d\ude31 Let me check it first. There's a good chance that some additional tweaks or updates are needed.</li> <li>If the PR updates one of the internal dependencies, for example it's modifying <code>requirements.txt</code> files, or GitHub Action versions, if the tests are passing, the release notes (shown in a summary in the PR) don't show any obvious potential breaking change, you can merge it. \ud83d\ude0e</li> </ul>"},{"location":"management-tasks/#mark-github-discussions-answers","title":"Mark GitHub Discussions Answers","text":"<p>When a question in GitHub Discussions has been answered, mark the answer by clicking \"Mark as answer\".</p> <p>Many of the current Discussion Questions were migrated from old issues. Many have the label <code>answered</code>, that means they were answered when they were issues, but now in GitHub Discussions, it's not known what is the actual response from the messages.</p> <p>You can filter discussions by <code>Questions</code> that are <code>Unanswered</code>.</p>"},{"location":"management/","title":"Repository Management","text":"<p>Here's a short description of how the SQLDev repository is managed and maintained.</p>"},{"location":"management/#owner","title":"Owner","text":"<p>I, @khulnasoft, am the creator and owner of the SQLDev repository. \ud83e\udd13</p> <p>I normally give the final review to each PR before merging them. I make the final decisions on the project, I'm the BDFL. \ud83d\ude05</p>"},{"location":"management/#team","title":"Team","text":"<p>There's a team of people that help manage and maintain the project. \ud83d\ude0e</p> <p>They have different levels of permissions and specific instructions.</p> <p>Some of the tasks they can perform include:</p> <ul> <li>Adding labels to PRs.</li> <li>Editing PR titles.</li> <li>Adding commits on top of PRs to tweak them.</li> <li>Mark answers in GitHub Discussions questions, etc.</li> <li>Merge some specific types of PRs.</li> </ul> <p>Joining the team is by invitation only, and I could update or remove permissions, instructions, or membership.</p>"},{"location":"management/#team-members","title":"Team Members","text":"<p>This is the current list of team members. \ud83d\ude0e</p> @khulnasoft @estebanx64 @alejsdev <p>Additional to them, there's a large community of people helping each other and getting involved in the projects in different ways.</p>"},{"location":"management/#external-contributions","title":"External Contributions","text":"<p>External contributions are very welcome and appreciated, including answering questions, submitting PRs, etc. \ud83d\ude47\u200d\u2642\ufe0f</p> <p>There are many ways to help maintain SQLDev.</p>"},{"location":"release-notes/","title":"Release Notes","text":""},{"location":"release-notes/#latest-changes","title":"Latest Changes","text":""},{"location":"release-notes/#docs","title":"Docs","text":"<ul> <li>\ud83d\udcdd Remove highlights in <code>indexes.md</code> . PR #1100 by @alejsdev.</li> </ul>"},{"location":"release-notes/#internal","title":"Internal","text":"<ul> <li>\ud83d\udc77 Update <code>issue-manager.yml</code>. PR #1103 by @khulnasoft.</li> <li>\ud83d\udc77 Fix coverage processing in CI, one name per matrix run. PR #1104 by @khulnasoft.</li> <li>\ud83d\udc9a Set <code>include-hidden-files</code> to <code>True</code> when using the <code>upload-artifact</code> GH action. PR #1098 by @svlandeg.</li> <li>\u2b06 [pre-commit.ci] pre-commit autoupdate. PR #1088 by @pre-commit-ci[bot].</li> </ul>"},{"location":"release-notes/#0022","title":"0.0.22","text":""},{"location":"release-notes/#fixes","title":"Fixes","text":"<ul> <li>\ud83d\udc1b Fix support for types with <code>Optional[Annotated[x, f()]]</code>, e.g. <code>id: Optional[pydantic.UUID4]</code>. PR #1093 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#docs_1","title":"Docs","text":"<ul> <li>\u270f\ufe0f Fix a typo in <code>docs/virtual-environments.md</code>. PR #1085 by @khulnasoft.</li> <li>\ud83d\udcdd Add docs for virtual environments and environment variables, update contributing. PR #1082 by @khulnasoft.</li> <li>\ud83d\udcdd Add docs about repo management and team. PR #1059 by @khulnasoft.</li> <li>\u270f\ufe0f Fix typo in <code>cascade_delete</code> docs. PR #1030 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#internal_1","title":"Internal","text":"<ul> <li>\u2705 Refactor test_enums to make them independent of previous imports. PR #1095 by @khulnasoft.</li> <li>\ud83d\udc77 Update <code>latest-changes</code> GitHub Action. PR #1087 by @khulnasoft.</li> <li>\u2b06 [pre-commit.ci] pre-commit autoupdate. PR #1028 by @pre-commit-ci[bot].</li> <li>\u2b06 Bump ruff from 0.4.7 to 0.6.2. PR #1081 by @dependabot[bot].</li> <li>\ud83d\udd27 Update lint script. PR #1084 by @khulnasoft.</li> <li>\ud83d\udc77 Update Python version for coverage. PR #1083 by @khulnasoft.</li> <li>\ud83d\udd27 Update coverage config files. PR #1077 by @khulnasoft.</li> <li>\ud83d\udd27 Add URLs to <code>pyproject.toml</code>, show up in PyPI. PR #1074 by @khulnasoft.</li> <li>\ud83d\udc77 Do not sync labels as it overrides manually added labels. PR #1073 by @khulnasoft.</li> <li>\ud83d\udc77 Update configs for GitHub Action labeler, to add only one label. PR #1072 by @khulnasoft.</li> <li>\ud83d\udc77 Update labeler GitHub Actions permissions and dependencies. PR #1071 by @khulnasoft.</li> <li>\ud83d\udc77 Add GitHub Action label-checker. PR #1069 by @khulnasoft.</li> <li>\ud83d\udc77 Add GitHub Action labeler. PR #1068 by @khulnasoft.</li> <li>\ud83d\udc77 Update GitHub Action add-to-project. PR #1067 by @khulnasoft.</li> <li>\ud83d\udc77 Add GitHub Action add-to-project. PR #1066 by @khulnasoft.</li> <li>\ud83d\udcdd Update admonitions in annotations. PR #1065 by @khulnasoft.</li> <li>\ud83d\udcdd Update links from github.com/khulnasoft/sqldev to github.com/readyapi/sqldev. PR #1064 by @khulnasoft.</li> <li>\ud83d\udd27 Update members. PR #1063 by @khulnasoft.</li> <li>\ud83d\udc84 Add dark-mode logo. PR #1061 by @khulnasoft.</li> <li>\ud83d\udd28 Update docs.py script to enable dirty reload conditionally. PR #1060 by @khulnasoft.</li> <li>\ud83d\udd27 Update MkDocs previews. PR #1058 by @khulnasoft.</li> <li>\ud83d\udc84 Update Termynal line-height. PR #1057 by @khulnasoft.</li> <li>\ud83d\udc77 Upgrade build docs configs. PR #1047 by @khulnasoft.</li> <li>\ud83d\udc77 Add alls-green for test-redistribute. PR #1055 by @khulnasoft.</li> <li>\ud83d\udc77 Update docs-previews to handle no docs changes. PR #1056 by @khulnasoft.</li> <li>\ud83d\udc77\ud83c\udffb Show docs deployment status and preview URLs in comment. PR #1054 by @khulnasoft.</li> <li>\ud83d\udd27 Enable auto dark mode. PR #1046 by @khulnasoft.</li> <li>\ud83d\udc77 Update issue-manager. PR #1045 by @khulnasoft.</li> <li>\ud83d\udc77 Update issue-manager.yml GitHub Action permissions. PR #1040 by @khulnasoft.</li> <li>\u267b\ufe0f Refactor Deploy Docs GitHub Action to be a script and update token preparing for org. PR #1039 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#0021","title":"0.0.21","text":""},{"location":"release-notes/#features","title":"Features","text":"<ul> <li>\u2728 Add support for cascade delete relationships: <code>cascade_delete</code>, <code>ondelete</code>, and <code>passive_deletes</code>. Initial PR #983 by @estebanx64.</li> <li>New docs at: Cascade Delete Relationships.</li> </ul>"},{"location":"release-notes/#docs_2","title":"Docs","text":"<ul> <li>\ud83d\udcdd Update docs . PR #1003 by @alejsdev.</li> </ul>"},{"location":"release-notes/#internal_2","title":"Internal","text":"<ul> <li>\u2b06 Bump actions/cache from 3 to 4. PR #783 by @dependabot[bot].</li> <li>\u2b06 Bump cairosvg from 2.7.0 to 2.7.1. PR #919 by @dependabot[bot].</li> <li>\u2b06 Bump jinja2 from 3.1.3 to 3.1.4. PR #974 by @dependabot[bot].</li> <li>\u2b06 Bump pypa/gh-action-pypi-publish from 1.8.11 to 1.9.0. PR #987 by @dependabot[bot].</li> <li>\u2b06 Bump mkdocstrings[python] from 0.23.0 to 0.25.1. PR #927 by @dependabot[bot].</li> <li>\u2b06 Bump dorny/paths-filter from 2 to 3. PR #972 by @dependabot[bot].</li> </ul>"},{"location":"release-notes/#0020","title":"0.0.20","text":""},{"location":"release-notes/#features_1","title":"Features","text":"<ul> <li>\u2728 Add official UUID support, docs and tests, internally using new SQLAlchemy 2.0 types. Initial PR #992 by @estebanx64.</li> <li>New docs in the Advanced User Guide: UUID (Universally Unique Identifiers).</li> </ul>"},{"location":"release-notes/#docs_3","title":"Docs","text":"<ul> <li>\u270f\ufe0f Fix internal link in <code>docs/tutorial/create-db-and-table.md</code>. PR #911 by @tfpgh.</li> <li>\u270f\ufe0f Add missing step in <code>create-db-and-table-with-db-browser.md</code>. PR #976 by @alejsdev.</li> <li>\u270f\ufe0f Fix typo in <code>docs/tutorial</code>. PR #943 by @luco17.</li> <li>\u270f\ufe0f Fix typo in <code>sqldev/_compat.py</code>. PR #950 by @Highfire1.</li> <li>\u270f\ufe0f Update pip installation command in tutorial. PR #975 by @alejsdev.</li> <li>\u270f\ufe0f Fix typo in <code>docs/tutorial/relationship-attributes/index.md</code>. PR #880 by @UncleGoogle.</li> </ul>"},{"location":"release-notes/#internal_3","title":"Internal","text":"<ul> <li>\u2b06 [pre-commit.ci] pre-commit autoupdate. PR #979 by @pre-commit-ci[bot].</li> <li>\ud83d\udd28 Update docs Termynal scripts to not include line nums for local dev. PR #1018 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#0019","title":"0.0.19","text":""},{"location":"release-notes/#fixes_1","title":"Fixes","text":"<ul> <li>\ud83d\udc1b Fix pydantic <code>EmailStr</code> support and <code>max_length</code> in several String subclasses. PR #966 by @estebanx64.</li> <li>\ud83d\udc1b Fix set varchar limit when <code>max_length</code> is set on Pydantic models using Pydantic v2. PR #963 by @estebanx64.</li> </ul>"},{"location":"release-notes/#refactors","title":"Refactors","text":"<ul> <li>\u267b\ufe0f Refactor generate select template to isolate templated code to the minimum. PR #967 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#upgrades","title":"Upgrades","text":"<ul> <li>\u2b06\ufe0f Update minimum SQLAlchemy version to 2.0.14 as that one includes <code>TryCast</code> used internally. PR #964 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#docs_4","title":"Docs","text":"<ul> <li>\u270f\ufe0f Fix broken link to <code>@dataclass_transform</code> (now PEP 681) in <code>docs/features.md</code>. PR #753 by @soof-golan.</li> </ul>"},{"location":"release-notes/#internal_4","title":"Internal","text":"<ul> <li>\u2b06\ufe0f Upgrade Ruff and Black. PR #968 by @khulnasoft.</li> <li>\u2b06 Bump khulnasoft/issue-manager from 0.4.1 to 0.5.0. PR #922 by @dependabot[bot].</li> <li>\ud83d\udccc Pin typing-extensions in tests for compatiblity with Python 3.8, dirty-equals, Pydantic. PR #965 by @khulnasoft.</li> <li>\ud83d\udc77 Update GitHub Actions to download and upload artifacts. PR #936 by @khulnasoft.</li> <li>\ud83d\udc77 Tweak CI for test-redistribute, add needed env vars for slim. PR #929 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#0018","title":"0.0.18","text":""},{"location":"release-notes/#internal_5","title":"Internal","text":"<ul> <li>\u2728 Add <code>sqldev-slim</code> setup. PR #916 by @khulnasoft.</li> </ul> <p>In the future SQLDev will include the standard default recommended packages, and <code>sqldev-slim</code> will come without those recommended standard packages and with a group of optional dependencies <code>sqldev-slim[standard]</code>, equivalent to <code>sqldev</code>, for those that want to opt out of those packages.</p> <ul> <li>\ud83d\udd27 Re-enable MkDocs Material Social plugin. PR #915 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#0017","title":"0.0.17","text":""},{"location":"release-notes/#refactors_1","title":"Refactors","text":"<ul> <li>\u267b\ufe0f Refactor types to properly support Pydantic 2.7. PR #913 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#docs_5","title":"Docs","text":"<ul> <li>\ud83d\udcdd Update ModelRead to ModelPublic documentation and examples. PR #885 by @estebanx64.</li> <li>\u2728 Add source examples for Python 3.10 and 3.9 with updated syntax. PR #842 by @khulnasoft and @estebanx64.</li> </ul>"},{"location":"release-notes/#internal_6","title":"Internal","text":"<ul> <li>\u2b06 Bump actions/setup-python from 4 to 5. PR #733 by @dependabot[bot].</li> <li>\ud83d\udd28 Update internal scripts and remove unused ones. PR #914 by @khulnasoft.</li> <li>\ud83d\udd27 Migrate from Poetry to PDM for the internal build config. PR #912 by @khulnasoft.</li> <li>\ud83d\udd27 Update MkDocs, disable cards while I can upgrade to the latest MkDocs Material, that fixes an issue with social cards. PR #888 by @khulnasoft.</li> <li>\ud83d\udc77 Add cron to run test once a week on monday. PR #869 by @estebanx64.</li> <li>\u2b06\ufe0f Upgrade Ruff version and configs. PR #859 by @khulnasoft.</li> <li>\ud83d\udd25 Remove Jina QA Bot as it has been discontinued. PR #840 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#0016","title":"0.0.16","text":""},{"location":"release-notes/#features_2","title":"Features","text":"<ul> <li>\u2728 Add new method <code>.sqldev_update()</code> to update models in place, including an <code>update</code> parameter for extra data. And fix implementation for the (now documented) <code>update</code> parameter for <code>.model_validate()</code>. PR #804 by @khulnasoft.<ul> <li>Updated docs: Update Data with ReadyAPI.</li> <li>New docs: Update with Extra Data (Hashed Passwords) with ReadyAPI.</li> </ul> </li> </ul>"},{"location":"release-notes/#0015","title":"0.0.15","text":""},{"location":"release-notes/#fixes_2","title":"Fixes","text":"<ul> <li>\ud83d\udc1b Fix class initialization compatibility with Pydantic and SQLDev, fixing errors revealed by the latest Pydantic. PR #807 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#internal_7","title":"Internal","text":"<ul> <li>\u2b06 Bump khulnasoft/issue-manager from 0.4.0 to 0.4.1. PR #775 by @dependabot[bot].</li> <li>\ud83d\udc77 Fix GitHub Actions build docs filter paths for GitHub workflows. PR #738 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#0014","title":"0.0.14","text":""},{"location":"release-notes/#features_3","title":"Features","text":"<ul> <li>\u2728 Add support for Pydantic v2 (while keeping support for v1 if v2 is not available). PR #722 by @khulnasoft including initial work in PR #699 by @AntonDeMeester.</li> </ul>"},{"location":"release-notes/#0013","title":"0.0.13","text":""},{"location":"release-notes/#fixes_3","title":"Fixes","text":"<ul> <li>\u267b\ufe0f Refactor type generation of selects re-order to prioritize models to optimize editor support. PR #718 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#refactors_2","title":"Refactors","text":"<ul> <li>\ud83d\udd07 Do not raise deprecation warnings for execute as it's automatically used internally. PR #716 by @khulnasoft.</li> <li>\u2705 Move OpenAPI tests inline to simplify updating them with Pydantic v2. PR #709 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#upgrades_1","title":"Upgrades","text":"<ul> <li>\u2b06\ufe0f Add support for Python 3.11 and Python 3.12. PR #710 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#docs_6","title":"Docs","text":"<ul> <li>\u270f\ufe0f Fix typo, simplify single quote/apostrophe character in \"Sister Margaret's\" everywhere in the docs. PR #721 by @khulnasoft.</li> <li>\ud83d\udcdd Update docs for Decimal, use proper types. PR #719 by @khulnasoft.</li> <li>\ud83d\udcdd Add source examples for Python 3.9 and 3.10. PR #715 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#internal_8","title":"Internal","text":"<ul> <li>\ud83d\ude48 Update gitignore, include all coverage files. PR #711 by @khulnasoft.</li> <li>\ud83d\udd27 Update config with new pymdown extensions. PR #712 by @khulnasoft.</li> <li>\ud83d\udd27 Update docs build setup, add support for sponsors, add sponsor GOVCERT.LU. PR #720 by @khulnasoft.</li> <li>\u2b06 [pre-commit.ci] pre-commit autoupdate. PR #697 by @pre-commit-ci[bot].</li> <li>\ud83d\udd27 Show line numbers in docs during local development. PR #714 by @khulnasoft.</li> <li>\ud83d\udcdd Update details syntax with new pymdown extensions format. PR #713 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#0012","title":"0.0.12","text":""},{"location":"release-notes/#features_4","title":"Features","text":"<ul> <li>\u2728 Upgrade SQLAlchemy to 2.0. PR #700 by @khulnasoft including initial work in PR #563 by @farahats9.</li> </ul>"},{"location":"release-notes/#internal_9","title":"Internal","text":"<ul> <li>\u2b06 [pre-commit.ci] pre-commit autoupdate. PR #686 by @pre-commit-ci[bot].</li> <li>\ud83d\udc77 Upgrade latest-changes GitHub Action. PR #693 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#0011","title":"0.0.11","text":""},{"location":"release-notes/#features_5","title":"Features","text":"<ul> <li>\u2728 Add support for passing a custom SQLAlchemy type to <code>Field()</code> with <code>sa_type</code>. PR #505 by @maru0123-2004.<ul> <li>You might consider this a breaking change if you were using an incompatible combination of arguments, those arguments were not taking effect and now you will have a type error and runtime error telling you that.</li> </ul> </li> <li>\u2728 Do not allow invalid combinations of field parameters for columns and relationships, <code>sa_column</code> excludes <code>sa_column_args</code>, <code>primary_key</code>, <code>nullable</code>, etc. PR #681 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#docs_7","title":"Docs","text":"<ul> <li>\ud83c\udfa8 Update inline source examples, hide <code>#</code> in annotations (from MkDocs Material). PR #677 by @Matthieu-LAURENT39.</li> </ul>"},{"location":"release-notes/#internal_10","title":"Internal","text":"<ul> <li>\u2b06 Update coverage requirement from ^6.2 to &gt;=6.2,&lt;8.0. PR #663 by @dependabot[bot].</li> <li>\u2b06 Update mkdocs-material requirement from 9.1.21 to 9.2.7. PR #675 by @dependabot[bot].</li> <li>\u2b06\ufe0f Upgrade mypy manually. PR #684 by @khulnasoft.</li> <li>\u2b06 Update black requirement from ^22.10.0 to &gt;=22.10,&lt;24.0. PR #664 by @dependabot[bot].</li> <li>\ud83d\udc77 Update CI to build MkDocs Insiders only when the secrets are available, for Dependabot. PR #683 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#0010","title":"0.0.10","text":""},{"location":"release-notes/#features_6","title":"Features","text":"<ul> <li>\u2728 Add support for all <code>Field</code> parameters from Pydantic <code>1.9.0</code> and above, make Pydantic <code>1.9.0</code> the minimum required version. PR #440 by @daniil-berg.</li> </ul>"},{"location":"release-notes/#internal_11","title":"Internal","text":"<ul> <li>\ud83d\udd27 Adopt Ruff for formatting. PR #679 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#009","title":"0.0.9","text":""},{"location":"release-notes/#breaking-changes","title":"Breaking Changes","text":"<ul> <li>\ud83d\uddd1\ufe0f Deprecate Python 3.6 and upgrade Poetry and Poetry Version Plugin. PR #627 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#features_7","title":"Features","text":"<ul> <li>\u2728 Raise a more clear error when a type is not valid. PR #425 by @ddanier.</li> </ul>"},{"location":"release-notes/#fixes_4","title":"Fixes","text":"<ul> <li>\ud83d\udc1b Fix <code>AsyncSession</code> type annotations for <code>exec()</code>. PR #58 by @Bobronium.</li> <li>\ud83d\udc1b Fix allowing using a <code>ForeignKey</code> directly, remove repeated column construction from <code>SQLDevMetaclass.__init__</code> and upgrade minimum SQLAlchemy to <code>&gt;=1.4.36</code>. PR #443 by @daniil-berg.</li> <li>\ud83d\udc1b Fix enum type checks ordering in <code>get_sqlalchemy_type</code>. PR #669 by @khulnasoft.</li> <li>\ud83d\udc1b Fix SQLAlchemy version 1.4.36 breaks SQLDev relationships (#315). PR #461 by @byrman.</li> </ul>"},{"location":"release-notes/#upgrades_2","title":"Upgrades","text":"<ul> <li>\u2b06\ufe0f Upgrade support for SQLAlchemy 1.4.49, update tests. PR #519 by @sandrotosi.</li> <li>\u2b06 Raise SQLAlchemy version requirement to at least <code>1.4.29</code> (related to #434). PR #439 by @daniil-berg.</li> </ul>"},{"location":"release-notes/#docs_8","title":"Docs","text":"<ul> <li>\ud83d\udcdd Clarify description of in-memory SQLite database in <code>docs/tutorial/create-db-and-table.md</code>. PR #601 by @SimonCW.</li> <li>\ud83d\udcdd Tweak wording in <code>docs/tutorial/readyapi/multiple-models.md</code>. PR #674 by @khulnasoft.</li> <li>\u270f\ufe0f Fix contributing instructions to run tests, update script name. PR #634 by @PookieBuns.</li> <li>\ud83d\udcdd Update link to docs for intro to databases. PR #593 by @abenezerBelachew.</li> <li>\ud83d\udcdd Update docs, use <code>offset</code> in example with <code>limit</code> and <code>where</code>. PR #273 by @jbmchuck.</li> <li>\ud83d\udcdd Fix docs for Pydantic's fields using <code>le</code> (<code>lte</code> is invalid, use <code>le</code> ). PR #207 by @jrycw.</li> <li>\ud83d\udcdd Update outdated link in <code>docs/db-to-code.md</code>. PR #649 by @MatveyF.</li> <li>\u270f\ufe0f Fix typos found with codespell. PR #520 by @kianmeng.</li> <li>\ud83d\udcdd Fix typos (duplication) in main page. PR #631 by @Mr-DRP.</li> <li>\ud83d\udcdd Update release notes, add second author to PR. PR #429 by @br-follow.</li> <li>\ud83d\udcdd Update instructions about how to make a foreign key required in <code>docs/tutorial/relationship-attributes/define-relationships-attributes.md</code>. PR #474 by @jalvaradosegura.</li> <li>\ud83d\udcdd Update help SQLDev docs. PR #548 by @khulnasoft.</li> <li>\u270f\ufe0f Fix typo in internal function name <code>get_sqlachemy_type()</code>. PR #496 by @cmarqu.</li> <li>\u270f\ufe0f Fix typo in docs. PR #446 by @davidbrochart.</li> <li>\u270f\ufe0f Fix typo in <code>docs/tutorial/create-db-and-table.md</code>. PR #477 by @FluffyDietEngine.</li> <li>\u270f\ufe0f Fix small typos in docs. PR #481 by @micuffaro.</li> </ul>"},{"location":"release-notes/#internal_12","title":"Internal","text":"<ul> <li>\u2b06 [pre-commit.ci] pre-commit autoupdate. PR #672 by @pre-commit-ci[bot].</li> <li>\u2b06 Bump dawidd6/action-download-artifact from 2.24.2 to 2.28.0. PR #660 by @dependabot[bot].</li> <li>\u2705 Refactor OpenAPI ReadyAPI tests to simplify updating them later, this moves things around without changes. PR #671 by @khulnasoft.</li> <li>\u2b06 Bump actions/checkout from 3 to 4. PR #670 by @dependabot[bot].</li> <li>\ud83d\udd27 Update mypy config, use <code>strict = true</code> instead of manual configs. PR #428 by @michaeloliverx.</li> <li>\u2b06\ufe0f Upgrade MkDocs Material. PR #668 by @khulnasoft.</li> <li>\ud83c\udfa8 Update docs format and references with pre-commit and Ruff. PR #667 by @khulnasoft.</li> <li>\ud83c\udfa8 Run pre-commit on all files and autoformat. PR #666 by @khulnasoft.</li> <li>\ud83d\udc77 Move to Ruff and add pre-commit. PR #661 by @khulnasoft.</li> <li>\ud83d\udee0\ufe0f Add <code>CITATION.cff</code> file for academic citations. PR #13 by @sugatoray.</li> <li>\ud83d\udc77 Update docs deployments to Cloudflare. PR #630 by @khulnasoft.</li> <li>\ud83d\udc77\u200d\u2642\ufe0f Upgrade CI for docs. PR #628 by @khulnasoft.</li> <li>\ud83d\udc77 Update CI debug mode with Tmate. PR #629 by @khulnasoft.</li> <li>\ud83d\udc77 Update latest changes token. PR #616 by @khulnasoft.</li> <li>\u2b06\ufe0f Upgrade analytics. PR #558 by @khulnasoft.</li> <li>\ud83d\udd27 Update new issue chooser to point to GitHub Discussions. PR #546 by @khulnasoft.</li> <li>\ud83d\udd27 Add template for GitHub Discussion questions and update issues template. PR #544 by @khulnasoft.</li> <li>\ud83d\udc77 Refactor CI artifact upload/download for docs previews. PR #514 by @khulnasoft.</li> <li>\u2b06 Bump actions/cache from 2 to 3. PR #497 by @dependabot[bot].</li> <li>\u2b06 Bump dawidd6/action-download-artifact from 2.24.0 to 2.24.2. PR #493 by @dependabot[bot].</li> <li>\ud83d\udd27 Update Smokeshow coverage threshold. PR #487 by @khulnasoft.</li> <li>\ud83d\udc77 Move from Codecov to Smokeshow. PR #486 by @khulnasoft.</li> <li>\u2b06 Bump actions/setup-python from 2 to 4. PR #411 by @dependabot[bot].</li> <li>\u2b06 Update black requirement from ^21.5-beta.1 to ^22.10.0. PR #460 by @dependabot[bot].</li> <li>\u2795 Add extra dev dependencies for MkDocs Material. PR #485 by @khulnasoft.</li> <li>\u2b06 Update mypy requirement from 0.930 to 0.971. PR #380 by @dependabot[bot].</li> <li>\u2b06 Update coverage requirement from ^5.5 to ^6.2. PR #171 by @dependabot[bot].</li> <li>\u2b06 Bump codecov/codecov-action from 2 to 3. PR #415 by @dependabot[bot].</li> <li>\u2b06 Bump actions/upload-artifact from 2 to 3. PR #412 by @dependabot[bot].</li> <li>\u2b06 Update flake8 requirement from ^3.9.2 to ^5.0.4. PR #396 by @dependabot[bot].</li> <li>\u2b06 Update pytest requirement from ^6.2.4 to ^7.0.1. PR #242 by @dependabot[bot].</li> <li>\u2b06 Bump actions/checkout from 2 to 3.1.0. PR #458 by @dependabot[bot].</li> <li>\u2b06 Bump dawidd6/action-download-artifact from 2.9.0 to 2.24.0. PR #470 by @dependabot[bot].</li> <li>\ud83d\udc77 Update Dependabot config. PR #484 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#008","title":"0.0.8","text":""},{"location":"release-notes/#fixes_5","title":"Fixes","text":"<ul> <li>\ud83d\udc1b Fix auto detecting and setting <code>nullable</code>, allowing overrides in field. PR #423 by @JonasKs and @br-follow.</li> <li>\u267b\ufe0f Update <code>expresion.py</code>, sync from Jinja2 template, implement <code>inherit_cache</code> to solve errors like: <code>SAWarning: Class SelectOfScalar will not make use of SQL compilation caching</code>. PR #422 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#docs_9","title":"Docs","text":"<ul> <li>\ud83d\udcdd Adjust and clarify docs for <code>docs/tutorial/create-db-and-table.md</code>. PR #426 by @khulnasoft.</li> <li>\u270f Fix typo in <code>docs/tutorial/connect/remove-data-connections.md</code>. PR #421 by @VerdantFox.</li> </ul>"},{"location":"release-notes/#007","title":"0.0.7","text":""},{"location":"release-notes/#features_8","title":"Features","text":"<ul> <li>\u2728 Allow setting <code>unique</code> in <code>Field()</code> for a column. PR #83 by @raphaelgibson.</li> <li>\u2728 Update GUID handling to use stdlib <code>UUID.hex</code> instead of an <code>int</code>. PR #26 by @andrewbolster.</li> <li>\u2728 Raise an exception when using a Pydantic field type with no matching SQLAlchemy type. PR #18 by @elben10.</li> <li>\u2b06 Upgrade constrain for SQLAlchemy = \"&gt;=1.4.17,&lt;=1.4.41\". PR #371 by @RobertRosca.</li> <li>\u2728 Add new <code>Session.get()</code> parameter <code>execution_options</code>. PR #302 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#fixes_6","title":"Fixes","text":"<ul> <li>\ud83d\udc1b Fix type annotations for <code>Model.parse_obj()</code>, and <code>Model.validate()</code>. PR #321 by @phi-friday.</li> <li>\ud83d\udc1b Fix <code>Select</code> and <code>SelectOfScalar</code> to inherit cache to avoid warning: <code>SAWarning: Class SelectOfScalar will not make use of SQL compilation caching</code>. PR #234 by @rabinadk1.</li> <li>\ud83d\udc1b Fix handling validators for non-default values. PR #253 by @byrman.</li> <li>\ud83d\udc1b Fix fields marked as \"set\" in models. PR #117 by @statt8900.</li> <li>\ud83d\udc1b Fix Enum handling in SQLAlchemy. PR #165 by @chriswhite199.</li> <li>\ud83d\udc1b Fix setting nullable property of Fields that don't accept <code>None</code>. PR #79 by @van51.</li> <li>\ud83d\udc1b Fix SQLAlchemy version 1.4.36 breaks SQLDev relationships (#315). PR #322 by @byrman.</li> </ul>"},{"location":"release-notes/#docs_10","title":"Docs","text":"<ul> <li>\ud83d\udcdd Update docs for models for updating, <code>id</code> should not be updatable. PR #335 by @kurtportelli.</li> <li>\u270f Fix broken variable/typo in docs for Read Relationships, <code>hero_spider_boy.id</code> =&gt; <code>hero_spider_boy.team_id</code>. PR #106 by @yoannmos.</li> <li>\ud83c\udfa8 Remove unwanted highlight in the docs. PR #233 by @jalvaradosegura.</li> <li>\u270f Fix typos in <code>docs/databases.md</code> and <code>docs/tutorial/index.md</code>. PR #35 by @prrao87.</li> <li>\u270f Fix typo in <code>docs/tutorial/relationship-attributes/define-relationships-attributes.md</code>. PR #239 by @jalvaradosegura.</li> <li>\u270f Fix typo in <code>docs/tutorial/readyapi/simple-hero-api.md</code>. PR #80 by @joemudryk.</li> <li>\u270f Fix typos in multiple files in the docs. PR #400 by @VictorGambarini.</li> <li>\u270f Fix typo in <code>docs/tutorial/code-structure.md</code>. PR #344 by @marciomazza.</li> <li>\u270f Fix typo in <code>docs/db-to-code.md</code>. PR #155 by @gr8jam.</li> <li>\u270f Fix typo in <code>docs/contributing.md</code>. PR #323 by @Fardad13.</li> <li>\u270f Fix typo in <code>docs/tutorial/readyapi/tests.md</code>. PR #265 by @johnhoman.</li> <li>\u270f Fix typo in <code>docs/tutorial/where.md</code>. PR #286 by @jalvaradosegura.</li> <li>\u270f Fix typos in <code>docs/tutorial/readyapi/update.md</code>. PR #268 by @cirrusj.</li> <li>\u270f Fix typo in <code>docs/tutorial/readyapi/simple-hero-api.md</code>. PR #247 by @hao-wang.</li> <li>\u270f Fix typos in <code>docs/tutorial/automatic-id-none-refresh.md</code>, <code>docs/tutorial/readyapi/update.md</code>, <code>docs/tutorial/select.md</code>. PR #185 by @rootux.</li> <li>\u270f Fix typo in <code>docs/databases.md</code>. PR #177 by @seandlg.</li> <li>\u270f Fix typos in <code>docs/tutorial/readyapi/update.md</code>. PR #162 by @wmcgee3.</li> <li>\u270f Fix typos in <code>docs/tutorial/code-structure.md</code>, <code>docs/tutorial/readyapi/multiple-models.md</code>, <code>docs/tutorial/readyapi/simple-hero-api.md</code>, <code>docs/tutorial/many-to-many/index.md</code>. PR #116 by @moonso.</li> <li>\u270f Fix typo in <code>docs/tutorial/readyapi/teams.md</code>. PR #154 by @chrisgoddard.</li> <li>\u270f Fix typo variable in example about relationships and <code>back_populates</code>, always use <code>hero</code> instead of <code>owner</code>. PR #120 by @onionj.</li> <li>\u270f Fix typo in <code>docs/tutorial/readyapi/tests.md</code>. PR #113 by @feanil.</li> <li>\u270f Fix typo in <code>docs/tutorial/where.md</code>. PR #72 by @ZettZet.</li> <li>\u270f Fix typo in <code>docs/tutorial/code-structure.md</code>. PR #91 by @dhiraj.</li> <li>\u270f Fix broken link to newsletter sign-up in <code>docs/help.md</code>. PR #84 by @mborus.</li> <li>\u270f Fix typos in <code>docs/tutorial/many-to-many/create-models-with-link.md</code>. PR #45 by @xginn8.</li> <li>\u270f Fix typo in <code>docs/tutorial/index.md</code>. PR #398 by @ryangrose.</li> </ul>"},{"location":"release-notes/#internal_13","title":"Internal","text":"<ul> <li>\u267b Refactor internal statements to simplify code. PR #53 by @yezz123.</li> <li>\u267b Refactor internal imports to reduce redundancy. PR #272 by @aminalaee.</li> <li>\u2b06 Update development requirement for ReadyAPI from <code>^0.68.0</code> to <code>^0.68.1</code>. PR #48 by @alucarddelta.</li> <li>\u23ea Revert upgrade Poetry, to make a release that supports Python 3.6 first. PR #417 by @khulnasoft.</li> <li>\ud83d\udc77 Add dependabot for GitHub Actions. PR #410 by @khulnasoft.</li> <li>\u2b06\ufe0f Upgrade Poetry to version <code>==1.2.0b1</code>. PR #303 by @khulnasoft.</li> <li>\ud83d\udc77 Add CI for Python 3.10. PR #305 by @khulnasoft.</li> <li>\ud83d\udcdd Add Jina's QA Bot to the docs to help people that want to ask quick questions. PR #263 by @khulnasoft.</li> <li>\ud83d\udc77 Upgrade Codecov GitHub Action. PR #304 by @khulnasoft.</li> <li>\ud83d\udc9a Only run CI on push when on master, to avoid duplicate runs on PRs. PR #244 by @khulnasoft.</li> <li>\ud83d\udd27 Upgrade MkDocs Material and update configs. PR #217 by @khulnasoft.</li> <li>\u2b06 Upgrade mypy, fix type annotations. PR #218 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#006","title":"0.0.6","text":""},{"location":"release-notes/#breaking-changes_1","title":"Breaking Changes","text":"<p>SQLDev no longer creates indexes by default for every column, indexes are now opt-in. You can read more about it in PR #205.</p> <p>Before this change, if you had a model like this:</p> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n</code></pre> <p>...when creating the tables, SQLDev version <code>0.0.5</code> and below, would also create an index for <code>name</code>, one for <code>secret_name</code>, and one for <code>age</code> (<code>id</code> is the primary key, so it doesn't need an additional index).</p> <p>If you depended on having an index for each one of those columns, now you can (and would have to) define them explicitly:</p> <pre><code>class Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str = Field(index=True)\n    age: Optional[int] = Field(default=None, index=True)\n</code></pre> <p>There's a high chance you don't need indexes for all the columns. For example, you might only need indexes for <code>name</code> and <code>age</code>, but not for <code>secret_name</code>. In that case, you could define the model as:</p> <pre><code>class Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n</code></pre> <p>If you already created your database tables with SQLDev using versions <code>0.0.5</code> or below, it would have also created those indexes in the database. In that case, you might want to manually drop (remove) some of those indexes, if they are unnecessary, to avoid the extra cost in performance and space.</p> <p>Depending on the database you are using, there will be a different way to find the available indexes.</p> <p>For example, let's say you no longer need the index for <code>secret_name</code>. You could check the current indexes in the database and find the one for <code>secret_name</code>, it could be named <code>ix_hero_secret_name</code>. Then you can remove it with SQL:</p> <pre><code>DROP INDEX ix_hero_secret_name\n</code></pre> <p>or</p> <pre><code>DROP INDEX ix_hero_secret_name ON hero;\n</code></pre> <p>Here's the new, extensive documentation explaining indexes and how to use them: Indexes - Optimize Queries.</p>"},{"location":"release-notes/#docs_11","title":"Docs","text":"<ul> <li>\u2728 Document indexes and make them opt-in. Here's the new documentation: Indexes - Optimize Queries. This is the same change described above in Breaking Changes. PR #205 by @khulnasoft.</li> <li>\u270f Fix typo in ReadyAPI tutorial. PR #192 by @yaquelinehoyos.</li> <li>\ud83d\udcdd Add links to the license file. PR #29 by @sobolevn.</li> <li>\u270f Fix typos in docs titles. PR #28 by @Batalex.</li> <li>\u270f Fix multiple typos and some rewording. PR #22 by @egrim.</li> <li>\u270f Fix typo in <code>docs/tutorial/automatic-id-none-refresh.md</code>. PR #14 by @leynier.</li> <li>\u270f Fix typos in <code>docs/tutorial/index.md</code> and <code>docs/databases.md</code>. PR #5 by @sebastianmarines.</li> </ul>"},{"location":"release-notes/#005","title":"0.0.5","text":""},{"location":"release-notes/#features_9","title":"Features","text":"<ul> <li>\u2728 Add support for Decimal fields from Pydantic and SQLAlchemy. Original PR #103 by @robcxyz. New docs: Advanced User Guide - Decimal Numbers.</li> </ul>"},{"location":"release-notes/#docs_12","title":"Docs","text":"<ul> <li>\u270f Update decimal tutorial source for consistency. PR #188 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#internal_14","title":"Internal","text":"<ul> <li>\ud83d\udd27 Split MkDocs insiders build in CI to support building from PRs. PR #186 by @khulnasoft.</li> <li>\ud83c\udfa8 Format <code>expression.py</code> and expression template, currently needed by CI. PR #187 by @khulnasoft.</li> <li>\ud83d\udc1bFix docs light/dark theme switcher. PR #1 by @Lehoczky.</li> <li>\ud83d\udd27 Add MkDocs Material social cards. PR #90 by @khulnasoft.</li> <li>\u2728 Update type annotations and upgrade mypy. PR #173 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#004","title":"0.0.4","text":"<ul> <li>\ud83c\udfa8 Fix type detection of select results in PyCharm. PR #15 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#003","title":"0.0.3","text":"<ul> <li>\u2b06\ufe0f Update and relax specification range for <code>sqlalchemy-stubs</code>. PR #4 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#002","title":"0.0.2","text":"<ul> <li>This includes several small bug fixes detected during the first CI runs.</li> <li>\ud83d\udc9a Fix CI installs and tests. PR #2 by @khulnasoft.</li> </ul>"},{"location":"release-notes/#001","title":"0.0.1","text":"<ul> <li>First release. \ud83c\udf89</li> </ul>"},{"location":"virtual-environments/","title":"Virtual Environments","text":"<p>When you work in Python projects you probably should use a virtual environment (or a similar mechanism) to isolate the packages you install for each project.</p> <p>Info</p> <p>If you already know about virtual environments, how to create them and use them, you might want to skip this section. \ud83e\udd13</p> <p>Tip</p> <p>A virtual environment is different than an environment variable.</p> <p>An environment variable is a variable in the system that can be used by programs.</p> <p>A virtual environment is a directory with some files in it.</p> <p>Info</p> <p>This page will teach you how to use virtual environments and how they work.</p> <p>If you are ready to adopt a tool that manages everything for you (including installing Python), try uv.</p>"},{"location":"virtual-environments/#create-a-project","title":"Create a Project","text":"<p>First, create a directory for your project.</p> <p>What I normally do is that I create a directory named <code>code</code> inside my home/user directory.</p> <p>And inside of that I create one directory per project.</p> <pre><code>// Go to the home directory\n$ cd\n// Create a directory for all your code projects\n$ mkdir code\n// Enter into that code directory\n$ cd code\n// Create a directory for this project\n$ mkdir awesome-project\n// Enter into that project directory\n$ cd awesome-project\n</code></pre>"},{"location":"virtual-environments/#create-a-virtual-environment","title":"Create a Virtual Environment","text":"<p>When you start working on a Python project for the first time, create a virtual environment inside your project.</p> <p>Tip</p> <p>You only need to do this once per project, not every time you work.</p> <code>venv</code><code>uv</code> <p>To create a virtual environment, you can use the <code>venv</code> module that comes with Python.</p> <pre><code>$ python -m venv .venv\n</code></pre> What that command means <ul> <li><code>python</code>: use the program called <code>python</code></li> <li><code>-m</code>: call a module as a script, we'll tell it which module next</li> <li><code>venv</code>: use the module called <code>venv</code> that normally comes installed with Python</li> <li><code>.venv</code>: create the virtual environment in the new directory <code>.venv</code></li> </ul> <p>If you have <code>uv</code> installed, you can use it to create a virtual environment.</p> <pre><code>$ uv venv\n</code></pre> <p>Tip</p> <p>By default, <code>uv</code> will create a virtual environment in a directory called <code>.venv</code>.</p> <p>But you could customize it passing an additional argument with the directory name.</p> <p>That command creates a new virtual environment in a directory called <code>.venv</code>.</p> <code>.venv</code> or other name <p>You could create the virtual environment in a different directory, but there's a convention of calling it <code>.venv</code>.</p>"},{"location":"virtual-environments/#activate-the-virtual-environment","title":"Activate the Virtual Environment","text":"<p>Activate the new virtual environment so that any Python command you run or package you install uses it.</p> <p>Tip</p> <p>Do this every time you start a new terminal session to work on the project.</p> Linux, macOSWindows PowerShellWindows Bash <pre><code>$ source .venv/bin/activate\n</code></pre> <pre><code>$ .venv\\Scripts\\Activate.ps1\n</code></pre> <p>Or if you use Bash for Windows (e.g. Git Bash):</p> <pre><code>$ source .venv/Scripts/activate\n</code></pre> <p>Tip</p> <p>Every time you install a new package in that environment, activate the environment again.</p> <p>This makes sure that if you use a terminal (CLI) program installed by that package, you use the one from your virtual environment and not any other that could be installed globally, probably with a different version than what you need.</p>"},{"location":"virtual-environments/#check-the-virtual-environment-is-active","title":"Check the Virtual Environment is Active","text":"<p>Check that the virtual environment is active (the previous command worked).</p> <p>Tip</p> <p>This is optional, but it's a good way to check that everything is working as expected and you are using the virtual environment you intended.</p> Linux, macOS, Windows BashWindows PowerShell <pre><code>$ which python\n\n/home/user/code/awesome-project/.venv/bin/python\n</code></pre> <p>If it shows the <code>python</code> binary at <code>.venv/bin/python</code>, inside of your project (in this case <code>awesome-project</code>), then it worked. \ud83c\udf89</p> <pre><code>$ Get-Command python\n\nC:\\Users\\user\\code\\awesome-project\\.venv\\Scripts\\python\n</code></pre> <p>If it shows the <code>python</code> binary at <code>.venv\\Scripts\\python</code>, inside of your project (in this case <code>awesome-project</code>), then it worked. \ud83c\udf89</p>"},{"location":"virtual-environments/#upgrade-pip","title":"Upgrade <code>pip</code>","text":"<p>Tip</p> <p>If you use <code>uv</code> you would use it to install things instead of <code>pip</code>, so you don't need to upgrade <code>pip</code>. \ud83d\ude0e</p> <p>If you are using <code>pip</code> to install packages (it comes by default with Python), you should upgrade it to the latest version.</p> <p>Many exotic errors while installing a package are solved by just upgrading <code>pip</code> first.</p> <p>Tip</p> <p>You would normally do this once, right after you create the virtual environment.</p> <p>Make sure the virtual environment is active (with the command above) and then run:</p> <pre><code>$ python -m pip install --upgrade pip\n\n---&gt; 100%\n</code></pre>"},{"location":"virtual-environments/#add-gitignore","title":"Add <code>.gitignore</code>","text":"<p>If you are using Git (you should), add a <code>.gitignore</code> file to exclude everything in your <code>.venv</code> from Git.</p> <p>Tip</p> <p>If you used <code>uv</code> to create the virtual environment, it already did this for you, you can skip this step. \ud83d\ude0e</p> <p>Tip</p> <p>Do this once, right after you create the virtual environment.</p> <pre><code>$ echo \"*\" &gt; .venv/.gitignore\n</code></pre> What that command means <ul> <li><code>echo \"*\"</code>: will \"print\" the text <code>*</code> in the terminal (the next part changes that a bit)</li> <li><code>&gt;</code>: anything printed to the terminal by the command to the left of <code>&gt;</code> should not be printed but instead written to the file that goes to the right of <code>&gt;</code></li> <li><code>.gitignore</code>: the name of the file where the text should be written</li> </ul> <p>And <code>*</code> for Git means \"everything\". So, it will ignore everything in the <code>.venv</code> directory.</p> <p>That command will create a file <code>.gitignore</code> with the content:</p> <pre><code>*\n</code></pre>"},{"location":"virtual-environments/#install-packages","title":"Install Packages","text":"<p>After activating the environment, you can install packages in it.</p> <p>Tip</p> <p>Do this once when installing or upgrading the packages your project needs.</p> <p>If you need to upgrade a version or add a new package you would do this again.</p>"},{"location":"virtual-environments/#install-packages-directly","title":"Install Packages Directly","text":"<p>If you're in a hurry and don't want to use a file to declare your project's package requirements, you can install them directly.</p> <p>Tip</p> <p>It's a (very) good idea to put the packages and versions your program needs in a file (for example <code>requirements.txt</code> or <code>pyproject.toml</code>).</p> <code>pip</code><code>uv</code> <pre><code>$ pip install sqldev\n\n---&gt; 100%\n</code></pre> <p>If you have <code>uv</code>:</p> <pre><code>$ uv pip install sqldev\n---&gt; 100%\n</code></pre>"},{"location":"virtual-environments/#install-from-requirementstxt","title":"Install from <code>requirements.txt</code>","text":"<p>If you have a <code>requirements.txt</code>, you can now use it to install its packages.</p> <code>pip</code><code>uv</code> <pre><code>$ pip install -r requirements.txt\n---&gt; 100%\n</code></pre> <p>If you have <code>uv</code>:</p> <pre><code>$ uv pip install -r requirements.txt\n---&gt; 100%\n</code></pre> <code>requirements.txt</code> <p>A <code>requirements.txt</code> with some packages could look like:</p> <pre><code>sqldev==0.13.0\nrich==13.7.1\n</code></pre>"},{"location":"virtual-environments/#run-your-program","title":"Run Your Program","text":"<p>After you activated the virtual environment, you can run your program, and it will use the Python inside of your virtual environment with the packages you installed there.</p> <pre><code>$ python main.py\n\nHello World\n</code></pre>"},{"location":"virtual-environments/#configure-your-editor","title":"Configure Your Editor","text":"<p>You would probably use an editor, make sure you configure it to use the same virtual environment you created (it will probably autodetect it) so that you can get autocompletion and inline errors.</p> <p>For example:</p> <ul> <li>VS Code</li> <li>PyCharm</li> </ul> <p>Tip</p> <p>You normally have to do this only once, when you create the virtual environment.</p>"},{"location":"virtual-environments/#deactivate-the-virtual-environment","title":"Deactivate the Virtual Environment","text":"<p>Once you are done working on your project you can deactivate the virtual environment.</p> <pre><code>$ deactivate\n</code></pre> <p>This way, when you run <code>python</code> it won't try to run it from that virtual environment with the packages installed there.</p>"},{"location":"virtual-environments/#ready-to-work","title":"Ready to Work","text":"<p>Now you're ready to start working on your project.</p> <p>Tip</p> <p>Do you want to understand what's all that above?</p> <p>Continue reading. \ud83d\udc47\ud83e\udd13</p>"},{"location":"virtual-environments/#why-virtual-environments","title":"Why Virtual Environments","text":"<p>To work with SQLDev you need to install Python.</p> <p>After that, you would need to install SQLDev and any other packages you want to use.</p> <p>To install packages you would normally use the <code>pip</code> command that comes with Python (or similar alternatives).</p> <p>Nevertheless, if you just use <code>pip</code> directly, the packages would be installed in your global Python environment (the global installation of Python).</p>"},{"location":"virtual-environments/#the-problem","title":"The Problem","text":"<p>So, what's the problem with installing packages in the global Python environment?</p> <p>At some point, you will probably end up writing many different programs that depend on different packages. And some of these projects you work on will depend on different versions of the same package. \ud83d\ude31</p> <p>For example, you could create a project called <code>philosophers-stone</code>, this program depends on another package called <code>harry</code>, using the version <code>1</code>. So, you need to install <code>harry</code>.</p> <pre><code>flowchart LR\n    stone(philosophers-stone) --&gt;|requires| harry-1[harry v1]</code></pre> <p>Then, at some point later, you create another project called <code>prisoner-of-azkaban</code>, and this project also depends on <code>harry</code>, but this project needs <code>harry</code> version <code>3</code>.</p> <pre><code>flowchart LR\n    azkaban(prisoner-of-azkaban) --&gt; |requires| harry-3[harry v3]</code></pre> <p>But now the problem is, if you install the packages globally (in the global environment) instead of in a local virtual environment, you will have to choose which version of <code>harry</code> to install.</p> <p>If you want to run <code>philosophers-stone</code> you will need to first install <code>harry</code> version <code>1</code>, for example with:</p> <pre><code>$ pip install \"harry==1\"\n</code></pre> <p>And then you would end up with <code>harry</code> version <code>1</code> installed in your global Python environment.</p> <pre><code>flowchart LR\n    subgraph global[global env]\n        harry-1[harry v1]\n    end\n    subgraph stone-project[philosophers-stone project]\n        stone(philosophers-stone) --&gt;|requires| harry-1\n    end</code></pre> <p>But then if you want to run <code>prisoner-of-azkaban</code>, you will need to uninstall <code>harry</code> version <code>1</code> and install <code>harry</code> version <code>3</code> (or just installing version <code>3</code> would automatically uninstall version <code>1</code>).</p> <pre><code>$ pip install \"harry==3\"\n</code></pre> <p>And then you would end up with <code>harry</code> version <code>3</code> installed in your global Python environment.</p> <p>And if you try to run <code>philosophers-stone</code> again, there's a chance it would not work because it needs <code>harry</code> version <code>1</code>.</p> <pre><code>flowchart LR\n    subgraph global[global env]\n        harry-1[&lt;strike&gt;harry v1&lt;/strike&gt;]\n        style harry-1 fill:#ccc,stroke-dasharray: 5 5\n        harry-3[harry v3]\n    end\n    subgraph stone-project[philosophers-stone project]\n        stone(philosophers-stone) -.-x|\u26d4\ufe0f| harry-1\n    end\n    subgraph azkaban-project[prisoner-of-azkaban project]\n        azkaban(prisoner-of-azkaban) --&gt; |requires| harry-3\n    end</code></pre> <p>Tip</p> <p>It's very common in Python packages to try the best to avoid breaking changes in new versions, but it's better to be safe, and install newer versions intentionally and when you can run the tests to check everything is working correctly.</p> <p>Now, imagine that with many other packages that all your projects depend on. That's very difficult to manage. And you would probably end up running some projects with some incompatible versions of the packages, and not knowing why something isn't working.</p> <p>Also, depending on your operating system (e.g. Linux, Windows, macOS), it could have come with Python already installed. And in that case it probably had some packages pre-installed with some specific versions needed by your system. If you install packages in the global Python environment, you could end up breaking some of the programs that came with your operating system.</p>"},{"location":"virtual-environments/#where-are-packages-installed","title":"Where are Packages Installed","text":"<p>When you install Python, it creates some directories with some files in your computer.</p> <p>Some of these directories are the ones in charge of having all the packages you install.</p> <p>When you run:</p> <pre><code>// Don't run this now, it's just an example \ud83e\udd13\n$ pip install sqldev\n---&gt; 100%\n</code></pre> <p>That will download a compressed file with the SQLDev code, normally from PyPI.</p> <p>It will also download files for other packages that SQLDev depends on.</p> <p>Then it will extract all those files and put them in a directory in your computer.</p> <p>By default, it will put those files downloaded and extracted in the directory that comes with your Python installation, that's the global environment.</p>"},{"location":"virtual-environments/#what-are-virtual-environments","title":"What are Virtual Environments","text":"<p>The solution to the problems of having all the packages in the global environment is to use a virtual environment for each project you work on.</p> <p>A virtual environment is a directory, very similar to the global one, where you can install the packages for a project.</p> <p>This way, each project will have its own virtual environment (<code>.venv</code> directory) with its own packages.</p> <pre><code>flowchart TB\n    subgraph stone-project[philosophers-stone project]\n        stone(philosophers-stone) ---&gt;|requires| harry-1\n        subgraph venv1[.venv]\n            harry-1[harry v1]\n        end\n    end\n    subgraph azkaban-project[prisoner-of-azkaban project]\n        azkaban(prisoner-of-azkaban) ---&gt;|requires| harry-3\n        subgraph venv2[.venv]\n            harry-3[harry v3]\n        end\n    end\n    stone-project ~~~ azkaban-project</code></pre>"},{"location":"virtual-environments/#what-does-activating-a-virtual-environment-mean","title":"What Does Activating a Virtual Environment Mean","text":"<p>When you activate a virtual environment, for example with:</p> Linux, macOSWindows PowerShellWindows Bash <pre><code>$ source .venv/bin/activate\n</code></pre> <pre><code>$ .venv\\Scripts\\Activate.ps1\n</code></pre> <p>Or if you use Bash for Windows (e.g. Git Bash):</p> <pre><code>$ source .venv/Scripts/activate\n</code></pre> <p>That command will create or modify some environment variables that will be available for the next commands.</p> <p>One of those variables is the <code>PATH</code> variable.</p> <p>Tip</p> <p>You can learn more about the <code>PATH</code> environment variable in the Environment Variables section.</p> <p>Activating a virtual environment adds its path <code>.venv/bin</code> (on Linux and macOS) or <code>.venv\\Scripts</code> (on Windows) to the <code>PATH</code> environment variable.</p> <p>Let's say that before activating the environment, the <code>PATH</code> variable looked like this:</p> Linux, macOSWindows <pre><code>/usr/bin:/bin:/usr/sbin:/sbin\n</code></pre> <p>That means that the system would look for programs in:</p> <ul> <li><code>/usr/bin</code></li> <li><code>/bin</code></li> <li><code>/usr/sbin</code></li> <li><code>/sbin</code></li> </ul> <pre><code>C:\\Windows\\System32\n</code></pre> <p>That means that the system would look for programs in:</p> <ul> <li><code>C:\\Windows\\System32</code></li> </ul> <p>After activating the virtual environment, the <code>PATH</code> variable would look something like this:</p> Linux, macOSWindows <pre><code>/home/user/code/awesome-project/.venv/bin:/usr/bin:/bin:/usr/sbin:/sbin\n</code></pre> <p>That means that the system will now start looking first look for programs in:</p> <pre><code>/home/user/code/awesome-project/.venv/bin\n</code></pre> <p>before looking in the other directories.</p> <p>So, when you type <code>python</code> in the terminal, the system will find the Python program in</p> <pre><code>/home/user/code/awesome-project/.venv/bin/python\n</code></pre> <p>and use that one.</p> <pre><code>C:\\Users\\user\\code\\awesome-project\\.venv\\Scripts;C:\\Windows\\System32\n</code></pre> <p>That means that the system will now start looking first look for programs in:</p> <pre><code>C:\\Users\\user\\code\\awesome-project\\.venv\\Scripts\n</code></pre> <p>before looking in the other directories.</p> <p>So, when you type <code>python</code> in the terminal, the system will find the Python program in</p> <pre><code>C:\\Users\\user\\code\\awesome-project\\.venv\\Scripts\\python\n</code></pre> <p>and use that one.</p> <p>An important detail is that it will put the virtual environment path at the beginning of the <code>PATH</code> variable. The system will find it before finding any other Python available. This way, when you run <code>python</code>, it will use the Python from the virtual environment instead of any other <code>python</code> (for example, a <code>python</code> from a global environment).</p> <p>Activating a virtual environment also changes a couple of other things, but this is one of the most important things it does.</p>"},{"location":"virtual-environments/#checking-a-virtual-environment","title":"Checking a Virtual Environment","text":"<p>When you check if a virtual environment is active, for example with:</p> Linux, macOS, Windows BashWindows PowerShell <pre><code>$ which python\n\n/home/user/code/awesome-project/.venv/bin/python\n</code></pre> <pre><code>$ Get-Command python\n\nC:\\Users\\user\\code\\awesome-project\\.venv\\Scripts\\python\n</code></pre> <p>That means that the <code>python</code> program that will be used is the one in the virtual environment.</p> <p>you use <code>which</code> in Linux and macOS and <code>Get-Command</code> in Windows PowerShell.</p> <p>The way that command works is that it will go and check in the <code>PATH</code> environment variable, going through each path in order, looking for the program called <code>python</code>. Once it finds it, it will show you the path to that program.</p> <p>The most important part is that when you call <code>python</code>, that is the exact \"<code>python</code>\" that will be executed.</p> <p>So, you can confirm if you are in the correct virtual environment.</p> <p>Tip</p> <p>It's easy to activate one virtual environment, get one Python, and then go to another project.</p> <p>And the second project wouldn't work because you are using the incorrect Python, from a virtual environment for another project.</p> <p>It's useful being able to check what <code>python</code> is being used. \ud83e\udd13</p>"},{"location":"virtual-environments/#why-deactivate-a-virtual-environment","title":"Why Deactivate a Virtual Environment","text":"<p>For example, you could be working on a project <code>philosophers-stone</code>, activate that virtual environment, install packages and work with that environment.</p> <p>And then you want to work on another project <code>prisoner-of-azkaban</code>.</p> <p>You go to that project:</p> <pre><code>$ cd ~/code/prisoner-of-azkaban\n</code></pre> <p>If you don't deactivate the virtual environment for <code>philosophers-stone</code>, when you run <code>python</code> in the terminal, it will try to use the Python from <code>philosophers-stone</code>.</p> <pre><code>$ cd ~/code/prisoner-of-azkaban\n\n$ python main.py\n\n// Error importing sirius, it's not installed \ud83d\ude31\nTraceback (most recent call last):\n    File \"main.py\", line 1, in &lt;module&gt;\n        import sirius\n</code></pre> <p>But if you deactivate the virtual environment and activate the new one for <code>prisoner-of-askaban</code> then when you run <code>python</code> it will use the Python from the virtual environment in <code>prisoner-of-azkaban</code>.</p> <pre><code>$ cd ~/code/prisoner-of-azkaban\n\n// You don't need to be in the old directory to deactivate, you can do it wherever you are, even after going to the other project \ud83d\ude0e\n$ deactivate\n\n// Activate the virtual environment in prisoner-of-azkaban/.venv \ud83d\ude80\n$ source .venv/bin/activate\n\n// Now when you run python, it will find the package sirius installed in this virtual environment \u2728\n$ python main.py\n\nI solemnly swear \ud83d\udc3a\n</code></pre>"},{"location":"virtual-environments/#alternatives","title":"Alternatives","text":"<p>This is a simple guide to get you started and teach you how everything works underneath.</p> <p>There are many alternatives to managing virtual environments, package dependencies (requirements), projects.</p> <p>Once you are ready and want to use a tool to manage the entire project, packages dependencies, virtual environments, etc. I would suggest you try uv.</p> <p><code>uv</code> can do a lot of things, it can:</p> <ul> <li>Install Python for you, including different versions</li> <li>Manage the virtual environment for your projects</li> <li>Install packages</li> <li>Manage package dependencies and versions for your project</li> <li>Make sure you have an exact set of packages and versions to install, including their dependencies, so that you can be sure that you can run your project in production exactly the same as in your computer while developing, this is called locking</li> <li>And many other things</li> </ul>"},{"location":"virtual-environments/#conclusion","title":"Conclusion","text":"<p>If you read and understood all this, now you know much more about virtual environments than many developers out there. \ud83e\udd13</p> <p>Knowing these details will most probably be useful in a future time when you are debugging something that seems complex, but you will know how it all works underneath. \ud83d\ude0e</p>"},{"location":"about/","title":"About","text":"<p>About SQLDev, its design, inspiration, and more. \ud83e\udd13</p>"},{"location":"advanced/","title":"Advanced User Guide","text":"<p>The Advanced User Guide is gradually growing, you can already read about some advanced topics.</p> <p>At some point it will include:</p> <ul> <li>How to use <code>async</code> and <code>await</code> with the async session.</li> <li>How to run migrations.</li> <li>How to combine SQLDev models with SQLAlchemy.</li> <li>...and more. \ud83e\udd13</li> </ul>"},{"location":"advanced/decimal/","title":"Decimal Numbers","text":"<p>In some cases you might need to be able to store decimal numbers with guarantees about the precision.</p> <p>This is particularly important if you are storing things like currencies, prices, accounts, and others, as you would want to know that you wouldn't have rounding errors.</p> <p>As an example, if you open Python and sum <code>1.1</code> + <code>2.2</code> you would expect to see <code>3.3</code>, but you will actually get <code>3.3000000000000003</code>:</p> <pre><code>&gt;&gt;&gt; 1.1 + 2.2\n3.3000000000000003\n</code></pre> <p>This is because of the way numbers are stored in \"ones and zeros\" (binary). But Python has a module and some types to have strict decimal values. You can read more about it in the official Python docs for Decimal.</p> <p>Because databases store data in the same ways as computers (in binary), they would have the same types of issues. And because of that, they also have a special decimal type.</p> <p>In most cases this would probably not be a problem, for example measuring views in a video, or the life bar in a videogame. But as you can imagine, this is particularly important when dealing with money and finances.</p>"},{"location":"advanced/decimal/#decimal-types","title":"Decimal Types","text":"<p>Pydantic has special support for <code>Decimal</code> types.</p> <p>When you use <code>Decimal</code> you can specify the number of digits and decimal places to support in the <code>Field()</code> function. They will be validated by Pydantic (for example when using ReadyAPI) and the same information will also be used for the database columns.</p> <p>Info</p> <p>For the database, SQLDev will use SQLAlchemy's <code>DECIMAL</code> type.</p>"},{"location":"advanced/decimal/#decimals-in-sqldev","title":"Decimals in SQLDev","text":"<p>Let's say that each hero in the database will have an amount of money. We could make that field a <code>Decimal</code> type using the <code>condecimal()</code> function:</p> Python 3.10+Python 3.7+ <pre><code>from decimal import Decimal\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n    money: Decimal = Field(default=0, max_digits=5, decimal_places=3)\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code>from decimal import Decimal\nfrom typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n    money: Decimal = Field(default=0, max_digits=5, decimal_places=3)\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from decimal import Decimal\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n    money: Decimal = Field(default=0, max_digits=5, decimal_places=3)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\", money=1.1)\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", money=0.001)\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, money=2.2)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Rusty-Man\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        total_money = hero_1.money + hero_2.money\n        print(f\"Total money: {total_money}\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from decimal import Decimal\nfrom typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n    money: Decimal = Field(default=0, max_digits=5, decimal_places=3)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\", money=1.1)\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", money=0.001)\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, money=2.2)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Rusty-Man\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        total_money = hero_1.money + hero_2.money\n        print(f\"Total money: {total_money}\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Here we are saying that <code>money</code> can have at most <code>5</code> digits with <code>max_digits</code>, this includes the integers (to the left of the decimal dot) and the decimals (to the right of the decimal dot).</p> <p>We are also saying that the number of decimal places (to the right of the decimal dot) is <code>3</code>, so we can have 3 decimal digits for these numbers in the <code>money</code> field. This means that we will have 2 digits for the integer part and 3 digits for the decimal part.</p> <p>\u2705 So, for example, these are all valid numbers for the <code>money</code> field:</p> <ul> <li><code>12.345</code></li> <li><code>12.3</code></li> <li><code>12</code></li> <li><code>1.2</code></li> <li><code>0.123</code></li> <li><code>0</code></li> </ul> <p>\ud83d\udeab But these are all invalid numbers for that <code>money</code> field:</p> <ul> <li><code>1.2345</code></li> <li>This number has more than 3 decimal places.</li> <li><code>123.234</code></li> <li>This number has more than 5 digits in total (integer and decimal part).</li> <li><code>123</code></li> <li>Even though this number doesn't have any decimals, we still have 3 places saved for them, which means that we can only use 2 places for the integer part, and this number has 3 integer digits. So, the allowed number of integer digits is <code>max_digits</code> - <code>decimal_places</code> = 2.</li> </ul> <p>Tip</p> <p>Make sure you adjust the number of digits and decimal places for your own needs, in your own application. \ud83e\udd13</p>"},{"location":"advanced/decimal/#create-models-with-decimals","title":"Create models with Decimals","text":"<p>When creating new models you can actually pass normal (<code>float</code>) numbers, Pydantic will automatically convert them to <code>Decimal</code> types, and SQLDev will store them as <code>Decimal</code> types in the database (using SQLAlchemy).</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\", money=1.1)\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", money=0.001)\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, money=2.2)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\", money=1.1)\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", money=0.001)\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, money=2.2)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from decimal import Decimal\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n    money: Decimal = Field(default=0, max_digits=5, decimal_places=3)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\", money=1.1)\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", money=0.001)\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, money=2.2)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Rusty-Man\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        total_money = hero_1.money + hero_2.money\n        print(f\"Total money: {total_money}\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from decimal import Decimal\nfrom typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n    money: Decimal = Field(default=0, max_digits=5, decimal_places=3)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\", money=1.1)\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", money=0.001)\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, money=2.2)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Rusty-Man\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        total_money = hero_1.money + hero_2.money\n        print(f\"Total money: {total_money}\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"advanced/decimal/#select-decimal-data","title":"Select Decimal data","text":"<p>Then, when working with Decimal types, you can confirm that they indeed avoid those rounding errors from floats:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Rusty-Man\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        total_money = hero_1.money + hero_2.money\n        print(f\"Total money: {total_money}\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Rusty-Man\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        total_money = hero_1.money + hero_2.money\n        print(f\"Total money: {total_money}\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from decimal import Decimal\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n    money: Decimal = Field(default=0, max_digits=5, decimal_places=3)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\", money=1.1)\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", money=0.001)\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, money=2.2)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Rusty-Man\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        total_money = hero_1.money + hero_2.money\n        print(f\"Total money: {total_money}\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from decimal import Decimal\nfrom typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n    money: Decimal = Field(default=0, max_digits=5, decimal_places=3)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\", money=1.1)\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", money=0.001)\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, money=2.2)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Rusty-Man\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        total_money = hero_1.money + hero_2.money\n        print(f\"Total money: {total_money}\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"advanced/decimal/#review-the-results","title":"Review the results","text":"<p>Now if you run this, instead of printing the unexpected number <code>3.3000000000000003</code>, it prints <code>3.300</code>:</p> <pre><code>$ python app.py\n\n// Some boilerplate and previous output omitted \ud83d\ude09\n\n// The type of money is Decimal('1.100')\nHero 1: id=1 secret_name='Dive Wilson' age=None name='Deadpond' money=Decimal('1.100')\n\n// More output omitted here \ud83e\udd13\n\n// The type of money is Decimal('1.100')\nHero 2: id=3 secret_name='Tommy Sharp' age=48 name='Rusty-Man' money=Decimal('2.200')\n\n// No rounding errors, just 3.3! \ud83c\udf89\nTotal money: 3.300\n</code></pre> <p>Warning</p> <p>Although Decimal types are supported and used in the Python side, not all databases support it. In particular, SQLite doesn't support decimals, so it will convert them to the same floating <code>NUMERIC</code> type it supports.</p> <p>But decimals are supported by most of the other SQL databases. \ud83c\udf89</p>"},{"location":"advanced/uuid/","title":"UUID (Universally Unique Identifiers)","text":"<p>We have discussed some data types like <code>str</code>, <code>int</code>, etc.</p> <p>There's another data type called <code>UUID</code> (Universally Unique Identifier).</p> <p>You might have seen UUIDs, for example in URLs. They look something like this:</p> <pre><code>4ff2dab7-bffe-414d-88a5-1826b9fea8df\n</code></pre> <p>UUIDs can be particularly useful as an alternative to auto-incrementing integers for primary keys.</p> <p>Info</p> <p>Official support for UUIDs was added in SQLDev version <code>0.0.20</code>.</p>"},{"location":"advanced/uuid/#about-uuids","title":"About UUIDs","text":"<p>UUIDs are numbers with 128 bits, that is, 16 bytes.</p> <p>They are normally seen as 32 hexadecimal characters separated by dashes.</p> <p>There are several versions of UUID, some versions include the current time in the bytes, but UUIDs version 4 are mainly random, the way they are generated makes them virtually unique.</p>"},{"location":"advanced/uuid/#distributed-uuids","title":"Distributed UUIDs","text":"<p>You could generate one UUID in one computer, and someone else could generate another UUID in another computer, and it would be almost impossible for both UUIDs to be the same.</p> <p>This means that you don't have to wait for the DB to generate the ID for you, you can generate it in code before sending it to the database, because you can be quite certain it will be unique.</p> <p>Technical Details</p> <p>Because the number of possible UUIDs is so large (2^128), the probability of generating the same UUID version 4 (the random ones) twice is very low.</p> <p>If you had 103 trillion version 4 UUIDs stored in the database, the probability of generating a duplicated new one is one in a billion. \ud83e\udd13</p> <p>For the same reason, if you decided to migrate your database, combine it with another database and mix records, etc. you would most probably be able to just use the same UUIDs you had originally.</p> <p>Warning</p> <p>There's still a chance you could have a collision, but it's very low. In most cases you could assume you wouldn't have it, but it would be good to be prepared for it.</p>"},{"location":"advanced/uuid/#uuids-prevent-information-leakage","title":"UUIDs Prevent Information Leakage","text":"<p>Because UUIDs version 4 are random, you could give these IDs to the application users or to other systems, without exposing information about your application.</p> <p>When using auto-incremented integers for primary keys, you could implicitly expose information about your system. For example, someone could create a new hero, and by getting the hero ID <code>20</code> they would know that you have 20 heroes in your system (or even less, if some heroes were already deleted).</p>"},{"location":"advanced/uuid/#uuid-storage","title":"UUID Storage","text":"<p>Because UUIDs are 16 bytes, they would consume more space in the database than a smaller auto-incremented integer (commonly 4 bytes).</p> <p>Depending on the database you use, UUIDs could have better or worse performance. If you are concerned about that, you should check the documentation for the specific database.</p> <p>SQLite doesn't have a specific UUID type, so it will store the UUID as a string. Other databases like Postgres have a specific UUID type which would result in better performance and space usage than strings.</p>"},{"location":"advanced/uuid/#models-with-uuids","title":"Models with UUIDs","text":"<p>To use UUIDs as primary keys we need to import <code>uuid</code>, which is part of the Python standard library (we don't have to install anything) and use <code>uuid.UUID</code> as the type for the ID field.</p> <p>We also want the Python code to generate a new UUID when creating a new instance, so we use <code>default_factory</code>.</p> <p>The parameter <code>default_factory</code> takes a function (or in general, a \"callable\"). This function will be called when creating a new instance of the model and the value returned by the function will be used as the default value for the field.</p> <p>For the function in <code>default_factory</code> we pass <code>uuid.uuid4</code>, which is a function that generates a new UUID version 4.</p> <p>Tip</p> <p>We don't call <code>uuid.uuid4()</code> ourselves in the code (we don't put the parenthesis). Instead, we pass the function itself, just <code>uuid.uuid4</code>, so that SQLDev can call it every time we create a new instance.</p> <p>This means that the UUID will be generated in the Python code, before sending the data to the database.</p> Python 3.10+Python 3.7+ <pre><code>import uuid\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: uuid.UUID = Field(default_factory=uuid.uuid4, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>import uuid\nfrom typing import Union\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: uuid.UUID = Field(default_factory=uuid.uuid4, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Union[int, None] = Field(default=None, index=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>import uuid\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: uuid.UUID = Field(default_factory=uuid.uuid4, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_hero():\n    with Session(engine) as session:\n        hero = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n        print(\"The hero before saving in the DB\")\n        print(hero)\n        print(\"The hero ID was already set\")\n        print(hero.id)\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"After saving in the DB\")\n        print(hero)\n\n\ndef select_hero():\n    with Session(engine) as session:\n        hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_2)\n        session.commit()\n        session.refresh(hero_2)\n        hero_id = hero_2.id\n        print(\"Created hero:\")\n        print(hero_2)\n        print(\"Created hero ID:\")\n        print(hero_id)\n\n        statement = select(Hero).where(Hero.id == hero_id)\n        selected_hero = session.exec(statement).one()\n        print(\"Selected hero:\")\n        print(selected_hero)\n        print(\"Selected hero ID:\")\n        print(selected_hero.id)\n\n\ndef main() -&gt; None:\n    create_db_and_tables()\n    create_hero()\n    select_hero()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>import uuid\nfrom typing import Union\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: uuid.UUID = Field(default_factory=uuid.uuid4, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Union[int, None] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_hero():\n    with Session(engine) as session:\n        hero = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n        print(\"The hero before saving in the DB\")\n        print(hero)\n        print(\"The hero ID was already set\")\n        print(hero.id)\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"After saving in the DB\")\n        print(hero)\n\n\ndef select_hero():\n    with Session(engine) as session:\n        hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_2)\n        session.commit()\n        session.refresh(hero_2)\n        hero_id = hero_2.id\n        print(\"Created hero:\")\n        print(hero_2)\n        print(\"Created hero ID:\")\n        print(hero_id)\n\n        statement = select(Hero).where(Hero.id == hero_id)\n        selected_hero = session.exec(statement).one()\n        print(\"Selected hero:\")\n        print(selected_hero)\n        print(\"Selected hero ID:\")\n        print(selected_hero.id)\n\n\ndef main() -&gt; None:\n    create_db_and_tables()\n    create_hero()\n    select_hero()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Pydantic has support for <code>UUID</code> types.</p> <p>For the database, SQLDev internally uses SQLAlchemy's <code>Uuid</code> type.</p>"},{"location":"advanced/uuid/#create-a-record-with-a-uuid","title":"Create a Record with a UUID","text":"<p>When creating a <code>Hero</code> record, the <code>id</code> field will be automatically populated with a new UUID because we set <code>default_factory=uuid.uuid4</code>.</p> <p>As <code>uuid.uuid4</code> will be called when creating the model instance, even before sending it to the database, we can access and use the ID right away.</p> <p>And that same ID (a UUID) will be saved in the database.</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_hero():\n    with Session(engine) as session:\n        hero = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n        print(\"The hero before saving in the DB\")\n        print(hero)\n        print(\"The hero ID was already set\")\n        print(hero.id)\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"After saving in the DB\")\n        print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_hero():\n    with Session(engine) as session:\n        hero = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n        print(\"The hero before saving in the DB\")\n        print(hero)\n        print(\"The hero ID was already set\")\n        print(hero.id)\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"After saving in the DB\")\n        print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>import uuid\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: uuid.UUID = Field(default_factory=uuid.uuid4, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_hero():\n    with Session(engine) as session:\n        hero = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n        print(\"The hero before saving in the DB\")\n        print(hero)\n        print(\"The hero ID was already set\")\n        print(hero.id)\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"After saving in the DB\")\n        print(hero)\n\n\ndef select_hero():\n    with Session(engine) as session:\n        hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_2)\n        session.commit()\n        session.refresh(hero_2)\n        hero_id = hero_2.id\n        print(\"Created hero:\")\n        print(hero_2)\n        print(\"Created hero ID:\")\n        print(hero_id)\n\n        statement = select(Hero).where(Hero.id == hero_id)\n        selected_hero = session.exec(statement).one()\n        print(\"Selected hero:\")\n        print(selected_hero)\n        print(\"Selected hero ID:\")\n        print(selected_hero.id)\n\n\ndef main() -&gt; None:\n    create_db_and_tables()\n    create_hero()\n    select_hero()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>import uuid\nfrom typing import Union\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: uuid.UUID = Field(default_factory=uuid.uuid4, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Union[int, None] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_hero():\n    with Session(engine) as session:\n        hero = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n        print(\"The hero before saving in the DB\")\n        print(hero)\n        print(\"The hero ID was already set\")\n        print(hero.id)\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"After saving in the DB\")\n        print(hero)\n\n\ndef select_hero():\n    with Session(engine) as session:\n        hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_2)\n        session.commit()\n        session.refresh(hero_2)\n        hero_id = hero_2.id\n        print(\"Created hero:\")\n        print(hero_2)\n        print(\"Created hero ID:\")\n        print(hero_id)\n\n        statement = select(Hero).where(Hero.id == hero_id)\n        selected_hero = session.exec(statement).one()\n        print(\"Selected hero:\")\n        print(selected_hero)\n        print(\"Selected hero ID:\")\n        print(selected_hero.id)\n\n\ndef main() -&gt; None:\n    create_db_and_tables()\n    create_hero()\n    select_hero()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"advanced/uuid/#select-a-hero","title":"Select a Hero","text":"<p>We can do the same operations we could do with other fields.</p> <p>For example we can select a hero by ID:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_hero():\n    with Session(engine) as session:\n        hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_2)\n        session.commit()\n        session.refresh(hero_2)\n        hero_id = hero_2.id\n        print(\"Created hero:\")\n        print(hero_2)\n        print(\"Created hero ID:\")\n        print(hero_id)\n\n        statement = select(Hero).where(Hero.id == hero_id)\n        selected_hero = session.exec(statement).one()\n        print(\"Selected hero:\")\n        print(selected_hero)\n        print(\"Selected hero ID:\")\n        print(selected_hero.id)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_hero():\n    with Session(engine) as session:\n        hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_2)\n        session.commit()\n        session.refresh(hero_2)\n        hero_id = hero_2.id\n        print(\"Created hero:\")\n        print(hero_2)\n        print(\"Created hero ID:\")\n        print(hero_id)\n\n        statement = select(Hero).where(Hero.id == hero_id)\n        selected_hero = session.exec(statement).one()\n        print(\"Selected hero:\")\n        print(selected_hero)\n        print(\"Selected hero ID:\")\n        print(selected_hero.id)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>import uuid\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: uuid.UUID = Field(default_factory=uuid.uuid4, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_hero():\n    with Session(engine) as session:\n        hero = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n        print(\"The hero before saving in the DB\")\n        print(hero)\n        print(\"The hero ID was already set\")\n        print(hero.id)\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"After saving in the DB\")\n        print(hero)\n\n\ndef select_hero():\n    with Session(engine) as session:\n        hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_2)\n        session.commit()\n        session.refresh(hero_2)\n        hero_id = hero_2.id\n        print(\"Created hero:\")\n        print(hero_2)\n        print(\"Created hero ID:\")\n        print(hero_id)\n\n        statement = select(Hero).where(Hero.id == hero_id)\n        selected_hero = session.exec(statement).one()\n        print(\"Selected hero:\")\n        print(selected_hero)\n        print(\"Selected hero ID:\")\n        print(selected_hero.id)\n\n\ndef main() -&gt; None:\n    create_db_and_tables()\n    create_hero()\n    select_hero()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>import uuid\nfrom typing import Union\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: uuid.UUID = Field(default_factory=uuid.uuid4, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Union[int, None] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_hero():\n    with Session(engine) as session:\n        hero = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n        print(\"The hero before saving in the DB\")\n        print(hero)\n        print(\"The hero ID was already set\")\n        print(hero.id)\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"After saving in the DB\")\n        print(hero)\n\n\ndef select_hero():\n    with Session(engine) as session:\n        hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_2)\n        session.commit()\n        session.refresh(hero_2)\n        hero_id = hero_2.id\n        print(\"Created hero:\")\n        print(hero_2)\n        print(\"Created hero ID:\")\n        print(hero_id)\n\n        statement = select(Hero).where(Hero.id == hero_id)\n        selected_hero = session.exec(statement).one()\n        print(\"Selected hero:\")\n        print(selected_hero)\n        print(\"Selected hero ID:\")\n        print(selected_hero.id)\n\n\ndef main() -&gt; None:\n    create_db_and_tables()\n    create_hero()\n    select_hero()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Tip</p> <p>Even if a database like SQLite stores the UUID as a string, we can select and run comparisons using a Python UUID object and it will work.</p> <p>SQLDev (actually SQLAlchemy) will take care of making it work. \u2728</p>"},{"location":"advanced/uuid/#select-with-sessionget","title":"Select with <code>session.get()</code>","text":"<p>We could also select by ID with <code>session.get()</code>:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_hero():\n    with Session(engine) as session:\n        hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_2)\n        session.commit()\n        session.refresh(hero_2)\n        hero_id = hero_2.id\n        print(\"Created hero:\")\n        print(hero_2)\n        print(\"Created hero ID:\")\n        print(hero_id)\n\n        selected_hero = session.get(Hero, hero_id)\n        print(\"Selected hero:\")\n        print(selected_hero)\n        print(\"Selected hero ID:\")\n        print(selected_hero.id)\n\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_hero():\n    with Session(engine) as session:\n        hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_2)\n        session.commit()\n        session.refresh(hero_2)\n        hero_id = hero_2.id\n        print(\"Created hero:\")\n        print(hero_2)\n        print(\"Created hero ID:\")\n        print(hero_id)\n\n        selected_hero = session.get(Hero, hero_id)\n        print(\"Selected hero:\")\n        print(selected_hero)\n        print(\"Selected hero ID:\")\n        print(selected_hero.id)\n\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>import uuid\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: uuid.UUID = Field(default_factory=uuid.uuid4, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_hero():\n    with Session(engine) as session:\n        hero = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n        print(\"The hero before saving in the DB\")\n        print(hero)\n        print(\"The hero ID was already set\")\n        print(hero.id)\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"After saving in the DB\")\n        print(hero)\n\n\ndef select_hero():\n    with Session(engine) as session:\n        hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_2)\n        session.commit()\n        session.refresh(hero_2)\n        hero_id = hero_2.id\n        print(\"Created hero:\")\n        print(hero_2)\n        print(\"Created hero ID:\")\n        print(hero_id)\n\n        selected_hero = session.get(Hero, hero_id)\n        print(\"Selected hero:\")\n        print(selected_hero)\n        print(\"Selected hero ID:\")\n        print(selected_hero.id)\n\n\ndef main() -&gt; None:\n    create_db_and_tables()\n    create_hero()\n    select_hero()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>import uuid\nfrom typing import Union\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: uuid.UUID = Field(default_factory=uuid.uuid4, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Union[int, None] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_hero():\n    with Session(engine) as session:\n        hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n        print(\"The hero before saving in the DB\")\n        print(hero_1)\n        print(\"The hero ID was already set\")\n        print(hero_1.id)\n        session.add(hero_1)\n        session.commit()\n        session.refresh(hero_1)\n        print(\"After saving in the DB\")\n        print(hero_1)\n\n\ndef select_hero():\n    with Session(engine) as session:\n        hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_2)\n        session.commit()\n        session.refresh(hero_2)\n        hero_id = hero_2.id\n        print(\"Created hero:\")\n        print(hero_2)\n        print(\"Created hero ID:\")\n        print(hero_id)\n\n        selected_hero = session.get(Hero, hero_id)\n        print(\"Selected hero:\")\n        print(selected_hero)\n        print(\"Selected hero ID:\")\n        print(selected_hero.id)\n\n\ndef main() -&gt; None:\n    create_db_and_tables()\n    create_hero()\n    select_hero()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>The same way as with other fields, we could update, delete, etc. \ud83d\ude80</p>"},{"location":"advanced/uuid/#run-the-program","title":"Run the program","text":"<p>If you run the program, you will see the UUID generated in the Python code, and then the record saved in the database with the same UUID.</p> <pre><code>$ python app.py\n\n// Some boilerplate and previous output omitted \ud83d\ude09\n\n// In SQLite, the UUID will be stored as a string\n// other DBs like Postgres have a specific UUID type\nCREATE TABLE hero (\n        id CHAR(32) NOT NULL,\n        name VARCHAR NOT NULL,\n        secret_name VARCHAR NOT NULL,\n        age INTEGER,\n        PRIMARY KEY (id)\n)\n\n// Before saving in the DB we already have the UUID\nThe hero before saving in the DB\nname='Deadpond' secret_name='Dive Wilson' id=UUID('0e44c1a6-88d3-4a35-8b8a-307faa2def28') age=None\nThe hero ID was already set\n0e44c1a6-88d3-4a35-8b8a-307faa2def28\n\n// The SQL statement to insert the record uses our UUID\nINSERT INTO hero (id, name, secret_name, age) VALUES (?, ?, ?, ?)\n('0e44c1a688d34a358b8a307faa2def28', 'Deadpond', 'Dive Wilson', None)\n\n// And indeed, the record was saved with the UUID we created \ud83d\ude0e\nAfter saving in the DB\nage=None id=UUID('0e44c1a6-88d3-4a35-8b8a-307faa2def28') name='Deadpond' secret_name='Dive Wilson'\n\n// Now we create a new hero (to select it in a bit)\nCreated hero:\nage=None id=UUID('9d90d186-85db-4eaa-891a-def7b4ae2dab') name='Spider-Boy' secret_name='Pedro Parqueador'\nCreated hero ID:\n9d90d186-85db-4eaa-891a-def7b4ae2dab\n\n// And now we select it\nSelected hero:\nage=None id=UUID('9d90d186-85db-4eaa-891a-def7b4ae2dab') name='Spider-Boy' secret_name='Pedro Parqueador'\nSelected hero ID:\n9d90d186-85db-4eaa-891a-def7b4ae2dab\n</code></pre>"},{"location":"advanced/uuid/#learn-more","title":"Learn More","text":"<p>You can learn more about UUIDs in:</p> <ul> <li>The official Python docs for UUID.</li> <li>The Wikipedia for UUID.</li> </ul>"},{"location":"learn/","title":"Learn","text":"<p>Learn how to use SQLDev here.</p> <p>This includes an introduction to databases, SQL, how to interact with databases from code and more.</p> <p>You could consider this a book, a course, the official and recommended way to learn SQLDev. \ud83d\ude0e</p>"},{"location":"resources/","title":"Resources","text":"<p>Additional resources, how to help and get help, how to contribute, and more. \u2708\ufe0f</p>"},{"location":"tutorial/","title":"Tutorial - User Guide","text":"<p>In this tutorial you will learn how to use SQLDev.</p>"},{"location":"tutorial/#type-hints","title":"Type hints","text":"<p>If you need a refresher about how to use Python type hints (type annotations), check ReadyAPI's Python types intro.</p> <p>You can also check the mypy cheat sheet.</p> <p>SQLDev uses type annotations for everything, this way you can use a familiar Python syntax and get all the editor support possible, with autocompletion and in-editor error checking.</p>"},{"location":"tutorial/#intro","title":"Intro","text":"<p>This tutorial shows you how to use SQLDev with all its features, step by step.</p> <p>Each section gradually builds on the previous ones, but it's structured to separate topics, so that you can go directly to any specific one to solve your specific needs.</p> <p>It is also built to work as a future reference.</p> <p>So you can come back and see exactly what you need.</p>"},{"location":"tutorial/#run-the-code","title":"Run the code","text":"<p>All the code blocks can be copied and used directly (they are tested Python files).</p> <p>It is HIGHLY encouraged that you write or copy the code, edit it, and run it locally.</p> <p>Using it in your editor is what really shows you the benefits of SQLDev, seeing how much code it saves you, and all the editor support you get, with autocompletion and in-editor error checks, preventing lots of bugs.</p> <p>Running the examples is what will really help you understand what is going on.</p> <p>You can learn a lot more by running some examples and playing around with them than by reading all the docs here.</p>"},{"location":"tutorial/automatic-id-none-refresh/","title":"Automatic IDs, None Defaults, and Refreshing Data","text":"<p>In the previous chapter, we saw how to add rows to the database using SQLDev.</p> <p>Now let's talk a bit about why the <code>id</code> field can't be <code>NULL</code> on the database because it's a primary key, and we declare it using <code>Field(primary_key=True)</code>.</p> <p>But the same <code>id</code> field actually can be <code>None</code> in the Python code, so we declare the type with <code>int | None (or Optional[int])</code>, and set the default value to <code>Field(default=None)</code>:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n    print(\"After the session closes\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n    print(\"After the session closes\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Next, I'll show you a bit more about the synchronization of data between the database and the Python code.</p> <p>When do we get an actual <code>int</code> from the database in that <code>id</code> field? Let's see all that. \ud83d\udc47</p>"},{"location":"tutorial/automatic-id-none-refresh/#create-a-new-hero-instance","title":"Create a New <code>Hero</code> Instance","text":"<p>When we create a new <code>Hero</code> instance, we don't set the <code>id</code>:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n    print(\"After the session closes\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n    print(\"After the session closes\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/automatic-id-none-refresh/#how-optional-helps","title":"How <code>Optional</code> Helps","text":"<p>Because we don't set the <code>id</code>, it takes the Python's default value of <code>None</code> that we set in <code>Field(default=None)</code>.</p> <p>This is the only reason why we define it with <code>Optional</code> and with a default value of <code>None</code>.</p> <p>Because at this point in the code, before interacting with the database, the Python value could actually be <code>None</code>.</p> <p>If we assumed that the <code>id</code> was always an <code>int</code> and added the type annotation without <code>Optional</code>, we could end up writing broken code, like:</p> <pre><code>next_hero_id = hero_1.id + 1\n</code></pre> <p>If we ran this code before saving the hero to the database and the <code>hero_1.id</code> was still <code>None</code>, we would get an error like:</p> <pre><code>TypeError: unsupported operand type(s) for +: 'NoneType' and 'int'\n</code></pre> <p>But by declaring it with <code>Optional[int]</code>, the editor will help us to avoid writing broken code by showing us a warning telling us that the code could be invalid if <code>hero_1.id</code> is <code>None</code>. \ud83d\udd0d</p>"},{"location":"tutorial/automatic-id-none-refresh/#print-the-default-id-values","title":"Print the Default <code>id</code> Values","text":"<p>We can confirm that by printing our heroes before adding them to the database:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n    print(\"After the session closes\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n    print(\"After the session closes\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>That will output:</p> <pre><code>$ python app.py\n\n// Output above omitted \ud83d\udc46\n\nBefore interacting with the database\nHero 1: id=None name='Deadpond' secret_name='Dive Wilson' age=None\nHero 2: id=None name='Spider-Boy' secret_name='Pedro Parqueador' age=None\nHero 3: id=None name='Rusty-Man' secret_name='Tommy Sharp' age=48\n</code></pre> <p>Notice they all have <code>id=None</code>.</p> <p>That's the default value we defined in the <code>Hero</code> model class.</p> <p>What happens when we <code>add</code> these objects to the session?</p>"},{"location":"tutorial/automatic-id-none-refresh/#add-the-objects-to-the-session","title":"Add the Objects to the Session","text":"<p>After we add the <code>Hero</code> instance objects to the session, the IDs are still <code>None</code>.</p> <p>We can verify by creating a session using a <code>with</code> block and adding the objects. And then printing them again:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n    print(\"After the session closes\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n    print(\"After the session closes\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>This will, again, output the <code>id</code>s of the objects as <code>None</code>:</p> <pre><code>$ python app.py\n\n// Output above omitted \ud83d\udc46\n\nAfter adding to the session\nHero 1: id=None name='Deadpond' secret_name='Dive Wilson' age=None\nHero 2: id=None name='Spider-Boy' secret_name='Pedro Parqueador' age=None\nHero 3: id=None name='Rusty-Man' secret_name='Tommy Sharp' age=48\n</code></pre> <p>As we saw before, the session is smart and doesn't talk to the database every time we prepare something to be changed, only after we are ready and tell it to <code>commit</code> the changes it goes and sends all the SQL to the database to store the data.</p>"},{"location":"tutorial/automatic-id-none-refresh/#commit-the-changes-to-the-database","title":"Commit the Changes to the Database","text":"<p>Then we can <code>commit</code> the changes in the session, and print again:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n    print(\"After the session closes\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n    print(\"After the session closes\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>And now, something unexpected happens, look at the output, it seems as if the <code>Hero</code> instance objects had no data at all:</p> <pre><code>$ python app.py\n\n// Output above omitted \ud83d\udc46\n\n// Here the engine talks to the database, the SQL part\nINFO Engine BEGIN (implicit)\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [generated in 0.00018s] ('Deadpond', 'Dive Wilson', None)\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [cached since 0.0008968s ago] ('Spider-Boy', 'Pedro Parqueador', None)\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [cached since 0.001143s ago] ('Rusty-Man', 'Tommy Sharp', 48)\nINFO Engine COMMIT\n\n// And now our prints\nAfter committing the session\nHero 1:\nHero 2:\nHero 3:\n\n// What is happening here? \ud83d\ude31\n</code></pre> <p>What happens is that SQLDev (actually SQLAlchemy) is internally marking those objects as \"expired\", they don't have the latest version of their data. This is because we could have some fields updated in the database, for example, imagine a field <code>updated_at: datetime</code> that was automatically updated when we saved changes.</p> <p>The same way, other values could have changed, so the option the session has to be sure and safe is to just internally mark the objects as expired.</p> <p>And then, next time we access each attribute, for example with:</p> <pre><code>current_hero_name = hero_1.name\n</code></pre> <p>...SQLDev (actually SQLAlchemy) will make sure to contact the database and get the most recent version of the data, updating that field <code>name</code> in our object and then making it available for the rest of the Python expression. In the example above, at that point, Python would be able to continue executing and use that <code>hero_1.name</code> value (just updated) to put it in the variable <code>current_hero_name</code>.</p> <p>All this happens automatically and behind the scenes. \u2728</p> <p>And here's the funny and strange thing with our example:</p> <pre><code>print(\"Hero 1:\", hero_1)\n</code></pre> <p>We didn't access the object's attributes, like <code>hero.name</code>. We only accessed the entire object and printed it, so SQLAlchemy has no way of knowing that we want to access this object's data.</p>"},{"location":"tutorial/automatic-id-none-refresh/#print-a-single-field","title":"Print a Single Field","text":"<p>To confirm and understand how this automatic expiration and refresh of data when accessing attributes work, we can print some individual fields (instance attributes):</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n    print(\"After the session closes\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n    print(\"After the session closes\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Now we are actually accessing the attributes, because instead of printing the whole object <code>hero_1</code>:</p> <pre><code>print(\"Hero 1:\", hero_1)\n</code></pre> <p>...we are now printing the <code>id</code> attribute in <code>hero.id</code>:</p> <pre><code>print(\"Hero 1 ID:\", hero_1.id)\n</code></pre> <p>By accessing the attribute, that triggers a lot of work done by SQLDev (actually SQLAlchemy) underneath to refresh the data from the database, set it in the object's <code>id</code> attribute, and make it available for the Python expression (in this case just to print it).</p> <p>Let's see how it works:</p> <pre><code>$ python app.py\n\n// Output above omitted \ud83d\udc46\n\n// After committing, the objects are expired and have no values\nAfter committing the session\nHero 1:\nHero 2:\nHero 3:\n\n// Now we will access an attribute like the ID, this is the first print\nAfter committing the session, show IDs\n\n// Notice that before printing the first ID, the Session makes the Engine go to the database to refresh the data \ud83e\udd13\nINFO Engine BEGIN (implicit)\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00017s] (1,)\n\n// Here's our first print, now we have the database-generated ID\nHero 1 ID: 1\n\n// Before the next print, refresh the data for the second object\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.001245s ago] (2,)\n\n// Here's our print for the second hero with its auto-generated ID\nHero 2 ID: 2\n\n// Before the third print, refresh its data\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.002215s ago] (3,)\n\n// And here's our print for the third hero\nHero 3 ID: 3\n\n// What if we print another attribute like the name?\nAfter committing the session, show names\nHero 1 name: Deadpond\nHero 2 name: Spider-Boy\nHero 3 name: Rusty-Man\n\n// Because the Session already refreshed these objects with all their data and the session knows they are not expired, it doesn't have to go again to the database for the names \ud83e\udd13\n</code></pre>"},{"location":"tutorial/automatic-id-none-refresh/#refresh-objects-explicitly","title":"Refresh Objects Explicitly","text":"<p>You just learnt how the session refreshes the data automatically behind the scenes, as a side effect, when you access an attribute.</p> <p>But what if you want to explicitly refresh the data?</p> <p>You can do that too with <code>session.refresh(object)</code>:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n    print(\"After the session closes\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n    print(\"After the session closes\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>When Python executes this code:</p> <pre><code>session.refresh(hero_1)\n</code></pre> <p>...the session goes and makes the engine communicate with the database to get the recent data for this object <code>hero_1</code>, and then the session puts the data in the <code>hero_1</code> object and marks it as \"fresh\" or \"not expired\".</p> <p>Here's how the output would look like:</p> <pre><code>$ python app.py\n\n// Output above omitted \ud83d\udc46\n\n// The first refresh\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00024s] (1,)\n\n// The second refresh\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.001487s ago] (2,)\n\n// The third refresh\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.002377s ago] (3,)\n\n// Now print the data, as it's already refreshed there's no need for the Session to go and refresh it again\nAfter refreshing the heroes\nHero 1: age=None id=1 name='Deadpond' secret_name='Dive Wilson'\nHero 2: age=None id=2 name='Spider-Boy' secret_name='Pedro Parqueador'\nHero 3: age=48 id=3 name='Rusty-Man' secret_name='Tommy Sharp'\n</code></pre> <p>This could be useful, for example, if you are building a web API to create heroes. And once a hero is created with some data, you return it to the client.</p> <p>You wouldn't want to return an object that looks empty because the automatic magic to refresh the data was not triggered.</p> <p>In this case, after committing the object to the database with the session, you could refresh it, and then return it to the client. This would ensure that the object has its fresh data.</p>"},{"location":"tutorial/automatic-id-none-refresh/#print-data-after-closing-the-session","title":"Print Data After Closing the Session","text":"<p>Now, as a final experiment, we can also print data after the session is closed.</p> <p>There are no surprises here, it still works:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n    print(\"After the session closes\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n    print(\"After the session closes\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n    print(\"After the session closes\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    print(\"Before interacting with the database\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        print(\"After adding to the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        session.commit()\n\n        print(\"After committing the session\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n        print(\"After committing the session, show IDs\")\n        print(\"Hero 1 ID:\", hero_1.id)\n        print(\"Hero 2 ID:\", hero_2.id)\n        print(\"Hero 3 ID:\", hero_3.id)\n\n        print(\"After committing the session, show names\")\n        print(\"Hero 1 name:\", hero_1.name)\n        print(\"Hero 2 name:\", hero_2.name)\n        print(\"Hero 3 name:\", hero_3.name)\n\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n        session.refresh(hero_3)\n\n        print(\"After refreshing the heroes\")\n        print(\"Hero 1:\", hero_1)\n        print(\"Hero 2:\", hero_2)\n        print(\"Hero 3:\", hero_3)\n\n    print(\"After the session closes\")\n    print(\"Hero 1:\", hero_1)\n    print(\"Hero 2:\", hero_2)\n    print(\"Hero 3:\", hero_3)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>And the output shows again the same data:</p> <pre><code>$ python app.py\n\n// Output above omitted \ud83d\udc46\n\n// By finishing the with block, the Session is closed, including a rollback of any pending transaction that could have been there and was not committed\nINFO Engine ROLLBACK\n\n// Then we print the data, it works normally\nAfter the session closes\nHero 1: age=None id=1 name='Deadpond' secret_name='Dive Wilson'\nHero 2: age=None id=2 name='Spider-Boy' secret_name='Pedro Parqueador'\nHero 3: age=48 id=3 name='Rusty-Man' secret_name='Tommy Sharp'\n</code></pre>"},{"location":"tutorial/automatic-id-none-refresh/#review-all-the-code","title":"Review All the Code","text":"<p>Now let's review all this code once again.</p> <p>Tip</p> <p>Each one of the numbered bubbles shows what each line will print in the output.</p> <p>And as we created the engine with <code>echo=True</code>, we can see the SQL statements being executed at each step.</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")  # (1)!\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")  # (2)!\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)  # (3)!\n\n    print(\"Before interacting with the database\")  # (4)!\n    print(\"Hero 1:\", hero_1)  # (5)!\n    print(\"Hero 2:\", hero_2)  # (6)!\n    print(\"Hero 3:\", hero_3)  # (7)!\n\n    with Session(engine) as session:  # (8)!\n        session.add(hero_1)  # (9)!\n        session.add(hero_2)  # (10)!\n        session.add(hero_3)  # (11)!\n\n        print(\"After adding to the session\")  # (12)!\n        print(\"Hero 1:\", hero_1)  # (13)!\n        print(\"Hero 2:\", hero_2)  # (14)!\n        print(\"Hero 3:\", hero_3)  # (15)!\n\n        session.commit()  # (16)!\n\n        print(\"After committing the session\")  # (17)!\n        print(\"Hero 1:\", hero_1)  # (18)!\n        print(\"Hero 2:\", hero_2)  # (19)!\n        print(\"Hero 3:\", hero_3)  # (20)!\n\n        print(\"After committing the session, show IDs\")  # (21)!\n        print(\"Hero 1 ID:\", hero_1.id)  # (22)!\n        print(\"Hero 2 ID:\", hero_2.id)  # (23)!\n        print(\"Hero 3 ID:\", hero_3.id)  # (24)!\n\n        print(\"After committing the session, show names\")  # (25)!\n        print(\"Hero 1 name:\", hero_1.name)  # (26)!\n        print(\"Hero 2 name:\", hero_2.name)  # (27)!\n        print(\"Hero 3 name:\", hero_3.name)  # (28)!\n\n        session.refresh(hero_1)  # (29)!\n        session.refresh(hero_2)  # (30)!\n        session.refresh(hero_3)  # (31)!\n\n        print(\"After refreshing the heroes\")  # (32)!\n        print(\"Hero 1:\", hero_1)  # (33)!\n        print(\"Hero 2:\", hero_2)  # (34)!\n        print(\"Hero 3:\", hero_3)  # (35)!\n    # (36)!\n\n    print(\"After the session closes\")  # (37)!\n    print(\"Hero 1:\", hero_1)  # (38)!\n    print(\"Hero 2:\", hero_2)  # (39)!\n    print(\"Hero 3:\", hero_3)  # (40)!\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <ol> <li> <p>Create the <code>hero_1</code>.</p> <p>Doesn't generate any output.</p> </li> <li> <p>Create the <code>hero_2</code>.</p> <p>Doesn't generate any output.</p> </li> <li> <p>Create the <code>hero_3</code>.</p> <p>Doesn't generate any output.</p> </li> <li> <p>Print the line <code>\"Before interacting with the database\"</code>.</p> <p>Generates the output:</p> <pre><code>Before interacting with the database\n</code></pre> </li> <li> <p>Print the <code>hero_1</code> before interacting with the database.</p> <p>Generates the output:</p> <pre><code>Hero 1: id=None name='Deadpond' secret_name='Dive Wilson' age=None\n</code></pre> </li> <li> <p>Print the <code>hero_2</code> before interacting with the database.</p> <p>Generates the output:</p> <pre><code>Hero 2: id=None name='Spider-Boy' secret_name='Pedro Parqueador' age=None\n</code></pre> </li> <li> <p>Print the <code>hero_3</code> before interacting with the database.</p> <p>Generates the output:</p> <pre><code>Hero 3: id=None name='Rusty-Man' secret_name='Tommy Sharp' age=48\n</code></pre> </li> <li> <p>Create the <code>Session</code> in a <code>with</code> block.</p> <p>Doesn't generate any output.</p> </li> <li> <p>Add the <code>hero_1</code> to the session.</p> <p>This still doesn't save it to the database.</p> <p>Doesn't generate any output.</p> </li> <li> <p>Add the <code>hero_2</code> to the session.</p> <p>This still doesn't save it to the database.</p> <p>Doesn't generate any output.</p> </li> <li> <p>Add the <code>hero_3</code> to the session.</p> <p>This still doesn't save it to the database.</p> <p>Doesn't generate any output.</p> </li> <li> <p>Print the line <code>\"After adding to the session\"</code>.</p> <p>Generates the output:</p> <pre><code>After adding to the session\n</code></pre> </li> <li> <p>Print the <code>hero_1</code> after adding it to the session.</p> <p>It still has the same data as there hasn't been any interaction with the database yet. Notice that the <code>id</code> is still <code>None</code>.</p> <p>Generates the output:</p> <pre><code>Hero 1: id=None name='Deadpond' secret_name='Dive Wilson' age=None\n</code></pre> </li> <li> <p>Print the <code>hero_2</code> after adding it to the session.</p> <p>It still has the same data as there hasn't been any interaction with the database yet. Notice that the <code>id</code> is still <code>None</code>.</p> <p>Generates the output:</p> <pre><code>Hero 2: id=None name='Spider-Boy' secret_name='Pedro Parqueador' age=None\n</code></pre> </li> <li> <p>Print the <code>hero_3</code> after adding it to the session.</p> <p>It still has the same data as there hasn't been any interaction with the database yet. Notice that the <code>id</code> is still <code>None</code>.</p> <p>Generates the output:</p> <pre><code>Hero 3: id=None name='Rusty-Man' secret_name='Tommy Sharp' age=48\n</code></pre> </li> <li> <p><code>commit</code> the session.</p> <p>This will save all the data to the database. The session will use the engine to run a lot of SQL.</p> <p>Generates the output:</p> <pre><code>INFO Engine BEGIN (implicit)\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [generated in 0.00018s] ('Deadpond', 'Dive Wilson', None)\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [cached since 0.0008968s ago] ('Spider-Boy', 'Pedro Parqueador', None)\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [cached since 0.001143s ago] ('Rusty-Man', 'Tommy Sharp', 48)\nINFO Engine COMMIT\n</code></pre> </li> <li> <p>Print the line <code>\"After committing the session\"</code>.</p> <p>Generates the output:</p> <pre><code>After committing the session\n</code></pre> </li> <li> <p>Print the <code>hero_1</code> after committing the session.</p> <p>The <code>hero_1</code> is now internally marked as expired, and until it is refreshed, it looks like if it didn't contain any data.</p> <p>Generates the output:</p> <pre><code>Hero 1:\n</code></pre> </li> <li> <p>Print the <code>hero_2</code> after committing the session.</p> <p>The <code>hero_2</code> is now internally marked as expired, and until it is refreshed, it looks like if it didn't contain any data.</p> <p>Generates the output:</p> <pre><code>Hero 2:\n</code></pre> </li> <li> <p>Print the <code>hero_3</code> after committing the session.</p> <p>The <code>hero_3</code> is now internally marked as expired, and until it is refreshed, it looks like if it didn't contain any data.</p> <p>Generates the output:</p> <pre><code>Hero 3:\n</code></pre> </li> <li> <p>Print the line <code>\"After committing the session, show IDs\"</code>.</p> <p>Generates the output:</p> <pre><code>After committing the session, show IDs\n</code></pre> </li> <li> <p>Print the <code>hero_1.id</code>. A lot happens here.</p> <p>Because we are accessing the attribute <code>id</code> of <code>hero_1</code>, SQLDev (actually SQLAlchemy) can detect that we are trying to access data from the <code>hero_1</code>.</p> <p>It then detects that <code>hero_1</code> is currently associated with a session (because we added it to the session and committed it), and it is marked as expired.</p> <p>Then with the session, it uses the engine to execute all the SQL to fetch the data for this object from the database.</p> <p>Next it updates the object with the new data and marks it internally as \"fresh\" or \"not expired\".</p> <p>Finally, it makes the ID value available for the rest of the Python expression. In this case, the Python expression just prints the ID.</p> <p>Generates the output:</p> <pre><code>INFO Engine BEGIN (implicit)\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00017s] (1,)\n\nHero 1 ID: 1\n</code></pre> </li> <li> <p>Print the <code>hero_2.id</code>.</p> <p>A lot happens here, all the same stuff that happened at point 22, but for this <code>hero_2</code> object.</p> <p>Generates the output:</p> <pre><code>INFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.001245s ago] (2,)\n\nHero 2 ID: 2\n</code></pre> </li> <li> <p>Print the <code>hero_3.id</code>.</p> <p>A lot happens here, all the same stuff that happened at point 22, but for this <code>hero_3</code> object.</p> <p>Generates the output:</p> <pre><code>INFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.002215s ago] (3,)\n\n\nHero 3 ID: 3\n</code></pre> </li> <li> <p>Print the line <code>\"After committing the session, show names\"</code>.</p> <p>Generates the output:</p> <pre><code>After committing the session, show names\n</code></pre> </li> <li> <p>Print the <code>hero_1.name</code>.</p> <p>Because <code>hero_1</code> is still fresh, no additional data is fetched, no additional SQL is executed, and the name is available.</p> <p>Generates the output:</p> <pre><code>Hero 1 name: Deadpond\n</code></pre> </li> <li> <p>Print the <code>hero_2.name</code>.</p> <p>Because <code>hero_2</code> is still fresh, no additional data is fetched, no additional SQL is executed, and the name is available.</p> <p>Generates the output:</p> <pre><code>Hero 2 name: Spider-Boy\n</code></pre> </li> <li> <p>Print the <code>hero_3.name</code>.</p> <p>Because <code>hero_3</code> is still fresh, no additional data is fetched, no additional SQL is executed, and the name is available.</p> <p>Generates the output:</p> <pre><code>Hero 3 name: Rusty-Man\n</code></pre> </li> <li> <p>Explicitly refresh the <code>hero_1</code> object.</p> <p>The session will use the engine to execute the SQL necessary to fetch fresh data from the database for the <code>hero_1</code> object.</p> <p>Generates the output:</p> <pre><code>INFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00024s] (1,)\n</code></pre> </li> <li> <p>Explicitly refresh the <code>hero_2</code> object.</p> <p>The session will use the engine to execute the SQL necessary to fetch fresh data from the database for the <code>hero_2</code> object.</p> <p>Generates the output:</p> <pre><code>INFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.001487s ago] (2,)\n</code></pre> </li> <li> <p>Explicitly refresh the <code>hero_3</code> object.</p> <p>The session will use the engine to execute the SQL necessary to fetch fresh data from the database for the <code>hero_3</code> object.</p> <p>Generates the output:</p> <pre><code>INFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.002377s ago] (3,)\n</code></pre> </li> <li> <p>Print the line <code>\"After refreshing the heroes\"</code>.</p> <p>Generates the output:</p> <pre><code>After refreshing the heroes\n</code></pre> </li> <li> <p>Print the <code>hero_1</code>.</p> <p>Info</p> <p>Even if the <code>hero_1</code> wasn't fresh, this would not trigger a <code>refresh</code> making the session use the engine to fetch data from the database because it is not accessing an attribute.</p> <p>Because the <code>hero_1</code> is fresh it has all it's data available.</p> <p>Generates the output:</p> <pre><code>Hero 1: age=None id=1 name='Deadpond' secret_name='Dive Wilson'\n</code></pre> </li> <li> <p>Print the <code>hero_2</code>.</p> <p>Info</p> <p>Even if the <code>hero_2</code> wasn't fresh, this would not trigger a <code>refresh</code> making the session use the engine to fetch data from the database because it is not accessing an attribute.</p> <p>Because the <code>hero_2</code> is fresh it has all it's data available.</p> <p>Generates the output:</p> <pre><code>Hero 2: age=None id=2 name='Spider-Boy' secret_name='Pedro Parqueador'\n</code></pre> </li> <li> <p>Print the <code>hero_3</code>.</p> <p>Info</p> <p>Even if the <code>hero_3</code> wasn't fresh, this would not trigger a <code>refresh</code> making the session use the engine to fetch data from the database because it is not accessing an attribute.</p> <p>Because the <code>hero_3</code> is fresh it has all it's data available.</p> <p>Generates the output:</p> <pre><code>Hero 3: age=48 id=3 name='Rusty-Man' secret_name='Tommy Sharp'\n</code></pre> </li> <li> <p>The <code>with</code> block ends here (there's no more indented code), so the session is closed, running all it's closing code.</p> <p>This includes doing a <code>ROLLBACK</code> of any possible transaction that could have been started.</p> <p>Generates the output:</p> <pre><code>INFO Engine ROLLBACK\n</code></pre> </li> <li> <p>Print the line <code>\"After the session closes\"</code>.</p> <p>Generates the output:</p> <pre><code>After the session closes\n</code></pre> </li> <li> <p>Print the <code>hero_1</code> after closing the session.</p> <p>Generates the output:</p> <pre><code>Hero 1: age=None id=1 name='Deadpond' secret_name='Dive Wilson'\n</code></pre> </li> <li> <p>Print the <code>hero_2</code> after closing the session.</p> <p>Generates the output:</p> <pre><code>Hero 2: age=None id=2 name='Spider-Boy' secret_name='Pedro Parqueador'\n</code></pre> </li> <li> <p>Print the <code>hero_3</code> after closing the session.</p> <p>Generates the output:</p> <pre><code>Hero 3: age=48 id=3 name='Rusty-Man' secret_name='Tommy Sharp'\n</code></pre> </li> </ol> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")  # (1)!\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")  # (2)!\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)  # (3)!\n\n    print(\"Before interacting with the database\")  # (4)!\n    print(\"Hero 1:\", hero_1)  # (5)!\n    print(\"Hero 2:\", hero_2)  # (6)!\n    print(\"Hero 3:\", hero_3)  # (7)!\n\n    with Session(engine) as session:  # (8)!\n        session.add(hero_1)  # (9)!\n        session.add(hero_2)  # (10)!\n        session.add(hero_3)  # (11)!\n\n        print(\"After adding to the session\")  # (12)!\n        print(\"Hero 1:\", hero_1)  # (13)!\n        print(\"Hero 2:\", hero_2)  # (14)!\n        print(\"Hero 3:\", hero_3)  # (15)!\n\n        session.commit()  # (16)!\n\n        print(\"After committing the session\")  # (17)!\n        print(\"Hero 1:\", hero_1)  # (18)!\n        print(\"Hero 2:\", hero_2)  # (19)!\n        print(\"Hero 3:\", hero_3)  # (20)!\n\n        print(\"After committing the session, show IDs\")  # (21)!\n        print(\"Hero 1 ID:\", hero_1.id)  # (22)!\n        print(\"Hero 2 ID:\", hero_2.id)  # (23)!\n        print(\"Hero 3 ID:\", hero_3.id)  # (24)!\n\n        print(\"After committing the session, show names\")  # (25)!\n        print(\"Hero 1 name:\", hero_1.name)  # (26)!\n        print(\"Hero 2 name:\", hero_2.name)  # (27)!\n        print(\"Hero 3 name:\", hero_3.name)  # (28)!\n\n        session.refresh(hero_1)  # (29)!\n        session.refresh(hero_2)  # (30)!\n        session.refresh(hero_3)  # (31)!\n\n        print(\"After refreshing the heroes\")  # (32)!\n        print(\"Hero 1:\", hero_1)  # (33)!\n        print(\"Hero 2:\", hero_2)  # (34)!\n        print(\"Hero 3:\", hero_3)  # (35)!\n    # (36)!\n\n    print(\"After the session closes\")  # (37)!\n    print(\"Hero 1:\", hero_1)  # (38)!\n    print(\"Hero 2:\", hero_2)  # (39)!\n    print(\"Hero 3:\", hero_3)  # (40)!\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <ol> <li> <p>Create the <code>hero_1</code>.</p> <p>Doesn't generate any output.</p> </li> <li> <p>Create the <code>hero_2</code>.</p> <p>Doesn't generate any output.</p> </li> <li> <p>Create the <code>hero_3</code>.</p> <p>Doesn't generate any output.</p> </li> <li> <p>Print the line <code>\"Before interacting with the database\"</code>.</p> <p>Generates the output:</p> <pre><code>Before interacting with the database\n</code></pre> </li> <li> <p>Print the <code>hero_1</code> before interacting with the database.</p> <p>Generates the output:</p> <pre><code>Hero 1: id=None name='Deadpond' secret_name='Dive Wilson' age=None\n</code></pre> </li> <li> <p>Print the <code>hero_2</code> before interacting with the database.</p> <p>Generates the output:</p> <pre><code>Hero 2: id=None name='Spider-Boy' secret_name='Pedro Parqueador' age=None\n</code></pre> </li> <li> <p>Print the <code>hero_3</code> before interacting with the database.</p> <p>Generates the output:</p> <pre><code>Hero 3: id=None name='Rusty-Man' secret_name='Tommy Sharp' age=48\n</code></pre> </li> <li> <p>Create the <code>Session</code> in a <code>with</code> block.</p> <p>Doesn't generate any output.</p> </li> <li> <p>Add the <code>hero_1</code> to the session.</p> <p>This still doesn't save it to the database.</p> <p>Doesn't generate any output.</p> </li> <li> <p>Add the <code>hero_2</code> to the session.</p> <p>This still doesn't save it to the database.</p> <p>Doesn't generate any output.</p> </li> <li> <p>Add the <code>hero_3</code> to the session.</p> <p>This still doesn't save it to the database.</p> <p>Doesn't generate any output.</p> </li> <li> <p>Print the line <code>\"After adding to the session\"</code>.</p> <p>Generates the output:</p> <pre><code>After adding to the session\n</code></pre> </li> <li> <p>Print the <code>hero_1</code> after adding it to the session.</p> <p>It still has the same data as there hasn't been any interaction with the database yet. Notice that the <code>id</code> is still <code>None</code>.</p> <p>Generates the output:</p> <pre><code>Hero 1: id=None name='Deadpond' secret_name='Dive Wilson' age=None\n</code></pre> </li> <li> <p>Print the <code>hero_2</code> after adding it to the session.</p> <p>It still has the same data as there hasn't been any interaction with the database yet. Notice that the <code>id</code> is still <code>None</code>.</p> <p>Generates the output:</p> <pre><code>Hero 2: id=None name='Spider-Boy' secret_name='Pedro Parqueador' age=None\n</code></pre> </li> <li> <p>Print the <code>hero_3</code> after adding it to the session.</p> <p>It still has the same data as there hasn't been any interaction with the database yet. Notice that the <code>id</code> is still <code>None</code>.</p> <p>Generates the output:</p> <pre><code>Hero 3: id=None name='Rusty-Man' secret_name='Tommy Sharp' age=48\n</code></pre> </li> <li> <p><code>commit</code> the session.</p> <p>This will save all the data to the database. The session will use the engine to run a lot of SQL.</p> <p>Generates the output:</p> <pre><code>INFO Engine BEGIN (implicit)\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [generated in 0.00018s] ('Deadpond', 'Dive Wilson', None)\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [cached since 0.0008968s ago] ('Spider-Boy', 'Pedro Parqueador', None)\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [cached since 0.001143s ago] ('Rusty-Man', 'Tommy Sharp', 48)\nINFO Engine COMMIT\n</code></pre> </li> <li> <p>Print the line <code>\"After committing the session\"</code>.</p> <p>Generates the output:</p> <pre><code>After committing the session\n</code></pre> </li> <li> <p>Print the <code>hero_1</code> after committing the session.</p> <p>The <code>hero_1</code> is now internally marked as expired, and until it is refreshed, it looks like if it didn't contain any data.</p> <p>Generates the output:</p> <pre><code>Hero 1:\n</code></pre> </li> <li> <p>Print the <code>hero_2</code> after committing the session.</p> <p>The <code>hero_2</code> is now internally marked as expired, and until it is refreshed, it looks like if it didn't contain any data.</p> <p>Generates the output:</p> <pre><code>Hero 2:\n</code></pre> </li> <li> <p>Print the <code>hero_3</code> after committing the session.</p> <p>The <code>hero_3</code> is now internally marked as expired, and until it is refreshed, it looks like if it didn't contain any data.</p> <p>Generates the output:</p> <pre><code>Hero 3:\n</code></pre> </li> <li> <p>Print the line <code>\"After committing the session, show IDs\"</code>.</p> <p>Generates the output:</p> <pre><code>After committing the session, show IDs\n</code></pre> </li> <li> <p>Print the <code>hero_1.id</code>. A lot happens here.</p> <p>Because we are accessing the attribute <code>id</code> of <code>hero_1</code>, SQLDev (actually SQLAlchemy) can detect that we are trying to access data from the <code>hero_1</code>.</p> <p>It then detects that <code>hero_1</code> is currently associated with a session (because we added it to the session and committed it), and it is marked as expired.</p> <p>Then with the session, it uses the engine to execute all the SQL to fetch the data for this object from the database.</p> <p>Next it updates the object with the new data and marks it internally as \"fresh\" or \"not expired\".</p> <p>Finally, it makes the ID value available for the rest of the Python expression. In this case, the Python expression just prints the ID.</p> <p>Generates the output:</p> <pre><code>INFO Engine BEGIN (implicit)\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00017s] (1,)\n\nHero 1 ID: 1\n</code></pre> </li> <li> <p>Print the <code>hero_2.id</code>.</p> <p>A lot happens here, all the same stuff that happened at point 22, but for this <code>hero_2</code> object.</p> <p>Generates the output:</p> <pre><code>INFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.001245s ago] (2,)\n\nHero 2 ID: 2\n</code></pre> </li> <li> <p>Print the <code>hero_3.id</code>.</p> <p>A lot happens here, all the same stuff that happened at point 22, but for this <code>hero_3</code> object.</p> <p>Generates the output:</p> <pre><code>INFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.002215s ago] (3,)\n\n\nHero 3 ID: 3\n</code></pre> </li> <li> <p>Print the line <code>\"After committing the session, show names\"</code>.</p> <p>Generates the output:</p> <pre><code>After committing the session, show names\n</code></pre> </li> <li> <p>Print the <code>hero_1.name</code>.</p> <p>Because <code>hero_1</code> is still fresh, no additional data is fetched, no additional SQL is executed, and the name is available.</p> <p>Generates the output:</p> <pre><code>Hero 1 name: Deadpond\n</code></pre> </li> <li> <p>Print the <code>hero_2.name</code>.</p> <p>Because <code>hero_2</code> is still fresh, no additional data is fetched, no additional SQL is executed, and the name is available.</p> <p>Generates the output:</p> <pre><code>Hero 2 name: Spider-Boy\n</code></pre> </li> <li> <p>Print the <code>hero_3.name</code>.</p> <p>Because <code>hero_3</code> is still fresh, no additional data is fetched, no additional SQL is executed, and the name is available.</p> <p>Generates the output:</p> <pre><code>Hero 3 name: Rusty-Man\n</code></pre> </li> <li> <p>Explicitly refresh the <code>hero_1</code> object.</p> <p>The session will use the engine to execute the SQL necessary to fetch fresh data from the database for the <code>hero_1</code> object.</p> <p>Generates the output:</p> <pre><code>INFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00024s] (1,)\n</code></pre> </li> <li> <p>Explicitly refresh the <code>hero_2</code> object.</p> <p>The session will use the engine to execute the SQL necessary to fetch fresh data from the database for the <code>hero_2</code> object.</p> <p>Generates the output:</p> <pre><code>INFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.001487s ago] (2,)\n</code></pre> </li> <li> <p>Explicitly refresh the <code>hero_3</code> object.</p> <p>The session will use the engine to execute the SQL necessary to fetch fresh data from the database for the <code>hero_3</code> object.</p> <p>Generates the output:</p> <pre><code>INFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.002377s ago] (3,)\n</code></pre> </li> <li> <p>Print the line <code>\"After refreshing the heroes\"</code>.</p> <p>Generates the output:</p> <pre><code>After refreshing the heroes\n</code></pre> </li> <li> <p>Print the <code>hero_1</code>.</p> <p>Info</p> <p>Even if the <code>hero_1</code> wasn't fresh, this would not trigger a <code>refresh</code> making the session use the engine to fetch data from the database because it is not accessing an attribute.</p> <p>Because the <code>hero_1</code> is fresh it has all it's data available.</p> <p>Generates the output:</p> <pre><code>Hero 1: age=None id=1 name='Deadpond' secret_name='Dive Wilson'\n</code></pre> </li> <li> <p>Print the <code>hero_2</code>.</p> <p>Info</p> <p>Even if the <code>hero_2</code> wasn't fresh, this would not trigger a <code>refresh</code> making the session use the engine to fetch data from the database because it is not accessing an attribute.</p> <p>Because the <code>hero_2</code> is fresh it has all it's data available.</p> <p>Generates the output:</p> <pre><code>Hero 2: age=None id=2 name='Spider-Boy' secret_name='Pedro Parqueador'\n</code></pre> </li> <li> <p>Print the <code>hero_3</code>.</p> <p>Info</p> <p>Even if the <code>hero_3</code> wasn't fresh, this would not trigger a <code>refresh</code> making the session use the engine to fetch data from the database because it is not accessing an attribute.</p> <p>Because the <code>hero_3</code> is fresh it has all it's data available.</p> <p>Generates the output:</p> <pre><code>Hero 3: age=48 id=3 name='Rusty-Man' secret_name='Tommy Sharp'\n</code></pre> </li> <li> <p>The <code>with</code> block ends here (there's no more indented code), so the session is closed, running all it's closing code.</p> <p>This includes doing a <code>ROLLBACK</code> of any possible transaction that could have been started.</p> <p>Generates the output:</p> <pre><code>INFO Engine ROLLBACK\n</code></pre> </li> <li> <p>Print the line <code>\"After the session closes\"</code>.</p> <p>Generates the output:</p> <pre><code>After the session closes\n</code></pre> </li> <li> <p>Print the <code>hero_1</code> after closing the session.</p> <p>Generates the output:</p> <pre><code>Hero 1: age=None id=1 name='Deadpond' secret_name='Dive Wilson'\n</code></pre> </li> <li> <p>Print the <code>hero_2</code> after closing the session.</p> <p>Generates the output:</p> <pre><code>Hero 2: age=None id=2 name='Spider-Boy' secret_name='Pedro Parqueador'\n</code></pre> </li> <li> <p>Print the <code>hero_3</code> after closing the session.</p> <p>Generates the output:</p> <pre><code>Hero 3: age=48 id=3 name='Rusty-Man' secret_name='Tommy Sharp'\n</code></pre> </li> </ol> <p>And here's all the output generated by running this program, all together:</p> <pre><code>$ python app.py\n\nINFO Engine BEGIN (implicit)\nINFO Engine PRAGMA main.table_info(\"hero\")\nINFO Engine [raw sql] ()\nINFO Engine PRAGMA temp.table_info(\"hero\")\nINFO Engine [raw sql] ()\nINFO Engine\nCREATE TABLE hero (\n        id INTEGER,\n        name VARCHAR NOT NULL,\n        secret_name VARCHAR NOT NULL,\n        age INTEGER,\n        PRIMARY KEY (id)\n)\n\n\nINFO Engine [no key 0.00018s] ()\nINFO Engine COMMIT\nBefore interacting with the database\nHero 1: id=None name='Deadpond' secret_name='Dive Wilson' age=None\nHero 2: id=None name='Spider-Boy' secret_name='Pedro Parqueador' age=None\nHero 3: id=None name='Rusty-Man' secret_name='Tommy Sharp' age=48\nAfter adding to the session\nHero 1: id=None name='Deadpond' secret_name='Dive Wilson' age=None\nHero 2: id=None name='Spider-Boy' secret_name='Pedro Parqueador' age=None\nHero 3: id=None name='Rusty-Man' secret_name='Tommy Sharp' age=48\nINFO Engine BEGIN (implicit)\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [generated in 0.00022s] ('Deadpond', 'Dive Wilson', None)\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [cached since 0.001127s ago] ('Spider-Boy', 'Pedro Parqueador', None)\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [cached since 0.001483s ago] ('Rusty-Man', 'Tommy Sharp', 48)\nINFO Engine COMMIT\nAfter committing the session\nHero 1:\nHero 2:\nHero 3:\nAfter committing the session, show IDs\nINFO Engine BEGIN (implicit)\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00029s] (1,)\nHero 1 ID: 1\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.002132s ago] (2,)\nHero 2 ID: 2\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.003367s ago] (3,)\nHero 3 ID: 3\nAfter committing the session, show names\nHero 1 name: Deadpond\nHero 2 name: Spider-Boy\nHero 3 name: Rusty-Man\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00025s] (1,)\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.001583s ago] (2,)\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.002722s ago] (3,)\nAfter refreshing the heroes\nHero 1: age=None id=1 name='Deadpond' secret_name='Dive Wilson'\nHero 2: age=None id=2 name='Spider-Boy' secret_name='Pedro Parqueador'\nHero 3: age=48 id=3 name='Rusty-Man' secret_name='Tommy Sharp'\nINFO Engine ROLLBACK\nAfter the session closes\nHero 1: age=None id=1 name='Deadpond' secret_name='Dive Wilson'\nHero 2: age=None id=2 name='Spider-Boy' secret_name='Pedro Parqueador'\nHero 3: age=48 id=3 name='Rusty-Man' secret_name='Tommy Sharp'\n</code></pre>"},{"location":"tutorial/automatic-id-none-refresh/#recap","title":"Recap","text":"<p>You read all that! That was a lot! Have some cake, you earned it. \ud83c\udf70</p> <p>We discussed how the session uses the engine to send SQL to the database, to create data and to fetch data too. How it keeps track of \"expired\" and \"fresh\" data. At which moments it fetches data automatically (when accessing instance attributes) and how that data is synchronized between objects in memory and the database via the session.</p> <p>If you understood all that, now you know a lot about SQLDev, SQLAlchemy, and how the interactions from Python with databases work in general.</p> <p>If you didn't get all that, it's fine, you can always come back later to <code>refresh</code> the concepts.</p> <p>I think this might be one of the main types of bugs that cause problems and makes you scratch your head. So, good job studying it! \ud83d\udcaa</p>"},{"location":"tutorial/code-structure/","title":"Code Structure and Multiple Files","text":"<p>Let's stop for a second to think about how to structure the code, particularly in large projects with multiple files.</p>"},{"location":"tutorial/code-structure/#circular-imports","title":"Circular Imports","text":"<p>The class <code>Hero</code> has a reference to the class <code>Team</code> internally.</p> <p>But the class <code>Team</code> also has a reference to the class <code>Hero</code>.</p> <p>So, if those two classes were in separate files and you tried to import the classes in each other's file directly, it would result in a circular import. \ud83d\udd04</p> <p>And Python will not be able to handle it and will throw an error. \ud83d\udea8</p> <p>But we actually want to mean that circular reference, because in our code, we would be able to do crazy things like:</p> <pre><code>hero.team.heroes[0].team.heroes[1].team.heroes[2].name\n</code></pre> <p>And that circular reference is what we are expressing with these relationship attributes, that:</p> <ul> <li>A hero can have a team<ul> <li>That team can have a list of heroes<ul> <li>Each of those heroes can have a team<ul> <li>...and so on.</li> </ul> </li> </ul> </li> </ul> </li> </ul> <p>Let's see different strategies to structure the code accounting for this.</p>"},{"location":"tutorial/code-structure/#single-module-for-models","title":"Single Module for Models","text":"<p>This is the simplest way. \u2728</p> <p>In this solution we are still using multiple files, for the <code>models</code>, for the <code>database</code>, and for the <code>app</code>.</p> <p>And we could have any other files necessary.</p> <p>But in this first case, all the models would live in a single file.</p> <p>The file structure of the project could be:</p> <pre><code>.\n\u251c\u2500\u2500 project\n    \u251c\u2500\u2500 __init__.py\n    \u251c\u2500\u2500 app.py\n    \u251c\u2500\u2500 database.py\n    \u2514\u2500\u2500 models.py\n</code></pre> <p>We have 3 Python modules (or files):</p> <ul> <li><code>app</code></li> <li><code>database</code></li> <li><code>models</code></li> </ul> <p>And we also have an empty <code>__init__.py</code> file to make this project a \"Python package\" (a collection of Python modules). This way we can use relative imports in the <code>app.py</code> file/module, like:</p> <pre><code>from .models import Hero, Team\nfrom .database import engine\n</code></pre> <p>We can use these relative imports because, for example, in the file <code>app.py</code> (the <code>app</code> module) Python knows that it is part of our Python package because it is in the same directory as the file <code>__init__.py</code>. And all the Python files on the same directory are part of the same Python package too.</p>"},{"location":"tutorial/code-structure/#models-file","title":"Models File","text":"<p>You could put all the database Models in a single Python module (a single Python file), for example <code>models.py</code>:</p> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, SQLDev\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n</code></pre> <p>This way, you wouldn't have to deal with circular imports for other models.</p> <p>And then you could import the models from this file/module in any other file/module in your application.</p>"},{"location":"tutorial/code-structure/#database-file","title":"Database File","text":"<p>Then you could put the code creating the engine and the function to create all the tables (if you are not using migrations) in another file <code>database.py</code>:</p> <pre><code>from sqldev import SQLDev, create_engine\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n</code></pre> <p>This file would also be imported by your application code, to use the shared engine and to get and call the function <code>create_db_and_tables()</code>.</p>"},{"location":"tutorial/code-structure/#application-file","title":"Application File","text":"<p>Finally, you could put the code to create the app in another file <code>app.py</code>:</p> <pre><code>from sqldev import Session\n\nfrom .database import create_db_and_tables, engine\nfrom .models import Hero, Team\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        session.add(hero_deadpond)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Hero's team:\", hero_deadpond.team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Here we import the models, the engine, and the function to create all the tables and then we can use them all internally.</p>"},{"location":"tutorial/code-structure/#order-matters","title":"Order Matters","text":"<p>Remember that Order Matters when calling <code>SQLDev.metadata.create_all()</code>?</p> <p>The point of that section in the docs is that you have to import the module that has the models before calling <code>SQLDev.metadata.create_all()</code>.</p> <p>We are doing that here, we import the models in <code>app.py</code> and after that we create the database and tables, so we are fine and everything works correctly. \ud83d\udc4c</p>"},{"location":"tutorial/code-structure/#run-it-in-the-command-line","title":"Run It in the Command Line","text":"<p>Because now this is a larger project with a Python package and not a single Python file, we cannot call it just passing a single file name as we did before with:</p> <pre><code>$ python app.py\n</code></pre> <p>Now we have to tell Python that we want it to execute a module that is part of a package:</p> <pre><code>$ python -m project.app\n</code></pre> <p>The <code>-m</code> is to tell Python to call a module. And the next thing we pass is a string with <code>project.app</code>, that is the same format we would use in an import:</p> <pre><code>import project.app\n</code></pre> <p>Then Python will execute that module inside of that package, and because Python is executing it directly, the same trick with the main block that we have in <code>app.py</code> will still work:</p> <pre><code>if __name__ == '__main__':\n    main()\n</code></pre> <p>So, the output would be:</p> <pre><code>$ python -m project.app\n\nCreated hero: id=1 secret_name='Dive Wilson' team_id=1 name='Deadpond' age=None\nHero's team: name='Z-Force' headquarters='Sister Margaret's Bar' id=1\n</code></pre>"},{"location":"tutorial/code-structure/#make-circular-imports-work","title":"Make Circular Imports Work","text":"<p>Let's say that for some reason you hate the idea of having all the database models together in a single file, and you really want to have separate files a <code>hero_model.py</code> file and a <code>team_model.py</code> file.</p> <p>You can also do it. \ud83d\ude0e There's a couple of things to keep in mind. \ud83e\udd13</p> <p>Warning</p> <p>This is a bit more advanced.</p> <p>If the solution above already worked for you, that might be enough for you, and you can continue in the next chapter. \ud83e\udd13</p> <p>Let's assume that now the file structure is:</p> <pre><code>.\n\u251c\u2500\u2500 project\n    \u251c\u2500\u2500 __init__.py\n    \u251c\u2500\u2500 app.py\n    \u251c\u2500\u2500 database.py\n    \u251c\u2500\u2500 hero_model.py\n    \u2514\u2500\u2500 team_model.py\n</code></pre>"},{"location":"tutorial/code-structure/#circular-imports-and-type-annotations","title":"Circular Imports and Type Annotations","text":"<p>The problem with circular imports is that Python can't resolve them at runtime.</p> <p>But when using Python type annotations it's very common to need to declare the type of some variables with classes imported from other files.</p> <p>And the files with those classes might also need to import more things from the first files.</p> <p>And this ends up requiring the same circular imports that are not supported in Python at runtime.</p>"},{"location":"tutorial/code-structure/#type-annotations-and-runtime","title":"Type Annotations and Runtime","text":"<p>But these type annotations we want to declare are not needed at runtime.</p> <p>In fact, remember that we used <code>List[\"Hero\"]</code>, with a <code>\"Hero\"</code> in a string?</p> <p>For Python, at runtime, that is just a string.</p> <p>So, if we could add the type annotations we need using the string versions, Python wouldn't have a problem.</p> <p>But if we just put strings in the type annotations, without importing anything, the editor wouldn't know what we mean, and wouldn't be able to help us with autocompletion and inline errors.</p> <p>So, if there was a way to \"import\" some things that act as \"imported\" only while editing the code but not at runtime, that would solve it... And it exists! Exactly that. \ud83c\udf89</p>"},{"location":"tutorial/code-structure/#import-only-while-editing-with-type_checking","title":"Import Only While Editing with <code>TYPE_CHECKING</code>","text":"<p>To solve it, there's a special trick with a special variable <code>TYPE_CHECKING</code> in the <code>typing</code> module.</p> <p>It has a value of <code>True</code> for editors and tools that analyze the code with the type annotations.</p> <p>But when Python is executing, its value is <code>False</code>.</p> <p>So, we can use it in an <code>if</code> block and import things inside the <code>if</code> block. And they will be \"imported\" only for editors, but not at runtime.</p>"},{"location":"tutorial/code-structure/#hero-model-file","title":"Hero Model File","text":"<p>Using that trick of <code>TYPE_CHECKING</code> we can \"import\" the <code>Team</code> in <code>hero_model.py</code>:</p> <pre><code>from typing import TYPE_CHECKING, Optional\n\nfrom sqldev import Field, Relationship, SQLDev\n\nif TYPE_CHECKING:\n    from .team_model import Team\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[\"Team\"] = Relationship(back_populates=\"heroes\")\n</code></pre> <p>Have in mind that now we have to put the annotation of <code>Team</code> as a string: <code>\"Team\"</code>, so that Python doesn't have errors at runtime.</p>"},{"location":"tutorial/code-structure/#team-model-file","title":"Team Model File","text":"<p>We use the same trick in the <code>team_model.py</code> file:</p> <pre><code>from typing import TYPE_CHECKING, List, Optional\n\nfrom sqldev import Field, Relationship, SQLDev\n\nif TYPE_CHECKING:\n    from .hero_model import Hero\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n</code></pre> <p>Now we get editor support, autocompletion, inline errors, and SQLDev keeps working. \ud83c\udf89</p>"},{"location":"tutorial/code-structure/#app-file","title":"App File","text":"<p>Now, just for completeness, the <code>app.py</code> file would import the models from both modules:</p> <pre><code>from sqldev import Session\n\nfrom .database import create_db_and_tables, engine\nfrom .hero_model import Hero\nfrom .team_model import Team\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        session.add(hero_deadpond)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Hero's team:\", hero_deadpond.team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>And of course, all the tricks with <code>TYPE_CHECKING</code> and type annotations in strings are only needed in the files with circular imports.</p> <p>As there are no circular imports with <code>app.py</code>, we can just use normal imports and use the classes as normally here.</p> <p>And running that achieves the same result as before:</p> <pre><code>$ python -m project.app\n\nCreated hero: id=1 age=None name='Deadpond' secret_name='Dive Wilson' team_id=1\nHero's team: id=1 name='Z-Force' headquarters='Sister Margaret's Bar'\n</code></pre>"},{"location":"tutorial/code-structure/#recap","title":"Recap","text":"<p>For the simplest cases (for most of the cases) you can just keep all the models in a single file, and structure the rest of the application (including setting up the engine) in as many files as you want.</p> <p>And for the complex cases that really need separating all the models in different files, you can use the <code>TYPE_CHECKING</code> to make it all work and still have the best developer experience with the best editor support. \u2728</p>"},{"location":"tutorial/create-db-and-table-with-db-browser/","title":"Create a Table with SQL","text":"<p>Let's get started!</p> <p>We will:</p> <ul> <li>Create a SQLite database with DB Browser for SQLite</li> <li>Create a table in the database with DB Browser for SQLite</li> </ul> <p>We'll add data later. For now, we'll create the database and the first table structure.</p> <p>We will create a table to hold this data:</p> idnamesecret_nameage 1DeadpondDive Wilsonnull 2Spider-BoyPedro Parqueadornull 3Rusty-ManTommy Sharp48"},{"location":"tutorial/create-db-and-table-with-db-browser/#create-a-database","title":"Create a Database","text":"<p>SQLDev and SQLAlchemy are based on SQL.</p> <p>They are designed to help you with using SQL through Python classes and objects. But it's still always very useful to understand SQL.</p> <p>So let's start with a simple, pure SQL example.</p> <p>Open DB Browser for SQLite.</p> <p>Click the button New Database.</p> <p></p> <p>A dialog should show up. Go to the project directory you created and save the file with a name of <code>database.db</code>.</p> <p>Tip</p> <p>It's common to save SQLite database files with an extension of <code>.db</code>. Sometimes also <code>.sqlite</code>.</p>"},{"location":"tutorial/create-db-and-table-with-db-browser/#create-a-table","title":"Create a Table","text":"<p>After doing that, it might prompt you to create a new table right away.</p> <p>If it doesn't, click the button Create Table.</p> <p></p> <p>Then you will see the dialog to create a new table.</p> <p>So, let's create a new table called <code>hero</code> with the following columns:</p> <ul> <li><code>id</code>: an <code>INTEGER</code> that will be the primary key (check <code>PK</code> \u2705).</li> <li><code>name</code>: a <code>TEXT</code>, it should be <code>NOT NULL</code> (check <code>NN</code> \u2705), so, it should always have a value.</li> <li><code>secret_name</code>: a <code>TEXT</code>, it should be <code>NOT NULL</code> too (check <code>NN</code> \u2705).</li> <li><code>age</code>: an <code>INTEGER</code>, this one can be <code>NULL</code>, so you don't have to check anything else.</li> </ul> <p></p> <p>Click OK to create the table.</p> <p>While you click on the Add button and add the information, it will create and update the SQL statement that is executed to create the table:</p> <pre><code>CREATE TABLE \"hero\" ( --(1)\n  \"id\"  INTEGER, --(2)\n  \"name\"  TEXT NOT NULL, --(3)\n  \"secret_name\" TEXT NOT NULL, --(4)\n  \"age\" INTEGER, --(5)\n  PRIMARY KEY(\"id\") --(6)\n); --(7)\n</code></pre> <ol> <li>Create a table with the name <code>hero</code>. Also notice that the columns for this table are declared inside the parenthesis \" <code>(</code>\" that starts here.</li> <li>The <code>id</code> column, an <code>INTEGER</code>. This is declared as the primary key at the end.</li> <li>The <code>name</code> column, a <code>TEXT</code>, and it should always have a value <code>NOT NULL</code>.</li> <li>The <code>secret_name</code> column, another <code>TEXT</code>, also <code>NOT NULL</code>.</li> <li>The <code>age</code> column, an <code>INTEGER</code>. This one doesn't have <code>NOT NULL</code>, so it can be <code>NULL</code>.</li> <li>The <code>PRIMARY KEY</code> of all this is the <code>id</code> column.</li> <li>This is the end of the SQL table, with the final parenthesis \"<code>)</code>\". It also has the semicolon \"<code>;</code>\" that marks the end of the SQL statement. There could be more SQL statements in the same SQL string.</li> </ol> <p>Now you will see that it shows up in the list of Tables with the columns we specified. \ud83c\udf89</p> <p></p> <p>The only step left is to click Write Changes to save the changes to the file.</p> <p></p> <p>After that, the new table is saved in this database on the file <code>./database.db</code>.</p>"},{"location":"tutorial/create-db-and-table-with-db-browser/#confirm-the-table","title":"Confirm the Table","text":"<p>Let's confirm that it's all saved.</p> <p>First click the button Close Database to close the database.</p> <p></p> <p>Now click on Open Database to open the database again, and select the same file <code>./database.db</code>.</p> <p></p> <p>You will see again the same table we created.</p> <p></p>"},{"location":"tutorial/create-db-and-table-with-db-browser/#create-the-table-again-with-sql","title":"Create the Table again, with SQL","text":"<p>Now, to see how is it that SQL works, let's create the table again, but with SQL.</p> <p>Click the Close Database button again.</p> <p>And delete that <code>./database.db</code> file in your project directory.</p> <p>And click again on New Database.</p> <p>Save the file with the name <code>database.db</code> again.</p> <p>This time, if you see the dialog to create a new table, just close it by clicking the Cancel button.</p> <p>And now, go to the tab Execute SQL.</p> <p>Write the same SQL that was generated in the previous step:</p> <pre><code>CREATE TABLE \"hero\" (\n  \"id\"  INTEGER,\n  \"name\"  TEXT NOT NULL,\n  \"secret_name\" TEXT NOT NULL,\n  \"age\" INTEGER,\n  PRIMARY KEY(\"id\")\n);\n</code></pre> <p>Then click the \"Execute all\" \u25b6 button.</p> <p></p> <p>You will see the \"execution finished successfully\" message.</p> <p></p> <p>And if you go back to the Database Structure tab, you will see that you effectively created again the same table.</p> <p></p>"},{"location":"tutorial/create-db-and-table-with-db-browser/#learn-more-sql","title":"Learn More SQL","text":"<p>I will keep showing you small bits of SQL through this tutorial. And you don't have to be a SQL expert to use SQLDev.</p> <p>But if you are curious and want to get a quick overview of SQL, I recommend the visual documentation from SQLite, on SQL As Understood By SQLite.</p> <p>You can start with <code>CREATE TABLE</code>.</p> <p>Of course, you can also go and take a full SQL course or read a book about SQL, but you don't need more than what I'll explain here on the tutorial to start being productive with SQLDev. \ud83e\udd13</p>"},{"location":"tutorial/create-db-and-table-with-db-browser/#recap","title":"Recap","text":"<p>We saw how to interact with SQLite databases in files using DB Browser for SQLite in a visual user interface.</p> <p>We also saw how to use it to write some SQL directly to the SQLite database. This will be useful to verify the data in the database is looking correctly, to debug, etc.</p> <p>In the next chapters we will start using SQLDev to interact with the database, and we will continue to use DB Browser for SQLite at the same time to look at the database underneath. \ud83d\udd0d</p>"},{"location":"tutorial/create-db-and-table/","title":"Create a Table with SQLDev - Use the Engine","text":"<p>Now let's get to the code. \ud83d\udc69\u200d\ud83d\udcbb</p> <p>Make sure you are inside of your project directory and with your virtual environment activated as explained in the previous chapter.</p> <p>We will:</p> <ul> <li>Define a table with SQLDev</li> <li>Create the same SQLite database and table with SQLDev</li> <li>Use DB Browser for SQLite to confirm the operations</li> </ul> <p>Here's a reminder of the table structure we want:</p> idnamesecret_nameage 1DeadpondDive Wilsonnull 2Spider-BoyPedro Parqueadornull 3Rusty-ManTommy Sharp48"},{"location":"tutorial/create-db-and-table/#create-the-table-model-class","title":"Create the Table Model Class","text":"<p>The first thing we need to do is create a class to represent the data in the table.</p> <p>A class like this that represents some data is commonly called a model.</p> <p>Tip</p> <p>That's why this package is called <code>SQLDev</code>. Because it's mainly used to create SQL Models.</p> <p>For that, we will import <code>SQLDev</code> (plus other things we will also use) and create a class <code>Hero</code> that inherits from <code>SQLDev</code> and represents the table model for our heroes:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <p>This class <code>Hero</code> represents the table for our heroes. And each instance we create later will represent a row in the table.</p> <p>We use the config <code>table=True</code> to tell SQLDev that this is a table model, it represents a table.</p> <p>Info</p> <p>It's also possible to have models without <code>table=True</code>, those would be only data models, without a table in the database, they would not be table models.</p> <p>Those data models will be very useful later, but for now, we'll just keep adding the <code>table=True</code> configuration.</p>"},{"location":"tutorial/create-db-and-table/#define-the-fields-columns","title":"Define the Fields, Columns","text":"<p>The next step is to define the fields or columns of the class by using standard Python type annotations.</p> <p>The name of each of these variables will be the name of the column in the table.</p> <p>And the type of each of them will also be the type of table column:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <p>Let's now see with more detail these field/column declarations.</p>"},{"location":"tutorial/create-db-and-table/#optional-fields-nullable-columns","title":"Optional Fields, Nullable Columns","text":"<p>Let's start with <code>age</code>, notice that it has a type of <code>int | None (or Optional[int])</code>.</p> <p>And we import that <code>Optional</code> from the <code>typing</code> standard module.</p> <p>That is the standard way to declare that something \"could be an <code>int</code> or <code>None</code>\" in Python.</p> <p>And we also set the default value of <code>age</code> to <code>None</code>.</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <p>Tip</p> <p>We also define <code>id</code> with <code>Optional</code>. But we will talk about <code>id</code> below.</p> <p>This way, we tell SQLDev that <code>age</code> is not required when validating data and that it has a default value of <code>None</code>.</p> <p>And we also tell it that, in the SQL database, the default value of <code>age</code> is <code>NULL</code> (the SQL equivalent to Python's <code>None</code>).</p> <p>So, this column is \"nullable\" (can be set to <code>NULL</code>).</p> <p>Info</p> <p>In terms of Pydantic, <code>age</code> is an optional field.</p> <p>In terms of SQLAlchemy, <code>age</code> is a nullable column.</p>"},{"location":"tutorial/create-db-and-table/#primary-key-id","title":"Primary Key <code>id</code>","text":"<p>Now let's review the <code>id</code> field. This is the primary key of the table.</p> <p>So, we need to mark <code>id</code> as the primary key.</p> <p>To do that, we use the special <code>Field</code> function from <code>sqldev</code> and set the argument <code>primary_key=True</code>:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <p>That way, we tell SQLDev that this <code>id</code> field/column is the primary key of the table.</p> <p>But inside the SQL database, it is always required and can't be <code>NULL</code>. Why should we declare it with <code>Optional</code>?</p> <p>The <code>id</code> will be required in the database, but it will be generated by the database, not by our code.</p> <p>So, whenever we create an instance of this class (in the next chapters), we will not set the <code>id</code>. And the value of <code>id</code> will be <code>None</code> until we save it in the database, and then it will finally have a value.</p> <pre><code>my_hero = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n\ndo_something(my_hero.id)  # Oh no! my_hero.id is None! \ud83d\ude31\ud83d\udea8\n\n# Imagine this saves it to the database\nsomehow_save_in_db(my_hero)\n\ndo_something(my_hero.id)  # Now my_hero.id has a value generated in DB \ud83c\udf89\n</code></pre> <p>So, because in our code (not in the database) the value of <code>id</code> could be <code>None</code>, we use <code>Optional</code>. This way the editor will be able to help us, for example, if we try to access the <code>id</code> of an object that we haven't saved in the database yet and would still be <code>None</code>.</p> <p></p> <p>Now, because we are taking the place of the default value with our <code>Field()</code> function, we set the actual default value of <code>id</code> to <code>None</code> with the argument <code>default=None</code> in <code>Field()</code>:</p> <pre><code>Field(default=None)\n</code></pre> <p>If we didn't set the <code>default</code> value, whenever we use this model later to do data validation (powered by Pydantic) it would accept a value of <code>None</code> apart from an <code>int</code>, but it would still require passing that <code>None</code> value. And it would be confusing for whoever is using this model later (probably us), so better set the default value here.</p>"},{"location":"tutorial/create-db-and-table/#create-the-engine","title":"Create the Engine","text":"<p>Now we need to create the SQLAlchemy Engine.</p> <p>It is an object that handles the communication with the database.</p> <p>If you have a server database (for example PostgreSQL or MySQL), the engine will hold the network connections to that database.</p> <p>Creating the engine is very simple, just call <code>create_engine()</code> with a URL for the database to use:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <p>You should normally have a single engine object for your whole application and re-use it everywhere.</p> <p>Tip</p> <p>There's another related thing called a Session that normally should not be a single object per application.</p> <p>But we will talk about it later.</p>"},{"location":"tutorial/create-db-and-table/#engine-database-url","title":"Engine Database URL","text":"<p>Each supported database has its own URL type. For example, for SQLite it is <code>sqlite:///</code> followed by the file path. For example:</p> <ul> <li><code>sqlite:///database.db</code></li> <li><code>sqlite:///databases/local/application.db</code></li> <li><code>sqlite:///db.sqlite</code></li> </ul> <p>SQLite supports a special database that lives all in memory. Hence, it's very fast, but be careful, the database gets deleted after the program terminates. You can specify this in-memory database by using just two slash characters (<code>//</code>) and no file name:</p> <ul> <li><code>sqlite://</code></li> </ul> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <p>You can read a lot more about all the databases supported by SQLAlchemy (and that way supported by SQLDev) in the SQLAlchemy documentation.</p>"},{"location":"tutorial/create-db-and-table/#engine-echo","title":"Engine Echo","text":"<p>In this example, we are also using the argument <code>echo=True</code>.</p> <p>It will make the engine print all the SQL statements it executes, which can help you understand what's happening.</p> <p>It is particularly useful for learning and debugging:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <p>But in production, you would probably want to remove <code>echo=True</code>:</p> <pre><code>engine = create_engine(sqlite_url)\n</code></pre>"},{"location":"tutorial/create-db-and-table/#engine-technical-details","title":"Engine Technical Details","text":"<p>Tip</p> <p>If you didn't know about SQLAlchemy before and are just learning SQLDev, you can probably skip this section, scroll below.</p> <p>You can read a lot more about the engine in the SQLAlchemy documentation.</p> <p>SQLDev defines its own <code>create_engine()</code> function. It is the same as SQLAlchemy's <code>create_engine()</code>, but with the difference that it defaults to use <code>future=True</code> (which means that it uses the style of the latest SQLAlchemy, 1.4, and the future 2.0).</p> <p>And SQLDev's version of <code>create_engine()</code> is type annotated internally, so your editor will be able to help you with autocompletion and inline errors.</p>"},{"location":"tutorial/create-db-and-table/#create-the-database-and-table","title":"Create the Database and Table","text":"<p>Now everything is in place to finally create the database and table:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <p>Tip</p> <p>Creating the engine doesn't create the <code>database.db</code> file.</p> <p>But once we run <code>SQLDev.metadata.create_all(engine)</code>, it creates the <code>database.db</code> file and creates the <code>hero</code> table in that database.</p> <p>Both things are done in this single step.</p> <p>Let's unwrap that:</p> <pre><code>SQLDev.metadata.create_all(engine)\n</code></pre>"},{"location":"tutorial/create-db-and-table/#sqldev-metadata","title":"SQLDev MetaData","text":"<p>The <code>SQLDev</code> class has a <code>metadata</code> attribute. It is an instance of a class <code>MetaData</code>.</p> <p>Whenever you create a class that inherits from <code>SQLDev</code> and is configured with <code>table = True</code>, it is registered in this <code>metadata</code> attribute.</p> <p>So, by the last line, <code>SQLDev.metadata</code> already has the <code>Hero</code> registered.</p>"},{"location":"tutorial/create-db-and-table/#calling-create_all","title":"Calling <code>create_all()</code>","text":"<p>This <code>MetaData</code> object at <code>SQLDev.metadata</code> has a <code>create_all()</code> method.</p> <p>It takes an engine and uses it to create the database and all the tables registered in this <code>MetaData</code> object.</p>"},{"location":"tutorial/create-db-and-table/#sqldev-metadata-order-matters","title":"SQLDev MetaData Order Matters","text":"<p>This also means that you have to call <code>SQLDev.metadata.create_all()</code> after the code that creates new model classes inheriting from <code>SQLDev</code>.</p> <p>For example, let's imagine you do this:</p> <ul> <li>Create the models in one Python file <code>models.py</code>.</li> <li>Create the engine object in a file <code>db.py</code>.</li> <li>Create your main app and call <code>SQLDev.metadata.create_all()</code> in <code>app.py</code>.</li> </ul> <p>If you only imported <code>SQLDev</code> and tried to call <code>SQLDev.metadata.create_all()</code> in <code>app.py</code>, it would not create your tables:</p> <pre><code># This wouldn't work! \ud83d\udea8\nfrom sqldev import SQLDev\n\nfrom .db import engine\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <p>It wouldn't work because when you import <code>SQLDev</code> alone, Python doesn't execute all the code creating the classes inheriting from it (in our example, the class <code>Hero</code>), so <code>SQLDev.metadata</code> is still empty.</p> <p>But if you import the models before calling <code>SQLDev.metadata.create_all()</code>, it will work:</p> <pre><code>from sqldev import SQLDev\n\nfrom . import models\nfrom .db import engine\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <p>This would work because by importing the models, Python executes all the code creating the classes inheriting from <code>SQLDev</code> and registering them in the <code>SQLDev.metadata</code>.</p> <p>As an alternative, you could import <code>SQLDev</code> and your models inside of <code>db.py</code>:</p> <pre><code># db.py\nfrom sqldev import SQLDev, create_engine\nfrom . import models\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url)\n</code></pre> <p>And then import <code>SQLDev</code> from <code>db.py</code> in <code>app.py</code>, and there call <code>SQLDev.metadata.create_all()</code>:</p> <pre><code># app.py\nfrom .db import engine, SQLDev\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <p>The import of <code>SQLDev</code> from <code>db.py</code> would work because <code>SQLDev</code> is also imported in <code>db.py</code>.</p> <p>And this trick would work correctly and create the tables in the database because by importing <code>SQLDev</code> from <code>db.py</code>, Python executes all the code creating the classes that inherit from <code>SQLDev</code> in that <code>db.py</code> file, for example, the class <code>Hero</code>.</p>"},{"location":"tutorial/create-db-and-table/#migrations","title":"Migrations","text":"<p>For this simple example, and for most of the Tutorial - User Guide, using <code>SQLDev.metadata.create_all()</code> is enough.</p> <p>But for a production system you would probably want to use a system to migrate the database.</p> <p>This would be useful and important, for example, whenever you add or remove a column, add a new table, change a type, etc.</p> <p>But you will learn about migrations later in the Advanced User Guide.</p>"},{"location":"tutorial/create-db-and-table/#run-the-program","title":"Run The Program","text":"<p>Let's run the program to see it all working.</p> <p>Put the code it in a file <code>app.py</code> if you haven't already.</p> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\nSQLDev.metadata.create_all(engine)\n</code></pre> <p>Tip</p> <p>Remember to activate the virtual environment before running it.</p> <p>Now run the program with Python:</p> <pre><code>// We set echo=True, so this will show the SQL code\n$ python app.py\n\n// First, some boilerplate SQL that we are not that interested in\n\nINFO Engine BEGIN (implicit)\nINFO Engine PRAGMA main.table_info(\"hero\")\nINFO Engine [raw sql] ()\nINFO Engine PRAGMA temp.table_info(\"hero\")\nINFO Engine [raw sql] ()\nINFO Engine\n\n// Finally, the glorious SQL to create the table \u2728\n\nCREATE TABLE hero (\n        id INTEGER,\n        name VARCHAR NOT NULL,\n        secret_name VARCHAR NOT NULL,\n        age INTEGER,\n        PRIMARY KEY (id)\n)\n\n// More SQL boilerplate\n\nINFO Engine [no key 0.00020s] ()\nINFO Engine COMMIT\n</code></pre> <p>Info</p> <p>I simplified the output above a bit to make it easier to read.</p> <p>But in reality, instead of showing:</p> <pre><code>INFO Engine BEGIN (implicit)\n</code></pre> <p>it would show something like:</p> <pre><code>2021-07-25 21:37:39,175 INFO sqlalchemy.engine.Engine BEGIN (implicit)\n</code></pre>"},{"location":"tutorial/create-db-and-table/#text-or-varchar","title":"<code>TEXT</code> or <code>VARCHAR</code>","text":"<p>In the example in the previous chapter we created the table using <code>TEXT</code> for some columns.</p> <p>But in this output SQLAlchemy is using <code>VARCHAR</code> instead. Let's see what's going on.</p> <p>Remember that each SQL Database has some different variations in what they support?</p> <p>This is one of the differences. Each database supports some particular data types, like <code>INTEGER</code> and <code>TEXT</code>.</p> <p>Some databases have some particular types that are special for certain things. For example, PostgreSQL and MySQL support <code>BOOLEAN</code> for values of <code>True</code> and <code>False</code>. SQLite accepts SQL with booleans, even when defining table columns, but what it actually uses internally are <code>INTEGER</code>s, with <code>1</code> to represent <code>True</code> and <code>0</code> to represent <code>False</code>.</p> <p>The same way, there are several possible types for storing strings. SQLite uses the <code>TEXT</code> type. But other databases like PostgreSQL and MySQL use the <code>VARCHAR</code> type by default, and <code>VARCHAR</code> is one of the most common data types.</p> <p><code>VARCHAR</code> comes from variable length character.</p> <p>SQLAlchemy generates the SQL statements to create tables using <code>VARCHAR</code>, and then SQLite receives them, and internally converts them to <code>TEXT</code>s.</p> <p>Additional to the difference between those two data types, some databases like MySQL require setting a maximum length for the <code>VARCHAR</code> types, for example <code>VARCHAR(255)</code> sets the maximum number of characters to 255.</p> <p>To make it easier to start using SQLDev right away independent of the database you use (even with MySQL), and without any extra configurations, by default, <code>str</code> fields are interpreted as <code>VARCHAR</code> in most databases and <code>VARCHAR(255)</code> in MySQL, this way you know the same class will be compatible with the most popular databases without extra effort.</p> <p>Tip</p> <p>You will learn how to change the maximum length of string columns later in the Advanced Tutorial - User Guide.</p>"},{"location":"tutorial/create-db-and-table/#verify-the-database","title":"Verify the Database","text":"<p>Now, open the database with DB Browser for SQLite, you will see that the program created the table <code>hero</code> just as before. \ud83c\udf89</p> <p></p>"},{"location":"tutorial/create-db-and-table/#refactor-data-creation","title":"Refactor Data Creation","text":"<p>Now let's restructure the code a bit to make it easier to reuse, share, and test later.</p> <p>Let's move the code that has the main side effects, that changes data (creates a file with a database and a table) to a function.</p> <p>In this example it's just the <code>SQLDev.metadata.create_all(engine)</code>.</p> <p>Let's put it in a function <code>create_db_and_tables()</code>:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\nif __name__ == \"__main__\":\n    create_db_and_tables()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\nif __name__ == \"__main__\":\n    create_db_and_tables()\n</code></pre> <p>If <code>SQLDev.metadata.create_all(engine)</code> was not in a function and we tried to import something from this module (from this file) in another, it would try to create the database and table every time we executed that other file that imported this module.</p> <p>We don't want that to happen like that, only when we intend it to happen, that's why we put it in a function, because we can make sure that the tables are created only when we call that function, and not when this module is imported somewhere else.</p> <p>Now we would be able to, for example, import the <code>Hero</code> class in some other file without having those side effects.</p> <p>Tip</p> <p>\ud83d\ude05 Spoiler alert: The function is called <code>create_db_and_tables()</code> because we will have more tables in the future with other classes apart from <code>Hero</code>. \ud83d\ude80</p>"},{"location":"tutorial/create-db-and-table/#create-data-as-a-script","title":"Create Data as a Script","text":"<p>We prevented the side effects when importing something from your <code>app.py</code> file.</p> <p>But we still want it to create the database and table when we call it with Python directly as an independent script from the terminal, just as as above.</p> <p>Tip</p> <p>Think of the word script and program as interchangeable.</p> <p>The word script often implies that the code could be run independently and easily. Or in some cases it refers to a relatively simple program.</p> <p>For that we can use the special variable <code>__name__</code> in an <code>if</code> block:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\nif __name__ == \"__main__\":\n    create_db_and_tables()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\nif __name__ == \"__main__\":\n    create_db_and_tables()\n</code></pre>"},{"location":"tutorial/create-db-and-table/#about-__name__-__main__","title":"About <code>__name__ == \"__main__\"</code>","text":"<p>The main purpose of the <code>__name__ == \"__main__\"</code> is to have some code that is executed when your file is called with:</p> <pre><code>$ python app.py\n\n// Something happens here \u2728\n</code></pre> <p>...but is not called when another file imports it, like in:</p> <pre><code>from app import Hero\n</code></pre> <p>Tip</p> <p>That <code>if</code> block using <code>if __name__ == \"__main__\":</code> is sometimes called the \"main block\".</p> <p>The official name (in the Python docs) is \"Top-level script environment\".</p>"},{"location":"tutorial/create-db-and-table/#more-details","title":"More details","text":"<p>Let's say your file is named <code>myapp.py</code>.</p> <p>If you run it with:</p> <pre><code>$ python myapp.py\n\n// This will call create_db_and_tables()\n</code></pre> <p>...then the internal variable <code>__name__</code> in your file, created automatically by Python, will have as value the string <code>\"__main__\"</code>.</p> <p>So, the function in:</p> <pre><code>if __name__ == \"__main__\":\n    create_db_and_tables()\n</code></pre> <p>...will run.</p> <p>This won't happen if you import that module (file).</p> <p>So, if you have another file <code>importer.py</code> with:</p> <pre><code>from myapp import Hero\n\n# Some more code\n</code></pre> <p>...in that case, the automatic variable inside of <code>myapp.py</code> will not have the variable <code>__name__</code> with a value of <code>\"__main__\"</code>.</p> <p>So, the line:</p> <pre><code>if __name__ == \"__main__\":\n    create_db_and_tables()\n</code></pre> <p>...will not be executed.</p> <p>Info</p> <p>For more information, check the official Python docs.</p>"},{"location":"tutorial/create-db-and-table/#last-review","title":"Last Review","text":"<p>After those changes, you could run it again, and it would generate the same output as before.</p> <p>But now we can import things from this module in other files.</p> <p>Now, let's give the code a final look:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine  # (2)!\n\n\nclass Hero(SQLDev, table=True):  # (3)!\n    id: int | None = Field(default=None, primary_key=True)  # (4)!\n    name: str  # (5)!\n    secret_name: str  # (6)!\n    age: int | None = None  # (7)!\n\n\nsqlite_file_name = \"database.db\"  # (8)!\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"  # (9)!\n\nengine = create_engine(sqlite_url, echo=True)  # (10)!\n\n\ndef create_db_and_tables():  # (11)!\n    SQLDev.metadata.create_all(engine)  # (12)!\n\n\nif __name__ == \"__main__\":  # (13)!\n    create_db_and_tables()  # (14)!\n</code></pre> <ol> <li>Import <code>Optional</code> from <code>typing</code> to declare fields that could be <code>None</code>.</li> <li>Import the things we will need from <code>sqldev</code>: <code>Field</code>, <code>SQLDev</code>, <code>create_engine</code>.</li> <li> <p>Create the <code>Hero</code> model class, representing the <code>hero</code> table in the database.</p> <p>And also mark this class as a table model with <code>table=True</code>.</p> </li> <li> <p>Create the <code>id</code> field:</p> <p>It could be <code>None</code> until the database assigns a value to it, so we annotate it with <code>Optional</code>.</p> <p>It is a primary key, so we use <code>Field()</code> and the argument <code>primary_key=True</code>.</p> </li> <li> <p>Create the <code>name</code> field.</p> <p>It is required, so there's no default value, and it's not <code>Optional</code>.</p> </li> <li> <p>Create the <code>secret_name</code> field.</p> <p>Also required.</p> </li> <li> <p>Create the <code>age</code> field.</p> <p>It is not required, the default value is <code>None</code>.</p> <p>In the database, the default value will be <code>NULL</code>, the SQL equivalent of <code>None</code>.</p> <p>As this field could be <code>None</code> (and <code>NULL</code> in the database), we annotate it with <code>Optional</code>.</p> </li> <li> <p>Write the name of the database file.</p> </li> <li>Use the name of the database file to create the database URL.</li> <li> <p>Create the engine using the URL.</p> <p>This doesn't create the database yet, no file or table is created at this point, only the engine object that will handle the connections with this specific database, and with specific support for SQLite (based on the URL).</p> </li> <li> <p>Put the code that creates side effects in a function.</p> <p>In this case, only one line that creates the database file with the table.</p> </li> <li> <p>Create all the tables that were automatically registered in <code>SQLDev.metadata</code>.</p> </li> <li> <p>Add a main block, or \"Top-level script environment\".</p> <p>And put some logic to be executed when this is called directly with Python, as in:</p> <pre><code>$ python app.py\n\n// Execute all the stuff and show the output\n</code></pre> <p>...but that is not executed when importing something from this module, like:</p> <pre><code>from app import Hero\n</code></pre> </li> <li> <p>In this main block, call the function that creates the database file and the table.</p> <p>This way when we call it with:</p> <pre><code>$ python app.py\n\n// Doing stuff \u2728\n</code></pre> <p>...it will create the database file and the table.</p> </li> </ol> <pre><code>from typing import Optional  # (1)!\n\nfrom sqldev import Field, SQLDev, create_engine  # (2)!\n\n\nclass Hero(SQLDev, table=True):  # (3)!\n    id: Optional[int] = Field(default=None, primary_key=True)  # (4)!\n    name: str  # (5)!\n    secret_name: str  # (6)!\n    age: Optional[int] = None  # (7)!\n\n\nsqlite_file_name = \"database.db\"  # (8)!\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"  # (9)!\n\nengine = create_engine(sqlite_url, echo=True)  # (10)!\n\n\ndef create_db_and_tables():  # (11)!\n    SQLDev.metadata.create_all(engine)  # (12)!\n\n\nif __name__ == \"__main__\":  # (13)!\n    create_db_and_tables()  # (14)!\n</code></pre> <ol> <li>Import <code>Optional</code> from <code>typing</code> to declare fields that could be <code>None</code>.</li> <li>Import the things we will need from <code>sqldev</code>: <code>Field</code>, <code>SQLDev</code>, <code>create_engine</code>.</li> <li> <p>Create the <code>Hero</code> model class, representing the <code>hero</code> table in the database.</p> <p>And also mark this class as a table model with <code>table=True</code>.</p> </li> <li> <p>Create the <code>id</code> field:</p> <p>It could be <code>None</code> until the database assigns a value to it, so we annotate it with <code>Optional</code>.</p> <p>It is a primary key, so we use <code>Field()</code> and the argument <code>primary_key=True</code>.</p> </li> <li> <p>Create the <code>name</code> field.</p> <p>It is required, so there's no default value, and it's not <code>Optional</code>.</p> </li> <li> <p>Create the <code>secret_name</code> field.</p> <p>Also required.</p> </li> <li> <p>Create the <code>age</code> field.</p> <p>It is not required, the default value is <code>None</code>.</p> <p>In the database, the default value will be <code>NULL</code>, the SQL equivalent of <code>None</code>.</p> <p>As this field could be <code>None</code> (and <code>NULL</code> in the database), we annotate it with <code>Optional</code>.</p> </li> <li> <p>Write the name of the database file.</p> </li> <li>Use the name of the database file to create the database URL.</li> <li> <p>Create the engine using the URL.</p> <p>This doesn't create the database yet, no file or table is created at this point, only the engine object that will handle the connections with this specific database, and with specific support for SQLite (based on the URL).</p> </li> <li> <p>Put the code that creates side effects in a function.</p> <p>In this case, only one line that creates the database file with the table.</p> </li> <li> <p>Create all the tables that were automatically registered in <code>SQLDev.metadata</code>.</p> </li> <li> <p>Add a main block, or \"Top-level script environment\".</p> <p>And put some logic to be executed when this is called directly with Python, as in:</p> <pre><code>$ python app.py\n\n// Execute all the stuff and show the output\n</code></pre> <p>...but that is not executed when importing something from this module, like:</p> <pre><code>from app import Hero\n</code></pre> </li> <li> <p>In this main block, call the function that creates the database file and the table.</p> <p>This way when we call it with:</p> <pre><code>$ python app.py\n\n// Doing stuff \u2728\n</code></pre> <p>...it will create the database file and the table.</p> </li> </ol> <p>Tip</p> <p>Review what each line does by clicking each number bubble in the code. \ud83d\udc46</p>"},{"location":"tutorial/create-db-and-table/#recap","title":"Recap","text":"<p>We learnt how to use SQLDev to define how a table in the database should look like, and we created a database and a table using SQLDev.</p> <p>We also refactored the code to make it easier to reuse, share, and test later.</p> <p>In the next chapters we will see how SQLDev will help us interact with SQL databases from code. \ud83e\udd13</p>"},{"location":"tutorial/delete/","title":"Delete Data - DELETE","text":"<p>Now let's delete some data using SQLDev.</p>"},{"location":"tutorial/delete/#continue-from-previous-code","title":"Continue From Previous Code","text":"<p>As before, we'll continue from where we left off with the previous code.</p> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        hero_1.age = 16\n        hero_1.name = \"Spider-Youngster\"\n        session.add(hero_1)\n\n        hero_2.name = \"Captain North America Except Canada\"\n        hero_2.age = 110\n        session.add(hero_2)\n\n        session.commit()\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n\n        print(\"Updated hero 1:\", hero_1)\n        print(\"Updated hero 2:\", hero_2)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        hero_1.age = 16\n        hero_1.name = \"Spider-Youngster\"\n        session.add(hero_1)\n\n        hero_2.name = \"Captain North America Except Canada\"\n        hero_2.age = 110\n        session.add(hero_2)\n\n        session.commit()\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n\n        print(\"Updated hero 1:\", hero_1)\n        print(\"Updated hero 2:\", hero_2)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Remember to remove the <code>database.db</code> file before running the examples to get the same results.</p>"},{"location":"tutorial/delete/#delete-with-sql","title":"Delete with SQL","text":"<p>This <code>Spider-Youngster</code> is getting too weird, so let's just delete it.</p> <p>But don't worry, we'll reboot it later with a new story. \ud83d\ude05</p> <p>Let's see how to delete it with SQL:</p> <pre><code>DELETE\nFROM hero\nWHERE name = \"Spider-Youngster\"\n</code></pre> <p>This means, more or less:</p> <p>Hey SQL database \ud83d\udc4b, I want to <code>DELETE</code> rows <code>FROM</code> the table called <code>hero</code>.</p> <p>Please delete all the rows <code>WHERE</code> the value of the column <code>name</code> is equal to <code>\"Spider-Youngster\"</code>.</p> <p>Remember that when using a <code>SELECT</code> statement it has the form:</p> <pre><code>SELECT [some stuff here]\nFROM [name of a table here]\nWHERE [some condition here]\n</code></pre> <p><code>DELETE</code> is very similar, and again we use <code>FROM</code> to tell the table to work on, and we use <code>WHERE</code> to tell the condition to use to match the rows that we want to delete.</p> <p>You can try that in DB Browser for SQLite:</p> <p></p> <p>Have in mind that <code>DELETE</code> is to delete entire rows, not single values in a row.</p> <p>If you want to \"delete\" a single value in a column while keeping the row, you would instead update the row as explained in the previous chapter, setting the specific value of the column in that row to <code>NULL</code> (to <code>None</code> in Python).</p> <p>Now let's delete with SQLDev.</p> <p>To get the same results, delete the <code>database.db</code> file before running the examples.</p>"},{"location":"tutorial/delete/#read-from-the-database","title":"Read From the Database","text":"<p>We'll start by selecting the hero <code>\"Spider-Youngster\"</code> that we updated in the previous chapter, this is the one we will delete:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        hero_1.age = 16\n        hero_1.name = \"Spider-Youngster\"\n        session.add(hero_1)\n\n        hero_2.name = \"Captain North America Except Canada\"\n        hero_2.age = 110\n        session.add(hero_2)\n\n        session.commit()\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n\n        print(\"Updated hero 1:\", hero_1)\n        print(\"Updated hero 2:\", hero_2)\n\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.first()\n\n        if hero is None:\n            print(\"There's no hero named Spider-Youngster\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n    delete_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        hero_1.age = 16\n        hero_1.name = \"Spider-Youngster\"\n        session.add(hero_1)\n\n        hero_2.name = \"Captain North America Except Canada\"\n        hero_2.age = 110\n        session.add(hero_2)\n\n        session.commit()\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n\n        print(\"Updated hero 1:\", hero_1)\n        print(\"Updated hero 2:\", hero_2)\n\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.first()\n\n        if hero is None:\n            print(\"There's no hero named Spider-Youngster\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n    delete_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>As this is a new function <code>delete_heroes()</code>, we'll also add it to the <code>main()</code> function so that we call it when executing the program from the command line:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n    delete_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n    delete_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        hero_1.age = 16\n        hero_1.name = \"Spider-Youngster\"\n        session.add(hero_1)\n\n        hero_2.name = \"Captain North America Except Canada\"\n        hero_2.age = 110\n        session.add(hero_2)\n\n        session.commit()\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n\n        print(\"Updated hero 1:\", hero_1)\n        print(\"Updated hero 2:\", hero_2)\n\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.first()\n\n        if hero is None:\n            print(\"There's no hero named Spider-Youngster\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n    delete_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        hero_1.age = 16\n        hero_1.name = \"Spider-Youngster\"\n        session.add(hero_1)\n\n        hero_2.name = \"Captain North America Except Canada\"\n        hero_2.age = 110\n        session.add(hero_2)\n\n        session.commit()\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n\n        print(\"Updated hero 1:\", hero_1)\n        print(\"Updated hero 2:\", hero_2)\n\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.first()\n\n        if hero is None:\n            print(\"There's no hero named Spider-Youngster\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n    delete_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>That will print the same existing hero Spider-Youngster:</p> <pre><code>$ python app.py\n\n// Some boilerplate and previous output omitted \ud83d\ude09\n\n// The SELECT with WHERE\nINFO Engine BEGIN (implicit)\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.name = ?\nINFO Engine [no key 0.00011s] ('Spider-Youngster',)\n\n// Print the hero as obtained from the database\nHero:  name='Spider-Youngster' secret_name='Pedro Parqueador' age=16 id=2\n</code></pre>"},{"location":"tutorial/delete/#delete-the-hero-from-the-session","title":"Delete the Hero from the Session","text":"<p>Now, very similar to how we used <code>session.add()</code> to add or update new heroes, we can use <code>session.delete()</code> to delete the hero from the session:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        hero_1.age = 16\n        hero_1.name = \"Spider-Youngster\"\n        session.add(hero_1)\n\n        hero_2.name = \"Captain North America Except Canada\"\n        hero_2.age = 110\n        session.add(hero_2)\n\n        session.commit()\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n\n        print(\"Updated hero 1:\", hero_1)\n        print(\"Updated hero 2:\", hero_2)\n\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.first()\n\n        if hero is None:\n            print(\"There's no hero named Spider-Youngster\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n    delete_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        hero_1.age = 16\n        hero_1.name = \"Spider-Youngster\"\n        session.add(hero_1)\n\n        hero_2.name = \"Captain North America Except Canada\"\n        hero_2.age = 110\n        session.add(hero_2)\n\n        session.commit()\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n\n        print(\"Updated hero 1:\", hero_1)\n        print(\"Updated hero 2:\", hero_2)\n\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.first()\n\n        if hero is None:\n            print(\"There's no hero named Spider-Youngster\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n    delete_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/delete/#commit-the-session","title":"Commit the Session","text":"<p>To save the current changes in the session, commit it.</p> <p>This will save all the changes stored in the session, like the deleted hero:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        hero_1.age = 16\n        hero_1.name = \"Spider-Youngster\"\n        session.add(hero_1)\n\n        hero_2.name = \"Captain North America Except Canada\"\n        hero_2.age = 110\n        session.add(hero_2)\n\n        session.commit()\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n\n        print(\"Updated hero 1:\", hero_1)\n        print(\"Updated hero 2:\", hero_2)\n\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.first()\n\n        if hero is None:\n            print(\"There's no hero named Spider-Youngster\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n    delete_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        hero_1.age = 16\n        hero_1.name = \"Spider-Youngster\"\n        session.add(hero_1)\n\n        hero_2.name = \"Captain North America Except Canada\"\n        hero_2.age = 110\n        session.add(hero_2)\n\n        session.commit()\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n\n        print(\"Updated hero 1:\", hero_1)\n        print(\"Updated hero 2:\", hero_2)\n\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.first()\n\n        if hero is None:\n            print(\"There's no hero named Spider-Youngster\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n    delete_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>The same as we have seen before, <code>.commit()</code> will also save anything else that was added to the session. Including updates, or created heroes.</p> <p>This commit after deleting the hero will generate this output:</p> <pre><code>$ python app.py\n\n// Some boilerplate output omitted \ud83d\ude09\n\n// Previous output omitted \ud83d\ude48\n\n// The SQL to update the hero in the database\nINFO Engine DELETE FROM hero WHERE hero.id = ?\nINFO Engine [generated in 0.00020s] (2,)\nINFO Engine COMMIT\n</code></pre>"},{"location":"tutorial/delete/#print-the-deleted-object","title":"Print the Deleted Object","text":"<p>Now the hero is deleted from the database.</p> <p>If we tried to use <code>session.refresh()</code> with it, it would raise an exception, because there's no data in the database for this hero.</p> <p>Nevertheless, the object is still available with its data, but now it's not connected to the session and it no longer exists in the database.</p> <p>As the object is not connected to the session, it is not marked as \"expired\", the session doesn't even care much about this object anymore.</p> <p>Because of that, the object still contains its attributes with the data in it, so we can print it:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        hero_1.age = 16\n        hero_1.name = \"Spider-Youngster\"\n        session.add(hero_1)\n\n        hero_2.name = \"Captain North America Except Canada\"\n        hero_2.age = 110\n        session.add(hero_2)\n\n        session.commit()\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n\n        print(\"Updated hero 1:\", hero_1)\n        print(\"Updated hero 2:\", hero_2)\n\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.first()\n\n        if hero is None:\n            print(\"There's no hero named Spider-Youngster\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n    delete_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        hero_1.age = 16\n        hero_1.name = \"Spider-Youngster\"\n        session.add(hero_1)\n\n        hero_2.name = \"Captain North America Except Canada\"\n        hero_2.age = 110\n        session.add(hero_2)\n\n        session.commit()\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n\n        print(\"Updated hero 1:\", hero_1)\n        print(\"Updated hero 2:\", hero_2)\n\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.first()\n\n        if hero is None:\n            print(\"There's no hero named Spider-Youngster\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n    delete_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>This will output:</p> <pre><code>$ python app.py\n\n// Some boilerplate output omitted \ud83d\ude09\n\n// Previous output omitted \ud83d\ude48\n\n// Print the deleted hero\nDeleted hero: name='Spider-Youngster' secret_name='Pedro Parqueador' age=16 id=2\n</code></pre>"},{"location":"tutorial/delete/#query-the-database-for-the-same-row","title":"Query the Database for the Same Row","text":"<p>To confirm if it was deleted, now let's query the database again, with the same <code>\"Spider-Youngster\"</code> name:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.first()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.first()\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        hero_1.age = 16\n        hero_1.name = \"Spider-Youngster\"\n        session.add(hero_1)\n\n        hero_2.name = \"Captain North America Except Canada\"\n        hero_2.age = 110\n        session.add(hero_2)\n\n        session.commit()\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n\n        print(\"Updated hero 1:\", hero_1)\n        print(\"Updated hero 2:\", hero_2)\n\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.first()\n\n        if hero is None:\n            print(\"There's no hero named Spider-Youngster\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n    delete_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        hero_1.age = 16\n        hero_1.name = \"Spider-Youngster\"\n        session.add(hero_1)\n\n        hero_2.name = \"Captain North America Except Canada\"\n        hero_2.age = 110\n        session.add(hero_2)\n\n        session.commit()\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n\n        print(\"Updated hero 1:\", hero_1)\n        print(\"Updated hero 2:\", hero_2)\n\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.first()\n\n        if hero is None:\n            print(\"There's no hero named Spider-Youngster\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n    delete_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Here we are using <code>results.first()</code> to get the first object found (in case it found multiple) or <code>None</code>, if it didn't find anything.</p> <p>If we used <code>results.one()</code> instead, it would raise an exception, because it expects exactly one result.</p> <p>And because we just deleted that hero, this should not find anything and we should get <code>None</code>.</p> <p>This will execute some SQL in the database and output:</p> <pre><code>$ python app.py\n\n// Some boilerplate output omitted \ud83d\ude09\n\n// Previous output omitted \ud83d\ude48\n\n// Automatically start a new transaction\nINFO Engine BEGIN (implicit)\n\n// SQL to search for the hero\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.name = ?\nINFO Engine [no key 0.00013s] ('Spider-Youngster',)\n</code></pre>"},{"location":"tutorial/delete/#confirm-the-deletion","title":"Confirm the Deletion","text":"<p>Now let's just confirm that, indeed, no hero was found in the database with that name.</p> <p>We'll do it by checking that the \"first\" item in the <code>results</code> is <code>None</code>:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.first()\n\n        if hero is None:\n            print(\"There's no hero named Spider-Youngster\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.first()\n\n        if hero is None:\n            print(\"There's no hero named Spider-Youngster\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        hero_1.age = 16\n        hero_1.name = \"Spider-Youngster\"\n        session.add(hero_1)\n\n        hero_2.name = \"Captain North America Except Canada\"\n        hero_2.age = 110\n        session.add(hero_2)\n\n        session.commit()\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n\n        print(\"Updated hero 1:\", hero_1)\n        print(\"Updated hero 2:\", hero_2)\n\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.first()\n\n        if hero is None:\n            print(\"There's no hero named Spider-Youngster\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n    delete_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        hero_1.age = 16\n        hero_1.name = \"Spider-Youngster\"\n        session.add(hero_1)\n\n        hero_2.name = \"Captain North America Except Canada\"\n        hero_2.age = 110\n        session.add(hero_2)\n\n        session.commit()\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n\n        print(\"Updated hero 1:\", hero_1)\n        print(\"Updated hero 2:\", hero_2)\n\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero: \", hero)\n\n        session.delete(hero)\n        session.commit()\n\n        print(\"Deleted hero:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")\n        results = session.exec(statement)\n        hero = results.first()\n\n        if hero is None:\n            print(\"There's no hero named Spider-Youngster\")\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n    delete_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>This will output:</p> <pre><code>$ python app.py\n\n// Some boilerplate output omitted \ud83d\ude09\n\n// Previous output omitted \ud83d\ude48\n\n// Indeed, the hero was deleted \ud83d\udd25\nThere's no hero named Spider-Youngster\n\n// Cleanup after the with block\nINFO Engine ROLLBACK\n</code></pre>"},{"location":"tutorial/delete/#review-the-code","title":"Review the Code","text":"<p>Now let's review all that code:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        hero_1.age = 16\n        hero_1.name = \"Spider-Youngster\"\n        session.add(hero_1)\n\n        hero_2.name = \"Captain North America Except Canada\"\n        hero_2.age = 110\n        session.add(hero_2)\n\n        session.commit()\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n\n        print(\"Updated hero 1:\", hero_1)\n        print(\"Updated hero 2:\", hero_2)\n\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")  # (1)!\n        results = session.exec(statement)  # (2)!\n        hero = results.one()  # (3)!\n        print(\"Hero: \", hero)  # (4)!\n\n        session.delete(hero)  # (5)!\n        session.commit()  # (6)!\n\n        print(\"Deleted hero:\", hero)  # (7)!\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")  # (8)!\n        results = session.exec(statement)  # (9)!\n        hero = results.first()  # (10)!\n\n        if hero is None:  # (11)!\n            print(\"There's no hero named Spider-Youngster\")  # (12)!\n    # (13)!\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n    delete_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <ol> <li> <p>Select the hero we will delete.</p> </li> <li> <p>Execute the query with the select statement object.</p> <p>This generates the output:</p> <pre><code>INFO Engine BEGIN (implicit)\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.name = ?\nINFO Engine [no key 0.00011s] ('Spider-Youngster',)\n</code></pre> </li> <li> <p>Get one hero object, expecting exactly one.</p> <p>Tip</p> <p>This ensures there's no more than one, and that there's exactly one, not <code>None</code>.</p> <p>This would never return <code>None</code>, instead it would raise an exception.</p> </li> <li> <p>Print the hero object.</p> <p>This generates the output:</p> <pre><code>Hero:  name='Spider-Youngster' secret_name='Pedro Parqueador' age=16 id=2\n</code></pre> </li> <li> <p>Delete the hero from the session.</p> <p>This marks the hero as deleted from the session, but it will not be removed from the database until we commit the changes.</p> </li> <li> <p>Commit the session.</p> <p>This saves the changes in the session, including deleting this row.</p> <p>It generates the output:</p> <pre><code>INFO Engine DELETE FROM hero WHERE hero.id = ?\nINFO Engine [generated in 0.00020s] (2,)\nINFO Engine COMMIT\n</code></pre> </li> <li> <p>Print the deleted hero object.</p> <p>The hero is deleted in the database. And is marked as deleted in the session.</p> <p>But we still have the object in memory with its data, so we can use it to print it.</p> <p>This generates the output:</p> <pre><code>Deleted hero: name='Spider-Youngster' secret_name='Pedro Parqueador' age=16 id=2\n</code></pre> </li> <li> <p>Select the same hero again.</p> <p>We'll do this to confirm if the hero is really deleted.</p> </li> <li> <p>Execute the select statement.</p> <p>This generates the output:</p> <pre><code>INFO Engine BEGIN (implicit)\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.name = ?\nINFO Engine [no key 0.00013s] ('Spider-Youngster',)\n</code></pre> </li> <li> <p>Get the \"first\" item from the <code>results</code>.</p> <p>If no items were found, this will return <code>None</code>, which is what we expect.</p> </li> <li> <p>Check if the first item from the results is <code>None</code>.</p> </li> <li> <p>If this first item is indeed <code>None</code>, it means that it was correctly deleted from the database.</p> <p>Now we can print a message to confirm.</p> <p>This generates the output:</p> <pre><code>There's no hero named Spider-Youngster\n</code></pre> </li> <li> <p>This is the end of the <code>with</code> block, here the session executes its closing code.</p> <p>This generates the output:</p> <pre><code>INFO Engine ROLLBACK\n</code></pre> </li> </ol> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero_1 = results.one()\n        print(\"Hero 1:\", hero_1)\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")\n        results = session.exec(statement)\n        hero_2 = results.one()\n        print(\"Hero 2:\", hero_2)\n\n        hero_1.age = 16\n        hero_1.name = \"Spider-Youngster\"\n        session.add(hero_1)\n\n        hero_2.name = \"Captain North America Except Canada\"\n        hero_2.age = 110\n        session.add(hero_2)\n\n        session.commit()\n        session.refresh(hero_1)\n        session.refresh(hero_2)\n\n        print(\"Updated hero 1:\", hero_1)\n        print(\"Updated hero 2:\", hero_2)\n\n\ndef delete_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")  # (1)!\n        results = session.exec(statement)  # (2)!\n        hero = results.one()  # (3)!\n        print(\"Hero: \", hero)  # (4)!\n\n        session.delete(hero)  # (5)!\n        session.commit()  # (6)!\n\n        print(\"Deleted hero:\", hero)  # (7)!\n\n        statement = select(Hero).where(Hero.name == \"Spider-Youngster\")  # (8)!\n        results = session.exec(statement)  # (9)!\n        hero = results.first()  # (10)!\n\n        if hero is None:  # (11)!\n            print(\"There's no hero named Spider-Youngster\")  # (12)!\n    # (13)!\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n    delete_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <ol> <li> <p>Select the hero we will delete.</p> </li> <li> <p>Execute the query with the select statement object.</p> <p>This generates the output:</p> <pre><code>INFO Engine BEGIN (implicit)\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.name = ?\nINFO Engine [no key 0.00011s] ('Spider-Youngster',)\n</code></pre> </li> <li> <p>Get one hero object, expecting exactly one.</p> <p>Tip</p> <p>This ensures there's no more than one, and that there's exactly one, not <code>None</code>.</p> <p>This would never return <code>None</code>, instead it would raise an exception.</p> </li> <li> <p>Print the hero object.</p> <p>This generates the output:</p> <pre><code>Hero:  name='Spider-Youngster' secret_name='Pedro Parqueador' age=16 id=2\n</code></pre> </li> <li> <p>Delete the hero from the session.</p> <p>This marks the hero as deleted from the session, but it will not be removed from the database until we commit the changes.</p> </li> <li> <p>Commit the session.</p> <p>This saves the changes in the session, including deleting this row.</p> <p>It generates the output:</p> <pre><code>INFO Engine DELETE FROM hero WHERE hero.id = ?\nINFO Engine [generated in 0.00020s] (2,)\nINFO Engine COMMIT\n</code></pre> </li> <li> <p>Print the deleted hero object.</p> <p>The hero is deleted in the database. And is marked as deleted in the session.</p> <p>But we still have the object in memory with its data, so we can use it to print it.</p> <p>This generates the output:</p> <pre><code>Deleted hero: name='Spider-Youngster' secret_name='Pedro Parqueador' age=16 id=2\n</code></pre> </li> <li> <p>Select the same hero again.</p> <p>We'll do this to confirm if the hero is really deleted.</p> </li> <li> <p>Execute the select statement.</p> <p>This generates the output:</p> <pre><code>INFO Engine BEGIN (implicit)\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.name = ?\nINFO Engine [no key 0.00013s] ('Spider-Youngster',)\n</code></pre> </li> <li> <p>Get the \"first\" item from the <code>results</code>.</p> <p>If no items were found, this will return <code>None</code>, which is what we expect.</p> </li> <li> <p>Check if the first item from the results is <code>None</code>.</p> </li> <li> <p>If this first item is indeed <code>None</code>, it means that it was correctly deleted from the database.</p> <p>Now we can print a message to confirm.</p> <p>This generates the output:</p> <pre><code>There's no hero named Spider-Youngster\n</code></pre> </li> <li> <p>This is the end of the <code>with</code> block, here the session executes its closing code.</p> <p>This generates the output:</p> <pre><code>INFO Engine ROLLBACK\n</code></pre> </li> </ol> <p>Tip</p> <p>Check out the number bubbles to see what is done by each line of code.</p>"},{"location":"tutorial/delete/#recap","title":"Recap","text":"<p>To delete rows with SQLDev you just have to <code>.delete()</code> them with the session, and then, as always, <code>.commit()</code> the session to save the changes to the database. \ud83d\udd25</p>"},{"location":"tutorial/indexes/","title":"Indexes - Optimize Queries","text":"<p>We just saw how to get some data <code>WHERE</code> a condition is true. For example, where the hero name is \"Deadpond\".</p> <p>If we just create the tables and the data as we have been doing, when we <code>SELECT</code> some data using <code>WHERE</code>, the database would have to scan through each one of the records to find the ones that match. This is not a problem with 3 heroes as in these examples.</p> <p>But imagine that your database has thousands or millions of records, if every time you want to find the heroes with the name \"Deadpond\" it has to scan through all of the records to find all the possible matches, then that becomes problematic, as it would be too slow.</p> <p>I'll show you how to handle it with a database index.</p> <p>The change in the code is extremely small, but it's useful to understand what's happening behind the scenes, so I'll show you how it all works and what it means.</p> <p>If you already executed the previous examples and have a database with data, remove the database file before running each example, that way you won't have duplicate data and you will be able to get the same results.</p>"},{"location":"tutorial/indexes/#no-time-to-explain","title":"No Time to Explain","text":"<p>Are you already a SQL expert and don't have time for all my explanations?</p> <p>Fine, in that case, you can sneak peek the final code to create indexes here.</p> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>..but if you are not an expert, continue reading, this will probably be useful. \ud83e\udd13</p>"},{"location":"tutorial/indexes/#what-is-an-index","title":"What is an Index","text":"<p>In general, an index is just something we can have to help us find things faster. It normally works by having things in order. Let's think about some real-life examples before even thinking about databases and code.</p>"},{"location":"tutorial/indexes/#an-index-and-a-dictionary","title":"An Index and a Dictionary","text":"<p>Imagine a dictionary, a book with definitions of words. \ud83d\udcd4 ...not a Python <code>dict</code>. \ud83d\ude05</p> <p>Let's say that you want to find a word, for example the word \"database\". You take the dictionary, and open it somewhere, for example in the middle. Maybe you see some definitions of words that start with <code>m</code>, like <code>manual</code>, so you conclude that you are in the letter <code>m</code> in the dictionary.</p> <p></p> <p>You know that in the alphabet, the letter <code>d</code> for <code>database</code> comes before the letter <code>m</code> for <code>manual</code>.</p> <p></p> <p>So, you know you have to search in the dictionary before the point you currently are. You still don't know where the word <code>database</code> is, because you don't know exactly where the letter <code>d</code> is in the dictionary, but you know that it is not after that point, you can now discard the right half of the dictionary in your search.</p> <p></p> <p>Next, you open the dictionary again, but only taking into account the half of the dictionary that can contain the word you want, the left part of the dictionary. You open it in the middle of that left part and now you arrive maybe at the letter <code>f</code>.</p> <p></p> <p>You know that <code>d</code> from <code>database</code> comes before <code>f</code>. So it has to be before that. But now you know that <code>database</code> is not after that point, and you can discard the dictionary from that point onward.</p> <p></p> <p>Now you have a small section of dictionary to search (only a quarter of dictionary can have your word). You take that quarter of the pages at the start of the dictionary that can contain your word, and open it in the middle of that section. Maybe you arrive at the letter <code>c</code>.</p> <p></p> <p>You know the word <code>database</code> has to be after that and not before that point, so you can discard the left part of that block of pages.</p> <p></p> <p>You repeat this process a few more times, and you finally arrive at the letter <code>d</code>, you continue with the same process in that section for the letter <code>d</code> and you finally find the word <code>database</code>. \ud83c\udf89</p> <p></p> <p>You had to open the dictionary a few times, maybe 5 or 10. That's actually very little work compared to what it could have been.</p> <p>Technical Details</p> <p>Do you like fancy words? Cool! Programmers tend to like fancy words. \ud83d\ude05</p> <p>That algorithm I showed you above is called Binary Search.</p> <p>It's called that because you search something by splitting the dictionary (or any ordered list of things) in two (\"binary\" means \"two\") parts. And you do that process multiple times until you find what you want.</p>"},{"location":"tutorial/indexes/#an-index-and-a-novel","title":"An Index and a Novel","text":"<p>Let's now imagine you are reading a novel book. And someone told you that at some point, they mention a database, and you want to find that chapter.</p> <p>How do you find the word \"database\" there? You might have to read the entire book to find where the word \"database\" is located in the book. So, instead of opening the book 5 or 10 times, you would have to open each of the 500 pages and read them one by one until you find the word. You might enjoy the book, though. \ud83d\ude05</p> <p>But if we are only interested in quickly finding information (as when working with SQL databases), then reading each of the 500 pages is too inefficient when there could be an option to open the book in 5 or 10 places and find what you're looking for.</p>"},{"location":"tutorial/indexes/#a-technical-book-with-an-index","title":"A Technical Book with an Index","text":"<p>Now let's imagine you are reading a technical book. For example, with several topics about programming. And there's a couple of sections where it talks about a database.</p> <p>This book might have a book index: a section in the book that has some names of topics covered and the page numbers in the book where you can read about them. And the topic names are sorted in alphabetic order, pretty much like a dictionary (a book with words, as in the previous example).</p> <p>In this case, you can open that book in the end (or in the beginning) to find the book index section, it would have only a few pages. And then, you can do the same process as with the dictionary example above.</p> <p>Open the index, and after 5 or 10 steps, quickly find the topic \"database\" with the page numbers where that is covered, for example \"page 253 in Chapter 5\". Now you used the dictionary technique to find the topic, and that topic gave you a page number.</p> <p>Now you know that you need to find \"page 253\". But by looking at the closed book you still don't know where that page is, so you have to find that page. To find it, you can do the same process again, but this time, instead of searching for a topic in the index, you are searching for a page number in the entire book. And after 5 or 10 more steps, you find the page 253 in Chapter 5.</p> <p></p> <p>After this, even though this book is not a dictionary and has some particular content, you were able to find the section in the book that talks about a \"database\" in a few steps (say 10 or 20, instead of reading all the 500 pages).</p> <p>The main point is that the index is sorted, so we can use the same process we used for the dictionary to find the topic. And then that gives us a page number, and the page numbers are also sorted! \ud83d\ude05</p> <p>When we have a list of sorted things we can apply the same technique, and that's the whole trick here, we use the same technique first for the topics in the index and then for the page numbers to find the actual chapter.</p> <p>Such efficiency! \ud83d\ude0e</p>"},{"location":"tutorial/indexes/#what-are-database-indexes","title":"What are Database Indexes","text":"<p>Database indexes are very similar to book indexes.</p> <p>Database indexes store some info, some keys, in a way that makes it easy and fast to find (for example sorted), and then for each key they point to some data somewhere else in the database.</p> <p>Let's see a more clear example. Let's say you have this table in a database:</p> idnamesecret_nameage 1DeadpondDive Wilsonnull 2Spider-BoyPedro Parqueadornull 3Rusty-ManTommy Sharp48 <p>And let's imagine you have many more rows, many more heroes. Probably thousands.</p> <p>If you tell the SQL database to get you a hero by a specific name, for example <code>Spider-Boy</code> (by using the <code>name</code> in the <code>WHERE</code> part of the SQL query), the database will have to scan all the heroes, checking one by one to find all the ones with a name of <code>Spider-Boy</code>.</p> <p>In this case, there's only one, but there's nothing limiting the database from having more records with the same name. And because of that, the database would continue searching and checking each one of the records, which would be very slow.</p> <p>But now let's say that the database has an index for the column <code>name</code>. The index could look something like this, we could imagine that the index is like an additional special table that the database manages automatically:</p> nameid Deadpond1 Rusty-Man3 Spider-Boy2 <p>It would have each <code>name</code> field from the <code>hero</code> table in order. It would not be sorted by <code>id</code>, but by <code>name</code> (in alphabetical order, as the <code>name</code> is a string). So, first it would have <code>Deadpond</code>, then <code>Rusty-Man</code>, and last <code>Spider-Boy</code>. It would also include the <code>id</code> of each hero. Remember that this could have thousands of heroes.</p> <p>Then the database would be able to use more or less the same ideas in the examples above with the dictionary and the book index.</p> <p>It could start somewhere (for example, in the middle of the index). It could arrive at some hero there in the middle, like <code>Rusty-Man</code>. And because the index has the <code>name</code> fields in order, the database would know that it can discard all the previous index rows and only search in the following index rows.</p> nameid Deadpond1 Rusty-Man3 Spider-Boy2 <p>And that way, as with the example with the dictionary above, instead of reading thousands of heroes, the database would be able to do a few steps, say 5 or 10 steps, and arrive at the row of the index that has <code>Spider-Boy</code>, even if the table (and index) has thousands of rows:</p> nameid Deadpond1 Rusty-Man3 \u2728 Spider-Boy \u27282 <p>Then by looking at this index row, it would know that the <code>id</code> for <code>Spider-Boy</code> in the <code>hero</code> table is <code>2</code>.</p> <p>So then it could search that <code>id</code> in the <code>hero</code> table using more or less the same technique.</p> <p>That way, in the end, instead of reading thousands of records, the database only had to do a few steps to find the hero we wanted.</p>"},{"location":"tutorial/indexes/#updating-the-index","title":"Updating the Index","text":"<p>As you can imagine, for all this to work, the index would need to be up to date with the data in the database.</p> <p>If you had to update it manually in code, it would be very cumbersome and error-prone, as it would be easy to end up in a state where the index is not up to date and points to incorrect data. \ud83d\ude31</p> <p>Here's the good news: when you create an index in a SQL Database, the database takes care of updating it automatically whenever it's necessary. \ud83d\ude0e\ud83c\udf89</p> <p>If you add new records to the <code>hero</code> table, the database will automatically update the index. It will do the same process of finding the right place to put the new index data (those 5 or 10 steps described above), and then it will save the new index information there. The same would happen when you update or delete data.</p> <p>Defining and creating an index is very easy with SQL databases. And then using it is even easier... it's transparent. The database will figure out which index to use automatically, the SQL queries don't even change.</p> <p>So, in SQL databases indexes are great! And are super easy to use. Why not just have indexes for everything? .....Because indexes also have a \"cost\" in computation and storage (disk space).</p>"},{"location":"tutorial/indexes/#index-cost","title":"Index Cost","text":"<p>There's a cost associated with indexes. \ud83d\udcb0</p> <p>When you don't have an index and add a new row to the table <code>hero</code>, the database has to perform 1 operation to add the new hero row at the end of the table.</p> <p>But if you have an index for the hero names, now the database has to perform the same 1 operation to add that row plus some extra 5 or 10 operations in the index, to find the right spot for the name, to then add that index record there.</p> <p>And if you have an index for the <code>name</code>, one for the <code>age</code>, and one for the <code>secret_name</code>, now the database has to perform the same 1 operation to add that row plus some extra 5 or 10 operations in the index times 3, for each of the indexes. This means that now adding one row takes something like 31 operations.</p> <p>This also means that you are exchanging the time it takes to read data for the time it takes to write data plus some extra space in the database.</p> <p>If you have queries that get data out of the database comparing each one of those fields (for example using <code>WHERE</code>), then it makes total sense to have indexes for each one of them. Because 31 operations while creating or updating data (plus the space of the index) is much, much better than the possible 500 or 1000 operations to read all the rows to be able to compare them using each field.</p> <p>But if you never have queries that find records by the <code>secret_name</code> (you never use <code>secret_name</code> in the <code>WHERE</code> part) it probably doesn't make sense to have an index for the <code>secret_name</code> field/column, as that will increase the computational and space cost of writing and updating the database.</p>"},{"location":"tutorial/indexes/#create-an-index-with-sql","title":"Create an Index with SQL","text":"<p>Phew, that was a lot of theory and explanations. \ud83d\ude05</p> <p>The most important thing about indexes is understanding them, how, and when to use them.</p> <p>Let's now see the SQL syntax to create an index. It is very simple:</p> <pre><code>CREATE INDEX ix_hero_name\nON hero (name)\n</code></pre> <p>This means, more or less:</p> <p>Hey SQL database \ud83d\udc4b, please <code>CREATE</code> an <code>INDEX</code> for me.</p> <p>I want the name of the index to be <code>ix_hero_name</code>.</p> <p>This index should be <code>ON</code> the table <code>hero</code>, it refers to that table.</p> <p>The column I want you to use for it is <code>name</code>.</p>"},{"location":"tutorial/indexes/#declare-indexes-with-sqldev","title":"Declare Indexes with SQLDev","text":"<p>And now let's see how to define indexes in SQLDev.</p> <p>The change in code is underwhelming, it's very simple. \ud83d\ude06</p> <p>Here's the <code>Hero</code> model we had before:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Let's now update it to tell SQLDev to create an index for the <code>name</code> field when creating the table:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>We use the same <code>Field()</code> again as we did before, and set <code>index=True</code>. That's it! \ud83d\ude80</p> <p>Notice that we didn't set an argument of <code>default=None</code> or anything similar. This means that SQLDev (thanks to Pydantic) will keep it as a required field.</p> <p>Info</p> <p>SQLDev (actually SQLAlchemy) will automatically generate the index name for you.</p> <p>In this case the generated name would be <code>ix_hero_name</code>.</p>"},{"location":"tutorial/indexes/#query-data","title":"Query Data","text":"<p>Now, to query the data using the field <code>name</code> and the new index we don't have to do anything special or different in the code, it's just the same code.</p> <p>The SQL database will figure it out automatically. \u2728</p> <p>This is great because it means that indexes are very simple to use. But it might also feel counterintuitive at first, as you are not doing anything explicitly in the code to make it obvious that the index is useful, it all happens in the database behind the scenes.</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>This is exactly the same code as we had before, but now the database will use the index underneath.</p>"},{"location":"tutorial/indexes/#run-the-program","title":"Run the Program","text":"<p>If you run the program now, you will see an output like this:</p> <pre><code>$ python app.py\n\n// Some boilerplate output omitted \ud83d\ude09\n\n// Create the table\nCREATE TABLE hero (\n        id INTEGER,\n        name VARCHAR NOT NULL,\n        secret_name VARCHAR NOT NULL,\n        age INTEGER,\n        PRIMARY KEY (id)\n)\n\n// Create the index \ud83e\udd13\ud83c\udf89\nCREATE INDEX ix_hero_name ON hero (name)\n\n// The SELECT with WHERE looks the same\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.name = ?\nINFO Engine [no key 0.00014s] ('Deadpond',)\n\n// The resulting hero\nsecret_name='Dive Wilson' age=None id=1 name='Deadpond'\n</code></pre>"},{"location":"tutorial/indexes/#more-indexes","title":"More Indexes","text":"<p>We are going to query the <code>hero</code> table doing comparisons on the <code>age</code> field too, so we should define an index for that one as well:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>In this case, we want the default value of <code>age</code> to continue being <code>None</code>, so we set <code>default=None</code> when using <code>Field()</code>.</p> <p>Now when we use SQLDev to create the database and tables, it will also create the indexes for these two columns in the <code>hero</code> table.</p> <p>So, when we query the database for the <code>hero</code> table and use those two columns to define what data we get, the database will be able to use those indexes to improve the reading performance. \ud83d\ude80</p>"},{"location":"tutorial/indexes/#primary-key-and-indexes","title":"Primary Key and Indexes","text":"<p>You probably noticed that we didn't set <code>index=True</code> for the <code>id</code> field.</p> <p>Because the <code>id</code> is already the primary key, the database will automatically create an internal index for it.</p> <p>The database always creates an internal index for primary keys automatically, as those are the primary way to organize, store, and retrieve data. \ud83e\udd13</p> <p>But if you want to be frequently querying the SQL database for any other field (e.g. using any other field in the <code>WHERE</code> section), you will probably want to have at least an index for that.</p>"},{"location":"tutorial/indexes/#recap","title":"Recap","text":"<p>Indexes are very important to improve reading performance and speed when querying the database. \ud83c\udfce</p> <p>Creating and using them is very simple and easy. The most important part is to understand how they work, when to create them, and for which columns.</p>"},{"location":"tutorial/insert/","title":"Create Rows - Use the Session - INSERT","text":"<p>Now that we have a database and a table, we can start adding data.</p> <p>Here's a reminder of how the table would look like, this is the data we want to add:</p> idnamesecret_nameage 1DeadpondDive Wilsonnull 2Spider-BoyPedro Parqueadornull 3Rusty-ManTommy Sharp48"},{"location":"tutorial/insert/#create-table-and-database","title":"Create Table and Database","text":"<p>We will continue from where we left of in the last chapter.</p> <p>This is the code we had to create the database and table, nothing new here:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine  # (2)!\n\n\nclass Hero(SQLDev, table=True):  # (3)!\n    id: int | None = Field(default=None, primary_key=True)  # (4)!\n    name: str  # (5)!\n    secret_name: str  # (6)!\n    age: int | None = None  # (7)!\n\n\nsqlite_file_name = \"database.db\"  # (8)!\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"  # (9)!\n\nengine = create_engine(sqlite_url, echo=True)  # (10)!\n\n\ndef create_db_and_tables():  # (11)!\n    SQLDev.metadata.create_all(engine)  # (12)!\n\n# More code here later \ud83d\udc48\n\nif __name__ == \"__main__\":  # (13)!\n    create_db_and_tables()  # (14)!\n</code></pre> <ol> <li>Import <code>Optional</code> from <code>typing</code> to declare fields that could be <code>None</code>.</li> <li>Import the things we will need from <code>sqldev</code>: <code>Field</code>, <code>SQLDev</code>, <code>create_engine</code>.</li> <li> <p>Create the <code>Hero</code> model class, representing the <code>hero</code> table in the database.</p> <p>And also mark this class as a table model with <code>table=True</code>.</p> </li> <li> <p>Create the <code>id</code> field:</p> <p>It could be <code>None</code> until the database assigns a value to it, so we annotate it with <code>Optional</code>.</p> <p>It is a primary key, so we use <code>Field()</code> and the argument <code>primary_key=True</code>.</p> </li> <li> <p>Create the <code>name</code> field.</p> <p>It is required, so there's no default value, and it's not <code>Optional</code>.</p> </li> <li> <p>Create the <code>secret_name</code> field.</p> <p>Also required.</p> </li> <li> <p>Create the <code>age</code> field.</p> <p>It is not required, the default value is <code>None</code>.</p> <p>In the database, the default value will be <code>NULL</code>, the SQL equivalent of <code>None</code>.</p> <p>As this field could be <code>None</code> (and <code>NULL</code> in the database), we annotate it with <code>Optional</code>.</p> </li> <li> <p>Write the name of the database file.</p> </li> <li>Use the name of the database file to create the database URL.</li> <li> <p>Create the engine using the URL.</p> <p>This doesn't create the database yet, no file or table is created at this point, only the engine object that will handle the connections with this specific database, and with specific support for SQLite (based on the URL).</p> </li> <li> <p>Put the code that creates side effects in a function.</p> <p>In this case, only one line that creates the database file with the table.</p> </li> <li> <p>Create all the tables that were automatically registered in <code>SQLDev.metadata</code>.</p> </li> <li> <p>Add a main block, or \"Top-level script environment\".</p> <p>And put some logic to be executed when this is called directly with Python, as in:</p> <pre><code>$ python app.py\n\n// Execute all the stuff and show the output\n</code></pre> <p>...but that is not executed when importing something from this module, like:</p> <pre><code>from app import Hero\n</code></pre> </li> <li> <p>In this main block, call the function that creates the database file and the table.</p> <p>This way when we call it with:</p> <pre><code>$ python app.py\n\n// Doing stuff \u2728\n</code></pre> <p>...it will create the database file and the table.</p> </li> </ol> <pre><code>from typing import Optional  # (1)!\n\nfrom sqldev import Field, SQLDev, create_engine  # (2)!\n\n\nclass Hero(SQLDev, table=True):  # (3)!\n    id: Optional[int] = Field(default=None, primary_key=True)  # (4)!\n    name: str  # (5)!\n    secret_name: str  # (6)!\n    age: Optional[int] = None  # (7)!\n\n\nsqlite_file_name = \"database.db\"  # (8)!\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"  # (9)!\n\nengine = create_engine(sqlite_url, echo=True)  # (10)!\n\n\ndef create_db_and_tables():  # (11)!\n    SQLDev.metadata.create_all(engine)  # (12)!\n\n# More code here later \ud83d\udc48\n\nif __name__ == \"__main__\":  # (13)!\n    create_db_and_tables()  # (14)!\n</code></pre> <ol> <li>Import <code>Optional</code> from <code>typing</code> to declare fields that could be <code>None</code>.</li> <li>Import the things we will need from <code>sqldev</code>: <code>Field</code>, <code>SQLDev</code>, <code>create_engine</code>.</li> <li> <p>Create the <code>Hero</code> model class, representing the <code>hero</code> table in the database.</p> <p>And also mark this class as a table model with <code>table=True</code>.</p> </li> <li> <p>Create the <code>id</code> field:</p> <p>It could be <code>None</code> until the database assigns a value to it, so we annotate it with <code>Optional</code>.</p> <p>It is a primary key, so we use <code>Field()</code> and the argument <code>primary_key=True</code>.</p> </li> <li> <p>Create the <code>name</code> field.</p> <p>It is required, so there's no default value, and it's not <code>Optional</code>.</p> </li> <li> <p>Create the <code>secret_name</code> field.</p> <p>Also required.</p> </li> <li> <p>Create the <code>age</code> field.</p> <p>It is not required, the default value is <code>None</code>.</p> <p>In the database, the default value will be <code>NULL</code>, the SQL equivalent of <code>None</code>.</p> <p>As this field could be <code>None</code> (and <code>NULL</code> in the database), we annotate it with <code>Optional</code>.</p> </li> <li> <p>Write the name of the database file.</p> </li> <li>Use the name of the database file to create the database URL.</li> <li> <p>Create the engine using the URL.</p> <p>This doesn't create the database yet, no file or table is created at this point, only the engine object that will handle the connections with this specific database, and with specific support for SQLite (based on the URL).</p> </li> <li> <p>Put the code that creates side effects in a function.</p> <p>In this case, only one line that creates the database file with the table.</p> </li> <li> <p>Create all the tables that were automatically registered in <code>SQLDev.metadata</code>.</p> </li> <li> <p>Add a main block, or \"Top-level script environment\".</p> <p>And put some logic to be executed when this is called directly with Python, as in:</p> <pre><code>$ python app.py\n\n// Execute all the stuff and show the output\n</code></pre> <p>...but that is not executed when importing something from this module, like:</p> <pre><code>from app import Hero\n</code></pre> </li> <li> <p>In this main block, call the function that creates the database file and the table.</p> <p>This way when we call it with:</p> <pre><code>$ python app.py\n\n// Doing stuff \u2728\n</code></pre> <p>...it will create the database file and the table.</p> </li> </ol> <p>Now that we can create the database and the table, we will continue from this point and add more code on the same file to create the data.</p>"},{"location":"tutorial/insert/#create-data-with-sql","title":"Create Data with SQL","text":"<p>Before working with Python code, let's see how we can create data with SQL.</p> <p>Let's say we want to insert the record/row for <code>Deadpond</code> into our database.</p> <p>We can do this with the following SQL code:</p> <pre><code>INSERT INTO \"hero\" (\"name\", \"secret_name\")\nVALUES (\"Deadpond\", \"Dive Wilson\");\n</code></pre> <p>It means, more or less:</p> <p>Hey SQL database \ud83d\udc4b, please <code>INSERT</code> something (create a record/row) <code>INTO</code> the table <code>\"hero\"</code>.</p> <p>I want you to insert a row with some values in these specific columns:</p> <ul> <li><code>\"name\"</code></li> <li><code>\"secret_name\"</code></li> </ul> <p>And the values I want you to put in these columns are:</p> <ul> <li><code>\"Deadpond\"</code></li> <li><code>\"Dive Wilson\"</code></li> </ul>"},{"location":"tutorial/insert/#try-it-in-db-explorer-for-sqlite","title":"Try it in DB Explorer for SQLite","text":"<p>You can try that SQL statement in DB Explorer for SQLite.</p> <p>Make sure to open the same database we already created by clicking Open Database and selecting the same <code>database.db</code> file.</p> <p>Tip</p> <p>If you don't have that <code>database.db</code> file with the table <code>hero</code>, you can re-create it by running the Python program at the top. \ud83d\udc46</p> <p>Then go to the Execute SQL tab and copy the SQL from above.</p> <p>It would look like this:</p> <p></p> <p>Click the \"Execute all\" \u25b6 button.</p> <p>Then you can go to the Browse Data tab, and you will see your newly created record/row:</p> <p></p>"},{"location":"tutorial/insert/#data-in-a-database-and-data-in-code","title":"Data in a Database and Data in Code","text":"<p>When working with a database (SQL or any other type) in a programming language, we will always have some data in memory, in objects and variables we create in our code, and there will be some data in the database.</p> <p>We are constantly getting some of the data from the database and putting it in memory, in variables.</p> <p>The same way, we are constantly creating variables and objects with data in our code, that we then want to save in the database, so we send it somehow.</p> <p>In some cases, we can even create some data in memory and then change it and update it before saving it in the database.</p> <p>We might even decide with some logic in the code that we no longer want to save the data in the database, and then just remove it. \ud83d\udd25 And we only handled that data in memory, without sending it back and forth to the database.</p> <p>SQLDev does all it can (actually via SQLAlchemy) to make this interaction as simple, intuitive, and familiar or \"close to programming\" as possible. \u2728</p> <p>But that division of the two places where some data might be at each moment in time (in memory or in the database) is always there. And it's important for you to have it in mind. \ud83e\udd13</p>"},{"location":"tutorial/insert/#create-data-with-python-and-sqldev","title":"Create Data with Python and SQLDev","text":"<p>Now let's create that same row in Python.</p> <p>First, remove that file <code>database.db</code> so we can start from a clean slate.</p> <p>Because we have Python code executing with data in memory, and the database is an independent system (an external SQLite file, or an external database server), we need to perform two steps:</p> <ul> <li>create the data in Python, in memory (in a variable)</li> <li>save/send the data to the database</li> </ul>"},{"location":"tutorial/insert/#create-a-model-instance","title":"Create a Model Instance","text":"<p>Let's start with the first step, create the data in memory.</p> <p>We already created a class <code>Hero</code> that represents the <code>hero</code> table in the database.</p> <p>Each instance we create will represent the data in a row in the database.</p> <p>So, the first step is to simply create an instance of <code>Hero</code>.</p> <p>We'll create 3 right away, for the 3 heroes:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Tip</p> <p>The code above in this file (the omitted code) is just the same code that you see at the top of this chapter.</p> <p>The same code we used before to create the <code>Hero</code> model.</p> <p>We are putting that in a function <code>create_heroes()</code>, to call it later once we finish it.</p> <p>If you are trying the code interactively, you could also write that directly.</p>"},{"location":"tutorial/insert/#create-a-session","title":"Create a Session","text":"<p>Up to now, we have only used the engine to interact with the database.</p> <p>The engine is that single object that we share with all the code, and that is in charge of communicating with the database, handling the connections (when using a server database like PostgreSQL or MySQL), etc.</p> <p>But when working with SQLDev you will mostly use another tool that sits on top, the Session.</p> <p>In contrast to the engine that is one for the whole application, we create a new session for each group of operations with the database that belong together.</p> <p>In fact, the session needs and uses an engine.</p> <p>For example, if we have a web application, we would normally have a single session per request.</p> <p>We would re-use the same engine in all the code, everywhere in the application (shared by all the requests). But for each request, we would create and use a new session. And once the request is done, we would close the session.</p> <p>The first step is to import the <code>Session</code> class:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    session = Session(engine)\n\n    session.add(hero_1)\n    session.add(hero_2)\n    session.add(hero_3)\n\n    session.commit()\n\n    session.close()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    session = Session(engine)\n\n    session.add(hero_1)\n    session.add(hero_2)\n    session.add(hero_3)\n\n    session.commit()\n\n    session.close()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Then we can create a new session:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    session = Session(engine)\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    session = Session(engine)\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    session = Session(engine)\n\n    session.add(hero_1)\n    session.add(hero_2)\n    session.add(hero_3)\n\n    session.commit()\n\n    session.close()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    session = Session(engine)\n\n    session.add(hero_1)\n    session.add(hero_2)\n    session.add(hero_3)\n\n    session.commit()\n\n    session.close()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>The new <code>Session</code> takes an <code>engine</code> as a parameter. And it will use the engine underneath.</p> <p>Tip</p> <p>We will see a better way to create a session using a <code>with</code> block later.</p>"},{"location":"tutorial/insert/#add-model-instances-to-the-session","title":"Add Model Instances to the Session","text":"<p>Now that we have some hero model instances (some objects in memory) and a session, the next step is to add them to the session:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    session = Session(engine)\n\n    session.add(hero_1)\n    session.add(hero_2)\n    session.add(hero_3)\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    session = Session(engine)\n\n    session.add(hero_1)\n    session.add(hero_2)\n    session.add(hero_3)\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    session = Session(engine)\n\n    session.add(hero_1)\n    session.add(hero_2)\n    session.add(hero_3)\n\n    session.commit()\n\n    session.close()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    session = Session(engine)\n\n    session.add(hero_1)\n    session.add(hero_2)\n    session.add(hero_3)\n\n    session.commit()\n\n    session.close()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>By this point, our heroes are not stored in the database yet.</p> <p>And this is one of the cases where having a session independent of an engine makes sense.</p> <p>The session is holding in memory all the objects that should be saved in the database later.</p> <p>And once we are ready, we can commit those changes, and then the session will use the engine underneath to save all the data by sending the appropriate SQL to the database, and that way it will create all the rows. All in a single batch.</p> <p>This makes the interactions with the database more efficient (plus some extra benefits).</p> <p>Technical Details</p> <p>The session will create a new transaction and execute all the SQL code in that transaction.</p> <p>This ensures that the data is saved in a single batch, and that it will all succeed or all fail, but it won't leave the database in a broken state.</p>"},{"location":"tutorial/insert/#commit-the-session-changes","title":"Commit the Session Changes","text":"<p>Now that we have the heroes in the session and that we are ready to save all that to the database, we can commit the changes:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    session = Session(engine)\n\n    session.add(hero_1)\n    session.add(hero_2)\n    session.add(hero_3)\n\n    session.commit()\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    session = Session(engine)\n\n    session.add(hero_1)\n    session.add(hero_2)\n    session.add(hero_3)\n\n    session.commit()\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    session = Session(engine)\n\n    session.add(hero_1)\n    session.add(hero_2)\n    session.add(hero_3)\n\n    session.commit()\n\n    session.close()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    session = Session(engine)\n\n    session.add(hero_1)\n    session.add(hero_2)\n    session.add(hero_3)\n\n    session.commit()\n\n    session.close()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Once this line is executed, the session will use the engine to save all the data in the database by sending the corresponding SQL.</p>"},{"location":"tutorial/insert/#create-heroes-as-a-script","title":"Create Heroes as a Script","text":"<p>The function to create the heroes is now ready.</p> <p>Now we just need to make sure to call it when we run this program with Python directly.</p> <p>We already had a main block like:</p> <pre><code>if __name__ == \"__main__\":\n    create_db_and_tables()\n</code></pre> <p>We could add the new function there, as:</p> <pre><code>if __name__ == \"__main__\":\n    create_db_and_tables()\n    create_heroes()\n</code></pre> <p>But to keep things a bit more organized, let's instead create a new function <code>main()</code> that will contain all the code that should be executed when called as an independent script, and we can put there the previous function <code>create_db_and_tables()</code>, and add the new function <code>create_heroes()</code>:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>And then we can call that single <code>main()</code> function from that main block:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>By having everything that should happen when called as a script in a single function, we can easily add more code later on.</p> <p>And some other code could also import and use this same <code>main()</code> function if it was necessary.</p>"},{"location":"tutorial/insert/#run-the-script","title":"Run the Script","text":"<p>Now we can run our program as a script from the console.</p> <p>Because we created the engine with <code>echo=True</code>, it will print out all the SQL code that it is executing:</p> <pre><code>$ python app.py\n// Some boilerplate, checking that the hero table already exists\nINFO Engine BEGIN (implicit)\nINFO Engine PRAGMA main.table_info(\"hero\")\nINFO Engine [raw sql] ()\nINFO Engine COMMIT\n// BEGIN a transaction automatically \u2728\nINFO Engine BEGIN (implicit)\n// Our INSERT statement, it uses VALUES (?, ?, ?) as parameters\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\n// ...and these are the parameter values \ud83d\ude80\nINFO Engine [generated in 0.00013s] ('Deadpond', 'Dive Wilson', None)\n// Again, for Spider-Boy\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [cached since 0.000755s ago] ('Spider-Boy', 'Pedro Parqueador', None)\n// And now for Rusty-Man\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [cached since 0.001014s ago] ('Rusty-Man', 'Tommy Sharp', 48)\n// All good? Yes, commit this transaction! \ud83c\udf89\nINFO Engine COMMIT\n</code></pre> <p>If you have ever used Git, this works very similarly.</p> <p>We use <code>session.add()</code> to add new objects (model instances) to the session (similar to <code>git add</code>).</p> <p>And that ends up in a group of data ready to be saved, but not saved yet.</p> <p>We can make more modifications, add more objects, etc.</p> <p>And once we are ready, we can commit all the changes in a single step (similar to <code>git commit</code>).</p>"},{"location":"tutorial/insert/#close-the-session","title":"Close the Session","text":"<p>The session holds some resources, like connections from the engine.</p> <p>So once we are done with the session, we should close it to make it release those resources and finish its cleanup:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    session = Session(engine)\n\n    session.add(hero_1)\n    session.add(hero_2)\n    session.add(hero_3)\n\n    session.commit()\n\n    session.close()\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    session = Session(engine)\n\n    session.add(hero_1)\n    session.add(hero_2)\n    session.add(hero_3)\n\n    session.commit()\n\n    session.close()\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    session = Session(engine)\n\n    session.add(hero_1)\n    session.add(hero_2)\n    session.add(hero_3)\n\n    session.commit()\n\n    session.close()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    session = Session(engine)\n\n    session.add(hero_1)\n    session.add(hero_2)\n    session.add(hero_3)\n\n    session.commit()\n\n    session.close()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>But what happens if we forget to close the session?</p> <p>Or if there's an exception in the code and it never reaches the <code>session.close()</code>?</p> <p>For that, there's a better way to create and close the session, using a <code>with</code> block. \ud83d\udc47</p>"},{"location":"tutorial/insert/#a-session-in-a-with-block","title":"A Session in a <code>with</code> Block","text":"<p>It's good to know how the <code>Session</code> works and how to create and close it manually. It might be useful if, for example, you want to explore the code in an interactive session (for example with Jupyter).</p> <p>But there's a better way to handle the session, using a <code>with</code> block:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>This is the same as creating the session manually and then manually closing it. But here, using a <code>with</code> block, it will be automatically created when starting the <code>with</code> block and assigned to the variable <code>session</code>, and it will be automatically closed after the <code>with</code> block is finished.</p> <p>And it will work even if there's an exception in the code. \ud83d\ude0e</p>"},{"location":"tutorial/insert/#review-all-the-code","title":"Review All the Code","text":"<p>Let's give this whole file a final look. \ud83d\udd0d</p> <p>You already know all the first part creating the <code>Hero</code> model class, the engine, and creating the database and table.</p> <p>Let's focus on the new code:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():  # (1)!\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")  # (2)!\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:  # (3)!\n        session.add(hero_1)  # (4)!\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()  # (5)!\n    # (6)!\n\n\ndef main():  # (7)!\n    create_db_and_tables()  # (8)!\n    create_heroes()  # (9)!\n\n\nif __name__ == \"__main__\":  # (10)!\n    main()  # (11)!\n</code></pre> <ol> <li> <p>We use a function <code>create_heroes()</code> to put this logic together.</p> </li> <li> <p>Create each of the objects/instances of the <code>Hero</code> model.</p> <p>Each of them represents the data for one row.</p> </li> <li> <p>Use a <code>with</code> block to create a <code>Session</code> using the <code>engine</code>.</p> <p>The new sesion will be assigned to the variable <code>session</code>.</p> <p>And it will be automatically closed when the <code>with</code> block is finished.</p> </li> <li> <p>Add each of the objects/instances to the session.</p> <p>Each of these objects represents a row in the database.</p> <p>They are all waiting there in the session to be saved.</p> </li> <li> <p>Commit the changes to the database.</p> <p>This will actually send the data to the database.</p> <p>It will start a transaction automatically and save all the data in a single batch.</p> </li> <li> <p>By this point, after the <code>with</code> block is finished, the session is automatically closed.</p> </li> <li> <p>We have a <code>main()</code> function with all the code that should be executed when the program is called as a script from the console.</p> <p>That way we can add more code later to this function.</p> <p>We then put this function <code>main()</code> in the main block below.</p> <p>And as it is a single function, other Python files could import it and call it directly.</p> </li> <li> <p>In this <code>main()</code> function, we are also creating the database and the tables.</p> <p>In the previous version, this function was called directly in the main block.</p> <p>But now it is just called in the <code>main()</code> function.</p> </li> <li> <p>And now we are also creating the heroes in this <code>main()</code> function.</p> </li> <li> <p>We still have a main block to execute some code when the program is run as a script from the command line, like:</p> <pre><code>$ python app.py\n\n// Do whatever is in the main block \ud83d\ude80\n</code></pre> </li> <li> <p>There's a single <code>main()</code> function now that contains all the code that should be executed when running the program from the console.</p> <p>So this is all we need to have in the main block. Just call the <code>main()</code> function.</p> </li> </ol> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():  # (1)!\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")  # (2)!\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:  # (3)!\n        session.add(hero_1)  # (4)!\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()  # (5)!\n    # (6)!\n\n\ndef main():  # (7)!\n    create_db_and_tables()  # (8)!\n    create_heroes()  # (9)!\n\n\nif __name__ == \"__main__\":  # (10)!\n    main()  # (11)!\n</code></pre> <ol> <li> <p>We use a function <code>create_heroes()</code> to put this logic together.</p> </li> <li> <p>Create each of the objects/instances of the <code>Hero</code> model.</p> <p>Each of them represents the data for one row.</p> </li> <li> <p>Use a <code>with</code> block to create a <code>Session</code> using the <code>engine</code>.</p> <p>The new sesion will be assigned to the variable <code>session</code>.</p> <p>And it will be automatically closed when the <code>with</code> block is finished.</p> </li> <li> <p>Add each of the objects/instances to the session.</p> <p>Each of these objects represents a row in the database.</p> <p>They are all waiting there in the session to be saved.</p> </li> <li> <p>Commit the changes to the database.</p> <p>This will actually send the data to the database.</p> <p>It will start a transaction automatically and save all the data in a single batch.</p> </li> <li> <p>By this point, after the <code>with</code> block is finished, the session is automatically closed.</p> </li> <li> <p>We have a <code>main()</code> function with all the code that should be executed when the program is called as a script from the console.</p> <p>That way we can add more code later to this function.</p> <p>We then put this function <code>main()</code> in the main block below.</p> <p>And as it is a single function, other Python files could import it and call it directly.</p> </li> <li> <p>In this <code>main()</code> function, we are also creating the database and the tables.</p> <p>In the previous version, this function was called directly in the main block.</p> <p>But now it is just called in the <code>main()</code> function.</p> </li> <li> <p>And now we are also creating the heroes in this <code>main()</code> function.</p> </li> <li> <p>We still have a main block to execute some code when the program is run as a script from the command line, like:</p> <pre><code>$ python app.py\n\n// Do whatever is in the main block \ud83d\ude80\n</code></pre> </li> <li> <p>There's a single <code>main()</code> function now that contains all the code that should be executed when running the program from the console.</p> <p>So this is all we need to have in the main block. Just call the <code>main()</code> function.</p> </li> </ol> <p>Tip</p> <p>Review what each line does by clicking each number bubble in the code. \ud83d\udc46</p> <p>You can now put it in a <code>app.py</code> file and run it with Python. And you will see an output like the one shown above.</p> <p>After that, if you open the database with DB Browser for SQLite, you will see the data you just created in the Browse Data tab:</p> <p></p>"},{"location":"tutorial/insert/#whats-next","title":"What's Next","text":"<p>Now you know how to add rows to the database. \ud83c\udf89</p> <p>Now is a good time to understand better why the <code>id</code> field can't be <code>NULL</code> on the database because it's a primary key, but actually can be <code>None</code> in the Python code.</p> <p>I'll tell you about that in the next chapter. \ud83d\ude80</p>"},{"location":"tutorial/limit-and-offset/","title":"Read a Range of Data - LIMIT and OFFSET","text":"<p>Now you know how to get a single row with <code>.one()</code>, <code>.first()</code>, and <code>session.get()</code>.</p> <p>And you also know how to get multiple rows while filtering them using <code>.where()</code>.</p> <p>Now let's see how to get only a range of results.</p> <p></p>"},{"location":"tutorial/limit-and-offset/#create-data","title":"Create Data","text":"<p>We will continue with the same code as before, but we'll modify it a little the <code>select_heroes()</code> function to simplify the example and focus on what we want to achieve here.</p> <p>Again, we will create several heroes to have some data to select from:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).limit(3)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).limit(3)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/limit-and-offset/#review-select-all","title":"Review Select All","text":"<p>This is the code we had to select all the heroes in the <code>select()</code> examples:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>But this would get us all the heroes at the same time, in a database that could have thousands, that could be problematic.</p>"},{"location":"tutorial/limit-and-offset/#select-with-limit","title":"Select with Limit","text":"<p>We currently have 7 heroes in the database. But we could as well have thousands, so let's limit the results to get only the first 3:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).limit(3)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).limit(3)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).limit(3)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).limit(3)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>The special select object we get from <code>select()</code> also has a method <code>.limit()</code> that we can use to limit the results to a certain number.</p> <p>In this case, instead of getting all the 7 rows, we are limiting them to only get the first 3.</p> <p></p>"},{"location":"tutorial/limit-and-offset/#run-the-program-on-the-command-line","title":"Run the Program on the Command Line","text":"<p>If we run it on the command line, it will output:</p> <pre><code>$ python app.py\n\n// Previous output omitted \ud83d\ude48\n\n// Select with LIMIT\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\n LIMIT ? OFFSET ?\nINFO Engine [no key 0.00014s] (3, 0)\n\n// Print the heroes received, only 3\n[\n    Hero(age=None, secret_name='Dive Wilson', id=1, name='Deadpond'),\n    Hero(age=None, secret_name='Pedro Parqueador', id=2, name='Spider-Boy'),\n    Hero(age=48, secret_name='Tommy Sharp', id=3, name='Rusty-Man')\n]\n</code></pre> <p>Great! We got only 3 heroes as we wanted.</p> <p>Tip</p> <p>We will check out that SQL code more in a bit.</p>"},{"location":"tutorial/limit-and-offset/#select-with-offset-and-limit","title":"Select with Offset and Limit","text":"<p>Now we can limit the results to get only the first 3.</p> <p>But imagine we are in a user interface showing the results in batches of 3 heroes at a time.</p> <p>Tip</p> <p>This is commonly called \"pagination\". Because the user interface would normally show a \"page\" of a predefined number of heroes at a time.</p> <p>And then you can interact with the user interface to get the next page, and so on.</p> <p>How do we get the next 3?</p> <p></p> <p>We can use <code>.offset()</code>:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).offset(3).limit(3)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).offset(3).limit(3)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).offset(3).limit(3)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).offset(3).limit(3)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>The way this works is that the special select object we get from <code>select()</code> has methods like <code>.where()</code>, <code>.offset()</code> and <code>.limit()</code>.</p> <p>Each of those methods applies the change in the internal special select statement object, and also return the same object, this way, we can continue using more methods on it, like in the example above that we use both <code>.offset()</code> and <code>.limit()</code>.</p> <p>Offset means \"skip this many rows\", and as we want to skip the ones we already saw, the first three, we use <code>.offset(3)</code>.</p>"},{"location":"tutorial/limit-and-offset/#run-the-program-with-offset-on-the-command-line","title":"Run the Program with Offset on the Command Line","text":"<p>Now we can run the program on the command line, and it will output:</p> <pre><code>$python app.py\n\n// Previous output omitted \ud83d\ude48\n\n// Select with LIMIT and OFFSET\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\n LIMIT ? OFFSET ?\nINFO Engine [no key 0.00020s] (3, 3)\n\n// Print the 3 heroes received, the second batch\n[\n    Hero(age=32, secret_name='Natalia Roman-on', id=4, name='Tarantula'),\n    Hero(age=35, secret_name='Trevor Challa', id=5, name='Black Lion'),\n    Hero(age=36, secret_name='Steve Weird', id=6, name='Dr. Weird')\n]\n</code></pre>"},{"location":"tutorial/limit-and-offset/#select-next-batch","title":"Select Next Batch","text":"<p>Then to get the next batch of 3 rows we would offset all the ones we already saw, the first 6:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).offset(6).limit(3)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).offset(6).limit(3)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).offset(6).limit(3)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).offset(6).limit(3)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>The database right now has only 7 rows, so this query can only get 1 row.</p> <p></p> <p>But don't worry, the database won't throw an error trying to get 3 rows when there's only one (as would happen with a Python list).</p> <p>The database knows that we want to limit the number of results, but it doesn't necessarily have to find that many results.</p>"},{"location":"tutorial/limit-and-offset/#run-the-program-with-the-last-batch-on-the-command-line","title":"Run the Program with the Last Batch on the Command Line","text":"<p>And if we run it in the command line, it will output:</p> <pre><code>$ python app.py\n\n// Previous output omitted \ud83d\ude48\n\n// Select last batch with LIMIT and OFFSET\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\n LIMIT ? OFFSET ?\nINFO Engine [no key 0.00038s] (3, 6)\n\n// Print last batch of heroes, only one\n[\n    Hero(age=93, secret_name='Esteban Rogelios', id=7, name='Captain North America')\n]\n</code></pre>"},{"location":"tutorial/limit-and-offset/#sql-with-limit-and-offset","title":"SQL with LIMIT and OFFSET","text":"<p>You probably noticed the new SQL keywords <code>LIMIT</code> and <code>OFFSET</code>.</p> <p>You can use them in SQL, at the end of the other parts:</p> <pre><code>SELECT id, name, secret_name, age\nFROM hero\nLIMIT 3 OFFSET 6\n</code></pre> <p>If you try that in DB Browser for SQLite, you will get the same result:</p> <p></p>"},{"location":"tutorial/limit-and-offset/#combine-limit-and-offset-with-where","title":"Combine Limit and Offset with Where","text":"<p>Of course, you can also combine <code>.limit()</code> and <code>.offset()</code> with <code>.where()</code> and other methods you will learn about later:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt; 32).offset(1).limit(2)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt; 32).offset(1).limit(2)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt; 32).offset(1).limit(2)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt; 32).offset(1).limit(2)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/limit-and-offset/#run-the-program-with-limit-offset-and-where-on-the-command-line","title":"Run the Program with Limit, Offset, and Where on the Command Line","text":"<p>If we run it on the command line, it will find all the heroes in the database with an age above 32. That would normally be 4 heroes.</p> <p>But we are starting to include after an offset of 1 (so we don't count the first one), and we are limiting the results to only get the first 2 after that:</p> <pre><code>$ python app.py\n\n// Previous output omitted \ud83d\ude48\n\n// Select with WHERE and LIMIT and OFFSET\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.age &gt; ?\n LIMIT ? OFFSET ?\nINFO Engine [no key 0.00022s] (32, 2, 1)\n\n// Print the heroes received, only 2\n[\n    Hero(age=36, id=6, name='Dr. Weird', secret_name='Steve Weird'),\n    Hero(age=48, id=3, name='Rusty-Man', secret_name='Tommy Sharp')\n]\n</code></pre>"},{"location":"tutorial/limit-and-offset/#recap","title":"Recap","text":"<p>Independently of how you filter the data with <code>.where()</code> or other methods, you can limit the query to get at maximum some number of results with <code>.limit()</code>.</p> <p>And the same way, you can skip the first results with <code>.offset()</code>.</p>"},{"location":"tutorial/one/","title":"Read One Row","text":"<p>You already know how to filter rows to select using <code>.where()</code>.</p> <p>And you saw how when executing a <code>select()</code> it normally returns an iterable object.</p> <p>Or you can call <code>results.all()</code> to get a list of all the rows right away, instead of an iterable.</p> <p>But in many cases you really just want to read a single row, and having to deal with an iterable or a list is not as convenient.</p> <p>Let's see the utilities to read a single row.</p>"},{"location":"tutorial/one/#continue-from-previous-code","title":"Continue From Previous Code","text":"<p>We'll continue with the same examples we have been using in the previous chapters to create and select data and we'll keep updating them.</p> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>If you already executed the previous examples and have a database with data, remove the database file before running each example, that way you won't have duplicate data and you will be able to get the same results.</p>"},{"location":"tutorial/one/#read-the-first-row","title":"Read the First Row","text":"<p>We have been iterating over the rows in a <code>result</code> object like:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>But let's say that we are not interested in all the rows, just the first one.</p> <p>We can call the <code>.first()</code> method on the <code>results</code> object to get the first row:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        hero = results.first()\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        hero = results.first()\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        hero = results.first()\n        print(\"Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        hero = results.first()\n        print(\"Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>This will return the first object in the <code>results</code> (if there was any).</p> <p>That way, we don't have to deal with an iterable or a list.</p> <p>Tip</p> <p>Notice that <code>.first()</code> is a method of the <code>results</code> object, not of the <code>select()</code> statement.</p> <p>Although this query would find two rows, by using <code>.first()</code> we get only the first row.</p> <p>If we run it in the command line it would output:</p> <pre><code>$ python app.py\n\n// Some boilerplate output omitted \ud83d\ude09\n\n// The SELECT with WHERE\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.age &lt;= ?\nINFO Engine [no key 0.00021s] (35,)\n\n// Only print the first item\nHero: secret_name='Natalia Roman-on' age=32 id=4 name='Tarantula'\n</code></pre>"},{"location":"tutorial/one/#first-or-none","title":"First or <code>None</code>","text":"<p>It would be possible that the SQL query doesn't find any row.</p> <p>In that case, <code>.first()</code> will return <code>None</code>:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt; 25)\n        results = session.exec(statement)\n        hero = results.first()\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt; 25)\n        results = session.exec(statement)\n        hero = results.first()\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt; 25)\n        results = session.exec(statement)\n        hero = results.first()\n        print(\"Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt; 25)\n        results = session.exec(statement)\n        hero = results.first()\n        print(\"Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>In this case, as there's no hero with an age less than 25, <code>.first()</code> will return <code>None</code>.</p> <p>When we run it in the command line it will output:</p> <pre><code>$ python app.py\n\n// Some boilerplate output omitted \ud83d\ude09\n\n// The SELECT with WHERE\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.age &lt;= ?\nINFO Engine [no key 0.00021s] (35,)\n\n// Now rows found, first is None\nHero: None\n</code></pre>"},{"location":"tutorial/one/#exactly-one","title":"Exactly One","text":"<p>There might be cases where we want to ensure that there's exactly one row matching the query.</p> <p>And if there was more than one, it would mean that there's an error in the system, and we should terminate with an error.</p> <p>In that case, instead of <code>.first()</code> we can use <code>.one()</code>:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Here we know that there's only one <code>\"Deadpond\"</code>, and there shouldn't be any more than one.</p> <p>If we run it once will output:</p> <pre><code>$ python app.py\n\n// Some boilerplate output omitted \ud83d\ude09\n\n// The SELECT with WHERE\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.name = ?\nINFO Engine [no key 0.00015s] ('Deadpond',)\n\n// Only one row found, we're good \u2705\nHero: secret_name='Dive Wilson' age=None id=1 name='Deadpond'\n</code></pre> <p>But if we run it again, as it will create and insert all the heroes in the database again, they will be duplicated, and there will be more than one <code>\"Deadpond\"</code>. \ud83d\ude31</p> <p>So, running it again, without first deleting the file <code>database.db</code> will output:</p> <pre><code>$ python app.py\n\n// Some boilerplate output omitted \ud83d\ude09\n\n// The SELECT with WHERE\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.name = ?\nINFO Engine [no key 0.00015s] ('Deadpond',)\n\n// Oh, no, the database is in a broken state, with duplicates! \ud83d\udea8\nTraceback (most recent call last):\n\n// Some details about the error omitted\n\nsqlalchemy.exc.MultipleResultsFound: Multiple rows were found when exactly one was required\n</code></pre>"},{"location":"tutorial/one/#exactly-one-with-more-data","title":"Exactly One with More Data","text":"<p>Of course, even if we don't duplicate the data, we could get the same error if we send a query that finds more than one row and expect exactly one with <code>.one()</code>:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>That would find 2 rows, and would end up with the same error.</p>"},{"location":"tutorial/one/#exactly-one-with-no-data","title":"Exactly One with No Data","text":"<p>And also, if we get no rows at all with <code>.one()</code>, it will also raise an error:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt; 25)\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt; 25)\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt; 25)\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt; 25)\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>In this case, as there are no heroes with an age less than 25, <code>.one()</code> will raise an error.</p> <p>This is what we would get if we run it in the command line:</p> <pre><code>$ python app.py\n\n// Some boilerplate output omitted \ud83d\ude09\n\n// SELECT with WHERE\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.age &lt; ?\nINFO Engine [no key 0.00014s] (25,)\n\n// Oh, no, we expected one row but there aren't any! \ud83d\udea8\nTraceback (most recent call last):\n\n// Some details about the error omitted\n\nsqlalchemy.exc.NoResultFound: No row was found when one was required\n</code></pre>"},{"location":"tutorial/one/#compact-version","title":"Compact Version","text":"<p>Of course, with <code>.first()</code> and <code>.one()</code> you would also probably write all that in a more compact form most of the time, all in a single line (or at least a single Python statement):</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        hero = session.exec(select(Hero).where(Hero.name == \"Deadpond\")).one()\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        hero = session.exec(select(Hero).where(Hero.name == \"Deadpond\")).one()\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        hero = session.exec(select(Hero).where(Hero.name == \"Deadpond\")).one()\n        print(\"Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        hero = session.exec(select(Hero).where(Hero.name == \"Deadpond\")).one()\n        print(\"Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>That would result in the same as some examples above.</p>"},{"location":"tutorial/one/#select-by-id-with-where","title":"Select by Id with <code>.where()</code>","text":"<p>In many cases you might want to select a single row by its Id column with the primary key.</p> <p>You could do it the same way we have been doing with a <code>.where()</code> and then getting the first item with <code>.first()</code>:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.id == 1)\n        results = session.exec(statement)\n        hero = results.first()\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.id == 1)\n        results = session.exec(statement)\n        hero = results.first()\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.id == 1)\n        results = session.exec(statement)\n        hero = results.first()\n        print(\"Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.id == 1)\n        results = session.exec(statement)\n        hero = results.first()\n        print(\"Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>That would work correctly, as expected. But there's a shorter version. \ud83d\udc47</p>"},{"location":"tutorial/one/#select-by-id-with-get","title":"Select by Id with <code>.get()</code>","text":"<p>As selecting a single row by its Id column with the primary key is a common operation, there's a shortcut for it:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        hero = session.get(Hero, 1)\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        hero = session.get(Hero, 1)\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        hero = session.get(Hero, 1)\n        print(\"Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        hero = session.get(Hero, 1)\n        print(\"Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p><code>session.get(Hero, 1)</code> is an equivalent to creating a <code>select()</code>, then filtering by Id using <code>.where()</code>, and then getting the first item with <code>.first()</code>.</p> <p>If you run it, it will output:</p> <pre><code>$ python app.py\n\n// Some boilerplate output omitted \ud83d\ude09\n\n// SELECT with WHERE\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00021s] (1,)\n\n// The printed result\nHero: secret_name='Dive Wilson' age=None id=1 name='Deadpond'\n</code></pre>"},{"location":"tutorial/one/#select-by-id-with-get-with-no-data","title":"Select by Id with <code>.get()</code> with No Data","text":"<p><code>.get()</code> behaves similar to <code>.first()</code>, if there's no data it will simply return <code>None</code> (instead of raising an error):</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        hero = session.get(Hero, 9001)\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        hero = session.get(Hero, 9001)\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        hero = session.get(Hero, 9001)\n        print(\"Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        hero = session.get(Hero, 9001)\n        print(\"Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Running that will output:</p> <pre><code>$ python app.py\n\n// Some boilerplate output omitted \ud83d\ude09\n\n// SELECT with WHERE\nINFO Engine BEGIN (implicit)\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00024s] (9001,)\n\n// No data found, so the value is None\nHero: None\n</code></pre>"},{"location":"tutorial/one/#recap","title":"Recap","text":"<p>As querying the SQL database for a single row is a common operation, you know have several tools to do it in a short and simple way. \ud83c\udf89</p>"},{"location":"tutorial/select/","title":"Read Data - SELECT","text":"<p>We already have a database and a table with some data in it that looks more or less like this:</p> idnamesecret_nameage 1DeadpondDive Wilsonnull 2Spider-BoyPedro Parqueadornull 3Rusty-ManTommy Sharp48 <p>Things are getting more exciting! Let's now see how to read data from the database! \ud83e\udd29</p>"},{"location":"tutorial/select/#continue-from-previous-code","title":"Continue From Previous Code","text":"<p>Let's continue from the last code we used to create some data.</p> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>We are creating a SQLDev <code>Hero</code> class model and creating some records.</p> <p>We will need the <code>Hero</code> model and the engine, but we will create a new session to query data in a new function.</p>"},{"location":"tutorial/select/#read-data-with-sql","title":"Read Data with SQL","text":"<p>Before writing Python code let's do a quick review of how querying data with SQL looks like:</p> <pre><code>SELECT id, name, secret_name, age\nFROM hero\n</code></pre> <p>It means, more or less:</p> <p>Hey SQL database \ud83d\udc4b, please go and <code>SELECT</code> some data for me.</p> <p>I'll first tell you the columns I want:</p> <ul> <li><code>id</code></li> <li><code>name</code></li> <li><code>secret_name</code></li> <li><code>age</code></li> </ul> <p>And I want you to get them <code>FROM</code> the table called <code>\"hero\"</code>.</p> <p>Then the database will go and get the data and return it to you in a table like this:</p> idnamesecret_nameage 1DeadpondDive Wilsonnull 2Spider-BoyPedro Parqueadornull 3Rusty-ManTommy Sharp48 <p>You can try that out in DB Browser for SQLite:</p> <p></p> <p>Warning</p> <p>Here we are getting all the rows.</p> <p>If you have thousands of rows, that could be expensive to compute for the database.</p> <p>You would normally want to filter the rows to receive only the ones you want. But we'll learn about that later in the next chapter.</p>"},{"location":"tutorial/select/#a-sql-shortcut","title":"A SQL Shortcut","text":"<p>If we want to get all the columns like in this case above, in SQL there's a shortcut, instead of specifying each of the column names we could write a <code>*</code>:</p> <pre><code>SELECT *\nFROM hero\n</code></pre> <p>That would end up in the same result. Although we won't use that for SQLDev.</p>"},{"location":"tutorial/select/#select-fewer-columns","title":"<code>SELECT</code> Fewer Columns","text":"<p>We can also <code>SELECT</code> fewer columns, for example:</p> <pre><code>SELECT id, name\nFROM hero\n</code></pre> <p>Here we are only selecting the <code>id</code> and <code>name</code> columns.</p> <p>And it would result in a table like this:</p> idname 1Deadpond 2Spider-Boy 3Rusty-Man <p>And here is something interesting to notice. SQL databases store their data in tables. And they also always communicate their results in tables.</p>"},{"location":"tutorial/select/#select-variants","title":"<code>SELECT</code> Variants","text":"<p>The SQL language allows several variations in several places.</p> <p>One of those variations is that in <code>SELECT</code> statements you can use the names of the columns directly, or you can prefix them with the name of the table and a dot.</p> <p>For example, the same SQL code above could be written as:</p> <pre><code>SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\n</code></pre> <p>This will be particularly important later when working with multiple tables at the same time that could have the same name for some columns.</p> <p>For example <code>hero.id</code> and <code>team.id</code>, or <code>hero.name</code> and <code>team.name</code>.</p> <p>Another variation is that most of the SQL keywords like <code>SELECT</code> can also be written in lowercase, like <code>select</code>.</p>"},{"location":"tutorial/select/#result-tables-dont-have-to-exist","title":"Result Tables Don't Have to Exist","text":"<p>This is the interesting part. The tables returned by SQL databases don't have to exist in the database as independent tables. \ud83e\uddd9</p> <p>For example, in our database, we only have one table that has all the columns, <code>id</code>, <code>name</code>, <code>secret_name</code>, <code>age</code>. And here we are getting a result table with fewer columns.</p> <p>One of the main points of SQL is to be able to keep the data structured in different tables, without repeating data, etc, and then query the database in many ways and get many different tables as a result.</p>"},{"location":"tutorial/select/#read-data-with-sqldev","title":"Read Data with SQLDev","text":"<p>Now let's do the same query to read all the heroes, but with SQLDev.</p>"},{"location":"tutorial/select/#create-a-session","title":"Create a Session","text":"<p>The first step is to create a Session, the same way we did when creating the rows.</p> <p>We will start with that in a new function <code>select_heroes()</code>:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/select/#create-a-select-statement","title":"Create a <code>select</code> Statement","text":"<p>Next, pretty much the same way we wrote a SQL <code>SELECT</code> statement above, now we'll create a SQLDev <code>select</code> statement.</p> <p>First we have to import <code>select</code> from <code>sqldev</code> at the top of the file:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n# More code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# More code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>And then we will use it to create a <code>SELECT</code> statement in Python code:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n# More code here omitted \ud83d\udc48\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# More code here omitted \ud83d\udc48\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>It's a very simple line of code that conveys a lot of information:</p> <pre><code>statement = select(Hero)\n</code></pre> <p>This is equivalent to the first SQL <code>SELECT</code> statement above:</p> <pre><code>SELECT id, name, secret_name, age\nFROM hero\n</code></pre> <p>We pass the class model <code>Hero</code> to the <code>select()</code> function. And that tells it that we want to select all the columns necessary for the <code>Hero</code> class.</p> <p>And notice that in the <code>select()</code> function we don't explicitly specify the <code>FROM</code> part. It is already obvious to SQLDev (actually to SQLAlchemy) that we want to select <code>FROM</code> the table <code>hero</code>, because that's the one associated with the <code>Hero</code> class model.</p> <p>Tip</p> <p>The value of the <code>statement</code> returned by <code>select()</code> is a special object that allows us to do other things.</p> <p>I'll tell you about that in the next chapters.</p>"},{"location":"tutorial/select/#execute-the-statement","title":"Execute the Statement","text":"<p>Now that we have the <code>select</code> statement, we can execute it with the session:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>This will tell the session to go ahead and use the engine to execute that <code>SELECT</code> statement in the database and bring the results back.</p> <p>Because we created the engine with <code>echo=True</code>, it will show the SQL it executes in the output.</p> <p>This <code>session.exec(statement)</code> will generate this output:</p> <pre><code>INFO Engine BEGIN (implicit)\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nINFO Engine [no key 0.00032s] ()\n</code></pre> <p>The database returns the table with all the data, just like above when we wrote SQL directly:</p> idnamesecret_nameage 1DeadpondDive Wilsonnull 2Spider-BoyPedro Parqueadornull 3Rusty-ManTommy Sharp48"},{"location":"tutorial/select/#iterate-through-the-results","title":"Iterate Through the Results","text":"<p>The <code>results</code> object is an iterable that can be used to go through each one of the rows.</p> <p>Now we can put it in a <code>for</code> loop and print each one of the heroes:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>This will print the output:</p> <pre><code>id=1 name='Deadpond' age=None secret_name='Dive Wilson'\nid=2 name='Spider-Boy' age=None secret_name='Pedro Parqueador'\nid=3 name='Rusty-Man' age=48 secret_name='Tommy Sharp'\n</code></pre>"},{"location":"tutorial/select/#add-select_heroes-to-main","title":"Add <code>select_heroes()</code> to <code>main()</code>","text":"<p>Now include a call to <code>select_heroes()</code> in the <code>main()</code> function so that it is executed when we run the program from the command line:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n# More code here later \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n# More code here later \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/select/#review-the-code","title":"Review The Code","text":"<p>Great, you're now being able to read the data from the database! \ud83c\udf89</p> <p>Let's review the code up to this point:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select  # (1)!\n\n\nclass Hero(SQLDev, table=True):  # (2)!\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)  # (3)!\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)  # (4)!\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")  # (5)!\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:  # (6)!\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:  # (7)!\n        statement = select(Hero)  # (8)!\n        results = session.exec(statement)  # (9)!\n        for hero in results:  # (10)!\n            print(hero)  # (11)!\n    # (12)!\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()  # (13)!\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <ol> <li> <p>Import from <code>sqldev</code> everything we will use, including the new <code>select()</code> function.</p> </li> <li> <p>Create the <code>Hero</code> class model, representing the <code>hero</code> table.</p> </li> <li> <p>Create the engine, we should use a single one shared by all the application code, and that's what we are doing here.</p> </li> <li> <p>Create all the tables for the models registered in <code>SQLDev.metadata</code>.</p> <p>This also creates the database if it doesn't exist already.</p> </li> <li> <p>Create each one of the <code>Hero</code> objects.</p> <p>You might not have this in your version if you had already created the data in the database.</p> </li> <li> <p>Create a new session and use it to <code>add</code> the heroes to the database, and then <code>commit</code> the changes.</p> </li> <li> <p>Create a new session to query data.</p> <p>Tip</p> <p>Notice that this is a new session independent from the one in the other function above.</p> <p>But it still uses the same engine. We still have one engine for the whole application.</p> </li> <li> <p>Use the <code>select()</code> function to create a statement selecting all the <code>Hero</code> objects.</p> <p>This selects all the rows in the <code>hero</code> table.</p> </li> <li> <p>Use <code>session.exec(statement)</code> to make the session use the engine to execute the internal SQL statement.</p> <p>This will go to the database, execute that SQL, and get the results back.</p> <p>It returns a special iterable object that we put in the variable <code>results</code>.</p> <p>This generates the output:</p> <pre><code>INFO Engine BEGIN (implicit)\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nINFO Engine [no key 0.00032s] ()\n</code></pre> </li> <li> <p>Iterate for each <code>Hero</code> object in the <code>results</code>.</p> </li> <li> <p>Print each <code>hero</code>.</p> <p>The 3 iterations in the <code>for</code> loop will generate this output:</p> <pre><code>id=1 name='Deadpond' age=None secret_name='Dive Wilson'\nid=2 name='Spider-Boy' age=None secret_name='Pedro Parqueador'\nid=3 name='Rusty-Man' age=48 secret_name='Tommy Sharp'\n</code></pre> </li> <li> <p>At this point, after the <code>with</code> block, the session is closed.</p> <p>This generates the output:</p> <pre><code>INFO Engine ROLLBACK\n</code></pre> </li> <li> <p>Add this function <code>select_heroes()</code> to the <code>main()</code> function so that it is called when we run this program from the command line.</p> </li> </ol> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select  # (1)!\n\n\nclass Hero(SQLDev, table=True):  # (2)!\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)  # (3)!\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)  # (4)!\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")  # (5)!\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:  # (6)!\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:  # (7)!\n        statement = select(Hero)  # (8)!\n        results = session.exec(statement)  # (9)!\n        for hero in results:  # (10)!\n            print(hero)  # (11)!\n    # (12)!\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()  # (13)!\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <ol> <li> <p>Import from <code>sqldev</code> everything we will use, including the new <code>select()</code> function.</p> </li> <li> <p>Create the <code>Hero</code> class model, representing the <code>hero</code> table.</p> </li> <li> <p>Create the engine, we should use a single one shared by all the application code, and that's what we are doing here.</p> </li> <li> <p>Create all the tables for the models registered in <code>SQLDev.metadata</code>.</p> <p>This also creates the database if it doesn't exist already.</p> </li> <li> <p>Create each one of the <code>Hero</code> objects.</p> <p>You might not have this in your version if you had already created the data in the database.</p> </li> <li> <p>Create a new session and use it to <code>add</code> the heroes to the database, and then <code>commit</code> the changes.</p> </li> <li> <p>Create a new session to query data.</p> <p>Tip</p> <p>Notice that this is a new session independent from the one in the other function above.</p> <p>But it still uses the same engine. We still have one engine for the whole application.</p> </li> <li> <p>Use the <code>select()</code> function to create a statement selecting all the <code>Hero</code> objects.</p> <p>This selects all the rows in the <code>hero</code> table.</p> </li> <li> <p>Use <code>session.exec(statement)</code> to make the session use the engine to execute the internal SQL statement.</p> <p>This will go to the database, execute that SQL, and get the results back.</p> <p>It returns a special iterable object that we put in the variable <code>results</code>.</p> <p>This generates the output:</p> <pre><code>INFO Engine BEGIN (implicit)\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nINFO Engine [no key 0.00032s] ()\n</code></pre> </li> <li> <p>Iterate for each <code>Hero</code> object in the <code>results</code>.</p> </li> <li> <p>Print each <code>hero</code>.</p> <p>The 3 iterations in the <code>for</code> loop will generate this output:</p> <pre><code>id=1 name='Deadpond' age=None secret_name='Dive Wilson'\nid=2 name='Spider-Boy' age=None secret_name='Pedro Parqueador'\nid=3 name='Rusty-Man' age=48 secret_name='Tommy Sharp'\n</code></pre> </li> <li> <p>At this point, after the <code>with</code> block, the session is closed.</p> <p>This generates the output:</p> <pre><code>INFO Engine ROLLBACK\n</code></pre> </li> <li> <p>Add this function <code>select_heroes()</code> to the <code>main()</code> function so that it is called when we run this program from the command line.</p> </li> </ol> <p>Tip</p> <p>Check out the number bubbles to see what is done by each line of code.</p> <p>Here it starts to become more evident why we should have a single engine for the whole application, but different sessions for each group of operations.</p> <p>This new session we created uses the same engine, but it's a new and independent session.</p> <p>The code above creating the models could, for example, live in a function handling web API requests and creating models.</p> <p>And the second section reading data from the database could be in another function for other requests.</p> <p>So, both sections could be in different places and would need their own sessions.</p> <p>Info</p> <p>To be fair, in this example all that code could actually share the same session, there's actually no need to have two here.</p> <p>But it allows me to show you how they could be separated and to reinforce the idea that you should have one engine per application, and multiple sessions, one per each group of operations.</p>"},{"location":"tutorial/select/#get-a-list-of-hero-objects","title":"Get a List of <code>Hero</code> Objects","text":"<p>Up to now we are using the <code>results</code> to iterate over them.</p> <p>But for different reasons you might want to have the full list of <code>Hero</code> objects right away instead of just an iterable. For example, if you want to return them in a web API.</p> <p>The special <code>results</code> object also has a method <code>results.all()</code> that returns a list with all the objects:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        heroes = results.all()\n        print(heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>With this now we have all the heroes in a list in the <code>heroes</code> variable.</p> <p>After printing it, we would see something like:</p> <pre><code>[\n    Hero(id=1, name='Deadpond', age=None, secret_name='Dive Wilson'),\n    Hero(id=2, name='Spider-Boy', age=None, secret_name='Pedro Parqueador'),\n    Hero(id=3, name='Rusty-Man', age=48, secret_name='Tommy Sharp')\n]\n</code></pre> <p>Info</p> <p>It would actually look more compact, I'm formatting it a bit for you to see that it is actually a list with all the data.</p>"},{"location":"tutorial/select/#compact-version","title":"Compact Version","text":"<p>I have been creating several variables to be able to explain to you what each thing is doing.</p> <p>But knowing what is each object and what it is all doing, we can simplify it a bit and put it in a more compact form:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        print(heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        print(heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        print(heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        print(heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Here we are putting it all on a single line, you will probably put the select statements in a single line like this more often.</p>"},{"location":"tutorial/select/#sqldev-or-sqlalchemy-technical-details","title":"SQLDev or SQLAlchemy - Technical Details","text":"<p>SQLDev is actually, more or less, just SQLAlchemy and Pydantic underneath, combined together.</p> <p>It uses and returns the same types of objects and is compatible with both libraries.</p> <p>Nevertheless, SQLDev defines a few of its own internal parts to improve the developer experience.</p> <p>In this chapter we are touching some of them.</p>"},{"location":"tutorial/select/#sqldevs-select","title":"SQLDev's <code>select</code>","text":"<p>When importing from <code>sqldev</code> the <code>select()</code> function, you are using SQLDev's version of <code>select</code>.</p> <p>SQLAchemy also has its own <code>select</code>, and SQLDev's <code>select</code> uses SQLAlchemy's <code>select</code> internally.</p> <p>But SQLDev's version does a lot of tricks with type annotations to make sure you get the best editor support possible, no matter if you use VS Code, PyCharm, or something else. \u2728</p> <p>Info</p> <p>There was a lot of work and research, with different versions of the internal code, to improve this as much as possible. \ud83e\udd13</p>"},{"location":"tutorial/select/#sqldevs-sessionexec","title":"SQLDev's <code>session.exec</code>","text":"<p>\ud83d\udce2 This is one to pay special attention to.</p> <p>SQLAlchemy's own <code>Session</code> has a method <code>session.execute()</code>. It doesn't have a <code>session.exec()</code> method.</p> <p>If you see SQLAlchemy tutorials, they will always use <code>session.execute()</code>.</p> <p>SQLDev's own <code>Session</code> inherits directly from SQLAlchemy's <code>Session</code>, and adds this additional method <code>session.exec()</code>. Underneath, it uses the same <code>session.execute()</code>.</p> <p>But <code>session.exec()</code> does several tricks combined with the tricks in <code>session()</code> to give you the best editor support, with autocompletion and inline errors everywhere, even after getting data from a select. \u2728</p> <p>For example, in SQLAlchemy you would need to add a <code>.scalars()</code> here:</p> <pre><code>heroes = session.execute(select(Hero)).scalars().all()\n</code></pre> <p>But you would have to remove it when selecting multiple things (we'll see that later).</p> <p>SQLDev's <code>session.exec()</code> takes care of that for you, so you don't have to add the <code>.scalars()</code>.</p> <p>This is something that SQLAlchemy currently can't provide, because the regular <code>session.execute()</code> supports several other use cases, including legacy ones, so it can't have all the internal type annotations and tricks to support this.</p> <p>On top of that, SQLDev's <code>session.exec()</code> also does some tricks to reduce the amount of code you have to write and to make it as intuitive as possible.</p> <p>But SQLDev's <code>Session</code> still has access to <code>session.execute()</code> too.</p> <p>Tip</p> <p>Your editor will give you autocompletion for both <code>session.exec()</code> and <code>session.execute()</code>.</p> <p>\ud83d\udce2 Remember to always use <code>session.exec()</code> to get the best editor support and developer experience.</p>"},{"location":"tutorial/select/#caveats-of-sqldev-flavor","title":"Caveats of SQLDev Flavor","text":"<p>SQLDev is designed to have the best developer experience in a narrow set of very common use cases. \u2728</p> <p>You can still combine it with SQLAlchemy directly and use all the features of SQLAlchemy when you need to, including lower level more \"pure\" SQL constructs, exotic patterns, and even legacy ones. \ud83e\udd13</p> <p>But SQLDev's design (e.g. type annotations) assume you are using it in the ways I explain here in the documentation.</p> <p>Thanks to this, you will get as much autocompletion and inline errors as possible. \ud83d\ude80</p> <p>But this also means that if you use SQLDev with some more exotic patterns from SQLAlchemy, your editor might tell you that there's an error, while in fact, the code would still work.</p> <p>That's the trade-off. \ud83e\udd37</p> <p>But for the situations where you need those exotic patterns, you can always use SQLAlchemy directly combined with SQLDev (using the same models, etc).</p>"},{"location":"tutorial/update/","title":"Update Data - UPDATE","text":"<p>Now let's see how to update data using SQLDev.</p>"},{"location":"tutorial/update/#continue-from-previous-code","title":"Continue From Previous Code","text":"<p>As before, we'll continue from where we left off with the previous code.</p> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Remember to remove the <code>database.db</code> file before running the examples to get the same results.</p>"},{"location":"tutorial/update/#update-with-sql","title":"Update with SQL","text":"<p>Let's quickly check how to update data with SQL:</p> <pre><code>UPDATE hero\nSET age=16\nWHERE name = \"Spider-Boy\"\n</code></pre> <p>This means, more or less:</p> <p>Hey SQL database \ud83d\udc4b, I want to <code>UPDATE</code> the table called <code>hero</code>.</p> <p>Please <code>SET</code> the value of the <code>age</code> column to <code>16</code>...</p> <p>...for each of the rows <code>WHERE</code> the value of the column <code>name</code> is equal to <code>\"Spider-Boy\"</code>.</p> <p>In a similar way to <code>SELECT</code> statements, the first part defines the columns to work with: what are the columns that have to be updated and to which value. The rest of the columns stay as they were.</p> <p>And the second part, with the <code>WHERE</code>, defines to which rows it should apply that update.</p> <p>In this case, as we only have one hero with the name <code>\"Spider-Boy\"</code>, it will only apply the update in that row.</p> <p>Info</p> <p>Notice that in the <code>UPDATE</code> the single equals sign (<code>=</code>) means assignment, setting a column to some value.</p> <p>And in the <code>WHERE</code> the same single equals sign (<code>=</code>) is used for comparison between two values, to find rows that match.</p> <p>This is in contrast to Python and most programming languages, where a single equals sign (<code>=</code>) is used for assignment, and two equal signs (<code>==</code>) are used for comparisons.</p> <p>You can try that in DB Browser for SQLite:</p> <p></p> <p>After that update, the data in the table will look like this, with the new age for Spider-Boy:</p> idnamesecret_nameage 1DeadpondDive Wilsonnull 2Spider-BoyPedro Parqueador16 \u2728 3Rusty-ManTommy Sharp48 <p>Tip</p> <p>It will probably be more common to find the row to update by <code>id</code>, for example:</p> <pre><code>UPDATE hero\nSET age=16\nWHERE id = 2\n</code></pre> <p>But in the example above I used <code>name</code> to make it more intuitive.</p> <p>Now let's do the same update in code, with SQLDev.</p> <p>To get the same results, delete the <code>database.db</code> file before running the examples.</p>"},{"location":"tutorial/update/#read-from-the-database","title":"Read From the Database","text":"<p>We'll start by selecting the hero <code>\"Spider-Boy\"</code>, this is the one we will update:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"Updated hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"Updated hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Let's not forget to add that <code>update_heroes()</code> function to the <code>main()</code> function so that we call it when executing the program from the command line:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"Updated hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"Updated hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Up to that point, running that in the command line will output:</p> <pre><code>$ python app.py\n\n// Some boilerplate and previous output omitted \ud83d\ude09\n\n// The SELECT with WHERE\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.name = ?\nINFO Engine [no key 0.00017s] ('Spider-Boy',)\n\n// Print the hero as obtained from the database\nHero: name='Spider-Boy' secret_name='Pedro Parqueador' age=None id=2\n</code></pre> <p>Tip</p> <p>Notice that by this point, the hero still doesn't have an age.</p>"},{"location":"tutorial/update/#set-a-field-value","title":"Set a Field Value","text":"<p>Now that you have a <code>hero</code> object, you can simply set the value of the field (the attribute representing a column) that you want.</p> <p>In this case, we will set the <code>age</code> to <code>16</code>:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"Updated hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"Updated hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/update/#add-the-hero-to-the-session","title":"Add the Hero to the Session","text":"<p>Now that the hero object in memory has a change, in this case a new value for the <code>age</code>, we need to add it to the session.</p> <p>This is the same we did when creating new hero instances:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"Updated hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"Updated hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/update/#commit-the-session","title":"Commit the Session","text":"<p>To save the current changes in the session, commit it.</p> <p>This will save the updated hero in the database:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"Updated hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"Updated hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>It will also save anything else that was added to the session.</p> <p>For example, if you were also creating new heroes and had added those objects to the session before, they would now be saved too in this single commit.</p> <p>This commit will generate this output:</p> <pre><code>$ python app.py\n\n// Some boilerplate output omitted \ud83d\ude09\n\n// Previous output omitted \ud83d\ude48\n\n// The SQL to update the hero in the database\nINFO Engine UPDATE hero SET age=? WHERE hero.id = ?\nINFO Engine [generated in 0.00017s] (16, 2)\nINFO Engine COMMIT\n</code></pre>"},{"location":"tutorial/update/#refresh-the-object","title":"Refresh the Object","text":"<p>At this point, the hero is updated in the database and it has the new data saved there.</p> <p>The data in the object would be automatically refreshed if we accessed an attribute, like <code>hero.name</code>.</p> <p>But in this example we are not accessing any attribute, we will only print the object. And we also want to be explicit, so we will <code>.refresh()</code> the object directly:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"Updated hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"Updated hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>This refresh will trigger the same SQL query that would be automatically triggered by accessing an attribute. So it will generate this output:</p> <pre><code>$ python app.py\n\n// Some boilerplate output omitted \ud83d\ude09\n\n// Previous output omitted \ud83d\ude48\n\n// The SQL to SELECT the fresh hero data\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00018s] (2,)\n</code></pre>"},{"location":"tutorial/update/#print-the-updated-object","title":"Print the Updated Object","text":"<p>Now we can just print the hero:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"Updated hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"Updated hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"Updated hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        results = session.exec(statement)\n        hero = results.one()\n        print(\"Hero:\", hero)\n\n        hero.age = 16\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        print(\"Updated hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Because we refreshed it right after updating it, it has fresh data, including the new <code>age</code> we just updated.</p> <p>So, printing it will show the new <code>age</code>:</p> <pre><code>$ python app.py\n\n// Some boilerplate output omitted \ud83d\ude09\n\n// Previous output omitted \ud83d\ude48\n\n// Print the hero with the new age\nUpdated hero: name='Spider-Boy' secret_name='Pedro Parqueador' age=16 id=2\n</code></pre>"},{"location":"tutorial/update/#review-the-code","title":"Review the Code","text":"<p>Now let's review all that code:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")  # (1)!\n        results = session.exec(statement)  # (2)!\n        hero = results.one()  # (3)!\n        print(\"Hero:\", hero)  # (4)!\n\n        hero.age = 16  # (5)!\n        session.add(hero)  # (6)!\n        session.commit()  # (7)!\n        session.refresh(hero)  # (8)!\n        print(\"Updated hero:\", hero)  # (9)!\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <ol> <li> <p>Select the hero we will work with.</p> </li> <li> <p>Execute the query with the select statement object.</p> <p>This generates the output:</p> <pre><code>INFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.name = ?\nINFO Engine [no key 0.00017s] ('Spider-Boy',)\n</code></pre> </li> <li> <p>Get one hero object, expecting exactly one.</p> <p>Tip</p> <p>This ensures there's no more than one, and that there's exactly one, not <code>None</code>.</p> <p>This would never return <code>None</code>, instead it would raise an exception.</p> </li> <li> <p>Print the hero object.</p> <p>This generates the output:</p> <pre><code>Hero: name='Spider-Boy' secret_name='Pedro Parqueador' age=None id=2\n</code></pre> </li> <li> <p>Set the hero's age field to the new value <code>16</code>.</p> <p>Now the <code>hero</code> object in memory has a different value for the age, but it is still not saved to the database.</p> </li> <li> <p>Add the hero to the session.</p> <p>This puts it in that temporary place in the session before committing.</p> <p>But it's still not saved in the database yet.</p> </li> <li> <p>Commit the session.</p> <p>This saves the updated hero to the database.</p> <p>And this generates the output:</p> <pre><code>INFO Engine UPDATE hero SET age=? WHERE hero.id = ?\nINFO Engine [generated in 0.00017s] (16, 2)\nINFO Engine COMMIT\n</code></pre> </li> <li> <p>Refresh the hero object to have the recent data, including the age we just committed.</p> <p>This generates the output:</p> <pre><code>INFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00018s] (2,)\n</code></pre> </li> <li> <p>Print the updated hero object.</p> <p>This generates the output:</p> <pre><code>Updated hero: name='Spider-Boy' secret_name='Pedro Parqueador' age=16 id=2\n</code></pre> </li> </ol> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")  # (1)!\n        results = session.exec(statement)  # (2)!\n        hero = results.one()  # (3)!\n        print(\"Hero:\", hero)  # (4)!\n\n        hero.age = 16  # (5)!\n        session.add(hero)  # (6)!\n        session.commit()  # (7)!\n        session.refresh(hero)  # (8)!\n        print(\"Updated hero:\", hero)  # (9)!\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <ol> <li> <p>Select the hero we will work with.</p> </li> <li> <p>Execute the query with the select statement object.</p> <p>This generates the output:</p> <pre><code>INFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.name = ?\nINFO Engine [no key 0.00017s] ('Spider-Boy',)\n</code></pre> </li> <li> <p>Get one hero object, expecting exactly one.</p> <p>Tip</p> <p>This ensures there's no more than one, and that there's exactly one, not <code>None</code>.</p> <p>This would never return <code>None</code>, instead it would raise an exception.</p> </li> <li> <p>Print the hero object.</p> <p>This generates the output:</p> <pre><code>Hero: name='Spider-Boy' secret_name='Pedro Parqueador' age=None id=2\n</code></pre> </li> <li> <p>Set the hero's age field to the new value <code>16</code>.</p> <p>Now the <code>hero</code> object in memory has a different value for the age, but it is still not saved to the database.</p> </li> <li> <p>Add the hero to the session.</p> <p>This puts it in that temporary place in the session before committing.</p> <p>But it's still not saved in the database yet.</p> </li> <li> <p>Commit the session.</p> <p>This saves the updated hero to the database.</p> <p>And this generates the output:</p> <pre><code>INFO Engine UPDATE hero SET age=? WHERE hero.id = ?\nINFO Engine [generated in 0.00017s] (16, 2)\nINFO Engine COMMIT\n</code></pre> </li> <li> <p>Refresh the hero object to have the recent data, including the age we just committed.</p> <p>This generates the output:</p> <pre><code>INFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00018s] (2,)\n</code></pre> </li> <li> <p>Print the updated hero object.</p> <p>This generates the output:</p> <pre><code>Updated hero: name='Spider-Boy' secret_name='Pedro Parqueador' age=16 id=2\n</code></pre> </li> </ol> <p>Tip</p> <p>Check out the number bubbles to see what is done by each line of code.</p>"},{"location":"tutorial/update/#multiple-updates","title":"Multiple Updates","text":"<p>The update process with SQLDev is more or less the same as with creating new objects, you add them to the session, and then commit them.</p> <p>This also means that you can update several fields (attributes, columns) at once, and you can also update several objects (heroes) at once:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")  # (1)!\n        results = session.exec(statement)  # (2)!\n        hero_1 = results.one()  # (3)!\n        print(\"Hero 1:\", hero_1)  # (4)!\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")  # (5)!\n        results = session.exec(statement)  # (6)!\n        hero_2 = results.one()  # (7)!\n        print(\"Hero 2:\", hero_2)  # (8)!\n\n        hero_1.age = 16  # (9)!\n        hero_1.name = \"Spider-Youngster\"  # (10)!\n        session.add(hero_1)  # (11)!\n\n        hero_2.name = \"Captain North America Except Canada\"  # (12)!\n        hero_2.age = 110  # (13)!\n        session.add(hero_2)  # (14)!\n\n        session.commit()  # (15)!\n        session.refresh(hero_1)  # (16)!\n        session.refresh(hero_2)  # (17)!\n\n        print(\"Updated hero 1:\", hero_1)  # (18)!\n        print(\"Updated hero 2:\", hero_2)  # (19)!\n    # (20)!\n\n# Code below omitted \ud83d\udc47\n</code></pre> <ol> <li> <p>Select the hero <code>Spider-Boy</code>.</p> </li> <li> <p>Execute the select statement.</p> <p>This generates the output:</p> <pre><code>INFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.name = ?\nINFO Engine [no key 0.00018s] ('Spider-Boy',)\n</code></pre> </li> <li> <p>Get one hero object, the only one that should be there for Spider-Boy.</p> </li> <li> <p>Print this hero.</p> <p>This generates the output:</p> <pre><code>Hero 1: name='Spider-Boy' secret_name='Pedro Parqueador' age=None id=2\n</code></pre> </li> <li> <p>Select another hero.</p> </li> <li> <p>Execute the select statement.</p> <p>This generates the output:</p> <pre><code>INFO Engine BEGIN (implicit)\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.name = ?\nINFO Engine [no key 0.00020s] ('Captain North America',)\n</code></pre> <p>Tip</p> <p>See the <code>BEGIN</code> at the top?</p> <p>This is SQLAlchemy automatically starting a transaction for us.</p> <p>This way, we could revert the last changes (if there were some) if we wanted to, even if the SQL to create them was already sent to the database.</p> </li> <li> <p>Get one hero object for this new query.</p> <p>The only one that should be there for Captain North America.</p> </li> <li> <p>Print this second hero.</p> <p>This generates the output:</p> <pre><code>Hero 2: name='Captain North America' secret_name='Esteban Rogelios' age=93 id=7\n</code></pre> </li> <li> <p>Update the age for the first hero.</p> <p>Set the value of the attribute <code>age</code> to <code>16</code>.</p> <p>This updates the hero object in memory, but not yet in the database.</p> </li> <li> <p>Update the name of the first hero.</p> <p>Now the name of the hero will not be <code>\"Spider-Boy\"</code> but <code>\"Spider-Youngster\"</code>.</p> <p>Also, this updates the object in memory, but not yet in the database.</p> </li> <li> <p>Add this first hero to the session.</p> <p>This puts it in the temporary space in the session before committing it to the database.</p> <p>It is not saved yet.</p> </li> <li> <p>Update the name of the second hero.</p> <p>Now the hero has a bit more precision in the name. \ud83d\ude1c</p> <p>This updates the object in memory, but not yet in the database.</p> </li> <li> <p>Update the age of the second hero.</p> <p>This updates the object in memory, but not yet in the database.</p> </li> <li> <p>Add the second hero to the session.</p> <p>This puts it in the temporary space in the session before committing it to the database.</p> </li> <li> <p>Commit all the changes tracked in the session.</p> <p>This commits everything in one single batch.</p> <p>This generates the output:</p> <pre><code>INFO Engine UPDATE hero SET name=?, age=? WHERE hero.id = ?\nINFO Engine [generated in 0.00028s] (('Spider-Youngster', 16, 2), ('Captain North America Except Canada', 110, 7))\nINFO Engine COMMIT\n</code></pre> <p>Tip</p> <p>See how SQLAlchemy (that powers SQLDev) optimizes the SQL to do as much work as possible in a single batch.</p> <p>Here it updates both heroes in a single SQL query.</p> </li> <li> <p>Refresh the first hero.</p> <p>This generates the output:</p> <pre><code>INFO Engine BEGIN (implicit)\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00023s] (2,)\n</code></pre> <p>Tip</p> <p>Because we just committed a SQL transaction with <code>COMMIT</code>, SQLAlchemy will automatically start a new transaction with <code>BEGIN</code>.</p> </li> <li> <p>Refresh the second hero.</p> <p>This generates the output:</p> <pre><code>INFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.001709s ago] (7,)\n</code></pre> <p>Tip</p> <p>SQLAlchemy is still using the previous transaction, so it doesn't have to create a new one.</p> </li> <li> <p>Print the first hero, now updated.</p> <p>This generates the output:</p> <pre><code>Updated hero 1: name='Spider-Youngster' secret_name='Pedro Parqueador' age=16 id=2\n</code></pre> </li> <li> <p>Print the second hero, now updated.</p> <p>This generates the output:</p> <pre><code>Updated hero 2: name='Captain North America Except Canada' secret_name='Esteban Rogelios' age=110 id=7\n</code></pre> </li> <li> <p>Here is the end of the <code>with</code> block statement, so the session can execute its terminating code.</p> <p>The session will <code>ROLLBACK</code> (undo) any possible changes in the last transaction that were not committed.</p> <p>This generates the output:</p> <pre><code>INFO Engine ROLLBACK\n</code></pre> </li> </ol> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")  # (1)!\n        results = session.exec(statement)  # (2)!\n        hero_1 = results.one()  # (3)!\n        print(\"Hero 1:\", hero_1)  # (4)!\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")  # (5)!\n        results = session.exec(statement)  # (6)!\n        hero_2 = results.one()  # (7)!\n        print(\"Hero 2:\", hero_2)  # (8)!\n\n        hero_1.age = 16  # (9)!\n        hero_1.name = \"Spider-Youngster\"  # (10)!\n        session.add(hero_1)  # (11)!\n\n        hero_2.name = \"Captain North America Except Canada\"  # (12)!\n        hero_2.age = 110  # (13)!\n        session.add(hero_2)  # (14)!\n\n        session.commit()  # (15)!\n        session.refresh(hero_1)  # (16)!\n        session.refresh(hero_2)  # (17)!\n\n        print(\"Updated hero 1:\", hero_1)  # (18)!\n        print(\"Updated hero 2:\", hero_2)  # (19)!\n    # (20)!\n\n# Code below omitted \ud83d\udc47\n</code></pre> <ol> <li> <p>Select the hero <code>Spider-Boy</code>.</p> </li> <li> <p>Execute the select statement.</p> <p>This generates the output:</p> <pre><code>INFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.name = ?\nINFO Engine [no key 0.00018s] ('Spider-Boy',)\n</code></pre> </li> <li> <p>Get one hero object, the only one that should be there for Spider-Boy.</p> </li> <li> <p>Print this hero.</p> <p>This generates the output:</p> <pre><code>Hero 1: name='Spider-Boy' secret_name='Pedro Parqueador' age=None id=2\n</code></pre> </li> <li> <p>Select another hero.</p> </li> <li> <p>Execute the select statement.</p> <p>This generates the output:</p> <pre><code>INFO Engine BEGIN (implicit)\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.name = ?\nINFO Engine [no key 0.00020s] ('Captain North America',)\n</code></pre> <p>Tip</p> <p>See the <code>BEGIN</code> at the top?</p> <p>This is SQLAlchemy automatically starting a transaction for us.</p> <p>This way, we could revert the last changes (if there were some) if we wanted to, even if the SQL to create them was already sent to the database.</p> </li> <li> <p>Get one hero object for this new query.</p> <p>The only one that should be there for Captain North America.</p> </li> <li> <p>Print this second hero.</p> <p>This generates the output:</p> <pre><code>Hero 2: name='Captain North America' secret_name='Esteban Rogelios' age=93 id=7\n</code></pre> </li> <li> <p>Update the age for the first hero.</p> <p>Set the value of the attribute <code>age</code> to <code>16</code>.</p> <p>This updates the hero object in memory, but not yet in the database.</p> </li> <li> <p>Update the name of the first hero.</p> <p>Now the name of the hero will not be <code>\"Spider-Boy\"</code> but <code>\"Spider-Youngster\"</code>.</p> <p>Also, this updates the object in memory, but not yet in the database.</p> </li> <li> <p>Add this first hero to the session.</p> <p>This puts it in the temporary space in the session before committing it to the database.</p> <p>It is not saved yet.</p> </li> <li> <p>Update the name of the second hero.</p> <p>Now the hero has a bit more precision in the name. \ud83d\ude1c</p> <p>This updates the object in memory, but not yet in the database.</p> </li> <li> <p>Update the age of the second hero.</p> <p>This updates the object in memory, but not yet in the database.</p> </li> <li> <p>Add the second hero to the session.</p> <p>This puts it in the temporary space in the session before committing it to the database.</p> </li> <li> <p>Commit all the changes tracked in the session.</p> <p>This commits everything in one single batch.</p> <p>This generates the output:</p> <pre><code>INFO Engine UPDATE hero SET name=?, age=? WHERE hero.id = ?\nINFO Engine [generated in 0.00028s] (('Spider-Youngster', 16, 2), ('Captain North America Except Canada', 110, 7))\nINFO Engine COMMIT\n</code></pre> <p>Tip</p> <p>See how SQLAlchemy (that powers SQLDev) optimizes the SQL to do as much work as possible in a single batch.</p> <p>Here it updates both heroes in a single SQL query.</p> </li> <li> <p>Refresh the first hero.</p> <p>This generates the output:</p> <pre><code>INFO Engine BEGIN (implicit)\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00023s] (2,)\n</code></pre> <p>Tip</p> <p>Because we just committed a SQL transaction with <code>COMMIT</code>, SQLAlchemy will automatically start a new transaction with <code>BEGIN</code>.</p> </li> <li> <p>Refresh the second hero.</p> <p>This generates the output:</p> <pre><code>INFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.001709s ago] (7,)\n</code></pre> <p>Tip</p> <p>SQLAlchemy is still using the previous transaction, so it doesn't have to create a new one.</p> </li> <li> <p>Print the first hero, now updated.</p> <p>This generates the output:</p> <pre><code>Updated hero 1: name='Spider-Youngster' secret_name='Pedro Parqueador' age=16 id=2\n</code></pre> </li> <li> <p>Print the second hero, now updated.</p> <p>This generates the output:</p> <pre><code>Updated hero 2: name='Captain North America Except Canada' secret_name='Esteban Rogelios' age=110 id=7\n</code></pre> </li> <li> <p>Here is the end of the <code>with</code> block statement, so the session can execute its terminating code.</p> <p>The session will <code>ROLLBACK</code> (undo) any possible changes in the last transaction that were not committed.</p> <p>This generates the output:</p> <pre><code>INFO Engine ROLLBACK\n</code></pre> </li> </ol> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")  # (1)!\n        results = session.exec(statement)  # (2)!\n        hero_1 = results.one()  # (3)!\n        print(\"Hero 1:\", hero_1)  # (4)!\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")  # (5)!\n        results = session.exec(statement)  # (6)!\n        hero_2 = results.one()  # (7)!\n        print(\"Hero 2:\", hero_2)  # (8)!\n\n        hero_1.age = 16  # (9)!\n        hero_1.name = \"Spider-Youngster\"  # (10)!\n        session.add(hero_1)  # (11)!\n\n        hero_2.name = \"Captain North America Except Canada\"  # (12)!\n        hero_2.age = 110  # (13)!\n        session.add(hero_2)  # (14)!\n\n        session.commit()  # (15)!\n        session.refresh(hero_1)  # (16)!\n        session.refresh(hero_2)  # (17)!\n\n        print(\"Updated hero 1:\", hero_1)  # (18)!\n        print(\"Updated hero 2:\", hero_2)  # (19)!\n    # (20)!\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")  # (1)!\n        results = session.exec(statement)  # (2)!\n        hero_1 = results.one()  # (3)!\n        print(\"Hero 1:\", hero_1)  # (4)!\n\n        statement = select(Hero).where(Hero.name == \"Captain North America\")  # (5)!\n        results = session.exec(statement)  # (6)!\n        hero_2 = results.one()  # (7)!\n        print(\"Hero 2:\", hero_2)  # (8)!\n\n        hero_1.age = 16  # (9)!\n        hero_1.name = \"Spider-Youngster\"  # (10)!\n        session.add(hero_1)  # (11)!\n\n        hero_2.name = \"Captain North America Except Canada\"  # (12)!\n        hero_2.age = 110  # (13)!\n        session.add(hero_2)  # (14)!\n\n        session.commit()  # (15)!\n        session.refresh(hero_1)  # (16)!\n        session.refresh(hero_2)  # (17)!\n\n        print(\"Updated hero 1:\", hero_1)  # (18)!\n        print(\"Updated hero 2:\", hero_2)  # (19)!\n    # (20)!\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Tip</p> <p>Review what each line does by clicking each number bubble in the code. \ud83d\udc46</p>"},{"location":"tutorial/update/#recap","title":"Recap","text":"<p>Update SQLDev objects just as you would with other Python objects. \ud83d\udc0d</p> <p>Just remember to <code>add</code> them to a session, and then <code>commit</code> it. And if necessary, <code>refresh</code> them.</p>"},{"location":"tutorial/where/","title":"Filter Data - WHERE","text":"<p>In the previous chapter we saw how to <code>SELECT</code> data from the database.</p> <p>We did it using pure SQL and using SQLDev.</p> <p>But we always got all the rows, the whole table:</p> idnamesecret_nameage 1DeadpondDive Wilsonnull 2Spider-BoyPedro Parqueadornull 3Rusty-ManTommy Sharp48 <p>In most of the cases we will want to get only one row, or only a group of rows.</p> <p>We will see how to do that now, to filter data and get only the rows where a condition is true.</p>"},{"location":"tutorial/where/#continue-from-previous-code","title":"Continue From Previous Code","text":"<p>We'll continue with the same examples we have been using in the previous chapters to create and select data.</p> <p>And now we will update <code>select_heroes()</code> to filter the data.</p> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>If you already executed the previous examples and have a database with data, remove the database file before running each example, that way you won't have duplicate data and you will be able to get the same results.</p>"},{"location":"tutorial/where/#filter-data-with-sql","title":"Filter Data with SQL","text":"<p>Let's check first how to filter data with SQL using the <code>WHERE</code> keyword.</p> <pre><code>SELECT id, name, secret_name, age\nFROM hero\nWHERE name = \"Deadpond\"\n</code></pre> <p>The first part means the same as before:</p> <p>Hey SQL database \ud83d\udc4b, please go and <code>SELECT</code> some data for me.</p> <p>I'll first tell you the columns I want:</p> <ul> <li><code>id</code></li> <li><code>name</code></li> <li><code>secret_name</code></li> <li><code>age</code></li> </ul> <p>And I want you to get them <code>FROM</code> the table called <code>\"hero\"</code>.</p> <p>Then the <code>WHERE</code> keyword adds the following:</p> <p>So, SQL database, I already told you what columns to <code>SELECT</code> and where to select them <code>FROM</code>. But I don't want you to bring me all the rows, I only want the rows <code>WHERE</code> the <code>name</code> column has a value of <code>\"Deadpond\"</code>.</p> <p>Then the database will bring a table like this:</p> idnamesecret_nameage 1DeadpondDive Wilsonnull <p>Tip</p> <p>Even if the result is only one row, the database always returns a table.</p> <p>In this case, a table with only one row.</p> <p>You can try that out in DB Browser for SQLite:</p> <p></p>"},{"location":"tutorial/where/#where-and-from-are-clauses","title":"<code>WHERE</code> and <code>FROM</code> are \"clauses\"","text":"<p>These additional keywords with some sections like <code>WHERE</code> and <code>FROM</code> that go after <code>SELECT</code> (or others) have a technical name, they are called clauses.</p> <p>There are others clauses too, with their own SQL keywords.</p> <p>I won't use the term clause too much here, but it's good for you to know it as it will probably show up in other tutorials you could study later. \ud83e\udd13</p>"},{"location":"tutorial/where/#select-and-where","title":"<code>SELECT</code> and <code>WHERE</code>","text":"<p>Here's a quick tip that helps me think about it.</p> <ul> <li><code>SELECT</code> is used to tell the SQL database what columns to return.</li> <li><code>WHERE</code> is used to tell the SQL database what rows to return.</li> </ul> <p>The size of the table in the two dimensions depend mostly on those two keywords.</p>"},{"location":"tutorial/where/#select-land","title":"<code>SELECT</code> Land","text":"<p>If the table has too many or too few columns, that's changed in the <code>SELECT</code> part.</p> <p>Starting with some table:</p> idnamesecret_nameage 1DeadpondDive Wilsonnull 2Spider-BoyPedro Parqueadornull 3Rusty-ManTommy Sharp48 <p>...and changing the number of columns:</p> name Deadpond Spider-Boy Rusty-Man <p>...is all <code>SELECT</code> land.</p>"},{"location":"tutorial/where/#where-land","title":"<code>WHERE</code> Land","text":"<p>If the table has too many or too few rows, that's changed in the <code>WHERE</code> part.</p> <p>Starting with some table:</p> idnamesecret_nameage 1DeadpondDive Wilsonnull 2Spider-BoyPedro Parqueadornull 3Rusty-ManTommy Sharp48 <p>...and changing the number of rows:</p> idnamesecret_nameage 2Spider-BoyPedro Parqueadornull <p>...is all <code>WHERE</code> land.</p>"},{"location":"tutorial/where/#review-select-with-sqldev","title":"Review <code>SELECT</code> with SQLDev","text":"<p>Let's review some of the code we used to read data with SQLDev.</p> <p>We care specially about the select statement:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/where/#filter-rows-using-where-with-sqldev","title":"Filter Rows Using <code>WHERE</code> with SQLDev","text":"<p>Now, the same way that we add <code>WHERE</code> to a SQL statement to filter rows, we can add a <code>.where()</code> to a SQLDev <code>select()</code> statement to filter rows, which will filter the objects returned:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>It's a very small change, but it's packed of details. Let's explore them.</p>"},{"location":"tutorial/where/#select-objects","title":"<code>select()</code> Objects","text":"<p>The object returned by <code>select(Hero)</code> is a special type of object with some methods.</p> <p>One of those methods is <code>.where()</code> used to (unsurprisingly) add a <code>WHERE</code> to the SQL statement in that select object.</p> <p>There are other methods that we will explore later. \ud83d\udca1</p> <p>Most of these methods return the same object again after modifying it.</p> <p>So we could call one after the other:</p> <pre><code>statement = select(Hero).where(Hero.name == \"Deadpond\").where(Hero.age == 48)\n</code></pre>"},{"location":"tutorial/where/#calling-where","title":"Calling <code>.where()</code>","text":"<p>Now, this <code>.where()</code> method is special and very powerful. It is tightly integrated with SQLDev (actually SQLAlchemy) to let you use very familiar Python syntax and code.</p> <p>Notice that we didn't call it with a single equal (<code>=</code>) sign, and with something like:</p> <pre><code># Not supported \ud83d\udea8\nselect(Hero).where(name=\"Deadpond\")\n</code></pre> <p>That would have been shorter, of course, but it would have been much more error prone and limited. I'll show you why in a bit.</p> <p>Instead, we used two <code>==</code>:</p> <pre><code>select(Hero).where(Hero.name == \"Deadpond\")\n</code></pre> <p>So, what's happening there?</p>"},{"location":"tutorial/where/#where-and-expressions","title":"<code>.where()</code> and Expressions","text":"<p>In the example above we are using two equal signs (<code>==</code>). That's called the \"equality operator\".</p> <p>Tip</p> <p>An operator is just a symbol that is put beside one value or in the middle of two values to do something with them.</p> <p><code>==</code> is called the equality operator because it checks if two things are equal.</p> <p>When writing Python, if you write something using this equality operator (<code>==</code>) like:</p> <pre><code>some_name == \"Deadpond\"\n</code></pre> <p>...that's called an equality \"comparison\", and it normally results in a value of:</p> <pre><code>True\n</code></pre> <p>...or</p> <pre><code>False\n</code></pre> <p>Tip</p> <p><code>&lt;</code>, <code>&gt;</code>, <code>==</code>, <code>&gt;=</code>, <code>&lt;=</code>, and <code>!=</code> are all operators used for comparisons.</p> <p>But SQLAlchemy adds some magic to the columns/fields in a model class to make those Python comparisons have super powers.</p> <p>So, if you write something like:</p> <pre><code>Hero.name == \"Deadpond\"\n</code></pre> <p>...that doesn't result in a value of <code>True</code> or <code>False</code>. \ud83e\udd2f</p> <p>Instead, it results in a special type of object. If you tried that in an interactive Python session, you'd see something like:</p> <pre><code>&gt;&gt;&gt; Hero.name == \"Deadpond\"\n&lt;sqlalchemy.sql.elements.BinaryExpression object at 0x7f4aec0d6c90&gt;\n</code></pre> <p>So, that result value is an expression object. \ud83d\udca1</p> <p>And <code>.where()</code> takes one (or more) of these expression objects to update the SQL statement.</p>"},{"location":"tutorial/where/#model-class-attributes-expressions-and-instances","title":"Model Class Attributes, Expressions, and Instances","text":"<p>Now, let's stop for a second to make a clear distinction that is very important and easy to miss.</p> <p>Model class attributes for each of the columns/fields are special and can be used for expressions.</p> <p>But that's only for the model class attributes. \ud83d\udea8</p> <p>Instance attributes behave like normal Python values. \u2705</p> <p>So, using the class (<code>Hero</code>, with capital <code>H</code>) in a Python comparison:</p> <pre><code>Hero.name == \"Deadpond\"\n</code></pre> <p>...results in one of those expression objects to be used with <code>.where()</code>:</p> <pre><code>&lt;sqlalchemy.sql.elements.BinaryExpression object at 0x7f4aec0d6c90&gt;\n</code></pre> <p>But if you take an instance:</p> <pre><code>some_hero = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n</code></pre> <p>...and use it in a comparison:</p> <pre><code>some_hero.name == \"Deadpond\"\n</code></pre> <p>...that results in a Python value of:</p> <pre><code>True\n</code></pre> <p>...or if it was a different object with a different name, it could have been:</p> <pre><code>False\n</code></pre> <p>The difference is that one is using the model class, the other is using an instance.</p>"},{"location":"tutorial/where/#class-or-instance","title":"Class or Instance","text":"<p>It's quite probable that you will end up having some variable <code>hero</code> (with lowercase <code>h</code>) like:</p> <pre><code>hero = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n</code></pre> <p>And now the class is <code>Hero</code> (with capital <code>H</code>) and the instance is <code>hero</code> (with a lowercase <code>h</code>).</p> <p>So now you have <code>Hero.name</code> and <code>hero.name</code> that look very similar, but are two different things:</p> <pre><code>&gt;&gt;&gt; Hero.name == \"Deadpond\"\n&lt;sqlalchemy.sql.elements.BinaryExpression object at 0x7f4aec0d6c90&gt;\n\n&gt;&gt;&gt; hero.name == \"Deadpond\"\nTrue\n</code></pre> <p>It's just something to pay attention to. \ud83e\udd13</p> <p>But after understanding that difference between classes and instances it can feel natural, and you can do very powerful things. \ud83d\ude80</p> <p>For example, as <code>hero.name</code> works like a <code>str</code> and <code>Hero.name</code> works like a special object for comparisons, you could write some code like:</p> <pre><code>select(Hero).where(Hero.name == hero.name)\n</code></pre> <p>That would mean:</p> <p>Hey SQL Database \ud83d\udc4b, please <code>SELECT</code> all the columns</p> <p><code>FROM</code> the table for the model class <code>Hero</code> (the table <code>\"hero\"</code>)</p> <p><code>WHERE</code> the column <code>\"name\"</code> is equal to the name of this hero instance I have here: <code>hero.name</code> (in the example above, the value <code>\"Deadpond\"</code>).</p>"},{"location":"tutorial/where/#where-and-expressions-instead-of-keyword-arguments","title":"<code>.where()</code> and Expressions Instead of Keyword Arguments","text":"<p>Now, let me tell you why I think that for this use case of interacting with SQL databases it's better to have these expressions:</p> <pre><code># Expression \u2728\nselect(Hero).where(Hero.name == \"Deadpond\")\n</code></pre> <p>...instead of keyword arguments like this:</p> <pre><code># Not supported, keyword argument \ud83d\udea8\nselect(Hero).where(name=\"Deadpond\")\n</code></pre> <p>Of course, the keyword arguments would have been a bit shorter.</p> <p>But with the expressions your editor can help you a lot with autocompletion and inline error checks. \u2728</p> <p>Let me give you an example. Let's imagine that keyword arguments were supported in SQLDev and you wanted to filter using the secret identity of Spider-Boy.</p> <p>You could write:</p> <pre><code># Don't copy this \ud83d\udea8\nselect(Hero).where(secret_identity=\"Pedro Parqueador\")\n</code></pre> <p>The editor would see the code, and because it doesn't have any information of which keyword arguments are allowed and which not, it would have no way to help you detect the error.</p> <p>Maybe your code could even run and seem like it's all fine, and then some months later you would be wondering why your app never finds rows although you were sure that there was one <code>\"Pedro Parqueador\"</code>. \ud83d\ude31</p> <p>And maybe finally you would realize that we wrote the code using <code>secret_identity</code> which is not a column in the table. We should have written <code>secret_name</code> instead.</p> <p>Now, with the expressions, your editor would show you an error right away if you tried this:</p> <pre><code># Expression \u2728\nselect(Hero).where(Hero.secret_identity == \"Pedro Parqueador\")\n</code></pre> <p>Even better, it would autocomplete the correct one for you, to get:</p> <pre><code>select(Hero).where(Hero.secret_name == \"Pedro Parqueador\")\n</code></pre> <p>I think that alone, having better editor support, autocompletion, and inline errors, is enough to make it worth having expressions instead of keyword arguments. \u2728</p> <p>Tip</p> <p>Expressions also provide more features for other types of comparisons, shown down below. \ud83d\udc47</p>"},{"location":"tutorial/where/#exec-the-statement","title":"Exec the Statement","text":"<p>Now that we know how <code>.where()</code> works, let's finish the code.</p> <p>It's actually the same as in previous chapters for selecting data:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>We take that statement, that now includes a <code>WHERE</code>, and we <code>exec()</code> it to get the results.</p> <p>And in this case the results will be just one:</p> <pre><code>$ python app.py\n\n// Some boilerplate output omitted \ud83d\ude09\n\n// Now the important part, the SELECT with WHERE \ud83d\udca1\n\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.name = ?\nINFO Engine [no key 0.00014s] ('Deadpond',)\n\n// Here's the only printed hero\nsecret_name='Dive Wilson' age=None id=1 name='Deadpond'\n</code></pre> <p>Tip</p> <p>The <code>results</code> object is an iterable to be used in a <code>for</code> loop.</p> <p>Even if we got only one row, we iterate over that <code>results</code> object. Just as if it was a list of one element.</p> <p>We'll see other ways to get the data later.</p>"},{"location":"tutorial/where/#other-comparisons","title":"Other Comparisons","text":"<p>Here's another great advantage of these special expressions  passed to <code>.where()</code>.</p> <p>Above, we have been using an \"equality\" comparison (using <code>==</code>), only checking if two things are the same value.</p> <p>But we can use other standard Python comparisons. \u2728</p>"},{"location":"tutorial/where/#not-equal","title":"Not Equal","text":"<p>We could get the rows where a column is not equal to a value using <code>!=</code>:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name != \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name != \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name != \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name != \"Deadpond\")\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>That would output:</p> <pre><code>secret_name='Pedro Parqueador' age=None id=2 name='Spider-Boy'\nsecret_name='Tommy Sharp' age=48 id=3 name='Rusty-Man'\n</code></pre>"},{"location":"tutorial/where/#pause-to-add-data","title":"Pause to Add Data","text":"<p>Let's update the function <code>create_heroes()</code> and add some more rows to make the next comparison examples clearer:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt; 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt; 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Now that we have several heroes with different ages, it's gonna be more obvious what the next comparisons do.</p>"},{"location":"tutorial/where/#more-than","title":"More Than","text":"<p>Now let's use <code>&gt;</code> to get the rows where a column is more than a value:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt; 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt; 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt; 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt; 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>That would output:</p> <pre><code>age=48 id=3 name='Rusty-Man' secret_name='Tommy Sharp'\nage=36 id=6 name='Dr. Weird' secret_name='Steve Weird'\nage=93 id=7 name='Captain North America' secret_name='Esteban Rogelios'\n</code></pre> <p>Tip</p> <p>Notice that it didn't select <code>Black Lion</code>, because the age is not strictly greater than <code>35</code>.</p>"},{"location":"tutorial/where/#more-than-or-equal","title":"More Than or Equal","text":"<p>Let's do that again, but with <code>&gt;=</code> to get the rows where a column is more than or equal to a value:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Because we are using <code>&gt;=</code>, the age <code>35</code> will be included in the output:</p> <pre><code>age=48 id=3 name='Rusty-Man' secret_name='Tommy Sharp'\nage=35 id=5 name='Black Lion' secret_name='Trevor Challa'\nage=36 id=6 name='Dr. Weird' secret_name='Steve Weird'\nage=93 id=7 name='Captain North America' secret_name='Esteban Rogelios'\n</code></pre> <p>Tip</p> <p>This time we got <code>Black Lion</code> too because although the age is not strictly greater than <code>35</code>it is equal to <code>35</code>.</p>"},{"location":"tutorial/where/#less-than","title":"Less Than","text":"<p>Similarly, we can use <code>&lt;</code> to get the rows where a column is less than a value:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt; 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt; 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt; 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt; 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>And we get the younger one with an age in the database:</p> <pre><code>age=32 id=4 name='Tarantula' secret_name='Natalia Roman-on'\n</code></pre> <p>Tip</p> <p>We could imagine that Spider-Boy is even younger. But because we don't know the age, it is <code>NULL</code> in the database (<code>None</code> in Python), it doesn't match any of these age comparisons with numbers.</p>"},{"location":"tutorial/where/#less-than-or-equal","title":"Less Than or Equal","text":"<p>Finally, we can use <code>&lt;=</code> to get the rows where a column is less than or equal to a value:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &lt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>And we get the younger ones, <code>35</code> and below:</p> <pre><code>age=32 id=4 name='Tarantula' secret_name='Natalia Roman-on'\nage=35 id=5 name='Black Lion' secret_name='Trevor Challa'\n</code></pre> <p>Tip</p> <p>We get <code>Black Lion</code> here too because although the age is not strictly less than <code>35</code> it is equal to <code>35</code>.</p>"},{"location":"tutorial/where/#benefits-of-expressions","title":"Benefits of Expressions","text":"<p>Here's a good moment to see that being able to use these pure Python expressions instead of keyword arguments can help a lot. \u2728</p> <p>We can use the same standard Python comparison operators like <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>==</code>, etc.</p>"},{"location":"tutorial/where/#multiple-where","title":"Multiple <code>.where()</code>","text":"<p>Because <code>.where()</code> returns the same special select object back, we can add more <code>.where()</code> calls to it:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt;= 35).where(Hero.age &lt; 40)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt;= 35).where(Hero.age &lt; 40)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt;= 35).where(Hero.age &lt; 40)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt;= 35).where(Hero.age &lt; 40)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>This will select the rows <code>WHERE</code> the <code>age</code> is greater than or equal to <code>35</code>, <code>AND</code> also the <code>age</code> is less than <code>40</code>.</p> <p>The equivalent SQL would be:</p> <pre><code>SELECT id, name, secret_name, age\nFROM hero\nWHERE age &gt;= 35 AND age &lt; 40\n</code></pre> <p>This uses <code>AND</code> to put both comparisons together.</p> <p>We can then run it to see the output from the program:</p> <pre><code>$ python app.py\n\n// Some boilerplate output omitted \ud83d\ude09\n\n// The SELECT statement with WHERE, also using AND\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.age &gt;= ? AND hero.age &lt; ?\nINFO Engine [no key 0.00014s] (35, 40)\n\n// The two heroes printed\nage=35 id=5 name='Black Lion' secret_name='Trevor Challa'\nage=36 id=6 name='Dr. Weird' secret_name='Steve Weird'\n</code></pre>"},{"location":"tutorial/where/#where-with-multiple-expressions","title":"<code>.where()</code> With Multiple Expressions","text":"<p>As an alternative to using multiple <code>.where()</code> we can also pass several expressions to a single <code>.where()</code>:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt;= 35, Hero.age &lt; 40)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt;= 35, Hero.age &lt; 40)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt;= 35, Hero.age &lt; 40)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.age &gt;= 35, Hero.age &lt; 40)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>This is the same as the above, and will result in the same output with the two heroes:</p> <pre><code>age=35 id=5 name='Black Lion' secret_name='Trevor Challa'\nage=36 id=6 name='Dr. Weird' secret_name='Steve Weird'\n</code></pre>"},{"location":"tutorial/where/#where-with-multiple-expressions-using-or","title":"<code>.where()</code> With Multiple Expressions Using <code>OR</code>","text":"<p>These last examples use <code>where()</code> with multiple expressions. And then those are combined in the final SQL using <code>AND</code>, which means that all of the expressions must be true in a row for it to be included in the results.</p> <p>But we can also combine expressions using <code>OR</code>. Which means that any (but not necessarily all) of the expressions should be true in a row for it to be included.</p> <p>To do it, you can import <code>or_</code>:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, or_, select\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, or_, select\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, or_, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(or_(Hero.age &lt;= 35, Hero.age &gt; 90))\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, or_, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(or_(Hero.age &lt;= 35, Hero.age &gt; 90))\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>And then pass both expressions to <code>or_()</code> and put it inside <code>.where()</code>.</p> <p>For example, here we select the heroes that are the youngest OR the oldest:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(or_(Hero.age &lt;= 35, Hero.age &gt; 90))\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(or_(Hero.age &lt;= 35, Hero.age &gt; 90))\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, or_, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(or_(Hero.age &lt;= 35, Hero.age &gt; 90))\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, or_, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(or_(Hero.age &lt;= 35, Hero.age &gt; 90))\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>When we run it, this generates the output:</p> <pre><code>$ python app.py\n\n// Some boilerplate output omitted \ud83d\ude09\n\n// The SELECT statement with WHERE, also using OR \ud83d\udd0d\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.age &lt;= ? OR hero.age &gt; ?\nINFO Engine [no key 0.00021s] (35, 90)\n\n// The results include the youngest and oldest \u2728\nsecret_name='Natalia Roman-on' age=32 id=4 name='Tarantula'\nsecret_name='Trevor Challa' age=35 id=5 name='Black Lion'\nsecret_name='Esteban Rogelios' age=93 id=7 name='Captain North America'\n</code></pre>"},{"location":"tutorial/where/#type-annotations-and-errors","title":"Type Annotations and Errors","text":"<p>There's a chance that your editor gives you an error when using these comparisons, like:</p> <pre><code>Hero.age &gt; 35\n</code></pre> <p>It would be an error telling you that</p> <p><code>Hero.age</code> is potentially <code>None</code>, and you cannot compare <code>None</code> with <code>&gt;</code></p> <p>This is because as we are using pure and plain Python annotations for the fields, <code>age</code> is indeed annotated as <code>int | None (or Optional[int])</code>.</p> <p>By using this simple and standard Python type annotations we get the benefit of the extra simplicity and the inline error checks when creating or using instances. \u2728</p> <p>And when we use these special class attributes in a <code>.where()</code>, during execution of the program, the special class attribute will know that the comparison only applies for the values that are not <code>NULL</code> in the database, and it will work correctly.</p> <p>But the editor doesn't know that it's a special class attribute, so it tries to help us preventing an error (that in this case is a false alarm).</p> <p>Nevertheless, we can easily fix. \ud83c\udf89</p> <p>We can tell the editor that this class attribute is actually a special SQLDev column (instead of an instance attribute with a normal value).</p> <p>To do that, we can import <code>col()</code> (as short for \"column\"):</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, col, create_engine, select\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, col, create_engine, select\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, col, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(col(Hero.age) &gt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, col, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(col(Hero.age) &gt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>And then put the class attribute inside <code>col()</code> when using it in a <code>.where()</code>:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(col(Hero.age) &gt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(col(Hero.age) &gt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, col, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(col(Hero.age) &gt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, col, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n    hero_3 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    hero_4 = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n    hero_5 = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n    hero_6 = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n    hero_7 = Hero(name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93)\n\n    with Session(engine) as session:\n        session.add(hero_1)\n        session.add(hero_2)\n        session.add(hero_3)\n        session.add(hero_4)\n        session.add(hero_5)\n        session.add(hero_6)\n        session.add(hero_7)\n\n        session.commit()\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(col(Hero.age) &gt;= 35)\n        results = session.exec(statement)\n        for hero in results:\n            print(hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>So, now the comparison is not:</p> <pre><code>Hero.age &gt; 35\n</code></pre> <p>...but:</p> <pre><code>col(Hero.age) &gt; 35\n</code></pre> <p>And with that the editor knows this code is actually fine, because this is a special SQLDev column.</p> <p>Tip</p> <p>That <code>col()</code> will come handy later, giving autocompletion to several other things we can do with these special class attributes for columns.</p> <p>But we'll get there later.</p>"},{"location":"tutorial/where/#recap","title":"Recap","text":"<p>You can use <code>.where()</code> with powerful expressions using SQLDev columns (the special class attributes) to filter the rows that you want. \ud83d\ude80</p> <p>Up to now, the database would have been looking through each one of the records (rows) to find the ones that match what you want. If you have thousands or millions of records, this could be very slow. \ud83d\ude31</p> <p>In the next section I'll tell you how to add indexes to the database, this is what will make the queries very efficient. \ud83d\ude0e</p>"},{"location":"tutorial/connect/","title":"Connect Tables - JOIN - Intro","text":"<p>By this point, you already know how to perform the main CRUD operations with SQLDev using a single table. \ud83c\udf89</p> <p>But the main advantage and feature of SQL databases is being able to handle related data, to connect or \"join\" different tables together. Connecting rows in one table to rows in another.</p> <p>Let's see how to use SQLDev to manage connected data in the next chapters. \ud83e\udd1d</p> <p>Tip</p> <p>We will extend this further in the next group of chapters making it even more convenient to work with in Python code, using relationship attributes.</p> <p>But you should start in this group of chapters first. \ud83e\udd13</p>"},{"location":"tutorial/connect/create-connected-rows/","title":"Create and Connect Rows","text":"<p>We will now create rows for each table. \u2728</p> <p>The <code>team</code> table will look like this:</p> idnameheadquarters 1PreventersSharp Tower 2Z-ForceSister Margaret's Bar <p>And after we finish working with the data in this chapter, the <code>hero</code> table will look like this:</p> idnamesecret_nameageteam_id 1DeadpondDive Wilsonnull2 2Rusty-ManTommy Sharp481 3Spider-BoyPedro Parqueadornullnull <p>Each row in the table <code>hero</code> will point to a row in the table <code>team</code>:</p> <p></p> <p>Info</p> <p>We will later update Spider-Boy to add him to the Preventers team too, but not yet.</p> <p>We will continue with the code in the previous example and we will add more things to it.</p> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef main():\n    create_db_and_tables()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef main():\n    create_db_and_tables()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Make sure you remove the <code>database.db</code> file before running the examples to get the same results.</p>"},{"location":"tutorial/connect/create-connected-rows/#create-rows-for-teams-with-sqldev","title":"Create Rows for Teams with SQLDev","text":"<p>Let's do the same we did before and define a <code>create_heroes()</code> function where we create our heroes.</p> <p>And now we will also create the teams there. \ud83c\udf89</p> <p>Let's start by creating two teams:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>This would hopefully look already familiar.</p> <p>We start a session in a <code>with</code> block using the same engine we created above.</p> <p>Then we create two instances of the model class (in this case <code>Team</code>).</p> <p>Next we add those objects to the session.</p> <p>And finally we commit the session to save the changes to the database.</p>"},{"location":"tutorial/connect/create-connected-rows/#add-it-to-main","title":"Add It to Main","text":"<p>Let's not forget to add this function <code>create_heroes()</code> to the <code>main()</code> function so that we run it when calling the program from the command line:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/connect/create-connected-rows/#run-it","title":"Run it","text":"<p>If we run that code we have up to now, it will output:</p> <pre><code>$ python app.py\n\n// Previous output omitted \ud83d\ude09\n\n// Automatically start a transaction\nINFO Engine BEGIN (implicit)\n// Add the teams to the database\nINFO Engine INSERT INTO team (name, headquarters) VALUES (?, ?)\nINFO Engine [generated in 0.00050s] ('Preventers', 'Sharp Tower')\nINFO Engine INSERT INTO team (name, headquarters) VALUES (?, ?)\nINFO Engine [cached since 0.002324s ago] ('Z-Force', 'Sister Margaret's Bar')\nINFO Engine COMMIT\n</code></pre> <p>You can see in the output that it uses common SQL <code>INSERT</code> statements to create the rows.</p>"},{"location":"tutorial/connect/create-connected-rows/#create-rows-for-heroes-in-code","title":"Create Rows for Heroes in Code","text":"<p>Now let's create one hero object to start.</p> <p>As the <code>Hero</code> class model now has a field (column, attribute) <code>team_id</code>, we can set it by using the ID field from the <code>Team</code> objects we just created before:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>We haven't committed this hero to the database yet, but there are already a couple of things to pay attention to.</p> <p>If the database already had some teams, we wouldn't even know what is the ID that is going to be automatically assigned to each team by the database, for example, we couldn't just guess <code>1</code> or <code>2</code>.</p> <p>But once the team is created and committed to the database, we can access the object's <code>id</code> field to get that ID.</p> <p>Accessing an attribute in a model that was just committed, for example with <code>team_z_force.id</code>, automatically triggers a refresh of the data from the DB in the object, and then exposes the value for that field.</p> <p>So, even though we are not committing this hero yet, just because we are using <code>team_z_force.id</code>, that will trigger some SQL sent to the database to fetch the data for this team.</p> <p>That line alone would generate an output of:</p> <pre><code>INFO Engine BEGIN (implicit)\nINFO Engine SELECT team.id AS team_id, team.name AS team_name, team.headquarters AS team_headquarters\nFROM team\nWHERE team.id = ?\nINFO Engine [generated in 0.00025s] (2,)\n</code></pre> <p>Let's now create two more heroes:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>When creating <code>hero_rusty_man</code>, we are accessing <code>team_preventers.id</code>, so that will also trigger a refresh of its data, generating an output of:</p> <pre><code>INFO Engine SELECT team.id AS team_id, team.name AS team_name, team.headquarters AS team_headquarters\nFROM team\nWHERE team.id = ?\nINFO Engine [cached since 0.001795s ago] (1,)\n</code></pre> <p>There's something else to note. We marked <code>team_id</code> as <code>Optional[int]</code>, meaning that this could be <code>NULL</code> on the database (and <code>None</code> in Python).</p> <p>That means that a hero doesn't have to have a team. And in this case, Spider-Boy doesn't have one.</p> <p>Next we just commit the changes to save them to the database, and that will generate the output:</p> <pre><code>INFO Engine INSERT INTO hero (name, secret_name, age, team_id) VALUES (?, ?, ?, ?)\nINFO Engine [generated in 0.00022s] ('Deadpond', 'Dive Wilson', None, 2)\nINFO Engine INSERT INTO hero (name, secret_name, age, team_id) VALUES (?, ?, ?, ?)\nINFO Engine [cached since 0.0007987s ago] ('Rusty-Man', 'Tommy Sharp', 48, 1)\nINFO Engine INSERT INTO hero (name, secret_name, age, team_id) VALUES (?, ?, ?, ?)\nINFO Engine [cached since 0.001095s ago] ('Spider-Boy', 'Pedro Parqueador', None, None)\nINFO Engine COMMIT\n</code></pre>"},{"location":"tutorial/connect/create-connected-rows/#refresh-and-print-heroes","title":"Refresh and Print Heroes","text":"<p>Now let's refresh and print those new heroes to see their new ID pointing to their teams:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>If we execute that in the command line, it will output:</p> <pre><code>$ python app.py\n\n// Previous output omitted \ud83d\ude09\n\n// Automatically start a transaction\nINFO Engine BEGIN (implicit)\n\n// Refresh the first hero\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age, hero.team_id\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00021s] (1,)\n// Refresh the second hero\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age, hero.team_id\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.001575s ago] (2,)\n// Refresh the third hero\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age, hero.team_id\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.002518s ago] (3,)\n\n// Print the heroes\nCreated hero: id=1 secret_name='Dive Wilson' team_id=2 name='Deadpond' age=None\nCreated hero: id=2 secret_name='Tommy Sharp' team_id=1 name='Rusty-Man' age=48\nCreated hero: id=3 secret_name='Pedro Parqueador' team_id=None name='Spider-Boy' age=None\n</code></pre> <p>They now have their <code>team_id</code>s, nice!</p>"},{"location":"tutorial/connect/create-connected-rows/#relationships","title":"Relationships","text":"<p>Relationships in SQL databases are just made by having columns in one table referencing the values in columns on other tables.</p> <p>And here we have treated them just like that, more column fields, which is what they actually are behind the scenes in the SQL database.</p> <p>But later in this tutorial, in the next group of chapters, you will learn about Relationship Attributes to make it all a lot easier to work with in code. \u2728</p>"},{"location":"tutorial/connect/create-connected-tables/","title":"Create Connected Tables","text":"<p>Now we will deal with connected data put in different tables.</p> <p>So, the first step is to create more than one table and connect them, so that each row in one table can reference another row in the other table.</p> <p>We have been working with heroes in a single table <code>hero</code>. Let's now add a table <code>team</code>.</p> <p>The team table will look like this:</p> idnameheadquarters 1PreventersSharp Tower 2Z-ForceSister Margaret's Bar <p>To connect them, we will add another column to the hero table to point to each team by the ID with the <code>team_id</code>:</p> idnamesecret_nameageteam_id \u2728 1DeadpondDive Wilsonnull2 \u2728 2Spider-BoyPedro Parqueadornull1 \u2728 3Rusty-ManTommy Sharp481 \u2728 <p>This way each row in the table <code>hero</code> can point to a row in the table <code>team</code>:</p> <p></p>"},{"location":"tutorial/connect/create-connected-tables/#one-to-many-and-many-to-one","title":"One-to-Many and Many-to-One","text":"<p>Here we are creating connected data in a relationship where one team could have many heroes. So it is commonly called a one-to-many or many-to-one relationship.</p> <p>The many-to-one part can be seen if we start from the heroes, many heroes could be part of one team.</p> <p>This is probably the most popular type of relationship, so we'll start with that. But there's also many-to-many and one-to-one relationships.</p>"},{"location":"tutorial/connect/create-connected-tables/#create-tables-in-code","title":"Create Tables in Code","text":""},{"location":"tutorial/connect/create-connected-tables/#create-the-team-table","title":"Create the <code>team</code> Table","text":"<p>Let's start by creating the tables in code.</p> <p>Import the things we need from <code>sqldev</code> and create a new <code>Team</code> model:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef main():\n    create_db_and_tables()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef main():\n    create_db_and_tables()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>This is very similar to what we have been doing with the <code>Hero</code> model.</p> <p>The <code>Team</code> model will be in a table automatically named <code>\"team\"</code>, and it will have the columns:</p> <ul> <li><code>id</code>, the primary key, automatically generated by the database</li> <li><code>name</code>, the name of the team<ul> <li>We also tell SQLDev to create an index for this column</li> </ul> </li> <li><code>headquarters</code>, the headquarters of the team</li> </ul> <p>And finally we mark it as a table in the config.</p>"},{"location":"tutorial/connect/create-connected-tables/#create-the-new-hero-table","title":"Create the New <code>hero</code> Table","text":"<p>Now let's create the <code>hero</code> table.</p> <p>This is the same model we have been using up to now, we are just adding the new column <code>team_id</code>:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef main():\n    create_db_and_tables()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef main():\n    create_db_and_tables()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Most of that should look familiar:</p> <p>The column will be named <code>team_id</code>. It will be an integer, and it could be <code>NULL</code> in the database (or <code>None</code> in Python), because there could be some heroes that don't belong to any team.</p> <p>We add a default of <code>None</code> to the <code>Field()</code> so we don't have to explicitly pass <code>team_id=None</code> when creating a hero.</p> <p>Now, here's the new part:</p> <p>In <code>Field()</code> we pass the argument <code>foreign_key=\"team.id\"</code>. This tells the database that this column <code>team_id</code> is a foreign key to the table <code>team</code>. A \"foreign key\" just means that this column will have the key to identify a row in a foreign table.</p> <p>The value in this column <code>team_id</code> will be the same integer that is in some row in the <code>id</code> column on the <code>team</code> table. That is what connects the two tables.</p>"},{"location":"tutorial/connect/create-connected-tables/#the-value-of-foreign_key","title":"The Value of <code>foreign_key</code>","text":"<p>Notice that the <code>foreign_key</code> is a string.</p> <p>Inside it has the name of the table, then a dot, and then the name of the column.</p> <p>This is the name of the table in the database, so it is <code>\"team\"</code>, not the name of the model class <code>Team</code> (with a capital <code>T</code>).</p> <p>If you had a custom table name, you would use that custom table name.</p> <p>Info</p> <p>You can learn about setting a custom table name for a model in the Advanced User Guide.</p>"},{"location":"tutorial/connect/create-connected-tables/#create-the-tables","title":"Create the Tables","text":"<p>Now we can add the same code as before to create the engine and the function to create the tables:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef main():\n    create_db_and_tables()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef main():\n    create_db_and_tables()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>And as before, we'll call this function from another function <code>main()</code>, and we'll add that function <code>main()</code> to the main block of the file:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef main():\n    create_db_and_tables()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef main():\n    create_db_and_tables()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/connect/create-connected-tables/#run-the-code","title":"Run the Code","text":"<p>Tip</p> <p>Before running the code, make sure you delete the file <code>database.db</code> to make sure you start from scratch.</p> <p>If we run the code we have up to now, it will go and create the database file <code>database.db</code> and the tables in it we just defined, <code>team</code> and <code>hero</code>:</p> <pre><code>$ python app.py\n\n// Automatically start a new transaction\nINFO Engine BEGIN (implicit)\n\n// Check if the tables exist already\nINFO Engine PRAGMA main.table_info(\"team\")\nINFO Engine [raw sql] ()\nINFO Engine PRAGMA temp.table_info(\"team\")\nINFO Engine [raw sql] ()\nINFO Engine PRAGMA main.table_info(\"hero\")\nINFO Engine [raw sql] ()\nINFO Engine PRAGMA temp.table_info(\"hero\")\nINFO Engine [raw sql] ()\n\n// Create the tables\nINFO Engine\nCREATE TABLE team (\n        id INTEGER,\n        name VARCHAR NOT NULL,\n        headquarters VARCHAR NOT NULL,\n        PRIMARY KEY (id)\n)\n\n\nINFO Engine [no key 0.00010s] ()\nINFO Engine\nCREATE TABLE hero (\n        id INTEGER,\n        name VARCHAR NOT NULL,\n        secret_name VARCHAR NOT NULL,\n        age INTEGER,\n        team_id INTEGER,\n        PRIMARY KEY (id),\n        FOREIGN KEY(team_id) REFERENCES team (id)\n)\n\n\nINFO Engine [no key 0.00026s] ()\nINFO Engine COMMIT\n</code></pre>"},{"location":"tutorial/connect/create-connected-tables/#create-tables-in-sql","title":"Create Tables in SQL","text":"<p>Let's see that same generated SQL code.</p> <p>As we saw before, those <code>VARCHAR</code> columns are converted to <code>TEXT</code> in SQLite, which is the database we are using for these experiments.</p> <p>So, the first SQL could also be written as:</p> <pre><code>CREATE TABLE team (\n    id INTEGER,\n    name TEXT NOT NULL,\n    headquarters TEXT NOT NULL,\n    PRIMARY KEY (id)\n)\n</code></pre> <p>And the second table could be written as:</p> <pre><code>CREATE TABLE hero (\n    id INTEGER,\n    name TEXT NOT NULL,\n    secret_name TEXT NOT NULL,\n    age INTEGER,\n    team_id INTEGER,\n    PRIMARY KEY (id),\n    FOREIGN KEY(team_id) REFERENCES team (id)\n)\n</code></pre> <p>The only new  is the <code>FOREIGN KEY</code> line, and as you can see, it tells the database what column in this table is a foreign key (<code>team_id</code>), which other (foreign) table it references (<code>team</code>) and which column in that table is the key to define which row to connect (<code>id</code>).</p> <p>Feel free to experiment with it in DB Browser for SQLite.</p>"},{"location":"tutorial/connect/create-connected-tables/#recap","title":"Recap","text":"<p>Using SQLDev, in most of the cases you only need a field (column) with a <code>foreign_key</code> in the <code>Field()</code> with a string pointing to another table and column to connect two tables.</p> <p>Now that we have the tables created and connected, let's create some rows in the next chapter. \ud83d\ude80</p>"},{"location":"tutorial/connect/read-connected-data/","title":"Read Connected Data","text":"<p>Now that we have some data in both tables, let's select the data that is connected together.</p> <p>The <code>team</code> table has this data:</p> idnameheadquarters 1PreventersSharp Tower 2Z-ForceSister Margaret's Bar <p>And the <code>hero</code> table has this data:</p> idnamesecret_nameageteam_id 1DeadpondDive Wilsonnull2 2Rusty-ManTommy Sharp481 3Spider-BoyPedro Parqueadornullnull <p>We will continue with the code in the previous example and we will add more things to it.</p> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/connect/read-connected-data/#select-connected-data-with-sql","title":"<code>SELECT</code> Connected Data with SQL","text":"<p>Let's start seeing how SQL works when selecting connected data. This is where SQL databases actually shine.</p> <p>If you don't have a <code>database.db</code> file, run that previous program we had written (or copy it from the preview above) to create it.</p> <p>Now open DB Browser for SQLite and open the <code>database.db</code> file.</p> <p>To <code>SELECT</code> connected data we use the same keywords we have used before, but now we combine the two tables.</p> <p>Let's get each hero with the <code>id</code>, <code>name</code>, and the team <code>name</code>:</p> <pre><code>SELECT hero.id, hero.name, team.name\nFROM hero, team\nWHERE hero.team_id = team.id\n</code></pre> <p>Info</p> <p>Because we have two columns called <code>name</code>, one for <code>hero</code> and one for <code>team</code>, we can specify them with the prefix of the table name and the dot to make it explicit what we refer to.</p> <p>Notice that now in the <code>WHERE</code> part we are not comparing one column with a literal value (like <code>hero.name = \"Deadpond\"</code>), but we are comparing two columns.</p> <p>It means, more or less:</p> <p>Hey SQL database \ud83d\udc4b, please go and <code>SELECT</code> some data for me.</p> <p>I'll first tell you the columns I want:</p> <ul> <li><code>id</code> of the <code>hero</code> table</li> <li><code>name</code> of the <code>hero</code> table</li> <li><code>name</code> of the <code>team</code> table</li> </ul> <p>I want you to get that data <code>FROM</code> the tables <code>hero</code> and <code>team</code>.</p> <p>And I don't want you to combine each hero with each possible team. Instead, for each hero, go and check each possible team, but give me only the ones <code>WHERE</code> the <code>hero.team_id</code> is the same as the <code>team.id</code>.</p> <p>If we execute that SQL, it will return the table:</p> idnamename 1DeadpondZ-Force 2Rusty-ManPreventers <p>You can go ahead and try it in DB Browser for SQLite:</p> <p></p> <p>Note</p> <p>Wait, what about Spider-Boy? \ud83d\ude31</p> <p>He doesn't have a team, so his <code>team_id</code> is <code>NULL</code> in the database. And this SQL is comparing that <code>NULL</code> from the <code>team_id</code> with all the <code>id</code> fields in the rows in the <code>team</code> table.</p> <p>As there's no team with an ID of <code>NULL</code>, it doesn't find a match.</p> <p>But we'll see how to fix that later with a <code>LEFT JOIN</code>.</p>"},{"location":"tutorial/connect/read-connected-data/#select-related-data-with-sqldev","title":"Select Related Data with SQLDev","text":"<p>Now let's use SQLDev to do the same select.</p> <p>We'll create a function <code>select_heroes()</code> just as we did before, but now we'll work with two tables.</p> <p>Remember SQLDev's <code>select()</code> function? It can take more than one argument.</p> <p>So, we can pass the <code>Hero</code> and <code>Team</code> model classes. And we can also use both their columns in the <code>.where()</code> part:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).where(Hero.team_id == Team.id)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).where(Hero.team_id == Team.id)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).where(Hero.team_id == Team.id)\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Hero:\", hero, \"Team:\", team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).where(Hero.team_id == Team.id)\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Hero:\", hero, \"Team:\", team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Notice that in the comparison with <code>==</code> we are using the class attributes for both <code>Hero.team_id</code> and <code>Team.id</code>.</p> <p>That will generate the appropriate expression object that will be converted to the right SQL, equivalent to the SQL example we saw above.</p> <p>Now we can execute it and get the <code>results</code> object.</p> <p>And as we used <code>select</code> with two models, we will receive tuples of instances of those two models, so we can iterate over them naturally in a <code>for</code> loop:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).where(Hero.team_id == Team.id)\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Hero:\", hero, \"Team:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).where(Hero.team_id == Team.id)\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Hero:\", hero, \"Team:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).where(Hero.team_id == Team.id)\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Hero:\", hero, \"Team:\", team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).where(Hero.team_id == Team.id)\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Hero:\", hero, \"Team:\", team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>For each iteration in the <code>for</code> loop we get a a tuple with an instance of the class <code>Hero</code> and an instance of the class <code>Team</code>.</p> <p>And in this <code>for</code> loop we assign them to the variable <code>hero</code> and the variable <code>team</code>.</p> <p>Info</p> <p>There was a lot of research, design, and work behind SQLDev to make this provide the best possible developer experience.</p> <p>And you should get autocompletion and inline errors in your editor for both <code>hero</code> and <code>team</code>. \ud83c\udf89</p>"},{"location":"tutorial/connect/read-connected-data/#add-it-to-main","title":"Add It to Main","text":"<p>As always, we must remember to add this new <code>select_heroes()</code> function to the <code>main()</code> function to make sure it is executed when we call this program from the command line.</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).where(Hero.team_id == Team.id)\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Hero:\", hero, \"Team:\", team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).where(Hero.team_id == Team.id)\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Hero:\", hero, \"Team:\", team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/connect/read-connected-data/#run-the-program","title":"Run the Program","text":"<p>Now we can run the program and see how it shows us each hero with their corresponding team:</p> <pre><code>$ python app.py\n\n// Previous output omitted \ud83d\ude09\n\n// Get the heroes with their teams\n2021-08-09 08:55:50,682 INFO sqlalchemy.engine.Engine SELECT hero.id, hero.name, hero.secret_name, hero.age, hero.team_id, team.id AS id_1, team.name AS name_1, team.headquarters\nFROM hero, team\nWHERE hero.team_id = team.id\n2021-08-09 08:55:50,682 INFO sqlalchemy.engine.Engine [no key 0.00015s] ()\n\n// Print the first hero and team\nHero: id=1 secret_name='Dive Wilson' team_id=2 name='Deadpond' age=None Team: headquarters='Sister Margaret's Bar' id=2 name='Z-Force'\n\n// Print the second hero and team\nHero: id=2 secret_name='Tommy Sharp' team_id=1 name='Rusty-Man' age=48 Team: headquarters='Sharp Tower' id=1 name='Preventers'\n2021-08-09 08:55:50,682 INFO sqlalchemy.engine.Engine ROLLBACK\n</code></pre>"},{"location":"tutorial/connect/read-connected-data/#join-tables-with-sql","title":"<code>JOIN</code> Tables with SQL","text":"<p>There's an alternative syntax for that SQL query from above using the keyword <code>JOIN</code> instead of <code>WHERE</code>.</p> <p>This is the same version from above, using <code>WHERE</code>:</p> <pre><code>SELECT hero.id, hero.name, team.name\nFROM hero, team\nWHERE hero.team_id = team.id\n</code></pre> <p>And this is the alternative version using <code>JOIN</code>:</p> <pre><code>SELECT hero.id, hero.name, team.name\nFROM hero\nJOIN team\nON hero.team_id = team.id\n</code></pre> <p>Both are equivalent. The differences in the SQL code are that instead of passing the <code>team</code> to the <code>FROM</code> part (also called <code>FROM</code> clause) we add a <code>JOIN</code> and put the <code>team</code> table there.</p> <p>And then, instead of putting a <code>WHERE</code> with a condition, we put an <code>ON</code> keyword with the condition, because <code>ON</code> is the one that comes with <code>JOIN</code>. \ud83e\udd37</p> <p>So, this second version means, more or less:</p> <p>Hey SQL database \ud83d\udc4b, please go and <code>SELECT</code> some data for me.</p> <p>I'll first tell you the columns I want:</p> <ul> <li><code>id</code> of the <code>hero</code> table</li> <li><code>name</code> of the <code>hero</code> table</li> <li><code>name</code> of the <code>team</code> table</li> </ul> <p>...up to here it's the same as before, LOL.</p> <p>Now, I want you to get that data starting <code>FROM</code> the table <code>hero</code>.</p> <p>And to get the rest of the data, I want you to <code>JOIN</code> it with the table <code>team</code>.</p> <p>And I want you to join those two tables <code>ON</code> the combinations of rows that have the <code>hero.team_id</code> with the same value as the <code>team.id</code>.</p> <p>Did I say all this before already? I feel like I'm just repeating myself. \ud83e\udd14</p> <p>That will return the same table as before:</p> idnamename 1DeadpondZ-Force 2Rusty-ManPreventers <p>Also in DB Browser for SQLite:</p> <p></p> <p>Tip</p> <p>Why bother with all this if the result is the same?</p> <p>This <code>JOIN</code> will be useful in a bit to be able to also get Spider-Boy, even if he doesn't have a team.</p>"},{"location":"tutorial/connect/read-connected-data/#join-tables-in-sqldev","title":"Join Tables in SQLDev","text":"<p>The same way there's a <code>.where()</code> available when using <code>select()</code>, there's also a <code>.join()</code>.</p> <p>And in SQLDev (actually SQLAlchemy), when using the <code>.join()</code>, because we already declared what is the <code>foreign_key</code> when creating the models, we don't have to pass an <code>ON</code> part, it is inferred automatically:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).join(Team)\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Hero:\", hero, \"Team:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).join(Team)\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Hero:\", hero, \"Team:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).join(Team)\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Hero:\", hero, \"Team:\", team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).join(Team)\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Hero:\", hero, \"Team:\", team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Also notice that we are still including <code>Team</code> in the <code>select(Hero, Team)</code>, because we still want to access that data.</p> <p>This is equivalent to the previous example.</p> <p>And if we run it in the command line, it will output:</p> <pre><code>$ python app.py\n\n// Previous output omitted \ud83d\ude09\n\n// Select using a JOIN with automatic ON\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age, hero.team_id, team.id AS id_1, team.name AS name_1, team.headquarters\nFROM hero JOIN team ON team.id = hero.team_id\nINFO Engine [no key 0.00032s] ()\n\n// Print the first hero and team\nHero: id=1 secret_name='Dive Wilson' team_id=2 name='Deadpond' age=None Team: headquarters='Sister Margaret's Bar' id=2 name='Z-Force'\n\n// Print the second hero and team\nHero: id=2 secret_name='Tommy Sharp' team_id=1 name='Rusty-Man' age=48 Team: headquarters='Sharp Tower' id=1 name='Preventers'\n</code></pre>"},{"location":"tutorial/connect/read-connected-data/#join-tables-with-sql-and-left-outer-maybe-join","title":"<code>JOIN</code> Tables with SQL and <code>LEFT OUTER</code> (Maybe <code>JOIN</code>)","text":"<p>When working with a <code>JOIN</code>, you can imagine that you start with a table on the <code>FROM</code> part and put that table in an imaginary space on the left side.</p> <p>And then you want another table to <code>JOIN</code> the result.</p> <p>And you put that second table in the right side on that imaginary space.</p> <p>And then you tell the database <code>ON</code> which condition it should join those two tables and give you the results back.</p> <p>But by default, only the rows from both left and right that match the condition will be returned.</p> <p></p> <p>In this example of tables above \ud83d\udc46, it would return all the heroes, because every hero has a <code>team_id</code>, so every hero can be joined with the <code>team</code> table:</p> idnamename 1DeadpondZ-Force 2Rusty-ManPreventers 3Spider-BoyPreventers"},{"location":"tutorial/connect/read-connected-data/#foreign-keys-with-null","title":"Foreign Keys with <code>NULL</code>","text":"<p>But in the database that we are working with in the code above, Spider-Boy doesn't have any team, the value of <code>team_id</code> is <code>NULL</code> in the database.</p> <p>So there's no way to join the Spider-Boy row with some row in the <code>team</code> table:</p> <p></p> <p>Running the same SQL we used above, the resulting table would not include Spider-Boy \ud83d\ude31:</p> idnamename 1DeadpondZ-Force 2Rusty-ManPreventers"},{"location":"tutorial/connect/read-connected-data/#include-everything-on-the-left-outer","title":"Include Everything on the <code>LEFT OUTER</code>","text":"<p>In this case, that we want to include all heroes in the result even if they don't have a team, we can extend that same SQL using a <code>JOIN</code> from above and add a <code>LEFT OUTER</code> right before <code>JOIN</code>:</p> <pre><code>SELECT hero.id, hero.name, team.name\nFROM hero\nLEFT OUTER JOIN team\nON hero.team_id = team.id\n</code></pre> <p>This <code>LEFT OUTER</code> part tells the database that we want to keep everything on the first table, the one on the <code>LEFT</code> in the imaginary space, even if those rows would be left out, so we want it to include the <code>OUTER</code> rows too. In this case, every hero with or without a team.</p> <p>And that would return the following result, including Spider-Boy \ud83c\udf89:</p> idnamename 1DeadpondZ-Force 2Rusty-ManPreventers 3Spider-Boynull <p>Tip</p> <p>The only difference between this query and the previous is that extra <code>LEFT OUTER</code>.</p> <p>And here's another of the SQL variations, you could write <code>LEFT OUTER JOIN</code> or just <code>LEFT JOIN</code>, it means the same.</p>"},{"location":"tutorial/connect/read-connected-data/#join-tables-in-sqldev-with-left-outer","title":"Join Tables in SQLDev with <code>LEFT OUTER</code>","text":"<p>Now let's replicate the same query in SQLDev.</p> <p><code>.join()</code> has a parameter we can use <code>isouter=True</code> to make the <code>JOIN</code> be a <code>LEFT OUTER JOIN</code>:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).join(Team, isouter=True)\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Hero:\", hero, \"Team:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).join(Team, isouter=True)\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Hero:\", hero, \"Team:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).join(Team, isouter=True)\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Hero:\", hero, \"Team:\", team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).join(Team, isouter=True)\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Hero:\", hero, \"Team:\", team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>And if we run it, it will output:</p> <pre><code>$ python app.py\n\n// Previous output omitted \ud83d\ude09\n\n// SELECT using LEFT OUTER JOIN\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age, hero.team_id, team.id AS id_1, team.name AS name_1, team.headquarters\nFROM hero LEFT OUTER JOIN team ON team.id = hero.team_id\n\nINFO Engine [no key 0.00051s] ()\n\n// Print the first hero and team\nHero: id=1 secret_name='Dive Wilson' team_id=2 name='Deadpond' age=None Team: headquarters='Sister Margaret's Bar' id=2 name='Z-Force'\n// Print the second hero and team\nHero: id=2 secret_name='Tommy Sharp' team_id=1 name='Rusty-Man' age=48 Team: headquarters='Sharp Tower' id=1 name='Preventers'\n// Print the third hero and team, we included Spider-Boy \ud83c\udf89\nHero: id=3 secret_name='Pedro Parqueador' team_id=None name='Spider-Boy' age=None Team: None\n</code></pre>"},{"location":"tutorial/connect/read-connected-data/#what-goes-in-select","title":"What Goes in <code>select()</code>","text":"<p>You might be wondering why we put the <code>Team</code> in the <code>select()</code> and not just in the <code>.join()</code>.</p> <p>And then why we didn't include <code>Hero</code> in the <code>.join()</code>. \ud83e\udd14</p> <p>In SQLDev (actually in SQLAlchemy), all these functions and tools try to replicate how it would be to work with the SQL language.</p> <p>Remember that <code>SELECT</code> defines the columns to get and <code>WHERE</code> how to filter them?.</p> <p>This also applies here, but with <code>JOIN</code> and <code>ON</code>.</p>"},{"location":"tutorial/connect/read-connected-data/#select-only-heroes-but-join-with-teams","title":"Select Only Heroes But Join with Teams","text":"<p>If we only put the <code>Team</code> in the <code>.join()</code> and not in the <code>select()</code> function, we would not get the <code>team</code> data.</p> <p>But we would still be able to filter the rows with it. \ud83e\udd13</p> <p>We could even add some additional <code>.where()</code> after <code>.join()</code> to filter the data more, for example to return only the heroes from one team:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).join(Team).where(Team.name == \"Preventers\")\n        results = session.exec(statement)\n        for hero in results:\n            print(\"Preventer Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).join(Team).where(Team.name == \"Preventers\")\n        results = session.exec(statement)\n        for hero in results:\n            print(\"Preventer Hero:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).join(Team).where(Team.name == \"Preventers\")\n        results = session.exec(statement)\n        for hero in results:\n            print(\"Preventer Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).join(Team).where(Team.name == \"Preventers\")\n        results = session.exec(statement)\n        for hero in results:\n            print(\"Preventer Hero:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Here we are filtering with <code>.where()</code> to get only the heroes that belong to the Preventers team.</p> <p>But we are still only requesting the data from the heroes, not their teams.</p> <p>If we run that, it would output:</p> <pre><code>$ python app.py\n\n// Select only the hero data\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age, hero.team_id\n// But still join with the team table\nFROM hero JOIN team ON team.id = hero.team_id\n// And filter with WHERE to get only the Preventers\nWHERE team.name = ?\nINFO Engine [no key 0.00066s] ('Preventers',)\n\n// We filter with the team, but only get the hero\nPreventer Hero: id=2 secret_name='Tommy Sharp' team_id=1 name='Rusty-Man' age=48\n</code></pre>"},{"location":"tutorial/connect/read-connected-data/#include-the-team","title":"Include the <code>Team</code>","text":"<p>By putting the <code>Team</code> in <code>select()</code> we tell SQLDev and the database that we want the team data too.</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).join(Team).where(Team.name == \"Preventers\")\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Preventer Hero:\", hero, \"Team:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).join(Team).where(Team.name == \"Preventers\")\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Preventer Hero:\", hero, \"Team:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).join(Team).where(Team.name == \"Preventers\")\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Preventer Hero:\", hero, \"Team:\", team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero, Team).join(Team).where(Team.name == \"Preventers\")\n        results = session.exec(statement)\n        for hero, team in results:\n            print(\"Preventer Hero:\", hero, \"Team:\", team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>And if we run that, it will output:</p> <pre><code>$ python app.py\n\n// Select the hero and the team data\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age, hero.team_id, team.id AS id_1, team.name AS name_1, team.headquarters\n// Join the hero with the team table\nFROM hero JOIN team ON team.id = hero.team_id\n// Filter with WHERE to get only Preventers\nWHERE team.name = ?\nINFO Engine [no key 0.00018s] ('Preventers',)\n\n// Print the hero and the team\nPreventer Hero: id=2 secret_name='Tommy Sharp' team_id=1 name='Rusty-Man' age=48 Team: headquarters='Sharp Tower' id=1 name='Preventers'\n</code></pre> <p>We still have to <code>.join()</code> because otherwise it would just compute all the possible combinations of heroes and teams, for example including Rusty-Man with Preventers and also Rusty-Man with Z-Force, which would be a mistake.</p>"},{"location":"tutorial/connect/read-connected-data/#relationship-attributes","title":"Relationship Attributes","text":"<p>Here we have been using the pure class models directly, but in a future chapter we will also see how to use Relationship Attributes that let us interact with the database in a way much more close to the code with Python objects.</p> <p>And we will also see how to load their data in a different, simpler way, achieving the same we achieved here. \u2728</p>"},{"location":"tutorial/connect/remove-data-connections/","title":"Remove Data Connections","text":"<p>We currently have a <code>team</code> table:</p> idnameheadquarters 1PreventersSharp Tower 2Z-ForceSister Margaret's Bar <p>And a <code>hero</code> table:</p> idnamesecret_nameageteam_id 1DeadpondDive Wilsonnull2 2Rusty-ManTommy Sharp481 3Spider-BoyPedro Parqueadornull1 <p>Let's see how to remove connections between rows in tables.</p> <p>We will continue with the code from the previous chapter.</p> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team_id = team_preventers.id\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team_id = team_preventers.id\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/connect/remove-data-connections/#break-a-connection","title":"Break a Connection","text":"<p>We don't really have to delete anything to break a connection. We can just assign <code>None</code> to the foreign key, in this case, to the <code>team_id</code>.</p> <p>Let's say Spider-Boy is tired of the lack of friendly neighbors and wants to get out of the Preventers.</p> <p>We can simply set the <code>team_id</code> to <code>None</code>, and now it doesn't have a connection with the team:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n\n        # Previous code here omitted \ud83d\udc48\n\n        hero_spider_boy.team_id = None\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"No longer Preventer:\", hero_spider_boy)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n\n        # Previous code here omitted \ud83d\udc48\n\n        hero_spider_boy.team_id = None\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"No longer Preventer:\", hero_spider_boy)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team_id = team_preventers.id\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_spider_boy.team_id = None\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"No longer Preventer:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team_id = team_preventers.id\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_spider_boy.team_id = None\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"No longer Preventer:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Again, we just assign a value to that field attribute <code>team_id</code>, now the value is <code>None</code>, which means <code>NULL</code> in the database. Then we <code>add()</code> the hero to the session, and then <code>commit()</code>.</p> <p>Next we <code>refresh()</code> it to get the recent data, and we print it.</p> <p>Running that in the command line will output:</p> <pre><code>$ python app.py\n\n// Previous output omitted \ud83d\ude09\n\n// Update the hero\nINFO Engine UPDATE hero SET team_id=? WHERE hero.id = ?\nINFO Engine [cached since 0.07753s ago] (None, 3)\n// Commit the session\nINFO Engine COMMIT\n// Automatically start a new transaction\nINFO Engine BEGIN (implicit)\n// Refresh the hero\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age, hero.team_id\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.1661s ago] (3,)\n\n// Print the hero without a team\nNo longer Preventer: id=3 secret_name='Pedro Parqueador' team_id=None name='Spider-Boy' age=None\n</code></pre> <p>That's it, we now removed a connection between rows in different tables by unsetting the foreign key column. \ud83d\udca5</p>"},{"location":"tutorial/connect/update-data-connections/","title":"Update Data Connections","text":"<p>At this point we have a <code>team</code> table:</p> idnameheadquarters 1PreventersSharp Tower 2Z-ForceSister Margaret's Bar <p>And a <code>hero</code> table:</p> idnamesecret_nameageteam_id 1DeadpondDive Wilsonnull2 2Rusty-ManTommy Sharp481 3Spider-BoyPedro Parqueadornullnull <p>Some of these heroes are part of a team.</p> <p>Now we'll see how to update those connections between rows tables.</p> <p>We will continue with the code we used to create some heroes, and we'll update them.</p> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/connect/update-data-connections/#assign-a-team-to-a-hero","title":"Assign a Team to a Hero","text":"<p>Let's say that Tommy Sharp uses his \"rich uncle\" charms to recruit Spider-Boy to join the team of the Preventers, now we need to update our Spider-Boy hero object to connect it to the Preventers team.</p> <p>Doing it is just like updating any other field:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n\n        # Previous code here omitted \ud83d\udc48\n\n        hero_spider_boy.team_id = team_preventers.id\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n\n        # Previous code here omitted \ud83d\udc48\n\n        hero_spider_boy.team_id = team_preventers.id\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team_id = team_preventers.id\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team_id = team_preventers.id\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>We can simply assign a value to that field attribute <code>team_id</code>, then <code>add()</code> the hero to the session, and then <code>commit()</code>.</p> <p>Next we <code>refresh()</code> it to get the recent data, and we print it.</p> <p>Running that in the command line will output:</p> <pre><code>$ python app.py\n\n// Previous output omitted \ud83d\ude09\n\n// Update the hero\nINFO Engine UPDATE hero SET team_id=? WHERE hero.id = ?\nINFO Engine [generated in 0.00014s] (1, 3)\n// Commit the session saving the changes\nINFO Engine COMMIT\n// Automatically start a new transaction\nINFO Engine BEGIN (implicit)\n// Refresh the hero data\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age, hero.team_id\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.08837s ago] (3,)\n\n// Print the updated hero\nUpdated hero: id=3 secret_name='Pedro Parqueador' team_id=1 name='Spider-Boy' age=None\n</code></pre> <p>And now Spider-Boy has the <code>team_id=1</code>, which is the ID of the Preventers. \ud83c\udf89</p> <p>Let's now see how to remove connections in the next chapter. \ud83d\udca5</p>"},{"location":"tutorial/many-to-many/","title":"Many to Many - Intro","text":"<p>We saw how to work with One-to-Many relationships in the data.</p> <p>But how do you handle Many-to-Many relationships?</p> <p>Let's explore them. \ud83d\ude80</p>"},{"location":"tutorial/many-to-many/#starting-from-one-to-many","title":"Starting from One-to-Many","text":"<p>Let's start with the familiar and simpler option of One-to-Many.</p> <p>We have one table with teams and one with heroes, and for each one team, we can have many heroes.</p> <p>As each team could have multiple heroes, we wouldn't be able to put the Hero IDs in columns for all of them in the <code>team</code> table.</p> <p>But as each hero can belong only to one team, we have a single column in the heroes table to point to the specific team (to a specific row in the <code>team</code> table).</p> <p>The <code>team</code> table looks like this:</p> idnameheadquarters 1PreventersSharp Tower 2Z-ForceSister Margaret's Bar <p>Tip</p> <p>Notice that it doesn't have any foreign key to other tables.</p> <p>And the <code>hero</code> table looks like this:</p> idnamesecret_nameageteam_id 1DeadpondDive Wilsonnull2 2Spider-BoyPedro Parqueadornull1 3Rusty-ManTommy Sharp481 <p>We have a column in the <code>hero</code> table for the <code>team_id</code> that points to the ID of a specific team in the <code>team</code> table.</p> <p>This is how we connect each <code>hero</code> with a <code>team</code>:</p> <p></p> <p>Notice that each hero can only have one connection. But each team can receive many connections. In particular, the team Preventers has two heroes.</p>"},{"location":"tutorial/many-to-many/#introduce-many-to-many","title":"Introduce Many-to-Many","text":"<p>But let's say that as Deadpond is a great character, they recruit him to the new Preventers team, but he's still part of the Z-Force team too.</p> <p>So, now, we need to be able to have a hero that is connected to many teams. And then, each team, should still be able to receive many heroes. So we need a Many-to-Many relationship.</p> <p>A naive approach that wouldn't work very well is to add more columns to the <code>hero</code> table. Imagine we add two extra columns. Now we could connect a single <code>hero</code> to 3 teams in total, but not more. So we haven't really solved the problem of supporting many teams, only a very limited fixed number of teams.</p> <p>We can do better! \ud83e\udd13</p>"},{"location":"tutorial/many-to-many/#link-table","title":"Link Table","text":"<p>We can create another table that would represent the link between the <code>hero</code> and <code>team</code> tables.</p> <p>All this table contains is two columns, <code>hero_id</code> and <code>team_id</code>.</p> <p>Both columns are foreign keys pointing to the ID of a specific row in the <code>hero</code> and <code>team</code> tables.</p> <p>As this will represent the hero-team-link, let's call the table <code>heroteamlink</code>.</p> <p>It would look like this:</p> <p></p> <p>Notice that now the table <code>hero</code> doesn't have a <code>team_id</code> column anymore, it is replaced by this link table.</p> <p>And the <code>team</code> table, just as before, doesn't have any foreign key either.</p> <p>Specifically, the new link table <code>heroteamlink</code> would be:</p> hero_idteam_id 11 12 21 31 <p>Info</p> <p>Other names used for this link table are:</p> <ul> <li>association table</li> <li>secondary table</li> <li>junction table</li> <li>intermediate table</li> <li>join table</li> <li>through table</li> <li>relationship table</li> <li>connection table</li> </ul> <p>I'm using the term \"link table\" because it's short, doesn't collide with other terms already used (e.g. \"relationship\"), it's easy to remember how to write it, etc.</p>"},{"location":"tutorial/many-to-many/#link-primary-key","title":"Link Primary Key","text":"<p>Cool, we have a link table with just two columns. But remember that SQL databases require each row to have a primary key that uniquely identifies the row in that table?</p> <p>Now, what is the primary key in this table?</p> <p>How to we identify each unique row?</p> <p>Should we add another column just to be the primary key of this link table? Nope! We don't have to do that. \ud83d\udc4c</p> <p>Both columns are the primary key of each row in this table (and each row just has those two columns). \u2728</p> <p>A primary key is a way to uniquely identify a particular row in a single table. But it doesn't have to be a single column.</p> <p>A primary key can be a group of the columns in a table, which combined are unique in this table.</p> <p>Check the table above again, see that each row has a unique combination of <code>hero_id</code> and <code>team_id</code>?</p> <p>We cannot have duplicated primary keys, which means that we cannot have duplicated links between <code>hero</code> and <code>team</code>, exactly what we want!</p> <p>For example, the database will now prevent an error like this, with a duplicated row:</p> hero_idteam_id 11 12 21 31 3 \ud83d\udea81 \ud83d\udea8 <p>It wouldn't make sense to have a hero be part of the same team twice, right?</p> <p>Now, just by using the two columns as the primary keys of this table, SQL will take care of preventing us from duplicating a link between <code>hero</code> and <code>team</code>. \u2705</p>"},{"location":"tutorial/many-to-many/#recap","title":"Recap","text":"<p>An intro with a recap! That's weird... but anyway. \ud83e\udd37</p> <p>Now you have the theory about the many-to-many relationships, and how to solve them with tables in SQL. \ud83e\udd13</p> <p>Now let's check how to write the SQL and the code to work with them. \ud83d\ude80</p>"},{"location":"tutorial/many-to-many/create-data/","title":"Create Data with Many-to-Many Relationships","text":"<p>Let's continue from where we left and create some data.</p> <p>We'll create data for this same many-to-many relationship with a link table:</p> <p></p> <p>We'll continue from where we left off with the previous code.</p> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: List[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/many-to-many/create-data/#create-heroes","title":"Create Heroes","text":"<p>As we have done before, we'll create a function <code>create_heroes()</code> and we'll create some teams and heroes in it:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: List[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>This is very similar to what we have done before.</p> <p>We create a couple of teams, and then three heroes.</p> <p>The only new detail is that instead of using an argument <code>team</code> we now use <code>teams</code>, because that is the name of the new relationship attribute. And more importantly, we pass a list of teams (even if it contains a single team).</p> <p>See how Deadpond now belongs to the two teams?</p>"},{"location":"tutorial/many-to-many/create-data/#commit-refresh-and-print","title":"Commit, Refresh, and Print","text":"<p>Now let's do as we have done before, <code>commit</code> the session, <code>refresh</code> the data, and print it:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: List[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/many-to-many/create-data/#add-to-main","title":"Add to Main","text":"<p>As before, add the <code>create_heroes()</code> function to the <code>main()</code> function to make sure it is called when running this program from the command line:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: List[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/many-to-many/create-data/#run-the-program","title":"Run the Program","text":"<p>If we run the program from the command line, it would output:</p> <pre><code>$ python app.py\n\n// Previous output omitted \ud83d\ude48\n\n// Automatically start a new transaction\nINFO Engine BEGIN (implicit)\n// Insert the hero data first\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [generated in 0.00041s] ('Deadpond', 'Dive Wilson', None)\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [cached since 0.001942s ago] ('Rusty-Man', 'Tommy Sharp', 48)\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [cached since 0.002541s ago] ('Spider-Boy', 'Pedro Parqueador', None)\n// Insert the team data second\nINFO Engine INSERT INTO team (name, headquarters) VALUES (?, ?)\nINFO Engine [generated in 0.00037s] ('Z-Force', 'Sister Margaret's Bar')\nINFO Engine INSERT INTO team (name, headquarters) VALUES (?, ?)\nINFO Engine [cached since 0.001239s ago] ('Preventers', 'Sharp Tower')\n// Insert the link data last, to be able to re-use the created IDs\nINFO Engine INSERT INTO heroteamlink (team_id, hero_id) VALUES (?, ?)\nINFO Engine [generated in 0.00026s] ((2, 3), (1, 1), (2, 1), (2, 2))\n// Commit and save the data in the database\nINFO Engine COMMIT\n\n// Automatically start a new transaction\nINFO Engine BEGIN (implicit)\n// Refresh the data\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00019s] (1,)\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.001959s ago] (2,)\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.003215s ago] (3,)\n\n// Print Deadpond\nDeadpond: name='Deadpond' age=None id=1 secret_name='Dive Wilson'\n\n// Accessing the .team attribute triggers a refresh\nINFO Engine SELECT team.id AS team_id, team.name AS team_name, team.headquarters AS team_headquarters\nFROM team, heroteamlink\nWHERE ? = heroteamlink.hero_id AND team.id = heroteamlink.team_id\nINFO Engine [generated in 0.00025s] (1,)\n\n// Print Deadpond's teams, 2 teams! \ud83c\udf89\nDeadpond teams: [Team(id=1, name='Z-Force', headquarters='Sister Margaret's Bar'), Team(id=2, name='Preventers', headquarters='Sharp Tower')]\n\n// Print Rusty-Man\nRusty-Man: name='Rusty-Man' age=48 id=2 secret_name='Tommy Sharp'\n\n// Accessing the .team attribute triggers a refresh\nINFO Engine SELECT team.id AS team_id, team.name AS team_name, team.headquarters AS team_headquarters\nFROM team, heroteamlink\nWHERE ? = heroteamlink.hero_id AND team.id = heroteamlink.team_id\nINFO Engine [cached since 0.001716s ago] (2,)\n\n// Print Rusty-Man teams, just one, but still a list\nRusty-Man Teams: [Team(id=2, name='Preventers', headquarters='Sharp Tower')]\n\n// Print Spider-Boy\nSpider-Boy: name='Spider-Boy' age=None id=3 secret_name='Pedro Parqueador'\n\n// Accessing the .team attribute triggers a refresh\nINFO Engine SELECT team.id AS team_id, team.name AS team_name, team.headquarters AS team_headquarters\nFROM team, heroteamlink\nWHERE ? = heroteamlink.hero_id AND team.id = heroteamlink.team_id\nINFO Engine [cached since 0.002739s ago] (3,)\n\n// Print Spider-Boy's teams, just one, but still a list\nSpider-Boy Teams: [Team(id=2, name='Preventers', headquarters='Sharp Tower')]\n\n// Automatic roll back any previous automatic transaction, at the end of the with block\nINFO Engine ROLLBACK\n</code></pre>"},{"location":"tutorial/many-to-many/create-data/#recap","title":"Recap","text":"<p>After setting up the model link, using it with relationship attributes is fairly straightforward, just Python objects. \u2728</p>"},{"location":"tutorial/many-to-many/create-models-with-link/","title":"Create Models with a Many-to-Many Link","text":"<p>We'll now support many-to-many relationships using a link table like this:</p> <p></p> <p>Let's start by defining the class models, including the link table model.</p>"},{"location":"tutorial/many-to-many/create-models-with-link/#link-table-model","title":"Link Table Model","text":"<p>As we want to support a many-to-many relationship, now we need a link table to connect them.</p> <p>We can create it just as any other SQLDev:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: List[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>This is a SQLDev class model table like any other.</p> <p>It has two fields, <code>team_id</code> and <code>hero_id</code>.</p> <p>They are both foreign keys to their respective tables. We'll create those models in a second, but you already know how that works.</p> <p>And both fields are primary keys. We hadn't used this before. \ud83e\udd13</p>"},{"location":"tutorial/many-to-many/create-models-with-link/#team-model","title":"Team Model","text":"<p>Let's see the <code>Team</code> model, it's almost identical as before, but with a little change:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: List[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>The relationship attribute <code>heroes</code> is still a list of heroes, annotated as <code>List[\"Hero\"]</code>. Again, we use <code>\"Hero\"</code> in quotes because we haven't declared that class yet by this point in the code (but as you know, editors and SQLDev understand that).</p> <p>We use the same <code>Relationship()</code> function.</p> <p>We use <code>back_populates=\"teams\"</code>. Before we referenced an attribute <code>team</code>, but as now we can have many, we'll rename it to <code>teams</code> when creating the <code>Hero</code> model.</p> <p>And here's the important part to allow the many-to-many relationship, we use <code>link_model=HeroTeamLink</code>. That's it. \u2728</p>"},{"location":"tutorial/many-to-many/create-models-with-link/#hero-model","title":"Hero Model","text":"<p>Let's see the other side, here's the <code>Hero</code> model:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: List[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: List[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>We removed the previous <code>team_id</code> field (column) because now the relationship is done via the link table. \ud83d\udd25</p> <p>The relationship attribute is now named <code>teams</code> instead of <code>team</code>, as now we support multiple teams.</p> <p>It is no longer an <code>Optional[Team]</code> but a list of teams, annotated as <code>List[Team]</code>.</p> <p>We are using the <code>Relationship()</code> here too.</p> <p>We still have <code>back_populates=\"heroes\"</code> as before.</p> <p>And now we have a <code>link_model=HeroTeamLink</code>. \u2728</p>"},{"location":"tutorial/many-to-many/create-models-with-link/#create-the-tables","title":"Create the Tables","text":"<p>The same as before, we will have the rest of the code to create the engine, and a function to create all the tables <code>create_db_and_tables()</code>.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: List[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>And as in previous examples, we will add that function to a function <code>main()</code>, and we will call that <code>main()</code> function in the main block:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    # We will do more stuff here later \ud83d\udc48\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    # We will do more stuff here later \ud83d\udc48\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    # We will do more stuff here later \ud83d\udc48\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: List[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/many-to-many/create-models-with-link/#run-the-code","title":"Run the Code","text":"<p>If you run the code in the command line, it would output:</p> <pre><code>$ python app.py\n\n// Boilerplate omitted \ud83d\ude09\n\nINFO Engine\nCREATE TABLE team (\n        id INTEGER,\n        name VARCHAR NOT NULL,\n        headquarters VARCHAR NOT NULL,\n        PRIMARY KEY (id)\n)\n\n\nINFO Engine [no key 0.00033s] ()\nINFO Engine\nCREATE TABLE hero (\n        id INTEGER,\n        name VARCHAR NOT NULL,\n        secret_name VARCHAR NOT NULL,\n        age INTEGER,\n        PRIMARY KEY (id)\n)\n\n\nINFO Engine [no key 0.00016s] ()\nINFO Engine\n\n// Our shinny new link table \u2728\nCREATE TABLE heroteamlink (\n        team_id INTEGER,\n        hero_id INTEGER,\n        PRIMARY KEY (team_id, hero_id),\n        FOREIGN KEY(team_id) REFERENCES team (id),\n        FOREIGN KEY(hero_id) REFERENCES hero (id)\n)\n\n\nINFO Engine [no key 0.00031s] ()\nINFO Engine COMMIT\n</code></pre>"},{"location":"tutorial/many-to-many/create-models-with-link/#recap","title":"Recap","text":"<p>We can support many-to-many relationships between tables by declaring a link table.</p> <p>We can create it the same way as with other SQLDev classes, and then use it in the <code>link_model</code> parameter to <code>Relationship()</code>.</p> <p>Now let's work with data using these models in the next chapters. \ud83e\udd13</p>"},{"location":"tutorial/many-to-many/link-with-extra-fields/","title":"Link Model with Extra Fields","text":"<p>In the previous example we never interacted directly with the <code>HeroTeamLink</code> model, it was all through the automatic many-to-many relationship.</p> <p>But what if we needed to have additional data to describe the link between the two models?</p> <p>Let's say that we want to have an extra field/column to say if a hero is still training in that team or if they are already going on missions and stuff.</p> <p>Let's see how to achieve that.</p>"},{"location":"tutorial/many-to-many/link-with-extra-fields/#link-model-with-two-one-to-many","title":"Link Model with Two One-to-Many","text":"<p>The way to handle this is to explicitly use the link model, to be able to get and modify its data (apart from the foreign keys pointing to the two models for <code>Hero</code> and <code>Team</code>).</p> <p>In the end, the way it works is just like two one-to-many relationships combined.</p> <p>A row in the table <code>heroteamlink</code> points to one particular hero, but a single hero can be connected to many hero-team links, so it's one-to-many.</p> <p>And also, the same row in the table <code>heroteamlink</code> points to one team, but a single team can be connected to many hero-team links, so it's also one-to-many.</p> <p>Tip</p> <p>The previous many-to-many relationship was also just two one-to-many relationships combined, but now it's going to be much more explicit.</p>"},{"location":"tutorial/many-to-many/link-with-extra-fields/#update-link-model","title":"Update Link Model","text":"<p>Let's update the <code>HeroTeamLink</code> model.</p> <p>We will add a new field <code>is_training</code>.</p> <p>And we will also add two relationship attributes, for the linked <code>team</code> and <code>hero</code>:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: list[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_links: list[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: list[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_links: list[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: List[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_links: List[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>The new relationship attributes have their own <code>back_populates</code> pointing to new relationship attributes we will create in the <code>Hero</code> and <code>Team</code> models:</p> <ul> <li><code>team</code>: has <code>back_populates=\"hero_links\"</code>, because in the <code>Team</code> model, the attribute will contain the links to the team's heroes.</li> <li><code>hero</code>: has <code>back_populates=\"team_links\"</code>, because in the <code>Hero</code> model, the attribute will contain the links to the hero's teams.</li> </ul> <p>Info</p> <p>In SQLAlchemy this is called an Association Object or Association Model.</p> <p>I'm calling it Link Model just because that's easier to write avoiding typos. But you are also free to call it however you want. \ud83d\ude09</p>"},{"location":"tutorial/many-to-many/link-with-extra-fields/#update-team-model","title":"Update Team Model","text":"<p>Now let's update the <code>Team</code> model.</p> <p>We no longer have the <code>heroes</code> relationship attribute, and instead we have the new <code>hero_links</code> attribute:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: list[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: list[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: List[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: list[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_links: list[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: list[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_links: list[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: List[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_links: List[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/many-to-many/link-with-extra-fields/#update-hero-model","title":"Update Hero Model","text":"<p>The same with the <code>Hero</code> model.</p> <p>We change the <code>teams</code> relationship attribute for <code>team_links</code>:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_links: list[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_links: list[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_links: List[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: list[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_links: list[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: list[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_links: list[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: List[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_links: List[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/many-to-many/link-with-extra-fields/#create-relationships","title":"Create Relationships","text":"<p>Now the process to create relationships is very similar.</p> <p>But now we create the explicit link models manually, pointing to their hero and team instances, and specifying the additional link data (<code>is_training</code>):</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: list[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_links: list[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: list[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_links: list[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: List[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_links: List[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>We are just adding the link model instances to the session, because the link model instances are connected to the heroes and teams, they will be also automatically included in the session when we commit.</p>"},{"location":"tutorial/many-to-many/link-with-extra-fields/#run-the-program","title":"Run the Program","text":"<p>Now, if we run the program, it will show almost the same output as before, because it is generating almost the same SQL, but this time including the new <code>is_training</code> column:</p> <pre><code>$ python app.py\n\n// Previous output omitted \ud83d\ude48\n\n// Automatically start a new transaction\nINFO Engine BEGIN (implicit)\n\n// Insert the heroes\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [generated in 0.00025s] ('Deadpond', 'Dive Wilson', None)\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [cached since 0.00136s ago] ('Spider-Boy', 'Pedro Parqueador', None)\nINFO Engine INSERT INTO hero (name, secret_name, age) VALUES (?, ?, ?)\nINFO Engine [cached since 0.001858s ago] ('Rusty-Man', 'Tommy Sharp', 48)\n\n// Insert the teams\nINFO Engine INSERT INTO team (name, headquarters) VALUES (?, ?)\nINFO Engine [generated in 0.00019s] ('Z-Force', 'Sister Margaret's Bar')\nINFO Engine INSERT INTO team (name, headquarters) VALUES (?, ?)\nINFO Engine [cached since 0.0007985s ago] ('Preventers', 'Sharp Tower')\n\n// Insert the hero-team links\nINFO Engine INSERT INTO heroteamlink (team_id, hero_id, is_training) VALUES (?, ?, ?)\nINFO Engine [generated in 0.00023s] ((1, 1, 0), (2, 1, 1), (2, 2, 1), (2, 3, 0))\n// Save the changes in the transaction in the database\nINFO Engine COMMIT\n\n// Automatically start a new transaction\nINFO Engine BEGIN (implicit)\n\n// Automatically fetch the data on attribute access\nINFO Engine SELECT team.id AS team_id, team.name AS team_name, team.headquarters AS team_headquarters\nFROM team\nWHERE team.id = ?\nINFO Engine [generated in 0.00028s] (1,)\nINFO Engine SELECT heroteamlink.team_id AS heroteamlink_team_id, heroteamlink.hero_id AS heroteamlink_hero_id, heroteamlink.is_training AS heroteamlink_is_training\nFROM heroteamlink\nWHERE ? = heroteamlink.team_id\nINFO Engine [generated in 0.00026s] (1,)\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00024s] (1,)\n\n// Print Z-Force hero data, including link data\nZ-Force hero: name='Deadpond' age=None id=1 secret_name='Dive Wilson' is training: False\n\n// Automatically fetch the data on attribute access\nINFO Engine SELECT team.id AS team_id, team.name AS team_name, team.headquarters AS team_headquarters\nFROM team\nWHERE team.id = ?\nINFO Engine [cached since 0.008822s ago] (2,)\nINFO Engine SELECT heroteamlink.team_id AS heroteamlink_team_id, heroteamlink.hero_id AS heroteamlink_hero_id, heroteamlink.is_training AS heroteamlink_is_training\nFROM heroteamlink\nWHERE ? = heroteamlink.team_id\nINFO Engine [cached since 0.005778s ago] (2,)\n\n// Print Preventers hero data, including link data\nPreventers hero: name='Deadpond' age=None id=1 secret_name='Dive Wilson' is training: True\n\n// Automatically fetch the data on attribute access\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.004196s ago] (2,)\n\n// Print Preventers hero data, including link data\nPreventers hero: name='Spider-Boy' age=None id=2 secret_name='Pedro Parqueador' is training: True\n\n// Automatically fetch the data on attribute access\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.006005s ago] (3,)\n\n// Print Preventers hero data, including link data\nPreventers hero: name='Rusty-Man' age=48 id=3 secret_name='Tommy Sharp' is training: False\n</code></pre>"},{"location":"tutorial/many-to-many/link-with-extra-fields/#add-relationships","title":"Add Relationships","text":"<p>Now, to add a new relationship, we have to create a new <code>HeroTeamLink</code> instance pointing to the hero and the team, add it to the session, and commit it.</p> <p>Here we do that in the <code>update_heroes()</code> function:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: list[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_links: list[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: list[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_links: list[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: List[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_links: List[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/many-to-many/link-with-extra-fields/#run-the-program-with-the-new-relationship","title":"Run the Program with the New Relationship","text":"<p>If we run that program, we will see the output:</p> <pre><code>$ python app.py\n\n// Previous output omitted \ud83d\ude48\n\n// Automatically start a new transaction\nINFO Engine BEGIN (implicit)\n\n// Select the hero\nINFO Engine SELECT hero.id, hero.name, hero.secret_name, hero.age\nFROM hero\nWHERE hero.name = ?\nINFO Engine [no key 0.00014s] ('Spider-Boy',)\n\n// Select the team\nINFO Engine SELECT team.id, team.name, team.headquarters\nFROM team\nWHERE team.name = ?\nINFO Engine [no key 0.00012s] ('Z-Force',)\n\n// Create the link\nINFO Engine INSERT INTO heroteamlink (team_id, hero_id, is_training) VALUES (?, ?, ?)\nINFO Engine [generated in 0.00023s] (1, 2, 1)\n\n// Automatically refresh the data on attribute access\nINFO Engine SELECT heroteamlink.team_id AS heroteamlink_team_id, heroteamlink.hero_id AS heroteamlink_hero_id, heroteamlink.is_training AS heroteamlink_is_training\nFROM heroteamlink\nWHERE ? = heroteamlink.team_id\nINFO Engine [cached since 0.01514s ago] (1,)\nINFO Engine COMMIT\nINFO Engine BEGIN (implicit)\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.08953s ago] (2,)\nINFO Engine SELECT heroteamlink.team_id AS heroteamlink_team_id, heroteamlink.hero_id AS heroteamlink_hero_id, heroteamlink.is_training AS heroteamlink_is_training\nFROM heroteamlink\nWHERE ? = heroteamlink.hero_id\nINFO Engine [generated in 0.00018s] (2,)\n\n// Print updated hero links\nUpdated Spider-Boy's Teams: [\n    HeroTeamLink(team_id=2, is_training=True, hero_id=2),\n    HeroTeamLink(team_id=1, is_training=True, hero_id=2)\n]\n\n// Automatically refresh team data on attribute access\nINFO Engine SELECT team.id AS team_id, team.name AS team_name, team.headquarters AS team_headquarters\nFROM team\nWHERE team.id = ?\nINFO Engine [cached since 0.1084s ago] (1,)\nINFO Engine SELECT heroteamlink.team_id AS heroteamlink_team_id, heroteamlink.hero_id AS heroteamlink_hero_id, heroteamlink.is_training AS heroteamlink_is_training\nFROM heroteamlink\nWHERE ? = heroteamlink.team_id\nINFO Engine [cached since 0.1054s ago] (1,)\n\n// Print team hero links\nZ-Force heroes: [\n    HeroTeamLink(team_id=1, is_training=False, hero_id=1),\n    HeroTeamLink(team_id=1, is_training=True, hero_id=2)\n]\n</code></pre>"},{"location":"tutorial/many-to-many/link-with-extra-fields/#update-relationships-with-links","title":"Update Relationships with Links","text":"<p>Now let's say that Spider-Boy has been training enough in the Preventers, and they say he can join the team full time.</p> <p>So now we want to update the status of <code>is_training</code> to <code>False</code>.</p> <p>We can do that by iterating on the links:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n\n        # Code here omitted \ud83d\udc48\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n\n        # Code here omitted \ud83d\udc48\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n\n        # Code here omitted \ud83d\udc48\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: list[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_links: list[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: list[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_links: list[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n    is_training: bool = False\n\n    team: \"Team\" = Relationship(back_populates=\"hero_links\")\n    hero: \"Hero\" = Relationship(back_populates=\"team_links\")\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    hero_links: List[HeroTeamLink] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_links: List[HeroTeamLink] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\",\n            secret_name=\"Pedro Parqueador\",\n        )\n        deadpond_team_z_link = HeroTeamLink(team=team_z_force, hero=hero_deadpond)\n        deadpond_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_deadpond, is_training=True\n        )\n        spider_boy_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_spider_boy, is_training=True\n        )\n        rusty_man_preventers_link = HeroTeamLink(\n            team=team_preventers, hero=hero_rusty_man\n        )\n\n        session.add(deadpond_team_z_link)\n        session.add(deadpond_preventers_link)\n        session.add(spider_boy_preventers_link)\n        session.add(rusty_man_preventers_link)\n        session.commit()\n\n        for link in team_z_force.hero_links:\n            print(\"Z-Force hero:\", link.hero, \"is training:\", link.is_training)\n\n        for link in team_preventers.hero_links:\n            print(\"Preventers hero:\", link.hero, \"is training:\", link.is_training)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        spider_boy_z_force_link = HeroTeamLink(\n            team=team_z_force, hero=hero_spider_boy, is_training=True\n        )\n        team_z_force.hero_links.append(spider_boy_z_force_link)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.team_links)\n        print(\"Z-Force heroes:\", team_z_force.hero_links)\n\n        for link in hero_spider_boy.team_links:\n            if link.team.name == \"Preventers\":\n                link.is_training = False\n\n        session.add(hero_spider_boy)\n        session.commit()\n\n        for link in hero_spider_boy.team_links:\n            print(\"Spider-Boy team:\", link.team, \"is training:\", link.is_training)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/many-to-many/link-with-extra-fields/#run-the-program-with-the-updated-relationships","title":"Run the Program with the Updated Relationships","text":"<p>And if we run the program now, it will output:</p> <pre><code>$ python app.py\n\n// Previous output omitted \ud83d\ude48\n\n// Automatically fetch team data on attribute access\nINFO Engine SELECT team.id AS team_id, team.name AS team_name, team.headquarters AS team_headquarters\nFROM team\nWHERE team.id = ?\nINFO Engine [generated in 0.00015s] (2,)\n\n// Update link row\nINFO Engine UPDATE heroteamlink SET is_training=? WHERE heroteamlink.team_id = ? AND heroteamlink.hero_id = ?\nINFO Engine [generated in 0.00020s] (0, 2, 2)\n\n// Save current transaction to database\nINFO Engine COMMIT\n\n// Automatically start a new transaction\nINFO Engine BEGIN (implicit)\n\n// Automatically fetch data on attribute access\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.2004s ago] (2,)\nINFO Engine SELECT heroteamlink.team_id AS heroteamlink_team_id, heroteamlink.hero_id AS heroteamlink_hero_id, heroteamlink.is_training AS heroteamlink_is_training\nFROM heroteamlink\nWHERE ? = heroteamlink.hero_id\nINFO Engine [cached since 0.1005s ago] (2,)\nINFO Engine SELECT team.id AS team_id, team.name AS team_name, team.headquarters AS team_headquarters\nFROM team\nWHERE team.id = ?\nINFO Engine [cached since 0.09707s ago] (2,)\n\n// Print Spider-Boy team, including link data, if is training\nSpider-Boy team: headquarters='Sharp Tower' id=2 name='Preventers' is training: False\n\n// Automatically fetch data on attribute access\nINFO Engine SELECT team.id AS team_id, team.name AS team_name, team.headquarters AS team_headquarters\nFROM team\nWHERE team.id = ?\nINFO Engine [cached since 0.2097s ago] (1,)\n\n// Print Spider-Boy team, including link data, if is training\nSpider-Boy team: headquarters='Sister Margaret's Bar' id=1 name='Z-Force' is training: True\nINFO Engine ROLLBACK\n</code></pre>"},{"location":"tutorial/many-to-many/link-with-extra-fields/#recap","title":"Recap","text":"<p>If you need to store more information about a many-to-many relationship you can use an explicit link model with extra data in it. \ud83e\udd13</p>"},{"location":"tutorial/many-to-many/update-remove-relationships/","title":"Update and Remove Many-to-Many Relationships","text":"<p>Now we'll see how to update and remove these many-to-many relationships.</p> <p>We'll continue from where we left off with the previous code.</p> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: List[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/many-to-many/update-remove-relationships/#get-data-to-update","title":"Get Data to Update","text":"<p>Let's now create a function <code>update_heroes()</code>.</p> <p>We'll get Spider-Boy and the Z-Force team.</p> <p>As you already know how these goes, I'll use the short version and get the data in a single Python statement.</p> <p>And because we are now using <code>select()</code>, we also have to import it.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n# Some code here omitted \ud83d\udc48\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n# Some code here omitted \ud83d\udc48\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n# Some code here omitted \ud83d\udc48\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        team_z_force.heroes.append(hero_spider_boy)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.teams)\n        print(\"Z-Force heroes:\", team_z_force.heroes)\n\n        hero_spider_boy.teams.remove(team_z_force)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Reverted Z-Force's heroes:\", team_z_force.heroes)\n        print(\"Reverted Spider-Boy's teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        team_z_force.heroes.append(hero_spider_boy)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.teams)\n        print(\"Z-Force heroes:\", team_z_force.heroes)\n\n        hero_spider_boy.teams.remove(team_z_force)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Reverted Z-Force's heroes:\", team_z_force.heroes)\n        print(\"Reverted Spider-Boy's teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: List[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        team_z_force.heroes.append(hero_spider_boy)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.teams)\n        print(\"Z-Force heroes:\", team_z_force.heroes)\n\n        hero_spider_boy.teams.remove(team_z_force)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Reverted Z-Force's heroes:\", team_z_force.heroes)\n        print(\"Reverted Spider-Boy's teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>And of course, we have to add <code>update_heroes()</code> to our <code>main()</code> function:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        team_z_force.heroes.append(hero_spider_boy)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.teams)\n        print(\"Z-Force heroes:\", team_z_force.heroes)\n\n        hero_spider_boy.teams.remove(team_z_force)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Reverted Z-Force's heroes:\", team_z_force.heroes)\n        print(\"Reverted Spider-Boy's teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        team_z_force.heroes.append(hero_spider_boy)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.teams)\n        print(\"Z-Force heroes:\", team_z_force.heroes)\n\n        hero_spider_boy.teams.remove(team_z_force)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Reverted Z-Force's heroes:\", team_z_force.heroes)\n        print(\"Reverted Spider-Boy's teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: List[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        team_z_force.heroes.append(hero_spider_boy)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.teams)\n        print(\"Z-Force heroes:\", team_z_force.heroes)\n\n        hero_spider_boy.teams.remove(team_z_force)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Reverted Z-Force's heroes:\", team_z_force.heroes)\n        print(\"Reverted Spider-Boy's teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/many-to-many/update-remove-relationships/#add-many-to-many-relationships","title":"Add Many-to-Many Relationships","text":"<p>Now let's imagine that Spider-Boy thinks that the Z-Force team is super cool and decides to go there and join them.</p> <p>We can use the same relationship attributes to include <code>hero_spider_boy</code> in the <code>team_z_force.heroes</code>.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        team_z_force.heroes.append(hero_spider_boy)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.teams)\n        print(\"Z-Force heroes:\", team_z_force.heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        team_z_force.heroes.append(hero_spider_boy)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.teams)\n        print(\"Z-Force heroes:\", team_z_force.heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        team_z_force.heroes.append(hero_spider_boy)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.teams)\n        print(\"Z-Force heroes:\", team_z_force.heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        team_z_force.heroes.append(hero_spider_boy)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.teams)\n        print(\"Z-Force heroes:\", team_z_force.heroes)\n\n        hero_spider_boy.teams.remove(team_z_force)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Reverted Z-Force's heroes:\", team_z_force.heroes)\n        print(\"Reverted Spider-Boy's teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        team_z_force.heroes.append(hero_spider_boy)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.teams)\n        print(\"Z-Force heroes:\", team_z_force.heroes)\n\n        hero_spider_boy.teams.remove(team_z_force)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Reverted Z-Force's heroes:\", team_z_force.heroes)\n        print(\"Reverted Spider-Boy's teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: List[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        team_z_force.heroes.append(hero_spider_boy)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.teams)\n        print(\"Z-Force heroes:\", team_z_force.heroes)\n\n        hero_spider_boy.teams.remove(team_z_force)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Reverted Z-Force's heroes:\", team_z_force.heroes)\n        print(\"Reverted Spider-Boy's teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Tip</p> <p>Because we are accessing an attribute in the models right after we commit, with <code>hero_spider_boy.teams</code> and <code>team_z_force.heroes</code>, the data is refreshed automatically.</p> <p>So we don't have to call <code>session.refresh()</code>.</p> <p>We then commit the change, refresh, and print the updated Spider-Boy's heroes to confirm.</p> <p>Notice that we only <code>add</code> Z-Force to the session, then we commit.</p> <p>We never add Spider-Boy to the session, and we never even refresh it. But we still print his teams.</p> <p>This still works correctly because we are using <code>back_populates</code> in the <code>Relationship()</code> in the models. That way, SQLDev (actually SQLAlchemy) can keep track of the changes and updates, and make sure they also happen on the relationships in the other related models. \ud83c\udf89</p>"},{"location":"tutorial/many-to-many/update-remove-relationships/#run-the-program","title":"Run the Program","text":"<p>You can confirm it's all working by running the program in the command line:</p> <pre><code>$ python app.py\n\n// Previous output omitted \ud83d\ude48\n\n// Create the new many-to-many relationship\nINFO Engine INSERT INTO heroteamlink (team_id, hero_id) VALUES (?, ?)\nINFO Engine [generated in 0.00020s] (1, 3)\nINFO Engine COMMIT\n\n// Start a new automatic transaction\nINFO Engine BEGIN (implicit)\n\n// Automatically refresh the data while accessing the attribute .teams\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [generated in 0.00044s] (3,)\nINFO Engine SELECT team.id AS team_id, team.name AS team_name, team.headquarters AS team_headquarters\nFROM team, heroteamlink\nWHERE ? = heroteamlink.hero_id AND team.id = heroteamlink.team_id\nINFO Engine [cached since 0.1648s ago] (3,)\n\n// Print Spider-Boy teams, including Z-Force \ud83c\udf89\nUpdated Spider-Boy's Teams: [\n    Team(id=2, name='Preventers', headquarters='Sharp Tower'),\n    Team(id=1, name='Z-Force', headquarters='Sister Margaret's Bar')\n]\n\n// Automatically refresh the data while accessing the attribute .heores\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero, heroteamlink\nWHERE ? = heroteamlink.team_id AND hero.id = heroteamlink.hero_id\nINFO Engine [cached since 0.1499s ago] (1,)\n\n// Print Z-Force heroes, including Spider-Boy \ud83c\udf89\nZ-Force heroes: [\n    Hero(name='Deadpond', age=None, id=1, secret_name='Dive Wilson'),\n    Hero(name='Spider-Boy', age=None, id=3, secret_name='Pedro Parqueador', teams=[\n        Team(id=2, name='Preventers', headquarters='Sharp Tower'),\n        Team(id=1, name='Z-Force', headquarters='Sister Margaret's Bar', heroes=[...])\n    ])\n]\n</code></pre>"},{"location":"tutorial/many-to-many/update-remove-relationships/#remove-many-to-many-relationships","title":"Remove Many-to-Many Relationships","text":"<p>Now let's say that right after joining the team, Spider-Boy realized that their \"life preserving policies\" are much more relaxed than what he's used to. \ud83d\udc80</p> <p>And their occupational safety and health is also not as great... \ud83d\udca5</p> <p>So, Spider-Boy decides to leave Z-Force.</p> <p>Let's update the relationships to remove <code>team_z_force</code> from <code>hero_spider_boy.teams</code>.</p> <p>Because <code>hero_spider_boy.teams</code> is just a list (a special list managed by SQLAlchemy, but a list), we can use the standard list methods.</p> <p>In this case, we use the method <code>.remove()</code>, that takes an item and removes it from the list.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        team_z_force.heroes.append(hero_spider_boy)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.teams)\n        print(\"Z-Force heroes:\", team_z_force.heroes)\n\n        hero_spider_boy.teams.remove(team_z_force)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Reverted Z-Force's heroes:\", team_z_force.heroes)\n        print(\"Reverted Spider-Boy's teams:\", hero_spider_boy.teams)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        team_z_force.heroes.append(hero_spider_boy)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.teams)\n        print(\"Z-Force heroes:\", team_z_force.heroes)\n\n        hero_spider_boy.teams.remove(team_z_force)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Reverted Z-Force's heroes:\", team_z_force.heroes)\n        print(\"Reverted Spider-Boy's teams:\", hero_spider_boy.teams)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        team_z_force.heroes.append(hero_spider_boy)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.teams)\n        print(\"Z-Force heroes:\", team_z_force.heroes)\n\n        hero_spider_boy.teams.remove(team_z_force)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Reverted Z-Force's heroes:\", team_z_force.heroes)\n        print(\"Reverted Spider-Boy's teams:\", hero_spider_boy.teams)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", primary_key=True)\n    hero_id: int | None = Field(default=None, foreign_key=\"hero.id\", primary_key=True)\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        team_z_force.heroes.append(hero_spider_boy)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.teams)\n        print(\"Z-Force heroes:\", team_z_force.heroes)\n\n        hero_spider_boy.teams.remove(team_z_force)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Reverted Z-Force's heroes:\", team_z_force.heroes)\n        print(\"Reverted Spider-Boy's teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: list[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        team_z_force.heroes.append(hero_spider_boy)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.teams)\n        print(\"Z-Force heroes:\", team_z_force.heroes)\n\n        hero_spider_boy.teams.remove(team_z_force)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Reverted Z-Force's heroes:\", team_z_force.heroes)\n        print(\"Reverted Spider-Boy's teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass HeroTeamLink(SQLDev, table=True):\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", primary_key=True\n    )\n    hero_id: Optional[int] = Field(\n        default=None, foreign_key=\"hero.id\", primary_key=True\n    )\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"teams\", link_model=HeroTeamLink)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    teams: List[Team] = Relationship(back_populates=\"heroes\", link_model=HeroTeamLink)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\",\n            secret_name=\"Dive Wilson\",\n            teams=[team_z_force, team_preventers],\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            teams=[team_preventers],\n        )\n        hero_spider_boy = Hero(\n            name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\", teams=[team_preventers]\n        )\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Deadpond:\", hero_deadpond)\n        print(\"Deadpond teams:\", hero_deadpond.teams)\n        print(\"Rusty-Man:\", hero_rusty_man)\n        print(\"Rusty-Man Teams:\", hero_rusty_man.teams)\n        print(\"Spider-Boy:\", hero_spider_boy)\n        print(\"Spider-Boy Teams:\", hero_spider_boy.teams)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n        team_z_force = session.exec(select(Team).where(Team.name == \"Z-Force\")).one()\n\n        team_z_force.heroes.append(hero_spider_boy)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Updated Spider-Boy's Teams:\", hero_spider_boy.teams)\n        print(\"Z-Force heroes:\", team_z_force.heroes)\n\n        hero_spider_boy.teams.remove(team_z_force)\n        session.add(team_z_force)\n        session.commit()\n\n        print(\"Reverted Z-Force's heroes:\", team_z_force.heroes)\n        print(\"Reverted Spider-Boy's teams:\", hero_spider_boy.teams)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>And this time, just to show again that by using <code>back_populates</code> SQLDev (actually SQLAlchemy) takes care of connecting the models by their relationships, even though we performed the operation from the <code>hero_spider_boy</code> object (modifying <code>hero_spider_boy.teams</code>), we are adding <code>team_z_force</code> to the session. And we commit that, without even add <code>hero_spider_boy</code>.</p> <p>This still works because by updating the teams in <code>hero_spider_boy</code>, because they are synchronized with <code>back_populates</code>, the changes are also reflected in <code>team_z_force</code>, so it also has changes to be saved in the DB (that Spider-Boy was removed).</p> <p>And then we add the team, and commit the changes, which updates the <code>team_z_force</code> object, and because it changed the table that also had a connection with the <code>hero_spider_boy</code>, it is also marked internally as updated, so it all works.</p> <p>And then we just print them again to confirm that everything worked correctly.</p>"},{"location":"tutorial/many-to-many/update-remove-relationships/#run-the-program-again","title":"Run the Program Again","text":"<p>To confirm that this last part worked, you can run the program again, it will output something like:</p> <pre><code>$ python app.py\n\n// Previous output omitted \ud83d\ude48\n\n// Delete the row in the link table\nINFO Engine DELETE FROM heroteamlink WHERE heroteamlink.team_id = ? AND heroteamlink.hero_id = ?\nINFO Engine [generated in 0.00043s] (1, 3)\n// Save the changes\nINFO Engine COMMIT\n\n// Automatically start a new transaction\nINFO Engine BEGIN (implicit)\n\n// Automatically refresh the data while accessing the attribute .heroes\nINFO Engine SELECT team.id AS team_id, team.name AS team_name, team.headquarters AS team_headquarters\nFROM team\nWHERE team.id = ?\nINFO Engine [generated in 0.00029s] (1,)\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero, heroteamlink\nWHERE ? = heroteamlink.team_id AND hero.id = heroteamlink.hero_id\nINFO Engine [cached since 0.5625s ago] (1,)\n\n// Print the Z-Force heroes after reverting the changes\nReverted Z-Force's heroes: [\n    Hero(name='Deadpond', age=None, id=1, secret_name='Dive Wilson')\n]\n\n// Automatically refresh the data while accessing the attribute .teams\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age\nFROM hero\nWHERE hero.id = ?\nINFO Engine [cached since 0.4209s ago] (3,)\nINFO Engine SELECT team.id AS team_id, team.name AS team_name, team.headquarters AS team_headquarters\nFROM team, heroteamlink\nWHERE ? = heroteamlink.hero_id AND team.id = heroteamlink.team_id\nINFO Engine [cached since 0.5842s ago] (3,)\n\n// Print Spider-Boy's teams after reverting the changes\nReverted Spider-Boy's teams: [\n    Team(id=2, name='Preventers', headquarters='Sharp Tower')\n]\n\n// Automatically roll back any possible previously unsaved transaction\nINFO Engine ROLLBACK\n</code></pre>"},{"location":"tutorial/many-to-many/update-remove-relationships/#recap","title":"Recap","text":"<p>Updating and removing many-to-many relationships is quite straightforward after setting up the link model and the relationship attributes.</p> <p>You can just use common list operation. \ud83d\ude80</p>"},{"location":"tutorial/readyapi/","title":"ReadyAPI and Pydantic - Intro","text":"<p>One of the use cases where SQLDev shines the most, and the main one why it was built, was to be combined with ReadyAPI. \u2728</p> <p>ReadyAPI is a Python web framework for building web APIs created by the same author of SQLDev. ReadyAPI is also built on top of Pydantic.</p> <p>In this group of chapters we will see how to combine SQLDev table models representing tables in the SQL database as all the ones we have seen up to now, with data models that only represent data (which are actually just Pydantic models behind the scenes).</p> <p>Being able to combine SQLDev table models with pure data models would be useful on its own, but to make all the examples more concrete, we will use them with ReadyAPI.</p> <p>By the end we will have a simple but complete web API to interact with the data in the database. \ud83c\udf89</p>"},{"location":"tutorial/readyapi/#learning-readyapi","title":"Learning ReadyAPI","text":"<p>If you have never used ReadyAPI, maybe a good idea would be to go and study it a bit before continuing.</p> <p>Just reading and trying the examples on the ReadyAPI main page should be enough, and it shouldn't take you more than 10 minutes.</p>"},{"location":"tutorial/readyapi/delete/","title":"Delete Data with ReadyAPI","text":"<p>Let's now add a path operation to delete a hero.</p> <p>This is quite straightforward. \ud83d\ude01</p>"},{"location":"tutorial/readyapi/delete/#delete-path-operation","title":"Delete Path Operation","text":"<p>Because we want to delete data, we use an HTTP <code>DELETE</code> operation.</p> <p>We get a <code>hero_id</code> from the path parameter and verify if it exists, just as we did when reading a single hero or when updating it, possibly raising an error with a <code>404</code> response.</p> <p>And if we actually find a hero, we just delete it with the session.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        session.delete(hero)\n        session.commit()\n        return {\"ok\": True}\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        session.delete(hero)\n        session.commit()\n        return {\"ok\": True}\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        session.delete(hero)\n        session.commit()\n        return {\"ok\": True}\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        for key, value in hero_data.items():\n            setattr(db_hero, key, value)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        session.delete(hero)\n        session.commit()\n        return {\"ok\": True}\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        for key, value in hero_data.items():\n            setattr(db_hero, key, value)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        session.delete(hero)\n        session.commit()\n        return {\"ok\": True}\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        for key, value in hero_data.items():\n            setattr(db_hero, key, value)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        session.delete(hero)\n        session.commit()\n        return {\"ok\": True}\n</code></pre> <p>After deleting it successfully, we just return a response of:</p> <pre><code>{\n    \"ok\": true\n}\n</code></pre>"},{"location":"tutorial/readyapi/delete/#recap","title":"Recap","text":"<p>That's it, feel free to try it out in the interactive docs UI to delete some heroes. \ud83d\udca5</p> <p>Using ReadyAPI to read data and combining it with SQLDev makes it quite straightforward to delete data from the database.</p>"},{"location":"tutorial/readyapi/limit-and-offset/","title":"Read Heroes with Limit and Offset with ReadyAPI","text":"<p>When a client sends a request to get all the heroes, we have been returning them all.</p> <p>But if we had thousands of heroes that could consume a lot of computational resources, network bandwidth, etc.</p> <p>So, we probably want to limit it.</p> <p>Let's use the same offset and limit we learned about in the previous tutorial chapters for the API.</p> <p>Info</p> <p>In many cases, this is also called pagination.</p>"},{"location":"tutorial/readyapi/limit-and-offset/#add-a-limit-and-offset-to-the-query-parameters","title":"Add a Limit and Offset to the Query Parameters","text":"<p>Let's add <code>limit</code> and <code>offset</code> to the query parameters.</p> <p>By default, we will return the first results from the database, so <code>offset</code> will have a default value of <code>0</code>.</p> <p>And by default, we will return a maximum of <code>100</code> heroes, so <code>limit</code> will have a default value of <code>100</code>.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> <p>We want to allow clients to set different <code>offset</code> and <code>limit</code> values.</p> <p>But we don't want them to be able to set a <code>limit</code> of something like <code>9999</code>, that's over <code>9000</code>! \ud83d\ude31</p> <p>So, to prevent it, we add additional validation to the <code>limit</code> query parameter, declaring that it has to be **l**ess than or **e**qual to <code>100</code> with <code>le=100</code>.</p> <p>This way, a client can decide to take fewer heroes if they want, but not more.</p> <p>Info</p> <p>If you need to refresh how query parameters and their validation work, check out the docs in ReadyAPI:</p> <ul> <li>Query Parameters</li> <li>Query Parameters and String Validations</li> <li>Path Parameters and Numeric Validations</li> </ul>"},{"location":"tutorial/readyapi/limit-and-offset/#check-the-docs-ui","title":"Check the Docs UI","text":"<p>Now we can see that the docs UI shows the new parameters to control limit and offset of our data.</p> <p></p>"},{"location":"tutorial/readyapi/limit-and-offset/#recap","title":"Recap","text":"<p>You can use ReadyAPI's automatic data validation to get the parameters for <code>limit</code> and <code>offset</code>, and then use them with the session to control ranges of data to be sent in responses.</p>"},{"location":"tutorial/readyapi/multiple-models/","title":"Multiple Models with ReadyAPI","text":"<p>We have been using the same <code>Hero</code> model to declare the schema of the data we receive in the API, the table model in the database, and the schema of the data we send back in responses.</p> <p>But in most of the cases, there are slight differences. Let's use multiple models to solve it.</p> <p>Here you will see the main and biggest feature of SQLDev. \ud83d\ude0e</p>"},{"location":"tutorial/readyapi/multiple-models/#review-creation-schema","title":"Review Creation Schema","text":"<p>Let's start by reviewing the automatically generated schemas from the docs UI.</p> <p>For input, we have:</p> <p></p> <p>If we pay attention, it shows that the client could send an <code>id</code> in the JSON body of the request.</p> <p>This means that the client could try to use the same ID that already exists in the database for another hero.</p> <p>That's not what we want.</p> <p>We want the client only to send the data that is needed to create a new hero:</p> <ul> <li><code>name</code></li> <li><code>secret_name</code></li> <li>Optional <code>age</code></li> </ul> <p>And we want the <code>id</code> to be generated automatically by the database, so we don't want the client to send it.</p> <p>We'll see how to fix it in a bit.</p>"},{"location":"tutorial/readyapi/multiple-models/#review-response-schema","title":"Review Response Schema","text":"<p>Now let's review the schema of the response we send back to the client in the docs UI.</p> <p>If you click the small tab Schema instead of the Example Value, you will see something like this:</p> <p></p> <p>Let's see the details.</p> <p>The fields with a red asterisk (*) are \"required\".</p> <p>This means that our API application is required to return those fields in the response:</p> <ul> <li><code>name</code></li> <li><code>secret_name</code></li> </ul> <p>The <code>age</code> is optional, we don't have to return it, or it could be <code>None</code> (or <code>null</code> in JSON), but the <code>name</code> and the <code>secret_name</code> are required.</p> <p>Here's the weird thing, the <code>id</code> currently seems also \"optional\". \ud83e\udd14</p> <p>This is because in our SQLDev class we declare the <code>id</code> with <code>Optional[int]</code>, because it could be <code>None</code> in memory until we save it in the database and we finally get the actual ID.</p> <p>But in the responses, we always send a model from the database, so it always has an ID. So the <code>id</code> in the responses can be declared as required.</p> <p>This means that our application is making the promise to the clients that if it sends a hero, it will for sure have an <code>id</code> with a value, it will not be <code>None</code>.</p>"},{"location":"tutorial/readyapi/multiple-models/#why-is-it-important-to-have-a-contract-for-responses","title":"Why Is it Important to Have a Contract for Responses","text":"<p>The ultimate goal of an API is for some clients to use it.</p> <p>The clients could be a frontend application, a command line program, a graphical user interface, a mobile application, another backend application, etc.</p> <p>And the code those clients write depends on what our API tells them they need to send, and what they can expect to receive.</p> <p>Making both sides very clear will make it much easier to interact with the API.</p> <p>And in most of the cases, the developer of the client for that API will also be yourself, so you are doing your future self a favor by declaring those schemas for requests and responses. \ud83d\ude09</p>"},{"location":"tutorial/readyapi/multiple-models/#so-why-is-it-important-to-have-required-ids","title":"So Why is it Important to Have Required IDs","text":"<p>Now, what's the matter with having one <code>id</code> field marked as \"optional\" in a response when in reality it is always required?</p> <p>For example, automatically generated clients in other languages (or also in Python) would have some declaration that this field <code>id</code> is optional.</p> <p>And then the developers using those clients in their languages would have to be checking all the time in all their code if the <code>id</code> is not <code>None</code> before using it anywhere.</p> <p>That's a lot of unnecessary checks and unnecessary code that could have been saved by declaring the schema properly. \ud83d\ude14</p> <p>It would be a lot simpler for that code to know that the <code>id</code> from a response is required and will always have a value.</p> <p>Let's fix that too. \ud83e\udd13</p>"},{"location":"tutorial/readyapi/multiple-models/#multiple-hero-schemas","title":"Multiple Hero Schemas","text":"<p>So, we want to have our <code>Hero</code> model that declares the data in the database:</p> <ul> <li><code>id</code>, optional on creation, required on database</li> <li><code>name</code>, required</li> <li><code>secret_name</code>, required</li> <li><code>age</code>, optional</li> </ul> <p>But we also want to have a <code>HeroCreate</code> for the data we want to receive when creating a new hero, which is almost all the same data as <code>Hero</code>, except for the <code>id</code>, because that is created automatically by the database:</p> <ul> <li><code>name</code>, required</li> <li><code>secret_name</code>, required</li> <li><code>age</code>, optional</li> </ul> <p>And we want to have a <code>HeroPublic</code> with the <code>id</code> field, but this time annotated with <code>id: int</code>, instead of <code>id: Optional[int]</code>, to make it clear that it is required in responses read from the clients:</p> <ul> <li><code>id</code>, required</li> <li><code>name</code>, required</li> <li><code>secret_name</code>, required</li> <li><code>age</code>, optional</li> </ul>"},{"location":"tutorial/readyapi/multiple-models/#multiple-models-with-duplicated-fields","title":"Multiple Models with Duplicated Fields","text":"<p>The simplest way to solve it could be to create multiple models, each one with all the corresponding fields:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># This would work, but there's a better option below \ud83d\udea8\n\n# Code above omitted \ud83d\udc46\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass HeroCreate(SQLDev):\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nclass HeroPublic(SQLDev):\n    id: int\n    name: str\n    secret_name: str\n    age: int | None = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># This would work, but there's a better option below \ud83d\udea8\n\n# Code above omitted \ud83d\udc46\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass HeroCreate(SQLDev):\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nclass HeroPublic(SQLDev):\n    id: int\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># This would work, but there's a better option below \ud83d\udea8\n\n# Code above omitted \ud83d\udc46\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass HeroCreate(SQLDev):\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nclass HeroPublic(SQLDev):\n    id: int\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass HeroCreate(SQLDev):\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nclass HeroPublic(SQLDev):\n    id: int\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass HeroCreate(SQLDev):\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nclass HeroPublic(SQLDev):\n    id: int\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass HeroCreate(SQLDev):\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nclass HeroPublic(SQLDev):\n    id: int\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <p>Here's the important detail, and probably the most important feature of SQLDev: only <code>Hero</code> is declared with <code>table = True</code>.</p> <p>This means that the class <code>Hero</code> represents a table in the database. It is both a Pydantic model and a SQLAlchemy model.</p> <p>But <code>HeroCreate</code> and <code>HeroPublic</code> don't have <code>table = True</code>. They are only data models, they are only Pydantic models. They won't be used with the database, but only to declare data schemas for the API (or for other uses).</p> <p>This also means that <code>SQLDev.metadata.create_all()</code> won't create tables in the database for <code>HeroCreate</code> and <code>HeroPublic</code>, because they don't have <code>table = True</code>, which is exactly what we want. \ud83d\ude80</p> <p>Tip</p> <p>We will improve this code to avoid duplicating the fields, but for now we can continue learning with these models.</p>"},{"location":"tutorial/readyapi/multiple-models/#use-multiple-models-to-create-a-hero","title":"Use Multiple Models to Create a Hero","text":"<p>Let's now see how to use these new models in the ReadyAPI application.</p> <p>Let's first check how is the process to create a hero now:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass HeroCreate(SQLDev):\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nclass HeroPublic(SQLDev):\n    id: int\n    name: str\n    secret_name: str\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass HeroCreate(SQLDev):\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nclass HeroPublic(SQLDev):\n    id: int\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass HeroCreate(SQLDev):\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nclass HeroPublic(SQLDev):\n    id: int\n    name: str\n    secret_name: str\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <p>Let's check that in detail.</p> <p>Now we use the type annotation <code>HeroCreate</code> for the request JSON data in the <code>hero</code> parameter of the path operation function.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_hero(hero: HeroCreate):\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_hero(hero: HeroCreate):\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_hero(hero: HeroCreate):\n\n# Code below omitted \ud83d\udc47\n</code></pre> <p>Then we create a new <code>Hero</code> (this is the actual table model that saves things to the database) using <code>Hero.model_validate()</code>.</p> <p>The method <code>.model_validate()</code> reads data from another object with attributes (or a dict) and creates a new instance of this class, in this case <code>Hero</code>.</p> <p>In this case, we have a <code>HeroCreate</code> instance in the <code>hero</code> variable. This is an object with attributes, so we use <code>.model_validate()</code> to read those attributes.</p> <p>Tip</p> <p>In versions of SQLDev before <code>0.0.14</code> you would use the method <code>.from_orm()</code>, but it is now deprecated and you should use <code>.model_validate()</code> instead.</p> <p>We can now create a new <code>Hero</code> instance (the one for the database) and put it in the variable <code>db_hero</code> from the data in the <code>hero</code> variable that is the <code>HeroCreate</code> instance we received from the request.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n        db_hero = Hero.model_validate(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n        db_hero = Hero.model_validate(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n        db_hero = Hero.model_validate(hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <p>Then we just <code>add</code> it to the session, <code>commit</code>, and <code>refresh</code> it, and finally, we return the same <code>db_hero</code> variable that has the just refreshed <code>Hero</code> instance.</p> <p>Because it is just refreshed, it has the <code>id</code> field set with a new ID taken from the database.</p> <p>And now that we return it, ReadyAPI will validate the data with the <code>response_model</code>, which is a <code>HeroPublic</code>:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <p>This will validate that all the data that we promised is there and will remove any data we didn't declare.</p> <p>Tip</p> <p>This filtering could be very important and could be a very good security feature, for example, to make sure you filter private data, hashed passwords, etc.</p> <p>You can read more about it in the ReadyAPI docs about Response Model.</p> <p>In particular, it will make sure that the <code>id</code> is there and that it is indeed an integer (and not <code>None</code>).</p>"},{"location":"tutorial/readyapi/multiple-models/#shared-fields","title":"Shared Fields","text":"<p>But looking closely, we could see that these models have a lot of duplicated information.</p> <p>All the 3 models declare that they share some common fields that look exactly the same:</p> <ul> <li><code>name</code>, required</li> <li><code>secret_name</code>, required</li> <li><code>age</code>, optional</li> </ul> <p>And then they declare other fields with some differences (in this case, only about the <code>id</code>).</p> <p>We want to avoid duplicated information if possible.</p> <p>This is important if, for example, in the future, we decide to refactor the code and rename one field (column). For example, from <code>secret_name</code> to <code>secret_identity</code>.</p> <p>If we have that duplicated in multiple models, we could easily forget to update one of them. But if we avoid duplication, there's only one place that would need updating. \u2728</p> <p>Let's now improve that. \ud83e\udd13</p>"},{"location":"tutorial/readyapi/multiple-models/#multiple-models-with-inheritance","title":"Multiple Models with Inheritance","text":"<p>And here it is, you found the biggest feature of SQLDev. \ud83d\udc8e</p> <p>Each of these models is only a data model or both a data model and a table model.</p> <p>So, it's possible to create models with SQLDev that don't represent tables in the database.</p> <p>On top of that, we can use inheritance to avoid duplicated information in these models.</p> <p>We can see from above that they all share some base fields:</p> <ul> <li><code>name</code>, required</li> <li><code>secret_name</code>, required</li> <li><code>age</code>, optional</li> </ul> <p>So let's create a base model <code>HeroBase</code> that the others can inherit from:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <p>As you can see, this is not a table model, it doesn't have the <code>table = True</code> config.</p> <p>But now we can create the other models inheriting from it, they will all share these fields, just as if they had them declared.</p>"},{"location":"tutorial/readyapi/multiple-models/#the-hero-table-model","title":"The <code>Hero</code> Table Model","text":"<p>Let's start with the only table model, the <code>Hero</code>:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <p>Notice that <code>Hero</code> now doesn't inherit from <code>SQLDev</code>, but from <code>HeroBase</code>.</p> <p>And now we only declare one single field directly, the <code>id</code>, that here is <code>Optional[int]</code>, and is a <code>primary_key</code>.</p> <p>And even though we don't declare the other fields explicitly, because they are inherited, they are also part of this <code>Hero</code> model.</p> <p>And of course, all these fields will be in the columns for the resulting <code>hero</code> table in the database.</p> <p>And those inherited fields will also be in the autocompletion and inline errors in editors, etc.</p>"},{"location":"tutorial/readyapi/multiple-models/#columns-and-inheritance-with-multiple-models","title":"Columns and Inheritance with Multiple Models","text":"<p>Notice that the parent model <code>HeroBase</code>  is not a table model, but still, we can declare <code>name</code> and <code>age</code> using <code>Field(index=True)</code>.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <p>This won't affect this parent data model <code>HeroBase</code>.</p> <p>But once the child model <code>Hero</code> (the actual table model) inherits those fields, it will use those field configurations to create the indexes when creating the tables in the database.</p>"},{"location":"tutorial/readyapi/multiple-models/#the-herocreate-data-model","title":"The <code>HeroCreate</code> Data Model","text":"<p>Now let's see the <code>HeroCreate</code> model that will be used to define the data that we want to receive in the API when creating a new hero.</p> <p>This is a fun one:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <p>What's happening here?</p> <p>The fields we need to create are exactly the same as the ones in the <code>HeroBase</code> model. So we don't have to add anything.</p> <p>And because we can't leave the empty space when creating a new class, but we don't want to add any field, we just use <code>pass</code>.</p> <p>This means that there's nothing else special in this class apart from the fact that it is named <code>HeroCreate</code> and that it inherits from <code>HeroBase</code>.</p> <p>As an alternative, we could use <code>HeroBase</code> directly in the API code instead of <code>HeroCreate</code>, but it would show up in the automatic docs UI with that name \"<code>HeroBase</code>\" which could be confusing for clients. Instead, \"<code>HeroCreate</code>\" is a bit more explicit about what it is for.</p> <p>On top of that, we could easily decide in the future that we want to receive more data when creating a new hero apart from the data in <code>HeroBase</code> (for example, a password), and now we already have the class to put those extra fields.</p>"},{"location":"tutorial/readyapi/multiple-models/#the-heropublic-data-model","title":"The <code>HeroPublic</code> Data Model","text":"<p>Now let's check the <code>HeroPublic</code> model.</p> <p>This one just declares that the <code>id</code> field is required when reading a hero from the API, because a hero read from the API will come from the database, and in the database it will always have an ID.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre>"},{"location":"tutorial/readyapi/multiple-models/#review-the-updated-docs-ui","title":"Review the Updated Docs UI","text":"<p>The ReadyAPI code is still the same as above, we still use <code>Hero</code>, <code>HeroCreate</code>, and <code>HeroPublic</code>. But now, we define them in a smarter way with inheritance.</p> <p>So, we can jump to the docs UI right away and see how they look with the updated data.</p>"},{"location":"tutorial/readyapi/multiple-models/#docs-ui-to-create-a-hero","title":"Docs UI to Create a Hero","text":"<p>Let's see the new UI for creating a hero:</p> <p></p> <p>Nice! It now shows that to create a hero, we just pass the <code>name</code>, <code>secret_name</code>, and optionally <code>age</code>.</p> <p>We no longer pass an <code>id</code>.</p>"},{"location":"tutorial/readyapi/multiple-models/#docs-ui-with-hero-responses","title":"Docs UI with Hero Responses","text":"<p>Now we can scroll down a bit to see the response schema:</p> <p></p> <p>We can now see that <code>id</code> is a required field, it has a red asterisk (*).</p> <p>And if we check the schema for the Read Heroes path operation it will also show the updated schema.</p>"},{"location":"tutorial/readyapi/multiple-models/#inheritance-and-table-models","title":"Inheritance and Table Models","text":"<p>We just saw how powerful the inheritance of these models could be.</p> <p>This is a very simple example, and it might look a bit... meh. \ud83d\ude05</p> <p>But now imagine that your table has 10 or 20 columns. And that you have to duplicate all that information for all your data models... then it becomes more obvious why it's quite useful to be able to avoid all that information duplication with inheritance.</p> <p>Now, this probably looks so flexible that it's not obvious when to use inheritance and for what.</p> <p>Here are a couple of rules of thumb that can help you.</p>"},{"location":"tutorial/readyapi/multiple-models/#only-inherit-from-data-models","title":"Only Inherit from Data Models","text":"<p>Only inherit from data models, don't inherit from table models.</p> <p>It will help you avoid confusion, and there won't be any reason for you to need to inherit from a table model.</p> <p>If you feel like you need to inherit from a table model, then instead create a base class that is only a data model and has all those fields, like <code>HeroBase</code>.</p> <p>And then inherit from that base class that is only a data model for any other data model and for the table model.</p>"},{"location":"tutorial/readyapi/multiple-models/#avoid-duplication-keep-it-simple","title":"Avoid Duplication - Keep it Simple","text":"<p>It could feel like you need to have a profound reason why to inherit from one model or another, because \"in some mystical way\" they separate different concepts... or something like that.</p> <p>In some cases, there are simple separations that you can use, like the models to create data, read, update, etc. If that's quick and obvious, nice, use it. \ud83d\udcaf</p> <p>Otherwise, don't worry too much about profound conceptual reasons to separate models, just try to avoid duplication and keep the code simple enough to reason about it.</p> <p>If you see you have a lot of overlap between two models, then you can probably avoid some of that duplication with a base model.</p> <p>But if to avoid some duplication you end up with a crazy tree of models with inheritance, then it might be simpler to just duplicate some of those fields, and that might be easier to reason about and to maintain.</p> <p>Do whatever is easier to reason about, to program with, to maintain, and to refactor in the future. \ud83e\udd13</p> <p>Remember that inheritance, the same as SQLDev, and anything else, are just tools to help you be more productive, that's one of their main objectives. If something is not helping with that (e.g. too much duplication, too much complexity), then change it. \ud83d\ude80</p>"},{"location":"tutorial/readyapi/multiple-models/#recap","title":"Recap","text":"<p>You can use SQLDev to declare multiple models:</p> <ul> <li>Some models can be only data models. They will also be Pydantic models.</li> <li>And some can also be table models (apart from already being data models) by having the config <code>table = True</code>. They will also be Pydantic models and SQLAlchemy models.</li> </ul> <p>Only the table models will create tables in the database.</p> <p>So, you can use all the other data models to validate, convert, filter, and document the schema of the data for your application. \u2728</p> <p>You can use inheritance to avoid information and code duplication. \ud83d\ude0e</p> <p>And you can use all these models directly with ReadyAPI. \ud83d\ude80</p>"},{"location":"tutorial/readyapi/read-one/","title":"Read One Model with ReadyAPI","text":"<p>Let's now add a path operation to read a single model to our ReadyAPI application.</p>"},{"location":"tutorial/readyapi/read-one/#path-operation-for-one-hero","title":"Path Operation for One Hero","text":"<p>Let's add a new path operation to read one single hero.</p> <p>We want to get the hero based on the <code>id</code>, so we will use a path parameter <code>hero_id</code>.</p> <p>Info</p> <p>If you need to refresh how path parameters work, including their data validation, check the ReadyAPI docs about Path Parameters.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> <p>For example, to get the hero with ID <code>2</code> we would send a <code>GET</code> request to:</p> <pre><code>/heroes/2\n</code></pre>"},{"location":"tutorial/readyapi/read-one/#handling-errors","title":"Handling Errors","text":"<p>Then, because ReadyAPI already takes care of making sure that the <code>hero_id</code> is an actual integer, we can use it directly with <code>Hero.get()</code> to try and get one hero by that ID.</p> <p>But if the integer is not the ID of any hero in the database, it will not find anything, and the variable <code>hero</code> will be <code>None</code>.</p> <p>So, we check it in an <code>if</code> block, if it's <code>None</code>, we raise an <code>HTTPException</code> with a <code>404</code> status code.</p> <p>And to use it, we first import <code>HTTPException</code> from <code>readyapi</code>.</p> <p>This will let the client know that they probably made a mistake on their side and requested a hero that doesn't exist in the database.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre>"},{"location":"tutorial/readyapi/read-one/#return-the-hero","title":"Return the Hero","text":"<p>Then, if the hero exists, we return it.</p> <p>And because we are using the <code>response_model</code> with <code>HeroPublic</code>, it will be validated, documented, etc.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n</code></pre>"},{"location":"tutorial/readyapi/read-one/#check-the-docs-ui","title":"Check the Docs UI","text":"<p>We can then go to the docs UI and see the new path operation.</p> <p></p>"},{"location":"tutorial/readyapi/read-one/#recap","title":"Recap","text":"<p>You can combine ReadyAPI features like automatic path parameter validation to get models by ID.</p>"},{"location":"tutorial/readyapi/relationships/","title":"Models with Relationships in ReadyAPI","text":"<p>If we go right now and read a single hero by ID, we get the hero data with the team ID.</p> <p>But we don't get any data about the particular team:</p> <p></p> <p>We get a response of:</p> <pre><code>{\n    \"name\": \"Deadpond\",\n    \"secret_name\": \"Dive Wilson\",\n    \"age\": null,\n    \"team_id\": 1,\n    \"id\": 1,\n}\n</code></pre> <p>And the same way, if we get a team by ID, we get the team data, but we don't get any information about this team's heroes:</p> <p></p> <p>Here we get a response of:</p> <pre><code>{\n    \"name\": \"Preventers\",\n    \"headquarters\": \"Sharp Tower\",\n    \"id\": 2\n}\n</code></pre> <p>...but no information about the heroes.</p> <p>Let's update that. \ud83e\udd13</p>"},{"location":"tutorial/readyapi/relationships/#why-arent-we-getting-more-data","title":"Why Aren't We Getting More Data","text":"<p>First, why is it that we are not getting the related data for each hero and for each team?</p> <p>It's because we declared the <code>HeroPublic</code> with only the same base fields of the <code>HeroBase</code> plus the <code>id</code>. But it doesn't include a field <code>team</code> for the relationship attribute.</p> <p>And the same way, we declared the <code>TeamPublic</code> with only the same base fields of the <code>TeamBase</code> plus the <code>id</code>. But it doesn't include a field <code>heroes</code> for the relationship attribute.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n# Code here omitted \ud83d\udc48\n\nclass TeamPublic(TeamBase):\n    id: int\n\n# Code here omitted \ud83d\udc48\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n# Code here omitted \ud83d\udc48\n\nclass HeroPublic(HeroBase):\n    id: int\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n# Code here omitted \ud83d\udc48\n\nclass TeamPublic(TeamBase):\n    id: int\n\n# Code here omitted \ud83d\udc48\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n# Code here omitted \ud83d\udc48\n\nclass HeroPublic(HeroBase):\n    id: int\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n# Code here omitted \ud83d\udc48\n\nclass TeamPublic(TeamBase):\n    id: int\n\n# Code here omitted \ud83d\udc48\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n# Code here omitted \ud83d\udc48\n\nclass HeroPublic(HeroBase):\n    id: int\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: str | None = None\n    headquarters: str | None = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n    team_id: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=list[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=list[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=List[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <p>Now, remember that ReadyAPI uses the <code>response_model</code> to validate and filter the response data?</p> <p>In this case, we used <code>response_model=TeamPublic</code> and <code>response_model=HeroPublic</code>, so ReadyAPI will use them to filter the response data, even if we return a table model that includes relationship attributes:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: str | None = None\n    headquarters: str | None = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n    team_id: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=list[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=list[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=List[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre>"},{"location":"tutorial/readyapi/relationships/#dont-include-all-the-data","title":"Don't Include All the Data","text":"<p>Now let's stop for a second and think about it.</p> <p>We cannot simply include all the data, including all the internal relationships, because each hero has an attribute <code>team</code> with their team, and then that team also has an attribute <code>heroes</code> with all the heroes in the team, including this one.</p> <p>If we tried to include everything, we could make the server application crash trying to extract infinite data, going through the same hero and team over and over again internally, something like this:</p> <pre><code>{\n    \"name\": \"Rusty-Man\",\n    \"secret_name\": \"Tommy Sharp\",\n    \"age\": 48,\n    \"team_id\": 1,\n    \"id\": 1,\n    \"team\": {\n        \"name\": \"Preventers\",\n        \"headquarters\": \"Sharp Tower\",\n        \"id\": 2,\n        \"heroes\": [\n            {\n                \"name\": \"Rusty-Man\",\n                \"secret_name\": \"Tommy Sharp\",\n                \"age\": 48,\n                \"team_id\": 1,\n                \"id\": 1,\n                \"team\": {\n                    \"name\": \"Preventers\",\n                    \"headquarters\": \"Sharp Tower\",\n                    \"id\": 2,\n                    \"heroes\": [\n                        {\n                            \"name\": \"Rusty-Man\",\n                            \"secret_name\": \"Tommy Sharp\",\n                            \"age\": 48,\n                            \"team_id\": 1,\n                            \"id\": 1,\n                            \"team\": {\n                                \"name\": \"Preventers\",\n                                \"headquarters\": \"Sharp Tower\",\n                                \"id\": 2,\n                                \"heroes\": [\n                                    ...with infinite data here... \ud83d\ude31\n                                ]\n                            }\n                        }\n                    ]\n                }\n            }\n        ]\n    }\n}\n</code></pre> <p>As you can see, in this example, we would get the hero Rusty-Man, and from this hero we would get the team Preventers, and then from this team we would get its heroes, of course, including Rusty-Man... \ud83d\ude31</p> <p>So we start again, and in the end, the server would just crash trying to get all the data with a <code>\"Maximum recursion error\"</code>, we would not even get a response like the one above.</p> <p>So, we need to carefully choose in which cases we want to include data and in which not.</p>"},{"location":"tutorial/readyapi/relationships/#what-data-to-include","title":"What Data to Include","text":"<p>This is a decision that will depend on each application.</p> <p>In our case, let's say that if we get a list of heroes, we don't want to also include each of their teams in each one.</p> <p>And if we get a list of teams, we don't want to get a list of the heroes for each one.</p> <p>But if we get a single hero, we want to include the team data (without the team's heroes).</p> <p>And if we get a single team, we want to include the list of heroes (without each hero's team).</p> <p>Let's add a couple more data models that declare that data so we can use them in those two specific path operations.</p>"},{"location":"tutorial/readyapi/relationships/#models-with-relationships","title":"Models with Relationships","text":"<p>Let's add the models <code>HeroPublicWithTeam</code> and <code>TeamPublicWithHeroes</code>.</p> <p>We'll add them after the other models so that we can easily reference the previous models.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroPublicWithTeam(HeroPublic):\n    team: TeamPublic | None = None\n\n\nclass TeamPublicWithHeroes(TeamPublic):\n    heroes: list[HeroPublic] = []\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroPublicWithTeam(HeroPublic):\n    team: Optional[TeamPublic] = None\n\n\nclass TeamPublicWithHeroes(TeamPublic):\n    heroes: list[HeroPublic] = []\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroPublicWithTeam(HeroPublic):\n    team: Optional[TeamPublic] = None\n\n\nclass TeamPublicWithHeroes(TeamPublic):\n    heroes: List[HeroPublic] = []\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    id: int | None = None\n    name: str | None = None\n    headquarters: str | None = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n    team_id: int | None = None\n\n\nclass HeroPublicWithTeam(HeroPublic):\n    team: TeamPublic | None = None\n\n\nclass TeamPublicWithHeroes(TeamPublic):\n    heroes: list[HeroPublic] = []\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublicWithTeam)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=list[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublicWithHeroes)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    id: Optional[int] = None\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n\nclass HeroPublicWithTeam(HeroPublic):\n    team: Optional[TeamPublic] = None\n\n\nclass TeamPublicWithHeroes(TeamPublic):\n    heroes: list[HeroPublic] = []\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublicWithTeam)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=list[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublicWithHeroes)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    id: Optional[int] = None\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n\nclass HeroPublicWithTeam(HeroPublic):\n    team: Optional[TeamPublic] = None\n\n\nclass TeamPublicWithHeroes(TeamPublic):\n    heroes: List[HeroPublic] = []\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublicWithTeam)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=List[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublicWithHeroes)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <p>These two models are very simple in code, but there's a lot happening here. Let's check it out.</p>"},{"location":"tutorial/readyapi/relationships/#inheritance-and-type-annotations","title":"Inheritance and Type Annotations","text":"<p>The <code>HeroPublicWithTeam</code> inherits from <code>HeroPublic</code>, which means that it will have the normal fields for reading, including the required <code>id</code> that was declared in <code>HeroPublic</code>.</p> <p>And then it adds the new field <code>team</code>, which could be <code>None</code>, and is declared with the type <code>TeamPublic</code> with the base fields for reading a team.</p> <p>Then we do the same for the <code>TeamPublicWithHeroes</code>, it inherits from <code>TeamPublic</code>, and declares the new field <code>heroes</code>, which is a list of <code>HeroPublic</code>.</p>"},{"location":"tutorial/readyapi/relationships/#data-models-without-relationship-attributes","title":"Data Models Without Relationship Attributes","text":"<p>Now, notice that these new fields <code>team</code> and <code>heroes</code> are not declared with <code>Relationship()</code>, because these are not table models, they cannot have relationship attributes with the magic access to get that data from the database.</p> <p>Instead, here these are only data models that will tell ReadyAPI which attributes to get data from and which data to get from them.</p>"},{"location":"tutorial/readyapi/relationships/#reference-to-other-models","title":"Reference to Other Models","text":"<p>Also, notice that the field <code>team</code> is not declared with this new <code>TeamPublicWithHeroes</code>, because that would again create that infinite recursion of data. Instead, we declare it with the normal <code>TeamPublic</code> model.</p> <p>And the same for <code>TeamPublicWithHeroes</code>, the model used for the new field <code>heroes</code> uses <code>HeroPublic</code> to get only each hero's data.</p> <p>This also means that, even though we have these two new models, we still need the previous ones, <code>HeroPublic</code> and <code>TeamPublic</code>, because we need to reference them here (and we are also using them in the rest of the path operations).</p>"},{"location":"tutorial/readyapi/relationships/#update-the-path-operations","title":"Update the Path Operations","text":"<p>Now we can update the path operations to use the new models.</p> <p>This will tell ReadyAPI to take the object that we return from the path operation function (a table model) and access the additional attributes from them to extract their data.</p> <p>In the case of the hero, this tells ReadyAPI to extract the <code>team</code> too. And in the case of the team, to extract the list of <code>heroes</code> too.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublicWithTeam)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublicWithHeroes)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublicWithTeam)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublicWithHeroes)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublicWithTeam)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublicWithHeroes)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    id: int | None = None\n    name: str | None = None\n    headquarters: str | None = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n    team_id: int | None = None\n\n\nclass HeroPublicWithTeam(HeroPublic):\n    team: TeamPublic | None = None\n\n\nclass TeamPublicWithHeroes(TeamPublic):\n    heroes: list[HeroPublic] = []\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublicWithTeam)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=list[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublicWithHeroes)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    id: Optional[int] = None\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n\nclass HeroPublicWithTeam(HeroPublic):\n    team: Optional[TeamPublic] = None\n\n\nclass TeamPublicWithHeroes(TeamPublic):\n    heroes: list[HeroPublic] = []\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublicWithTeam)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=list[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublicWithHeroes)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    id: Optional[int] = None\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n\nclass HeroPublicWithTeam(HeroPublic):\n    team: Optional[TeamPublic] = None\n\n\nclass TeamPublicWithHeroes(TeamPublic):\n    heroes: List[HeroPublic] = []\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublicWithTeam)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=List[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublicWithHeroes)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre>"},{"location":"tutorial/readyapi/relationships/#check-it-out-in-the-docs-ui","title":"Check It Out in the Docs UI","text":"<p>Now let's try it out again in the docs UI.</p> <p>Let's try again with the same hero with ID <code>1</code>:</p> <p></p> <p>Now we get the team data included:</p> <pre><code>{\n    \"name\": \"Deadpond\",\n    \"secret_name\": \"Dive Wilson\",\n    \"age\": null,\n    \"team_id\": 1,\n    \"id\": 1,\n    \"team\": {\n        \"name\": \"Z-Force\",\n        \"headquarters\": \"Sister Margaret's Bar\",\n        \"id\": 1\n    }\n}\n</code></pre> <p>And if we get now the team with ID <code>2</code>:</p> <p></p> <p>Now we get the list of heroes included:</p> <pre><code>{\n    \"name\": \"Preventers\",\n    \"headquarters\": \"Sharp Tower\",\n    \"id\": 2,\n    \"heroes\": [\n        {\n            \"name\": \"Rusty-Man\",\n            \"secret_name\": \"Tommy Sharp\",\n            \"age\": 48,\n            \"team_id\": 2,\n            \"id\": 2\n        },\n        {\n            \"name\": \"Spider-Boy\",\n            \"secret_name\": \"Pedro Parqueador\",\n            \"age\": null,\n            \"team_id\": 2,\n            \"id\": 3\n        },\n        {\n            \"name\": \"Tarantula\",\n            \"secret_name\": \"Natalia Roman-on\",\n            \"age\": 32,\n            \"team_id\": 2,\n            \"id\": 6\n        },\n        {\n            \"name\": \"Dr. Weird\",\n            \"secret_name\": \"Steve Weird\",\n            \"age\": 36,\n            \"team_id\": 2,\n            \"id\": 7\n        },\n        {\n            \"name\": \"Captain North America\",\n            \"secret_name\": \"Esteban Rogelios\",\n            \"age\": 93,\n            \"team_id\": 2,\n            \"id\": 8\n        }\n    ]\n}\n</code></pre>"},{"location":"tutorial/readyapi/relationships/#recap","title":"Recap","text":"<p>Using the same techniques to declare additional data models, we can tell ReadyAPI what data to return in the responses, even when we return table models.</p> <p>Here we almost didn't have to change the ReadyAPI app code, but of course, there will be cases where you need to get the data and process it in different ways in the path operation function before returning it.</p> <p>But even in those cases, you will be able to define the data models to use in <code>response_model</code> to tell ReadyAPI how to validate and filter the data.</p> <p>By this point, you already have a very robust API to handle data in a SQL database combining SQLDev with ReadyAPI, and implementing best practices, like data validation, conversion, filtering, and documentation. \u2728</p> <p>In the next chapter, I'll tell you how to implement automated testing for your application using ReadyAPI and SQLDev. \u2705</p>"},{"location":"tutorial/readyapi/response-model/","title":"ReadyAPI Response Model with SQLDev","text":"<p>Now I'll show you how to use ReadyAPI's <code>response_model</code> with SQLDev.</p>"},{"location":"tutorial/readyapi/response-model/#interactive-api-docs","title":"Interactive API Docs","text":"<p>Up to now, with the code we have used, the API docs know the data the clients have to send:</p> <p></p> <p>This interactive docs UI is powered by Swagger UI, and what Swagger UI does is to read a big JSON content that defines the API with all the data schemas (data shapes) using the standard OpenAPI, and showing it in that nice UI.</p> <p>ReadyAPI automatically generates that OpenAPI for Swagger UI to read it.</p> <p>And it generates it based on the code you write, using the Pydantic models (in this case SQLDev models) and type annotations to know the schemas of the data that the API handles.</p>"},{"location":"tutorial/readyapi/response-model/#response-data","title":"Response Data","text":"<p>But up to now, the API docs UI doesn't know the schema of the responses our app sends back.</p> <p>You can see that there's a possible \"Successful Response\" with a code <code>200</code>, but we have no idea how the response data would look like.</p> <p></p> <p>Right now, we only tell ReadyAPI the data we want to receive, but we don't tell it yet the data we want to send back.</p> <p>Let's do that now. \ud83e\udd13</p>"},{"location":"tutorial/readyapi/response-model/#use-response_model","title":"Use <code>response_model</code>","text":"<p>We can use <code>response_model</code> to tell ReadyAPI the schema of the data we want to send back.</p> <p>For example, we can pass the same <code>Hero</code> SQLDev class (because it is also a Pydantic model):</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n@app.post(\"/heroes/\", response_model=Hero)\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.post(\"/heroes/\", response_model=Hero)\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.post(\"/heroes/\", response_model=Hero)\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=Hero)\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n\n@app.get(\"/heroes/\", response_model=list[Hero])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=Hero)\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n\n@app.get(\"/heroes/\", response_model=list[Hero])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=Hero)\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n\n@app.get(\"/heroes/\", response_model=List[Hero])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre>"},{"location":"tutorial/readyapi/response-model/#list-of-heroes-in-response_model","title":"List of Heroes in <code>response_model</code>","text":"<p>We can also use other type annotations, the same way we can use with Pydantic fields. For example, we can pass a list of <code>Hero</code>s.</p> <p>First, we import <code>List</code> from <code>typing</code> and then we declare the <code>response_model</code> with <code>List[Hero]</code>:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code here omitted \ud83d\udc48\n\n@app.get(\"/heroes/\", response_model=list[Hero])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code here omitted \ud83d\udc48\n\n@app.get(\"/heroes/\", response_model=list[Hero])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\n# Code here omitted \ud83d\udc48\n\n@app.get(\"/heroes/\", response_model=List[Hero])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=Hero)\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n\n@app.get(\"/heroes/\", response_model=list[Hero])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=Hero)\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n\n@app.get(\"/heroes/\", response_model=list[Hero])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=Hero)\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n\n@app.get(\"/heroes/\", response_model=List[Hero])\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre>"},{"location":"tutorial/readyapi/response-model/#readyapi-and-response-model","title":"ReadyAPI and Response Model","text":"<p>ReadyAPI will do data validation and filtering of the response with this <code>response_model</code>.</p> <p>So this works like a contract between our application and the client.</p> <p>You can read more about it in the ReadyAPI docs about <code>response_model</code>.</p>"},{"location":"tutorial/readyapi/response-model/#new-api-docs-ui","title":"New API Docs UI","text":"<p>Now we can go back to the docs UI and see that they now show the schema of the response we will receive.</p> <p></p> <p>The clients will know what data they should expect.</p>"},{"location":"tutorial/readyapi/response-model/#automatic-clients","title":"Automatic Clients","text":"<p>The most visible advantage of using the <code>response_model</code> is that it shows up in the API docs UI.</p> <p>But there are other advantages, like that ReadyAPI will do automatic data validation and filtering of the response data using this model.</p> <p>Additionally, because the schemas are defined in using a standard, there are many tools that can take advantage of this.</p> <p>For example, client generators, that can automatically create the code necessary to talk to your API in many languages.</p> <p>Info</p> <p>If you are curious about the standards, ReadyAPI generates OpenAPI, that internally uses JSON Schema.</p> <p>You can read about all that in the ReadyAPI docs - First Steps.</p>"},{"location":"tutorial/readyapi/response-model/#recap","title":"Recap","text":"<p>Use the <code>response_model</code> to tell ReadyAPI the schema of the data you want to send back and have awesome data APIs. \ud83d\ude0e</p>"},{"location":"tutorial/readyapi/session-with-dependency/","title":"Session with ReadyAPI Dependency","text":"<p>Before we keep adding things, let's change a bit how we get the session for each request to simplify our life later.</p>"},{"location":"tutorial/readyapi/session-with-dependency/#current-sessions","title":"Current Sessions","text":"<p>Up to now, we have been creating a session in each path operation, in a <code>with</code> block.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        for key, value in hero_data.items():\n            setattr(db_hero, key, value)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        session.delete(hero)\n        session.commit()\n        return {\"ok\": True}\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        for key, value in hero_data.items():\n            setattr(db_hero, key, value)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        session.delete(hero)\n        session.commit()\n        return {\"ok\": True}\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        for key, value in hero_data.items():\n            setattr(db_hero, key, value)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        session.delete(hero)\n        session.commit()\n        return {\"ok\": True}\n</code></pre> <p>That's perfectly fine, but in many use cases we would want to use ReadyAPI Dependencies, for example to verify that the client is logged in and get the current user before executing any other code in the path operation.</p> <p>These dependencies are also very useful during testing, because we can easily replace them, and then, for example, use a new database for our tests, or put some data before the tests, etc.</p> <p>So, let's refactor these sessions to use ReadyAPI Dependencies.</p>"},{"location":"tutorial/readyapi/session-with-dependency/#create-a-readyapi-dependency","title":"Create a ReadyAPI Dependency","text":"<p>A ReadyAPI dependency is very simple, it's just a function that returns a value.</p> <p>It could use <code>yield</code> instead of <code>return</code>, and in that case ReadyAPI will make sure it executes all the code after the <code>yield</code>, once it is done with the request.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre>"},{"location":"tutorial/readyapi/session-with-dependency/#use-the-dependency","title":"Use the Dependency","text":"<p>Now let's make ReadyAPI execute a dependency and get its value in the path operation.</p> <p>We import <code>Depends()</code> from <code>readyapi</code>. Then we use it in the path operation function in a parameter, the same way we declared parameters to get JSON bodies, path parameters, etc.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n# Code here omitted \ud83d\udc48\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n# Code here omitted \ud83d\udc48\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n# Code here omitted \ud83d\udc48\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <p>Tip</p> <p>Here's a tip about that <code>*,</code> thing in the parameters.</p> <p>Here we are passing the parameter <code>session</code> that has a \"default value\" of <code>Depends(get_session)</code> before the parameter <code>hero</code>, that doesn't have any default value.</p> <p>Python would normally complain about that, but we can use the initial \"parameter\" <code>*,</code> to mark all the rest of the parameters as \"keyword only\", which solves the problem.</p> <p>You can read more about it in the ReadyAPI documentation Path Parameters and Numeric Validations - Order the parameters as you need, tricks</p> <p>The value of a dependency will only be used for one request, ReadyAPI will call it right before calling your code and will give you the value from that dependency.</p> <p>If it had <code>yield</code>, then it will continue the rest of the execution once you are done sending the response. In the case of the session, it will finish the cleanup code from the <code>with</code> block, closing the session, etc.</p> <p>Then ReadyAPI will call it again for the next request.</p> <p>Because it is called once per request, we will still get a single session per request as we should, so we are still fine with that. \u2705</p> <p>And because dependencies can use <code>yield</code>, ReadyAPI will make sure to run the code after the <code>yield</code> once it is done, including all the cleanup code at the end of the <code>with</code> block. So we are also fine with that. \u2705</p>"},{"location":"tutorial/readyapi/session-with-dependency/#the-with-block","title":"The <code>with</code> Block","text":"<p>This means that in the main code of the path operation function, it will work equivalently to the previous version with the explicit <code>with</code> block.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n# Code here omitted \ud83d\udc48\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n# Code here omitted \ud83d\udc48\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n# Code here omitted \ud83d\udc48\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <p>In fact, you could think that all that block of code inside of the <code>create_hero()</code> function is still inside a <code>with</code> block for the session, because this is more or less what's happening behind the scenes.</p> <p>But now, the <code>with</code> block is not explicitly in the function, but in the dependency above:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n# Code here omitted \ud83d\udc48\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n# Code here omitted \ud83d\udc48\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n# Code here omitted \ud83d\udc48\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <p>We will see how this is very useful when testing the code later. \u2705</p>"},{"location":"tutorial/readyapi/session-with-dependency/#update-the-path-operations-to-use-the-dependency","title":"Update the Path Operations to Use the Dependency","text":"<p>Now we can update the rest of the path operations to use the new dependency.</p> <p>We just declare the dependency in the parameters of the function, with:</p> <pre><code>session: Session = Depends(get_session)\n</code></pre> <p>And then we remove the previous <code>with</code> block with the old session.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n# Code here omitted \ud83d\udc48\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n# Code here omitted \ud83d\udc48\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# Code here omitted \ud83d\udc48\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n# Code here omitted \ud83d\udc48\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre>"},{"location":"tutorial/readyapi/session-with-dependency/#recap","title":"Recap","text":"<p>You just learned how to use ReadyAPI dependencies to handle the database session. This will come in handy later when testing the code.</p> <p>And you will see how much these dependencies can help the more you work with ReadyAPI, to handle permissions, authentication, resources like database sessions, etc. \ud83d\ude80</p> <p>If you want to learn more about dependencies, checkout the ReadyAPI docs about Dependencies.</p>"},{"location":"tutorial/readyapi/simple-hero-api/","title":"Simple Hero API with ReadyAPI","text":"<p>Let's start by building a simple hero web API with ReadyAPI. \u2728</p>"},{"location":"tutorial/readyapi/simple-hero-api/#install-readyapi","title":"Install ReadyAPI","text":"<p>The first step is to install ReadyAPI.</p> <p>ReadyAPI is the framework to create the web API.</p> <p>But we also need another type of program to run it, it is called a \"server\". We will use Uvicorn for that. And we will install Uvicorn with its standard dependencies.</p> <p>Then install ReadyAPI.</p> <p>Make sure you create a virtual environment, activate it, and then install them, for example with:</p> <pre><code>$ pip install readyapi \"uvicorn[standard]\"\n\n---&gt; 100%\n</code></pre>"},{"location":"tutorial/readyapi/simple-hero-api/#sqldev-code-models-engine","title":"SQLDev Code - Models, Engine","text":"<p>Now let's start with the SQLDev code.</p> <p>We will start with the simplest version, with just heroes (no teams yet).</p> <p>This is almost the same code we have seen up to now in previous examples:</p> Python 3.10+Python 3.7+ <pre><code># One line of ReadyAPI imports here later \ud83d\udc48\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\n# One line of ReadyAPI imports here later \ud83d\udc48\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\")\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n\n@app.get(\"/heroes/\")\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\")\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n\n@app.get(\"/heroes/\")\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <p>There's only one change here from the code we have used before, the <code>check_same_thread</code> in the <code>connect_args</code>.</p> <p>That is a configuration that SQLAlchemy passes to the low-level library in charge of communicating with the database.</p> <p><code>check_same_thread</code> is by default set to <code>True</code>, to prevent misuses in some simple cases.</p> <p>But here we will make sure we don't share the same session in more than one request, and that's the actual safest way to prevent any of the problems that configuration is there for.</p> <p>And we also need to disable it because in ReadyAPI each request could be handled by multiple interacting threads.</p> <p>Info</p> <p>That's enough information for now, you can read more about it in the ReadyAPI docs for <code>async</code> and <code>await</code>.</p> <p>The main point is, by ensuring you don't share the same session with more than one request, the code is already safe.</p>"},{"location":"tutorial/readyapi/simple-hero-api/#readyapi-app","title":"ReadyAPI App","text":"<p>The next step is to create the ReadyAPI app.</p> <p>We will import the <code>ReadyAPI</code> class from <code>readyapi</code>.</p> <p>And then create an <code>app</code> object that is an instance of that <code>ReadyAPI</code> class:</p> Python 3.10+Python 3.7+ <pre><code>from readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# SQLDev code here omitted \ud83d\udc48\n\napp = ReadyAPI()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n# SQLDev code here omitted \ud83d\udc48\n\napp = ReadyAPI()\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\")\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n\n@app.get(\"/heroes/\")\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\")\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n\n@app.get(\"/heroes/\")\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre>"},{"location":"tutorial/readyapi/simple-hero-api/#create-database-and-tables-on-startup","title":"Create Database and Tables on <code>startup</code>","text":"<p>We want to make sure that once the app starts running, the function <code>create_tables</code> is called. To create the database and tables.</p> <p>This should be called only once at startup, not before every request, so we put it in the function to handle the <code>\"startup\"</code> event:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\")\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n\n@app.get(\"/heroes/\")\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\")\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n\n@app.get(\"/heroes/\")\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre>"},{"location":"tutorial/readyapi/simple-hero-api/#create-heroes-path-operation","title":"Create Heroes Path Operation","text":"<p>Info</p> <p>If you need a refresher on what a Path Operation is (an endpoint with a specific HTTP Operation) and how to work with it in ReadyAPI, check out the ReadyAPI First Steps docs.</p> <p>Let's create the path operation code to create a new hero.</p> <p>It will be called when a user sends a request with a <code>POST</code> operation to the <code>/heroes/</code> path:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\")\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\")\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\")\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n\n@app.get(\"/heroes/\")\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\")\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n\n@app.get(\"/heroes/\")\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <p>Info</p> <p>If you need a refresher on some of those concepts, checkout the ReadyAPI documentation:</p> <ul> <li>First Steps</li> <li>Path Parameters - Data Validation and Data Conversion</li> <li>Request Body</li> </ul>"},{"location":"tutorial/readyapi/simple-hero-api/#the-sqldev-advantage","title":"The SQLDev Advantage","text":"<p>Here's where having our SQLDev class models be both SQLAlchemy models and Pydantic models at the same time shine. \u2728</p> <p>Here we use the same class model to define the request body that will be received by our API.</p> <p>Because ReadyAPI is based on Pydantic, it will use the same model (the Pydantic part) to do automatic data validation and conversion from the JSON request to an object that is an actual instance of the <code>Hero</code> class.</p> <p>And then, because this same SQLDev object is not only a Pydantic model instance but also a SQLAlchemy model instance, we can use it directly in a session to create the row in the database.</p> <p>So we can use intuitive standard Python type annotations, and we don't have to duplicate a lot of the code for the database models and the API data models. \ud83c\udf89</p> <p>Tip</p> <p>We will improve this further later, but for now, it already shows the power of having SQLDev classes be both SQLAlchemy models and Pydantic models at the same time.</p>"},{"location":"tutorial/readyapi/simple-hero-api/#read-heroes-path-operation","title":"Read Heroes Path Operation","text":"<p>Now let's add another path operation to read all the heroes:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\")\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n\n@app.get(\"/heroes/\")\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\")\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n\n@app.get(\"/heroes/\")\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\")\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n\n@app.get(\"/heroes/\")\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\")\ndef create_hero(hero: Hero):\n    with Session(engine) as session:\n        session.add(hero)\n        session.commit()\n        session.refresh(hero)\n        return hero\n\n\n@app.get(\"/heroes/\")\ndef read_heroes():\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero)).all()\n        return heroes\n</code></pre> <p>This is pretty straightforward.</p> <p>When a client sends a request to the path <code>/heroes/</code> with a <code>GET</code> HTTP operation, we run this function that gets the heroes from the database and returns them.</p>"},{"location":"tutorial/readyapi/simple-hero-api/#one-session-per-request","title":"One Session per Request","text":"<p>Remember that we should use a SQLDev session per each group of operations and if we need other unrelated operations we should use a different session?</p> <p>Here it is much more obvious.</p> <p>We should normally have one session per request in most of the cases.</p> <p>In some isolated cases, we would want to have new sessions inside, so, more than one session per request.</p> <p>But we would never want to share the same session among different requests.</p> <p>In this simple example, we just create the new sessions manually in the path operation functions.</p> <p>In future examples later we will use a ReadyAPI Dependency to get the session, being able to share it with other dependencies and being able to replace it during testing. \ud83e\udd13</p>"},{"location":"tutorial/readyapi/simple-hero-api/#run-the-readyapi-application","title":"Run the ReadyAPI Application","text":"<p>Now we are ready to run the ReadyAPI application.</p> <p>Put all that code in a file called <code>main.py</code>.</p> <p>Then run it with Uvicorn:</p> <pre><code>$ uvicorn main:app\n\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Started reloader process [28720]\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Started server process [28722]\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Waiting for application startup.\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Application startup complete.\n</code></pre> <p>Info</p> <p>The command <code>uvicorn main:app</code> refers to:</p> <ul> <li><code>main</code>: the file <code>main.py</code> (the Python \"module\").</li> <li><code>app</code>: the object created inside of <code>main.py</code> with the line <code>app = ReadyAPI()</code>.</li> </ul>"},{"location":"tutorial/readyapi/simple-hero-api/#uvicorn-reload","title":"Uvicorn <code>--reload</code>","text":"<p>During development (and only during development), you can also add the option <code>--reload</code> to Uvicorn.</p> <p>It will restart the server every time you make a change to the code, this way you will be able to develop faster. \ud83e\udd13</p> <pre><code>$ uvicorn main:app --reload\n\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Will watch for changes in these directories: ['/home/user/code/sqldev-tutorial']\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Started reloader process [28720]\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Started server process [28722]\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Waiting for application startup.\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Application startup complete.\n</code></pre> <p>Just remember to never use <code>--reload</code> in production, as it consumes much more resources than necessary, would be more error prone, etc.</p>"},{"location":"tutorial/readyapi/simple-hero-api/#check-the-api-docs-ui","title":"Check the API docs UI","text":"<p>Now you can go to that URL in your browser <code>http://127.0.0.1:8000</code>. We didn't create a path operation for the root path <code>/</code>, so that URL alone will only show a \"Not Found\" error... that \"Not Found\" error is produced by your ReadyAPI application.</p> <p>But you can go to the automatically generated interactive API documentation at the path <code>/docs</code>: http://127.0.0.1:8000/docs. \u2728</p> <p>You will see that this automatic API docs UI has the paths that we defined above with their operations, and that it already knows the shape of the data that the path operations will receive:</p> <p></p>"},{"location":"tutorial/readyapi/simple-hero-api/#play-with-the-api","title":"Play with the API","text":"<p>You can actually click the button Try it out and send some requests to create some heroes with the Create Hero path operation.</p> <p>And then you can get them back with the Read Heroes path operation:</p> <p></p>"},{"location":"tutorial/readyapi/simple-hero-api/#check-the-database","title":"Check the Database","text":"<p>Now you can terminate that Uvicorn server by going back to the terminal and pressing Ctrl+C.</p> <p>And then, you can open DB Browser for SQLite and check the database, to explore the data and confirm that it indeed saved the heroes. \ud83c\udf89</p> <p></p>"},{"location":"tutorial/readyapi/simple-hero-api/#recap","title":"Recap","text":"<p>Good job! This is already a ReadyAPI web API application to interact with the heroes database. \ud83c\udf89</p> <p>There are several things we can improve and extend. For example, we want the database to decide the ID of each new hero, we don't want to allow a user to send it.</p> <p>We will make all those improvements in the next chapters. \ud83d\ude80</p>"},{"location":"tutorial/readyapi/teams/","title":"ReadyAPI Path Operations for Teams - Other Models","text":"<p>Let's now update the ReadyAPI application to handle data for teams.</p> <p>This is very similar to the things we have done for heroes, so we will go over it quickly here.</p> <p>We will use the same models we used in previous examples, with the relationship attributes, etc.</p>"},{"location":"tutorial/readyapi/teams/#add-teams-models","title":"Add Teams Models","text":"<p>Let's add the models for the teams.</p> <p>It's the same process we did for heroes, with a base model, a table model, and some other data models.</p> <p>We have a <code>TeamBase</code> data model, and from it, we inherit with a <code>Team</code> table model.</p> <p>Then we also inherit from the <code>TeamBase</code> for the <code>TeamCreate</code> and <code>TeamPublic</code> data models.</p> <p>And we also create a <code>TeamUpdate</code> data model.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: str | None = None\n    headquarters: str | None = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: str | None = None\n    headquarters: str | None = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n    team_id: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=list[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=list[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=List[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <p>We now also have relationship attributes. \ud83c\udf89</p> <p>Let's now update the <code>Hero</code> models too.</p>"},{"location":"tutorial/readyapi/teams/#update-hero-models","title":"Update Hero Models","text":"Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n    team_id: int | None = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: str | None = None\n    headquarters: str | None = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n    team_id: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=list[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=list[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=List[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <p>We now have a <code>team_id</code> in the hero models.</p> <p>Notice that we can declare the <code>team_id</code> in the <code>HeroBase</code> because it can be reused by all the models, in all the cases it's an optional integer.</p> <p>And even though the <code>HeroBase</code> is not a table model, we can declare <code>team_id</code> in it with the <code>foreign key</code> parameter. It won't do anything in most of the models that inherit from <code>HeroBase</code>, but in the table model <code>Hero</code> it will be used to tell SQLDev that this is a foreign key to that table.</p>"},{"location":"tutorial/readyapi/teams/#relationship-attributes","title":"Relationship Attributes","text":"<p>Notice that the relationship attributes, the ones with <code>Relationship()</code>, are only in the table models, as those are the ones that are handled by SQLDev with SQLAlchemy and that can have the automatic fetching of data from the database when we access them.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: str | None = None\n    headquarters: str | None = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n    team_id: int | None = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: str | None = None\n    headquarters: str | None = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n    team_id: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=list[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=list[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=List[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre>"},{"location":"tutorial/readyapi/teams/#path-operations-for-teams","title":"Path Operations for Teams","text":"<p>Let's now add the path operations for teams.</p> <p>These are equivalent and very similar to the path operations for the heroes we had before, so we don't have to go over the details for each one, let's check the code.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=list[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=list[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=List[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: str | None = None\n    headquarters: str | None = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n    team_id: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=list[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=list[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass TeamBase(SQLDev):\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Team(TeamBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass TeamCreate(TeamBase):\n    pass\n\n\nclass TeamPublic(TeamBase):\n    id: int\n\n\nclass TeamUpdate(SQLDev):\n    name: Optional[str] = None\n    headquarters: Optional[str] = None\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    team_id: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n\n\n@app.post(\"/teams/\", response_model=TeamPublic)\ndef create_team(*, session: Session = Depends(get_session), team: TeamCreate):\n    db_team = Team.model_validate(team)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.get(\"/teams/\", response_model=List[TeamPublic])\ndef read_teams(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    teams = session.exec(select(Team).offset(offset).limit(limit)).all()\n    return teams\n\n\n@app.get(\"/teams/{team_id}\", response_model=TeamPublic)\ndef read_team(*, team_id: int, session: Session = Depends(get_session)):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    return team\n\n\n@app.patch(\"/teams/{team_id}\", response_model=TeamPublic)\ndef update_team(\n    *,\n    session: Session = Depends(get_session),\n    team_id: int,\n    team: TeamUpdate,\n):\n    db_team = session.get(Team, team_id)\n    if not db_team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    team_data = team.model_dump(exclude_unset=True)\n    for key, value in team_data.items():\n        setattr(db_team, key, value)\n    session.add(db_team)\n    session.commit()\n    session.refresh(db_team)\n    return db_team\n\n\n@app.delete(\"/teams/{team_id}\")\ndef delete_team(*, session: Session = Depends(get_session), team_id: int):\n    team = session.get(Team, team_id)\n    if not team:\n        raise HTTPException(status_code=404, detail=\"Team not found\")\n    session.delete(team)\n    session.commit()\n    return {\"ok\": True}\n</code></pre>"},{"location":"tutorial/readyapi/teams/#using-relationships-attributes","title":"Using Relationships Attributes","text":"<p>Up to this point, we are actually not using the relationship attributes, but we could access them in our code.</p> <p>In the next chapter, we will play more with them.</p>"},{"location":"tutorial/readyapi/teams/#check-the-docs-ui","title":"Check the Docs UI","text":"<p>Now we can check the automatic docs UI to see all the path operations for heroes and teams.</p> <p></p>"},{"location":"tutorial/readyapi/teams/#recap","title":"Recap","text":"<p>We can use the same patterns to add more models and API path operations to our ReadyAPI application. \ud83c\udf89</p>"},{"location":"tutorial/readyapi/tests/","title":"Test Applications with ReadyAPI and SQLDev","text":"<p>To finish this group of chapters about ReadyAPI with SQLDev, let's now learn how to implement automated tests for an application using ReadyAPI with SQLDev. \u2705</p> <p>Including the tips and tricks. \ud83c\udf81</p>"},{"location":"tutorial/readyapi/tests/#readyapi-application","title":"ReadyAPI Application","text":"<p>Let's work with one of the simpler ReadyAPI applications we built in the previous chapters.</p> <p>All the same concepts, tips and tricks will apply to more complex applications as well.</p> <p>We will use the application with the hero models, but without team models, and we will use the dependency to get a session.</p> <p>Now we will see how useful it is to have this session dependency. \u2728</p> \ud83d\udc40 Full file preview <pre><code>from typing import List, Optional\n\nfrom readyapi import Depends, HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(*, session: Session = Depends(get_session), hero: HeroCreate):\n    db_hero = Hero.model_validate(hero)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(\n    *,\n    session: Session = Depends(get_session),\n    offset: int = 0,\n    limit: int = Query(default=100, le=100),\n):\n    heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n    return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(\n    *, session: Session = Depends(get_session), hero_id: int, hero: HeroUpdate\n):\n    db_hero = session.get(Hero, hero_id)\n    if not db_hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    hero_data = hero.model_dump(exclude_unset=True)\n    for key, value in hero_data.items():\n        setattr(db_hero, key, value)\n    session.add(db_hero)\n    session.commit()\n    session.refresh(db_hero)\n    return db_hero\n\n\n@app.delete(\"/heroes/{hero_id}\")\ndef delete_hero(*, session: Session = Depends(get_session), hero_id: int):\n    hero = session.get(Hero, hero_id)\n    if not hero:\n        raise HTTPException(status_code=404, detail=\"Hero not found\")\n    session.delete(hero)\n    session.commit()\n    return {\"ok\": True}\n</code></pre>"},{"location":"tutorial/readyapi/tests/#file-structure","title":"File Structure","text":"<p>Now we will have a Python project with multiple files, one file <code>main.py</code> with all the application, and one file <code>test_main.py</code> with the tests, with the same ideas from Code Structure and Multiple Files.</p> <p>The file structure is:</p> <pre><code>.\n\u251c\u2500\u2500 project\n    \u251c\u2500\u2500 __init__.py\n    \u251c\u2500\u2500 main.py\n    \u2514\u2500\u2500 test_main.py\n</code></pre>"},{"location":"tutorial/readyapi/tests/#testing-readyapi-applications","title":"Testing ReadyAPI Applications","text":"<p>If you haven't done testing in ReadyAPI applications, first check the ReadyAPI docs about Testing.</p> <p>Then, we can continue here, the first step is to install the dependencies, <code>requests</code> and <code>pytest</code>.</p> <p>Make sure you create a virtual environment, activate it, and then install them, for example with:</p> <pre><code>$ pip install requests pytest\n\n---&gt; 100%\n</code></pre>"},{"location":"tutorial/readyapi/tests/#basic-tests-code","title":"Basic Tests Code","text":"<p>Let's start with a simple test, with just the basic test code we need the check that the ReadyAPI application is creating a new hero correctly.</p> <pre><code>from readyapi.testclient import TestClient\nfrom sqldev import Session, SQLDev, create_engine\n\nfrom .main import app, get_session  # (1)!\n\n\ndef test_create_hero():\n        # Some code here omitted, we will see it later \ud83d\udc48\n        client = TestClient(app)  # (2)!\n\n        response = client.post(  # (3)!\n            \"/heroes/\", json={\"name\": \"Deadpond\", \"secret_name\": \"Dive Wilson\"}\n        )\n        # Some code here omitted, we will see it later \ud83d\udc48\n        data = response.json()  # (4)!\n\n        assert response.status_code == 200  # (5)!\n        assert data[\"name\"] == \"Deadpond\"  # (6)!\n        assert data[\"secret_name\"] == \"Dive Wilson\"  # (7)!\n        assert data[\"age\"] is None  # (8)!\n        assert data[\"id\"] is not None  # (9)!\n\n# Code below omitted \ud83d\udc47\n</code></pre> <ol> <li> <p>Import the <code>app</code> from the the <code>main</code> module.</p> </li> <li> <p>We create a <code>TestClient</code> for the ReadyAPI <code>app</code> and put it in the variable <code>client</code>.</p> </li> <li> <p>Then we use use this <code>client</code> to talk to the API and send a <code>POST</code> HTTP operation, creating a new hero.</p> </li> <li> <p>Then we get the JSON data from the response and put it in the variable <code>data</code>.</p> </li> <li> <p>Next we start testing the results with <code>assert</code> statements, we check that the status code of the response is <code>200</code>.</p> </li> <li> <p>We check that the <code>name</code> of the hero created is <code>\"Deadpond\"</code>.</p> </li> <li> <p>We check that the <code>secret_name</code> of the hero created is <code>\"Dive Wilson\"</code>.</p> </li> <li> <p>We check that the <code>age</code> of the hero created is <code>None</code>, because we didn't send an age.</p> </li> <li> <p>We check that the hero created has an <code>id</code> created by the database, so it's not <code>None</code>.</p> </li> </ol> <p>Tip</p> <p>Check out the number bubbles to see what is done by each line of code.</p> <p>That's the core of the code we need for all the tests later.</p> <p>But now, we need to deal with a bit of logistics and details we are not paying attention to just yet. \ud83e\udd13</p>"},{"location":"tutorial/readyapi/tests/#testing-database","title":"Testing Database","text":"<p>This test looks fine, but there's a problem.</p> <p>If we run it, it will use the same production database that we are using to store our very important heroes, and we will end up adding unnecessary data to it, or even worse, in future tests we could end up removing production data.</p> <p>So, we should use an independent testing database, just for the tests.</p> <p>To do this, we need to change the URL used for the database.</p> <p>But when the code for the API is executed, it gets a session that is already connected to an engine, and the engine is already using a specific database URL.</p> <p>Even if we import the variable from the <code>main</code> module and change its value just for the tests, by that point the engine is already created with the original value.</p> <p>But all our API path operations get the session using a ReadyAPI dependency, and we can override dependencies in tests.</p> <p>Here's where dependencies start to help a lot.</p>"},{"location":"tutorial/readyapi/tests/#override-a-dependency","title":"Override a Dependency","text":"<p>Let's override the <code>get_session()</code> dependency for the tests.</p> <p>This dependency is used by all the path operations to get the SQLDev session object.</p> <p>We will override it to use a different session object just for the tests.</p> <p>That way we protect the production database and we have better control of the data we are testing.</p> <pre><code>from readyapi.testclient import TestClient\nfrom sqldev import Session, SQLDev, create_engine\n\nfrom .main import app, get_session  # (1)!\n\n\ndef test_create_hero():\n        # Some code here omitted, we will see it later \ud83d\udc48\n        def get_session_override():  # (2)!\n            return session  # (3)!\n\n        app.dependency_overrides[get_session] = get_session_override  # (4)!\n\n        client = TestClient(app)\n\n        response = client.post(\n            \"/heroes/\", json={\"name\": \"Deadpond\", \"secret_name\": \"Dive Wilson\"}\n        )\n        app.dependency_overrides.clear()  # (5)!\n        data = response.json()\n\n        assert response.status_code == 200\n        assert data[\"name\"] == \"Deadpond\"\n        assert data[\"secret_name\"] == \"Dive Wilson\"\n        assert data[\"age\"] is None\n        assert data[\"id\"] is not None\n\n# Code below omitted \ud83d\udc47\n</code></pre> <ol> <li> <p>Import the <code>get_session</code> dependency from the the <code>main</code> module.</p> </li> <li> <p>Define the new function that will be the new dependency override.</p> </li> <li> <p>This function will return a different session than the one that would be returned by the original <code>get_session</code> function.</p> <p>We haven't seen how this new session object is created yet, but the point is that this is a different session than the original one from the app.</p> <p>This session is attached to a different engine, and that different engine uses a different URL, for a database just for testing.</p> <p>We haven't defined that new URL nor the new engine yet, but here we already see the that this object <code>session</code> will override the one returned by the original dependency  <code>get_session()</code>.</p> </li> <li> <p>Then, the ReadyAPI <code>app</code> object has an attribute <code>app.dependency_overrides</code>.</p> <p>This attribute is a dictionary, and we can put dependency overrides in it by passing, as the key, the original dependency function, and as the value, the new overriding dependency function.</p> <p>So, here we are telling the ReadyAPI app to use <code>get_session_override</code> instead of <code>get_session</code> in all the places in the code that depend on <code>get_session</code>, that is, all the parameters with something like:</p> <pre><code>session: Session = Depends(get_session)\n</code></pre> </li> <li> <p>After we are done with the dependency override, we can restore the application back to normal, by removing all the values in this dictionary <code>app.dependency_overrides</code>.</p> <p>This way whenever a path operation function needs the dependency ReadyAPI will use the original one instead of the override.</p> </li> </ol> <p>Tip</p> <p>Check out the number bubbles to see what is done by each line of code.</p>"},{"location":"tutorial/readyapi/tests/#create-the-engine-and-session-for-testing","title":"Create the Engine and Session for Testing","text":"<p>Now let's create that session object that will be used during testing.</p> <p>It will use its own engine, and this new engine will use a new URL for the testing database:</p> <pre><code>sqlite:///testing.db\n</code></pre> <p>So, the testing database will be in the file <code>testing.db</code>.</p> <pre><code>from readyapi.testclient import TestClient\nfrom sqldev import Session, SQLDev, create_engine\n\nfrom .main import app, get_session  # (1)!\n\n\ndef test_create_hero():\n    engine = create_engine(  # (2)!\n        \"sqlite:///testing.db\", connect_args={\"check_same_thread\": False}\n    )\n    SQLDev.metadata.create_all(engine)  # (3)!\n\n    with Session(engine) as session:  # (4)!\n\n        def get_session_override():\n            return session  # (5)!\n\n        app.dependency_overrides[get_session] = get_session_override  # (4)!\n\n        client = TestClient(app)\n\n        response = client.post(\n            \"/heroes/\", json={\"name\": \"Deadpond\", \"secret_name\": \"Dive Wilson\"}\n        )\n        app.dependency_overrides.clear()\n        data = response.json()\n\n        assert response.status_code == 200\n        assert data[\"name\"] == \"Deadpond\"\n        assert data[\"secret_name\"] == \"Dive Wilson\"\n        assert data[\"age\"] is None\n        assert data[\"id\"] is not None\n    # (6)!\n</code></pre> <ol> <li> <p>Here's a subtle thing to notice.</p> <p>Remember that Order Matters and we need to make sure all the SQLDev models are already defined and imported before calling <code>.create_all()</code>.</p> <p>IN this line, by importing something, anything, from <code>.main</code>, the code in <code>.main</code> will be executed, including the definition of the table models, and that will automatically register them in <code>SQLDev.metadata</code>.</p> </li> <li> <p>Here we create a new engine, completely different from the one in <code>main.py</code>.</p> <p>This is the engine we will use for the tests.</p> <p>We use the new URL of the database for tests:</p> <pre><code>sqlite:///testing.db\n</code></pre> <p>And again, we use the connection argument <code>check_same_thread=False</code>.</p> </li> <li> <p>Then we call:</p> <pre><code>SQLDev.metadata.create_all(engine)\n</code></pre> <p>...to make sure we create all the tables in the new testing database.</p> <p>The table models are registered in <code>SQLDev.metadata</code> just because we imported something from <code>.main</code>, and the code in <code>.main</code> was executed, creating the classes for the table models and automatically registering them in <code>SQLDev.metadata</code>.</p> <p>So, by the point we call this method, the table models are already registered there. \ud83d\udcaf</p> </li> <li> <p>Here's where we create the custom session object for this test in a <code>with</code> block.</p> <p>It uses the new custom engine we created, so anything that uses this session will be using the testing database.</p> </li> <li> <p>Now, back to the dependency override, it is just returning the same session object from outside, that's it, that's the whole trick.</p> </li> <li> <p>By this point, the testing session <code>with</code> block finishes, and the session is closed, the file is closed, etc.</p> </li> </ol>"},{"location":"tutorial/readyapi/tests/#import-table-models","title":"Import Table Models","text":"<p>Here we create all the tables in the testing database with:</p> <pre><code>SQLDev.metadata.create_all(engine)\n</code></pre> <p>But remember that Order Matters and we need to make sure all the SQLDev models are already defined and imported before calling <code>.create_all()</code>.</p> <p>In this case, it all works for a little subtlety that deserves some attention.</p> <p>Because we import something, anything, from <code>.main</code>, the code in <code>.main</code> will be executed, including the definition of the table models, and that will automatically register them in <code>SQLDev.metadata</code>.</p> <p>That way, when we call <code>.create_all()</code> all the table models are correctly registered in <code>SQLDev.metadata</code> and it will all work. \ud83d\udc4c</p>"},{"location":"tutorial/readyapi/tests/#memory-database","title":"Memory Database","text":"<p>Now we are not using the production database. Instead, we use a new testing database with the <code>testing.db</code> file, which is great.</p> <p>But SQLite also supports having an in memory database. This means that all the database is only in memory, and it is never saved in a file on disk.</p> <p>After the program terminates, the in-memory database is deleted, so it wouldn't help much for a production database.</p> <p>But it works great for testing, because it can be quickly created before each test, and quickly removed after each test. \u2705</p> <p>And also, because it never has to write anything to a file and it's all just in memory, it will be even faster than normally. \ud83c\udfce</p> Other alternatives and ideas \ud83d\udc40 <p>Before arriving at the idea of using an in-memory database we could have explored other alternatives and ideas.</p> <p>The first is that we are not deleting the file after we finish the test, so the next test could have leftover data. So, the right thing would be to delete the file right after finishing the test. \ud83d\udd25</p> <p>But if each test has to create a new file and then delete it afterwards, running all the tests could be a bit slow.</p> <p>Right now, we have a file <code>testing.db</code> that is used by all the tests (we only have one test now, but we will have more).</p> <p>So, if we tried to run the tests at the same time in parallel to try to speed things up a bit, they would clash trying to use the same <code>testing.db</code> file.</p> <p>Of course, we could also fix that, using some random name for each testing database file... but in the case of SQLite, we have an even better alternative by just using an in-memory database. \u2728</p>"},{"location":"tutorial/readyapi/tests/#configure-the-in-memory-database","title":"Configure the In-Memory Database","text":"<p>Let's update our code to use the in-memory database.</p> <p>We just have to change a couple of parameters in the engine.</p> <pre><code>from readyapi.testclient import TestClient\nfrom sqldev import Session, SQLDev, create_engine\nfrom sqldev.pool import StaticPool  # (1)!\n\nfrom .main import app, get_session\n\n\ndef test_create_hero():\n    engine = create_engine(\n        \"sqlite://\",  # (2)!\n        connect_args={\"check_same_thread\": False},\n        poolclass=StaticPool,  # (3)!\n    )\n\n# Code below omitted \ud83d\udc47\n</code></pre> <ol> <li> <p>Import <code>StaticPool</code> from <code>sqldev</code>, we will use it in a bit.</p> </li> <li> <p>For the SQLite URL, don't write any file name, leave it empty.</p> <p>So, instead of:</p> <pre><code>sqlite:///testing.db\n</code></pre> <p>...just write:</p> <pre><code>sqlite://\n</code></pre> <p>This is enough to tell SQLDev (actually SQLAlchemy) that we want to use an in-memory SQLite database.</p> </li> <li> <p>Remember that we told the low-level library in charge of communicating with SQLite that we want to be able to access the database from different threads with <code>check_same_thread=False</code>?</p> <p>Now that we use an in-memory database, we need to also tell SQLAlchemy that we want to be able to use the same in-memory database object from different threads.</p> <p>We tell it that with the <code>poolclass=StaticPool</code> parameter.</p> <p>Info</p> <p>You can read more details in the SQLAlchemy documentation about Using a Memory Database in Multiple Threads</p> </li> </ol> <p>Tip</p> <p>Check out the number bubbles to see what is done by each line of code.</p> <p>That's it, now the test will run using the in-memory database, which will be faster and probably safer.</p> <p>And all the other tests can do the same.</p>"},{"location":"tutorial/readyapi/tests/#boilerplate-code","title":"Boilerplate Code","text":"<p>Great, that works, and you could replicate all that process in each of the test functions.</p> <p>But we had to add a lot of boilerplate code to handle the custom database, creating it in memory, the custom session, and the dependency override.</p> <p>Do we really have to duplicate all that for each test? No, we can do better! \ud83d\ude0e</p> <p>We are using pytest to run the tests. And pytest also has a very similar concept to the dependencies in ReadyAPI.</p> <p>Info</p> <p>In fact, pytest was one of the things that inspired the design of the dependencies in ReadyAPI.</p> <p>It's a way for us to declare some code that should be run before each test and provide a value for the test function (that's pretty much the same as ReadyAPI dependencies).</p> <p>In fact, it also has the same trick of allowing to use <code>yield</code> instead of <code>return</code> to provide the value, and then pytest makes sure that the code after <code>yield</code> is executed after the function with the test is done.</p> <p>In pytest, these things are called fixtures instead of dependencies.</p> <p>Let's use these fixtures to improve our code and reduce de duplicated boilerplate for the next tests.</p>"},{"location":"tutorial/readyapi/tests/#pytest-fixtures","title":"Pytest Fixtures","text":"<p>You can read more about them in the pytest docs for fixtures, but I'll give you a short example for what we need here.</p> <p>Let's see the first code example with a fixture:</p> <pre><code>import pytest  # (1)!\nfrom readyapi.testclient import TestClient\nfrom sqldev import Session, SQLDev, create_engine\nfrom sqldev.pool import StaticPool\n\nfrom .main import app, get_session\n\n\n@pytest.fixture(name=\"session\")  # (2)!\ndef session_fixture():  # (3)!\n    engine = create_engine(\n        \"sqlite://\", connect_args={\"check_same_thread\": False}, poolclass=StaticPool\n    )\n    SQLDev.metadata.create_all(engine)\n    with Session(engine) as session:\n        yield session  # (4)!\n\n\ndef test_create_hero(session: Session):  # (5)!\n    def get_session_override():\n        return session  # (6)!\n\n    app.dependency_overrides[get_session] = get_session_override\n\n    client = TestClient(app)\n\n    response = client.post(\n        \"/heroes/\", json={\"name\": \"Deadpond\", \"secret_name\": \"Dive Wilson\"}\n    )\n    app.dependency_overrides.clear()\n    data = response.json()\n\n    assert response.status_code == 200\n    assert data[\"name\"] == \"Deadpond\"\n    assert data[\"secret_name\"] == \"Dive Wilson\"\n    assert data[\"age\"] is None\n    assert data[\"id\"] is not None\n</code></pre> <ol> <li> <p>Import <code>pytest</code>.</p> </li> <li> <p>Use the <code>@pytest.fixture()</code> decorator on top of the function to tell pytest that this is a fixture function (equivalent to a ReadyAPI dependency).</p> <p>We also give it a name of <code>\"session\"</code>, this will be important in the testing function.</p> </li> <li> <p>Create the fixture function. This is equivalent to a ReadyAPI dependency function.</p> <p>In this fixture we create the custom engine, with the in-memory database, we create the tables, and we create the session.</p> <p>Then we <code>yield</code> the <code>session</code> object.</p> </li> <li> <p>The thing that we <code>return</code> or <code>yield</code> is what will be available to the test function, in this case, the <code>session</code> object.</p> <p>Here we use <code>yield</code> so that pytest comes back to execute \"the rest of the code\" in this function once the testing function is done.</p> <p>We don't have any more visible \"rest of the code\" after the <code>yield</code>, but we have the end of the <code>with</code> block that will close the session.</p> <p>By using <code>yield</code>, pytest will:</p> <ul> <li>run the first part</li> <li>create the session object</li> <li>give it to the test function</li> <li>run the test function</li> <li>once the test function is done, it will continue here, right after the <code>yield</code>, and will correctly close the session object in the end of the <code>with</code> block.</li> </ul> </li> <li> <p>Now, in the test function, to tell pytest that this test wants to get the fixture, instead of declaring something like in ReadyAPI with:</p> <pre><code>session: Session = Depends(session_fixture)\n</code></pre> <p>...the way we tell pytest what is the fixture that we want is by using the exact same name of the fixture.</p> <p>In this case, we named it <code>session</code>, so the parameter has to be exactly named <code>session</code> for it to work.</p> <p>We also add the type annotation <code>session: Session</code> so that we can get autocompletion and inline error checks in our editor.</p> </li> <li> <p>Now in the dependency override function, we just return the same <code>session</code> object that came from outside it.</p> <p>The <code>session</code> object comes from the parameter passed to the test function, and we just re-use it and return it here in the dependency override.</p> </li> </ol> <p>Tip</p> <p>Check out the number bubbles to see what is done by each line of code.</p> <p>pytest fixtures work in a very similar way to ReadyAPI dependencies, but have some minor differences:</p> <ul> <li>In pytest fixtures, we need to add a decorator of <code>@pytest.fixture()</code> on top.</li> <li>To use a pytest fixture in a function, we have to declare the parameter with the exact same name. In ReadyAPI we have to explicitly use <code>Depends()</code> with the actual function inside it.</li> </ul> <p>But apart from the way we declare them and how we tell the framework that we want to have them in the function, they work in a very similar way.</p> <p>Now we create lot's of tests and re-use that same fixture in all of them, saving us that boilerplate code.</p> <p>pytest will make sure to run them right before (and finish them right after) each test function. So, each test function will actually have its own database, engine, and session.</p>"},{"location":"tutorial/readyapi/tests/#client-fixture","title":"Client Fixture","text":"<p>Awesome, that fixture helps us prevent a lot of duplicated code.</p> <p>But currently, we still have to write some code in the test function that will be repetitive for other tests, right now we:</p> <ul> <li>create the dependency override</li> <li>put it in the <code>app.dependency_overrides</code></li> <li>create the <code>TestClient</code></li> <li>Clear the dependency override(s) after making the request</li> </ul> <p>That's still gonna be repetitive in the other future tests. Can we improve it? Yes! \ud83c\udf89</p> <p>Each pytest fixture (the same way as ReadyAPI dependencies), can require other fixtures.</p> <p>So, we can create a client fixture that will be used in all the tests, and it will itself require the session fixture.</p> <pre><code>import pytest\nfrom readyapi.testclient import TestClient\nfrom sqldev import Session, SQLDev, create_engine\nfrom sqldev.pool import StaticPool\n\nfrom .main import app, get_session\n\n\n@pytest.fixture(name=\"session\")\ndef session_fixture():\n    engine = create_engine(\n        \"sqlite://\", connect_args={\"check_same_thread\": False}, poolclass=StaticPool\n    )\n    SQLDev.metadata.create_all(engine)\n    with Session(engine) as session:\n        yield session\n\n\n@pytest.fixture(name=\"client\")  # (1)!\ndef client_fixture(session: Session):  # (2)!\n    def get_session_override():  # (3)!\n        return session\n\n    app.dependency_overrides[get_session] = get_session_override  # (4)!\n\n    client = TestClient(app)  # (5)!\n    yield client  # (6)!\n    app.dependency_overrides.clear()  # (7)!\n\n\ndef test_create_hero(client: TestClient):  # (8)!\n    response = client.post(\n        \"/heroes/\", json={\"name\": \"Deadpond\", \"secret_name\": \"Dive Wilson\"}\n    )\n    data = response.json()\n\n    assert response.status_code == 200\n    assert data[\"name\"] == \"Deadpond\"\n    assert data[\"secret_name\"] == \"Dive Wilson\"\n    assert data[\"age\"] is None\n    assert data[\"id\"] is not None\n</code></pre> <ol> <li> <p>Create the new fixture named <code>\"client\"</code>.</p> </li> <li> <p>This client fixture, in turn, also requires the session fixture.</p> </li> <li> <p>Now we create the dependency override inside the client fixture.</p> </li> <li> <p>Set the dependency override in the <code>app.dependency_overrides</code> dictionary.</p> </li> <li> <p>Create the <code>TestClient</code> with the ReadyAPI <code>app</code>.</p> </li> <li> <p><code>yield</code> the <code>TestClient</code> instance.</p> <p>By using <code>yield</code>, after the test function is done, pytest will come back to execute the rest of the code after <code>yield</code>.</p> </li> <li> <p>This is the cleanup code, after <code>yield</code>, and after the test function is done.</p> <p>Here we clear the dependency overrides (here it's only one) in the ReadyAPI <code>app</code>.</p> </li> <li> <p>Now the test function requires the client fixture.</p> <p>And inside the test function, the code is quite simple, we just use the <code>TestClient</code> to make requests to the API, check the data, and that's it.</p> <p>The fixtures take care of all the setup and cleanup code.</p> </li> </ol> <p>Tip</p> <p>Check out the number bubbles to see what is done by each line of code.</p> <p>Now we have a client fixture that, in turn, uses the session fixture.</p> <p>And in the actual test function, we just have to declare that we require this client fixture.</p>"},{"location":"tutorial/readyapi/tests/#add-more-tests","title":"Add More Tests","text":"<p>At this point, it all might seem like we just did a lot of changes for nothing, to get the same result. \ud83e\udd14</p> <p>But normally we will create lots of other test functions. And now all the boilerplate and complexity is written only once, in those two fixtures.</p> <p>Let's add some more tests:</p> <pre><code># Code above omitted \ud83d\udc46\n\ndef test_create_hero(client: TestClient):\n    response = client.post(\n        \"/heroes/\", json={\"name\": \"Deadpond\", \"secret_name\": \"Dive Wilson\"}\n    )\n    data = response.json()\n\n    assert response.status_code == 200\n    assert data[\"name\"] == \"Deadpond\"\n    assert data[\"secret_name\"] == \"Dive Wilson\"\n    assert data[\"age\"] is None\n    assert data[\"id\"] is not None\n\n\ndef test_create_hero_incomplete(client: TestClient):\n    # No secret_name\n    response = client.post(\"/heroes/\", json={\"name\": \"Deadpond\"})\n    assert response.status_code == 422\n\n\ndef test_create_hero_invalid(client: TestClient):\n    # secret_name has an invalid type\n    response = client.post(\n        \"/heroes/\",\n        json={\n            \"name\": \"Deadpond\",\n            \"secret_name\": {\"message\": \"Do you wanna know my secret identity?\"},\n        },\n    )\n    assert response.status_code == 422\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview <pre><code>import pytest\nfrom readyapi.testclient import TestClient\nfrom sqldev import Session, SQLDev, create_engine\nfrom sqldev.pool import StaticPool\n\nfrom .main import Hero, app, get_session\n\n\n@pytest.fixture(name=\"session\")\ndef session_fixture():\n    engine = create_engine(\n        \"sqlite://\", connect_args={\"check_same_thread\": False}, poolclass=StaticPool\n    )\n    SQLDev.metadata.create_all(engine)\n    with Session(engine) as session:\n        yield session\n\n\n@pytest.fixture(name=\"client\")\ndef client_fixture(session: Session):\n    def get_session_override():\n        return session\n\n    app.dependency_overrides[get_session] = get_session_override\n    client = TestClient(app)\n    yield client\n    app.dependency_overrides.clear()\n\n\ndef test_create_hero(client: TestClient):\n    response = client.post(\n        \"/heroes/\", json={\"name\": \"Deadpond\", \"secret_name\": \"Dive Wilson\"}\n    )\n    data = response.json()\n\n    assert response.status_code == 200\n    assert data[\"name\"] == \"Deadpond\"\n    assert data[\"secret_name\"] == \"Dive Wilson\"\n    assert data[\"age\"] is None\n    assert data[\"id\"] is not None\n\n\ndef test_create_hero_incomplete(client: TestClient):\n    # No secret_name\n    response = client.post(\"/heroes/\", json={\"name\": \"Deadpond\"})\n    assert response.status_code == 422\n\n\ndef test_create_hero_invalid(client: TestClient):\n    # secret_name has an invalid type\n    response = client.post(\n        \"/heroes/\",\n        json={\n            \"name\": \"Deadpond\",\n            \"secret_name\": {\"message\": \"Do you wanna know my secret identity?\"},\n        },\n    )\n    assert response.status_code == 422\n\n\ndef test_read_heroes(session: Session, client: TestClient):\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    session.add(hero_1)\n    session.add(hero_2)\n    session.commit()\n\n    response = client.get(\"/heroes/\")\n    data = response.json()\n\n    assert response.status_code == 200\n\n    assert len(data) == 2\n    assert data[0][\"name\"] == hero_1.name\n    assert data[0][\"secret_name\"] == hero_1.secret_name\n    assert data[0][\"age\"] == hero_1.age\n    assert data[0][\"id\"] == hero_1.id\n    assert data[1][\"name\"] == hero_2.name\n    assert data[1][\"secret_name\"] == hero_2.secret_name\n    assert data[1][\"age\"] == hero_2.age\n    assert data[1][\"id\"] == hero_2.id\n\n\ndef test_read_hero(session: Session, client: TestClient):\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    session.add(hero_1)\n    session.commit()\n\n    response = client.get(f\"/heroes/{hero_1.id}\")\n    data = response.json()\n\n    assert response.status_code == 200\n    assert data[\"name\"] == hero_1.name\n    assert data[\"secret_name\"] == hero_1.secret_name\n    assert data[\"age\"] == hero_1.age\n    assert data[\"id\"] == hero_1.id\n\n\ndef test_update_hero(session: Session, client: TestClient):\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    session.add(hero_1)\n    session.commit()\n\n    response = client.patch(f\"/heroes/{hero_1.id}\", json={\"name\": \"Deadpuddle\"})\n    data = response.json()\n\n    assert response.status_code == 200\n    assert data[\"name\"] == \"Deadpuddle\"\n    assert data[\"secret_name\"] == \"Dive Wilson\"\n    assert data[\"age\"] is None\n    assert data[\"id\"] == hero_1.id\n\n\ndef test_delete_hero(session: Session, client: TestClient):\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    session.add(hero_1)\n    session.commit()\n\n    response = client.delete(f\"/heroes/{hero_1.id}\")\n\n    hero_in_db = session.get(Hero, hero_1.id)\n\n    assert response.status_code == 200\n\n    assert hero_in_db is None\n</code></pre> <p>Tip</p> <p>It's always good idea to not only test the normal case, but also that invalid data, errors, and corner cases are handled correctly.</p> <p>That's why we add these two extra tests here.</p> <p>Now, any additional test functions can be as simple as the first one, they just have to declare the <code>client</code> parameter to get the <code>TestClient</code> fixture with all the database stuff setup. Nice! \ud83d\ude0e</p>"},{"location":"tutorial/readyapi/tests/#why-two-fixtures","title":"Why Two Fixtures","text":"<p>Now, seeing the code, we could think, why do we put two fixtures instead of just one with all the code? And that makes total sense!</p> <p>For these examples, that would have been simpler, there's no need to separate that code into two fixtures for them...</p> <p>But for the next test function, we will require both fixtures, the client and the session.</p> <pre><code>import pytest\nfrom readyapi.testclient import TestClient\nfrom sqldev import Session, SQLDev, create_engine\nfrom sqldev.pool import StaticPool\n\nfrom .main import Hero, app, get_session\n\n# Code here omitted \ud83d\udc48\n\ndef test_read_heroes(session: Session, client: TestClient):\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    session.add(hero_1)\n    session.add(hero_2)\n    session.commit()\n\n    response = client.get(\"/heroes/\")\n    data = response.json()\n\n    assert response.status_code == 200\n\n    assert len(data) == 2\n    assert data[0][\"name\"] == hero_1.name\n    assert data[0][\"secret_name\"] == hero_1.secret_name\n    assert data[0][\"age\"] == hero_1.age\n    assert data[0][\"id\"] == hero_1.id\n    assert data[1][\"name\"] == hero_2.name\n    assert data[1][\"secret_name\"] == hero_2.secret_name\n    assert data[1][\"age\"] == hero_2.age\n    assert data[1][\"id\"] == hero_2.id\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview <pre><code>import pytest\nfrom readyapi.testclient import TestClient\nfrom sqldev import Session, SQLDev, create_engine\nfrom sqldev.pool import StaticPool\n\nfrom .main import Hero, app, get_session\n\n\n@pytest.fixture(name=\"session\")\ndef session_fixture():\n    engine = create_engine(\n        \"sqlite://\", connect_args={\"check_same_thread\": False}, poolclass=StaticPool\n    )\n    SQLDev.metadata.create_all(engine)\n    with Session(engine) as session:\n        yield session\n\n\n@pytest.fixture(name=\"client\")\ndef client_fixture(session: Session):\n    def get_session_override():\n        return session\n\n    app.dependency_overrides[get_session] = get_session_override\n    client = TestClient(app)\n    yield client\n    app.dependency_overrides.clear()\n\n\ndef test_create_hero(client: TestClient):\n    response = client.post(\n        \"/heroes/\", json={\"name\": \"Deadpond\", \"secret_name\": \"Dive Wilson\"}\n    )\n    data = response.json()\n\n    assert response.status_code == 200\n    assert data[\"name\"] == \"Deadpond\"\n    assert data[\"secret_name\"] == \"Dive Wilson\"\n    assert data[\"age\"] is None\n    assert data[\"id\"] is not None\n\n\ndef test_create_hero_incomplete(client: TestClient):\n    # No secret_name\n    response = client.post(\"/heroes/\", json={\"name\": \"Deadpond\"})\n    assert response.status_code == 422\n\n\ndef test_create_hero_invalid(client: TestClient):\n    # secret_name has an invalid type\n    response = client.post(\n        \"/heroes/\",\n        json={\n            \"name\": \"Deadpond\",\n            \"secret_name\": {\"message\": \"Do you wanna know my secret identity?\"},\n        },\n    )\n    assert response.status_code == 422\n\n\ndef test_read_heroes(session: Session, client: TestClient):\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    session.add(hero_1)\n    session.add(hero_2)\n    session.commit()\n\n    response = client.get(\"/heroes/\")\n    data = response.json()\n\n    assert response.status_code == 200\n\n    assert len(data) == 2\n    assert data[0][\"name\"] == hero_1.name\n    assert data[0][\"secret_name\"] == hero_1.secret_name\n    assert data[0][\"age\"] == hero_1.age\n    assert data[0][\"id\"] == hero_1.id\n    assert data[1][\"name\"] == hero_2.name\n    assert data[1][\"secret_name\"] == hero_2.secret_name\n    assert data[1][\"age\"] == hero_2.age\n    assert data[1][\"id\"] == hero_2.id\n\n\ndef test_read_hero(session: Session, client: TestClient):\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    session.add(hero_1)\n    session.commit()\n\n    response = client.get(f\"/heroes/{hero_1.id}\")\n    data = response.json()\n\n    assert response.status_code == 200\n    assert data[\"name\"] == hero_1.name\n    assert data[\"secret_name\"] == hero_1.secret_name\n    assert data[\"age\"] == hero_1.age\n    assert data[\"id\"] == hero_1.id\n\n\ndef test_update_hero(session: Session, client: TestClient):\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    session.add(hero_1)\n    session.commit()\n\n    response = client.patch(f\"/heroes/{hero_1.id}\", json={\"name\": \"Deadpuddle\"})\n    data = response.json()\n\n    assert response.status_code == 200\n    assert data[\"name\"] == \"Deadpuddle\"\n    assert data[\"secret_name\"] == \"Dive Wilson\"\n    assert data[\"age\"] is None\n    assert data[\"id\"] == hero_1.id\n\n\ndef test_delete_hero(session: Session, client: TestClient):\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    session.add(hero_1)\n    session.commit()\n\n    response = client.delete(f\"/heroes/{hero_1.id}\")\n\n    hero_in_db = session.get(Hero, hero_1.id)\n\n    assert response.status_code == 200\n\n    assert hero_in_db is None\n</code></pre> <p>In this test function, we want to check that the path operation to read a list of heroes actually sends us heroes.</p> <p>But if the database is empty, we would get an empty list, and we wouldn't know if the hero data is being sent correctly or not.</p> <p>But we can create some heroes in the testing database right before sending the API request. \u2728</p> <p>And because we are using the testing database, we don't affect anything by creating heroes for the test.</p> <p>To do it, we have to:</p> <ul> <li>import the <code>Hero</code> model</li> <li>require both fixtures, the client and the session</li> <li>create some heroes and save them in the database using the session</li> </ul> <p>After that, we can send the request and check that we actually got the data back correctly from the database. \ud83d\udcaf</p> <p>Here's the important detail to notice: we can require fixtures in other fixtures and also in the test functions.</p> <p>The function for the client fixture and the actual testing function will both receive the same session.</p>"},{"location":"tutorial/readyapi/tests/#add-the-rest-of-the-tests","title":"Add the Rest of the Tests","text":"<p>Using the same ideas, requiring the fixtures, creating data that we need for the tests, etc., we can now add the rest of the tests. They look quite similar to what we have done up to now.</p> <pre><code># Code above omitted \ud83d\udc46\n\ndef test_read_hero(session: Session, client: TestClient):\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    session.add(hero_1)\n    session.commit()\n\n    response = client.get(f\"/heroes/{hero_1.id}\")\n    data = response.json()\n\n    assert response.status_code == 200\n    assert data[\"name\"] == hero_1.name\n    assert data[\"secret_name\"] == hero_1.secret_name\n    assert data[\"age\"] == hero_1.age\n    assert data[\"id\"] == hero_1.id\n\n\ndef test_update_hero(session: Session, client: TestClient):\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    session.add(hero_1)\n    session.commit()\n\n    response = client.patch(f\"/heroes/{hero_1.id}\", json={\"name\": \"Deadpuddle\"})\n    data = response.json()\n\n    assert response.status_code == 200\n    assert data[\"name\"] == \"Deadpuddle\"\n    assert data[\"secret_name\"] == \"Dive Wilson\"\n    assert data[\"age\"] is None\n    assert data[\"id\"] == hero_1.id\n\n\ndef test_delete_hero(session: Session, client: TestClient):\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    session.add(hero_1)\n    session.commit()\n\n    response = client.delete(f\"/heroes/{hero_1.id}\")\n\n    hero_in_db = session.get(Hero, hero_1.id)\n\n    assert response.status_code == 200\n\n    assert hero_in_db is None\n</code></pre> \ud83d\udc40 Full file preview <pre><code>import pytest\nfrom readyapi.testclient import TestClient\nfrom sqldev import Session, SQLDev, create_engine\nfrom sqldev.pool import StaticPool\n\nfrom .main import Hero, app, get_session\n\n\n@pytest.fixture(name=\"session\")\ndef session_fixture():\n    engine = create_engine(\n        \"sqlite://\", connect_args={\"check_same_thread\": False}, poolclass=StaticPool\n    )\n    SQLDev.metadata.create_all(engine)\n    with Session(engine) as session:\n        yield session\n\n\n@pytest.fixture(name=\"client\")\ndef client_fixture(session: Session):\n    def get_session_override():\n        return session\n\n    app.dependency_overrides[get_session] = get_session_override\n    client = TestClient(app)\n    yield client\n    app.dependency_overrides.clear()\n\n\ndef test_create_hero(client: TestClient):\n    response = client.post(\n        \"/heroes/\", json={\"name\": \"Deadpond\", \"secret_name\": \"Dive Wilson\"}\n    )\n    data = response.json()\n\n    assert response.status_code == 200\n    assert data[\"name\"] == \"Deadpond\"\n    assert data[\"secret_name\"] == \"Dive Wilson\"\n    assert data[\"age\"] is None\n    assert data[\"id\"] is not None\n\n\ndef test_create_hero_incomplete(client: TestClient):\n    # No secret_name\n    response = client.post(\"/heroes/\", json={\"name\": \"Deadpond\"})\n    assert response.status_code == 422\n\n\ndef test_create_hero_invalid(client: TestClient):\n    # secret_name has an invalid type\n    response = client.post(\n        \"/heroes/\",\n        json={\n            \"name\": \"Deadpond\",\n            \"secret_name\": {\"message\": \"Do you wanna know my secret identity?\"},\n        },\n    )\n    assert response.status_code == 422\n\n\ndef test_read_heroes(session: Session, client: TestClient):\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    hero_2 = Hero(name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48)\n    session.add(hero_1)\n    session.add(hero_2)\n    session.commit()\n\n    response = client.get(\"/heroes/\")\n    data = response.json()\n\n    assert response.status_code == 200\n\n    assert len(data) == 2\n    assert data[0][\"name\"] == hero_1.name\n    assert data[0][\"secret_name\"] == hero_1.secret_name\n    assert data[0][\"age\"] == hero_1.age\n    assert data[0][\"id\"] == hero_1.id\n    assert data[1][\"name\"] == hero_2.name\n    assert data[1][\"secret_name\"] == hero_2.secret_name\n    assert data[1][\"age\"] == hero_2.age\n    assert data[1][\"id\"] == hero_2.id\n\n\ndef test_read_hero(session: Session, client: TestClient):\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    session.add(hero_1)\n    session.commit()\n\n    response = client.get(f\"/heroes/{hero_1.id}\")\n    data = response.json()\n\n    assert response.status_code == 200\n    assert data[\"name\"] == hero_1.name\n    assert data[\"secret_name\"] == hero_1.secret_name\n    assert data[\"age\"] == hero_1.age\n    assert data[\"id\"] == hero_1.id\n\n\ndef test_update_hero(session: Session, client: TestClient):\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    session.add(hero_1)\n    session.commit()\n\n    response = client.patch(f\"/heroes/{hero_1.id}\", json={\"name\": \"Deadpuddle\"})\n    data = response.json()\n\n    assert response.status_code == 200\n    assert data[\"name\"] == \"Deadpuddle\"\n    assert data[\"secret_name\"] == \"Dive Wilson\"\n    assert data[\"age\"] is None\n    assert data[\"id\"] == hero_1.id\n\n\ndef test_delete_hero(session: Session, client: TestClient):\n    hero_1 = Hero(name=\"Deadpond\", secret_name=\"Dive Wilson\")\n    session.add(hero_1)\n    session.commit()\n\n    response = client.delete(f\"/heroes/{hero_1.id}\")\n\n    hero_in_db = session.get(Hero, hero_1.id)\n\n    assert response.status_code == 200\n\n    assert hero_in_db is None\n</code></pre>"},{"location":"tutorial/readyapi/tests/#run-the-tests","title":"Run the Tests","text":"<p>Now we can run the tests with <code>pytest</code> and see the results:</p> <pre><code>$ pytest\n\n============= test session starts ==============\nplatform linux -- Python 3.7.5, pytest-6.2.4, py-1.10.0, pluggy-0.13.1\nrootdir: /home/user/code/sqldev-tutorial\n&lt;b&gt;collected 7 items                              &lt;/b&gt;\n\n---&gt; 100%\n\nproject/test_main.py &lt;font color=\"#A6E22E\"&gt;.......         [100%]&lt;/font&gt;\n\n&lt;font color=\"#A6E22E\"&gt;============== &lt;/font&gt;&lt;font color=\"#A6E22E\"&gt;&lt;b&gt;7 passed&lt;/b&gt;&lt;/font&gt;&lt;font color=\"#A6E22E\"&gt; in 0.83s ===============&lt;/font&gt;\n</code></pre>"},{"location":"tutorial/readyapi/tests/#recap","title":"Recap","text":"<p>Did you read all that? Wow, I'm impressed! \ud83d\ude0e</p> <p>Adding tests to your application will give you a lot of certainty that everything is working correctly, as you intended.</p> <p>And tests will be notoriously useful when refactoring your code, changing things, adding features. Because tests can help catch a lot of errors that can be easily introduced by refactoring.</p> <p>And they will give you the confidence to work faster and more efficiently, because you know that you are checking if you are not breaking anything. \ud83d\ude05</p> <p>I think tests are one of those things that bring your code and you as a developer to the next professional level. \ud83d\ude0e</p> <p>And if you read and studied all this, you already know a lot of the advanced ideas and tricks that took me years to learn. \ud83d\ude80</p>"},{"location":"tutorial/readyapi/update-extra-data/","title":"Update with Extra Data (Hashed Passwords) with ReadyAPI","text":"<p>In the previous chapter I explained to you how to update data in the database from input data coming from a ReadyAPI path operation.</p> <p>Now I'll explain to you how to add extra data, additional to the input data, when updating or creating a model object.</p> <p>This is particularly useful when you need to generate some data in your code that is not coming from the client, but you need to store it in the database. For example, to store a hashed password.</p>"},{"location":"tutorial/readyapi/update-extra-data/#password-hashing","title":"Password Hashing","text":"<p>Let's imagine that each hero in our system also has a password.</p> <p>We should never store the password in plain text in the database, we should only stored a hashed version of it.</p> <p>\"Hashing\" means converting some content (a password in this case) into a sequence of bytes (just a string) that looks like gibberish.</p> <p>Whenever you pass exactly the same content (exactly the same password) you get exactly the same gibberish.</p> <p>But you cannot convert from the gibberish back to the password.</p>"},{"location":"tutorial/readyapi/update-extra-data/#why-use-password-hashing","title":"Why use Password Hashing","text":"<p>If your database is stolen, the thief won't have your users' plaintext passwords, only the hashes.</p> <p>So, the thief won't be able to try to use that password in another system (as many users use the same password everywhere, this would be dangerous).</p> <p>Tip</p> <p>You could use passlib to hash passwords.</p> <p>In this example we will use a fake hashing function to focus on the data changes. \ud83e\udd21</p>"},{"location":"tutorial/readyapi/update-extra-data/#update-models-with-extra-data","title":"Update Models with Extra Data","text":"<p>The <code>Hero</code> table model will now store a new field <code>hashed_password</code>.</p> <p>And the data models for <code>HeroCreate</code> and <code>HeroUpdate</code> will also have a new field <code>password</code> that will contain the plain text password sent by clients.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    hashed_password: str = Field()\n\n\nclass HeroCreate(HeroBase):\n    password: str\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n    password: str | None = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    hashed_password: str = Field()\n\n\nclass HeroCreate(HeroBase):\n    password: str\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    password: Optional[str] = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    hashed_password: str = Field()\n\n\nclass HeroCreate(HeroBase):\n    password: str\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    password: Optional[str] = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    hashed_password: str = Field()\n\n\nclass HeroCreate(HeroBase):\n    password: str\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n    password: str | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef hash_password(password: str) -&gt; str:\n    # Use something like passlib here\n    return f\"not really hashed {password} hehehe\"\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n    with Session(engine) as session:\n        extra_data = {\"hashed_password\": hashed_password}\n        db_hero = Hero.model_validate(hero, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        extra_data = {}\n        if \"password\" in hero_data:\n            password = hero_data[\"password\"]\n            hashed_password = hash_password(password)\n            extra_data[\"hashed_password\"] = hashed_password\n        db_hero.sqldev_update(hero_data, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    hashed_password: str = Field()\n\n\nclass HeroCreate(HeroBase):\n    password: str\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    password: Optional[str] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef hash_password(password: str) -&gt; str:\n    # Use something like passlib here\n    return f\"not really hashed {password} hehehe\"\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n    with Session(engine) as session:\n        extra_data = {\"hashed_password\": hashed_password}\n        db_hero = Hero.model_validate(hero, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        extra_data = {}\n        if \"password\" in hero_data:\n            password = hero_data[\"password\"]\n            hashed_password = hash_password(password)\n            extra_data[\"hashed_password\"] = hashed_password\n        db_hero.sqldev_update(hero_data, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    hashed_password: str = Field()\n\n\nclass HeroCreate(HeroBase):\n    password: str\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    password: Optional[str] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef hash_password(password: str) -&gt; str:\n    # Use something like passlib here\n    return f\"not really hashed {password} hehehe\"\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n    with Session(engine) as session:\n        extra_data = {\"hashed_password\": hashed_password}\n        db_hero = Hero.model_validate(hero, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        extra_data = {}\n        if \"password\" in hero_data:\n            password = hero_data[\"password\"]\n            hashed_password = hash_password(password)\n            extra_data[\"hashed_password\"] = hashed_password\n        db_hero.sqldev_update(hero_data, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <p>When a client is creating a new hero, they will send the <code>password</code> in the request body.</p> <p>And when they are updating a hero, they could also send the <code>password</code> in the request body to update it.</p>"},{"location":"tutorial/readyapi/update-extra-data/#hash-the-password","title":"Hash the Password","text":"<p>The app will receive the data from the client using the <code>HeroCreate</code> model.</p> <p>This contains the <code>password</code> field with the plain text password, and we cannot use that one. So we need to generate a hash from it.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef hash_password(password: str) -&gt; str:\n    # Use something like passlib here\n    return f\"not really hashed {password} hehehe\"\n\n# Code here omitted \ud83d\udc48\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef hash_password(password: str) -&gt; str:\n    # Use something like passlib here\n    return f\"not really hashed {password} hehehe\"\n\n# Code here omitted \ud83d\udc48\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef hash_password(password: str) -&gt; str:\n    # Use something like passlib here\n    return f\"not really hashed {password} hehehe\"\n\n# Code here omitted \ud83d\udc48\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    hashed_password: str = Field()\n\n\nclass HeroCreate(HeroBase):\n    password: str\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n    password: str | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef hash_password(password: str) -&gt; str:\n    # Use something like passlib here\n    return f\"not really hashed {password} hehehe\"\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n    with Session(engine) as session:\n        extra_data = {\"hashed_password\": hashed_password}\n        db_hero = Hero.model_validate(hero, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        extra_data = {}\n        if \"password\" in hero_data:\n            password = hero_data[\"password\"]\n            hashed_password = hash_password(password)\n            extra_data[\"hashed_password\"] = hashed_password\n        db_hero.sqldev_update(hero_data, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    hashed_password: str = Field()\n\n\nclass HeroCreate(HeroBase):\n    password: str\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    password: Optional[str] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef hash_password(password: str) -&gt; str:\n    # Use something like passlib here\n    return f\"not really hashed {password} hehehe\"\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n    with Session(engine) as session:\n        extra_data = {\"hashed_password\": hashed_password}\n        db_hero = Hero.model_validate(hero, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        extra_data = {}\n        if \"password\" in hero_data:\n            password = hero_data[\"password\"]\n            hashed_password = hash_password(password)\n            extra_data[\"hashed_password\"] = hashed_password\n        db_hero.sqldev_update(hero_data, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    hashed_password: str = Field()\n\n\nclass HeroCreate(HeroBase):\n    password: str\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    password: Optional[str] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef hash_password(password: str) -&gt; str:\n    # Use something like passlib here\n    return f\"not really hashed {password} hehehe\"\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n    with Session(engine) as session:\n        extra_data = {\"hashed_password\": hashed_password}\n        db_hero = Hero.model_validate(hero, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        extra_data = {}\n        if \"password\" in hero_data:\n            password = hero_data[\"password\"]\n            hashed_password = hash_password(password)\n            extra_data[\"hashed_password\"] = hashed_password\n        db_hero.sqldev_update(hero_data, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre>"},{"location":"tutorial/readyapi/update-extra-data/#create-an-object-with-extra-data","title":"Create an Object with Extra Data","text":"<p>Now we need to create the database hero.</p> <p>In previous examples, we have used something like:</p> <pre><code>db_hero = Hero.model_validate(hero)\n</code></pre> <p>This creates a <code>Hero</code> (which is a table model) object from the <code>HeroCreate</code> (which is a data model) object that we received in the request.</p> <p>And this is all good... but as <code>Hero</code> doesn't have a field <code>password</code>, it won't be extracted from the object <code>HeroCreate</code> that has it.</p> <p><code>Hero</code> actually has a <code>hashed_password</code>, but we are not providing it. We need a way to provide it...</p>"},{"location":"tutorial/readyapi/update-extra-data/#dictionary-update","title":"Dictionary Update","text":"<p>Let's pause for a second to check this, when working with dictionaries, there's a way to <code>update</code> a dictionary with extra data from another dictionary, something like this:</p> <pre><code>db_user_dict = {\n    \"name\": \"Deadpond\",\n    \"secret_name\": \"Dive Wilson\",\n    \"age\": None,\n}\n\nhashed_password = \"fakehashedpassword\"\n\nextra_data = {\n    \"hashed_password\": hashed_password,\n    \"age\": 32,\n}\n\ndb_user_dict.update(extra_data)\n\nprint(db_user_dict)\n\n# {\n#     \"name\": \"Deadpond\",\n#     \"secret_name\": \"Dive Wilson\",\n#     \"age\": 32,\n#     \"hashed_password\": \"fakehashedpassword\",\n# }\n</code></pre> <p>This <code>update</code> method allows us to add and override things in the original dictionary with the data from another dictionary.</p> <p>So now, <code>db_user_dict</code> has the updated <code>age</code> field with <code>32</code> instead of <code>None</code> and more importantly, it has the new <code>hashed_password</code> field.</p>"},{"location":"tutorial/readyapi/update-extra-data/#create-a-model-object-with-extra-data","title":"Create a Model Object with Extra Data","text":"<p>Similar to how dictionaries have an <code>update</code> method, SQLDev models have a parameter <code>update</code> in <code>Hero.model_validate()</code> that takes a dictionary with extra data, or data that should take precedence:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n    with Session(engine) as session:\n        extra_data = {\"hashed_password\": hashed_password}\n        db_hero = Hero.model_validate(hero, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n    with Session(engine) as session:\n        extra_data = {\"hashed_password\": hashed_password}\n        db_hero = Hero.model_validate(hero, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n    with Session(engine) as session:\n        extra_data = {\"hashed_password\": hashed_password}\n        db_hero = Hero.model_validate(hero, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    hashed_password: str = Field()\n\n\nclass HeroCreate(HeroBase):\n    password: str\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n    password: str | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef hash_password(password: str) -&gt; str:\n    # Use something like passlib here\n    return f\"not really hashed {password} hehehe\"\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n    with Session(engine) as session:\n        extra_data = {\"hashed_password\": hashed_password}\n        db_hero = Hero.model_validate(hero, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        extra_data = {}\n        if \"password\" in hero_data:\n            password = hero_data[\"password\"]\n            hashed_password = hash_password(password)\n            extra_data[\"hashed_password\"] = hashed_password\n        db_hero.sqldev_update(hero_data, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    hashed_password: str = Field()\n\n\nclass HeroCreate(HeroBase):\n    password: str\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    password: Optional[str] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef hash_password(password: str) -&gt; str:\n    # Use something like passlib here\n    return f\"not really hashed {password} hehehe\"\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n    with Session(engine) as session:\n        extra_data = {\"hashed_password\": hashed_password}\n        db_hero = Hero.model_validate(hero, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        extra_data = {}\n        if \"password\" in hero_data:\n            password = hero_data[\"password\"]\n            hashed_password = hash_password(password)\n            extra_data[\"hashed_password\"] = hashed_password\n        db_hero.sqldev_update(hero_data, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    hashed_password: str = Field()\n\n\nclass HeroCreate(HeroBase):\n    password: str\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    password: Optional[str] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef hash_password(password: str) -&gt; str:\n    # Use something like passlib here\n    return f\"not really hashed {password} hehehe\"\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n    with Session(engine) as session:\n        extra_data = {\"hashed_password\": hashed_password}\n        db_hero = Hero.model_validate(hero, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        extra_data = {}\n        if \"password\" in hero_data:\n            password = hero_data[\"password\"]\n            hashed_password = hash_password(password)\n            extra_data[\"hashed_password\"] = hashed_password\n        db_hero.sqldev_update(hero_data, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <p>Now, <code>db_hero</code> (which is a table model <code>Hero</code>) will extract its values from <code>hero</code> (which is a data model <code>HeroCreate</code>), and then it will <code>update</code> its values with the extra data from the dictionary <code>extra_data</code>.</p> <p>It will only take the fields defined in <code>Hero</code>, so it will not take the <code>password</code> from <code>HeroCreate</code>. And it will also take its values from the dictionary passed to the <code>update</code> parameter, in this case, the <code>hashed_password</code>.</p> <p>If there's a field in both <code>hero</code> and the <code>extra_data</code>, the value from the <code>extra_data</code> passed to <code>update</code> will take precedence.</p>"},{"location":"tutorial/readyapi/update-extra-data/#update-with-extra-data","title":"Update with Extra Data","text":"<p>Now let's say we want to update a hero that already exists in the database.</p> <p>The same way as before, to avoid removing existing data, we will use <code>exclude_unset=True</code> when calling <code>hero.model_dump()</code>, to get a dictionary with only the data sent by the client.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    hashed_password: str = Field()\n\n\nclass HeroCreate(HeroBase):\n    password: str\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n    password: str | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef hash_password(password: str) -&gt; str:\n    # Use something like passlib here\n    return f\"not really hashed {password} hehehe\"\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n    with Session(engine) as session:\n        extra_data = {\"hashed_password\": hashed_password}\n        db_hero = Hero.model_validate(hero, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        extra_data = {}\n        if \"password\" in hero_data:\n            password = hero_data[\"password\"]\n            hashed_password = hash_password(password)\n            extra_data[\"hashed_password\"] = hashed_password\n        db_hero.sqldev_update(hero_data, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    hashed_password: str = Field()\n\n\nclass HeroCreate(HeroBase):\n    password: str\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    password: Optional[str] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef hash_password(password: str) -&gt; str:\n    # Use something like passlib here\n    return f\"not really hashed {password} hehehe\"\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n    with Session(engine) as session:\n        extra_data = {\"hashed_password\": hashed_password}\n        db_hero = Hero.model_validate(hero, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        extra_data = {}\n        if \"password\" in hero_data:\n            password = hero_data[\"password\"]\n            hashed_password = hash_password(password)\n            extra_data[\"hashed_password\"] = hashed_password\n        db_hero.sqldev_update(hero_data, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    hashed_password: str = Field()\n\n\nclass HeroCreate(HeroBase):\n    password: str\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    password: Optional[str] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef hash_password(password: str) -&gt; str:\n    # Use something like passlib here\n    return f\"not really hashed {password} hehehe\"\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n    with Session(engine) as session:\n        extra_data = {\"hashed_password\": hashed_password}\n        db_hero = Hero.model_validate(hero, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        extra_data = {}\n        if \"password\" in hero_data:\n            password = hero_data[\"password\"]\n            hashed_password = hash_password(password)\n            extra_data[\"hashed_password\"] = hashed_password\n        db_hero.sqldev_update(hero_data, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <p>Now, this <code>hero_data</code> dictionary could contain a <code>password</code>. We need to check it, and if it's there, we need to generate the <code>hashed_password</code>.</p> <p>Then we can put that <code>hashed_password</code> in a dictionary.</p> <p>And then we can update the <code>db_hero</code> object using the method <code>db_hero.sqldev_update()</code>.</p> <p>It takes a model object or dictionary with the data to update the object and also an additional <code>update</code> argument with extra data.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        extra_data = {}\n        if \"password\" in hero_data:\n            password = hero_data[\"password\"]\n            hashed_password = hash_password(password)\n            extra_data[\"hashed_password\"] = hashed_password\n        db_hero.sqldev_update(hero_data, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        extra_data = {}\n        if \"password\" in hero_data:\n            password = hero_data[\"password\"]\n            hashed_password = hash_password(password)\n            extra_data[\"hashed_password\"] = hashed_password\n        db_hero.sqldev_update(hero_data, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        extra_data = {}\n        if \"password\" in hero_data:\n            password = hero_data[\"password\"]\n            hashed_password = hash_password(password)\n            extra_data[\"hashed_password\"] = hashed_password\n        db_hero.sqldev_update(hero_data, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    hashed_password: str = Field()\n\n\nclass HeroCreate(HeroBase):\n    password: str\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n    password: str | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef hash_password(password: str) -&gt; str:\n    # Use something like passlib here\n    return f\"not really hashed {password} hehehe\"\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n    with Session(engine) as session:\n        extra_data = {\"hashed_password\": hashed_password}\n        db_hero = Hero.model_validate(hero, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        extra_data = {}\n        if \"password\" in hero_data:\n            password = hero_data[\"password\"]\n            hashed_password = hash_password(password)\n            extra_data[\"hashed_password\"] = hashed_password\n        db_hero.sqldev_update(hero_data, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    hashed_password: str = Field()\n\n\nclass HeroCreate(HeroBase):\n    password: str\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    password: Optional[str] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef hash_password(password: str) -&gt; str:\n    # Use something like passlib here\n    return f\"not really hashed {password} hehehe\"\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n    with Session(engine) as session:\n        extra_data = {\"hashed_password\": hashed_password}\n        db_hero = Hero.model_validate(hero, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        extra_data = {}\n        if \"password\" in hero_data:\n            password = hero_data[\"password\"]\n            hashed_password = hash_password(password)\n            extra_data[\"hashed_password\"] = hashed_password\n        db_hero.sqldev_update(hero_data, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    hashed_password: str = Field()\n\n\nclass HeroCreate(HeroBase):\n    password: str\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n    password: Optional[str] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef hash_password(password: str) -&gt; str:\n    # Use something like passlib here\n    return f\"not really hashed {password} hehehe\"\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    hashed_password = hash_password(hero.password)\n    with Session(engine) as session:\n        extra_data = {\"hashed_password\": hashed_password}\n        db_hero = Hero.model_validate(hero, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        extra_data = {}\n        if \"password\" in hero_data:\n            password = hero_data[\"password\"]\n            hashed_password = hash_password(password)\n            extra_data[\"hashed_password\"] = hashed_password\n        db_hero.sqldev_update(hero_data, update=extra_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <p>Tip</p> <p>The method <code>db_hero.sqldev_update()</code> was added in SQLDev 0.0.16. \ud83d\ude0e</p>"},{"location":"tutorial/readyapi/update-extra-data/#recap","title":"Recap","text":"<p>You can use the <code>update</code> parameter in <code>Hero.model_validate()</code> to provide extra data when creating a new object and <code>Hero.sqldev_update()</code> to provide extra data when updating an existing object. \ud83e\udd13</p>"},{"location":"tutorial/readyapi/update/","title":"Update Data with ReadyAPI","text":"<p>Now let's see how to update data in the database with a ReadyAPI path operation.</p>"},{"location":"tutorial/readyapi/update/#heroupdate-model","title":"<code>HeroUpdate</code> Model","text":"<p>We want clients to be able to update the <code>name</code>, the <code>secret_name</code>, and the <code>age</code> of a hero.</p> <p>But we don't want them to have to include all the data again just to update a single field.</p> <p>So, we need to have all those fields marked as optional.</p> <p>And because the <code>HeroBase</code> has some of them as required and not optional, we will need to create a new model.</p> <p>Tip</p> <p>Here is one of those cases where it probably makes sense to use an independent model instead of trying to come up with a complex tree of models inheriting from each other.</p> <p>Because each field is actually different (we just change it to <code>Optional</code>, but that's already making it different), it makes sense to have them in their own model.</p> <p>So, let's create this new <code>HeroUpdate</code> model:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <p>This is almost the same as <code>HeroBase</code>, but all the fields are optional, so we can't simply inherit from <code>HeroBase</code>.</p>"},{"location":"tutorial/readyapi/update/#create-the-update-path-operation","title":"Create the Update Path Operation","text":"<p>Now let's use this model in the path operation to update a hero.</p> <p>We will use a <code>PATCH</code> HTTP operation. This is used to partially update data, which is what we are doing.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <p>We also read the <code>hero_id</code> from the path parameter and the request body, a <code>HeroUpdate</code>.</p>"},{"location":"tutorial/readyapi/update/#read-the-existing-hero","title":"Read the Existing Hero","text":"<p>We take a <code>hero_id</code> with the ID of the hero we want to update.</p> <p>So, we need to read the hero from the database, with the same logic we used to read a single hero, checking if it exists, possibly raising an error for the client if it doesn't exist, etc.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre>"},{"location":"tutorial/readyapi/update/#get-the-new-data","title":"Get the New Data","text":"<p>The <code>HeroUpdate</code> model has all the fields with default values, because they all have defaults, they are all optional, which is what we want.</p> <p>But that also means that if we just call <code>hero.model_dump()</code> we will get a dictionary that could potentially have several or all of those values with their defaults, for example:</p> <pre><code>{\n    \"name\": None,\n    \"secret_name\": None,\n    \"age\": None,\n}\n</code></pre> <p>And then, if we update the hero in the database with this data, we would be removing any existing values, and that's probably not what the client intended.</p> <p>But fortunately Pydantic models (and so SQLDev models) have a parameter we can pass to the <code>.model_dump()</code> method for that: <code>exclude_unset=True</code>.</p> <p>This tells Pydantic to not include the values that were not sent by the client. Saying it another way, it would only include the values that were sent by the client.</p> <p>So, if the client sent a JSON with no values:</p> <pre><code>{}\n</code></pre> <p>Then the dictionary we would get in Python using <code>hero.model_dump(exclude_unset=True)</code> would be:</p> <pre><code>{}\n</code></pre> <p>But if the client sent a JSON with:</p> <pre><code>{\n    \"name\": \"Deadpuddle\"\n}\n</code></pre> <p>Then the dictionary we would get in Python using <code>hero.model_dump(exclude_unset=True)</code> would be:</p> <pre><code>{\n    \"name\": \"Deadpuddle\"\n}\n</code></pre> <p>Then we use that to get the data that was actually sent by the client:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <p>Tip</p> <p>Before SQLDev 0.0.14, the method was called <code>hero.dict(exclude_unset=True)</code>, but it was renamed to <code>hero.model_dump(exclude_unset=True)</code> to be consistent with Pydantic v2.</p>"},{"location":"tutorial/readyapi/update/#update-the-hero-in-the-database","title":"Update the Hero in the Database","text":"<p>Now that we have a dictionary with the data sent by the client, we can use the method <code>db_hero.sqldev_update()</code> to update the object <code>db_hero</code>.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: str | None = None\n    secret_name: str | None = None\n    age: int | None = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=list[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom readyapi import HTTPException, Query, ReadyAPI\nfrom sqldev import Field, Session, SQLDev, create_engine, select\n\n\nclass HeroBase(SQLDev):\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n\nclass Hero(HeroBase, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n\n\nclass HeroCreate(HeroBase):\n    pass\n\n\nclass HeroPublic(HeroBase):\n    id: int\n\n\nclass HeroUpdate(SQLDev):\n    name: Optional[str] = None\n    secret_name: Optional[str] = None\n    age: Optional[int] = None\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nconnect_args = {\"check_same_thread\": False}\nengine = create_engine(sqlite_url, echo=True, connect_args=connect_args)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\napp = ReadyAPI()\n\n\n@app.on_event(\"startup\")\ndef on_startup():\n    create_db_and_tables()\n\n\n@app.post(\"/heroes/\", response_model=HeroPublic)\ndef create_hero(hero: HeroCreate):\n    with Session(engine) as session:\n        db_hero = Hero.model_validate(hero)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n\n\n@app.get(\"/heroes/\", response_model=List[HeroPublic])\ndef read_heroes(offset: int = 0, limit: int = Query(default=100, le=100)):\n    with Session(engine) as session:\n        heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n        return heroes\n\n\n@app.get(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef read_hero(hero_id: int):\n    with Session(engine) as session:\n        hero = session.get(Hero, hero_id)\n        if not hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        return hero\n\n\n@app.patch(\"/heroes/{hero_id}\", response_model=HeroPublic)\ndef update_hero(hero_id: int, hero: HeroUpdate):\n    with Session(engine) as session:\n        db_hero = session.get(Hero, hero_id)\n        if not db_hero:\n            raise HTTPException(status_code=404, detail=\"Hero not found\")\n        hero_data = hero.model_dump(exclude_unset=True)\n        db_hero.sqldev_update(hero_data)\n        session.add(db_hero)\n        session.commit()\n        session.refresh(db_hero)\n        return db_hero\n</code></pre> <p>Tip</p> <p>The method <code>db_hero.sqldev_update()</code> was added in SQLDev 0.0.16. \ud83e\udd13</p> <p>Before that, you would need to manually get the values and set them using <code>setattr()</code>.</p> <p>The method <code>db_hero.sqldev_update()</code> takes an argument with another model object or a dictionary.</p> <p>For each of the fields in the original model object (<code>db_hero</code> in this example), it checks if the field is available in the argument (<code>hero_data</code> in this example) and then updates it with the provided value.</p>"},{"location":"tutorial/readyapi/update/#remove-fields","title":"Remove Fields","text":"<p>Here's a bonus. \ud83c\udf81</p> <p>When getting the dictionary of data sent by the client, we only include what the client actually sent.</p> <p>This sounds simple, but it has some additional nuances that become nice features. \u2728</p> <p>We are not simply omitting the data that has the default values.</p> <p>And we are not simply omitting anything that is <code>None</code>.</p> <p>This means that if a model in the database has a value different than the default, the client could reset it to the same value as the default, or even <code>None</code>, and we would still notice it and update it accordingly. \ud83e\udd2f\ud83d\ude80</p> <p>So, if the client wanted to intentionally remove the <code>age</code> of a hero, they could just send a JSON with:</p> <pre><code>{\n    \"age\": null\n}\n</code></pre> <p>And when getting the data with <code>hero.model_dump(exclude_unset=True)</code>, we would get:</p> <pre><code>{\n    \"age\": None\n}\n</code></pre> <p>So, we would use that value and update the <code>age</code> to <code>None</code> in the database, just as the client intended.</p> <p>Notice that <code>age</code> here is <code>None</code>, and we still detected it.</p> <p>Also, that <code>name</code> was not even sent, and we don't accidentally set it to <code>None</code> or something. We just didn't touch it because the client didn't send it, so we are perfectly fine, even in these corner cases. \u2728</p> <p>These are some of the advantages of Pydantic, that we can use with SQLDev. \ud83c\udf89</p>"},{"location":"tutorial/readyapi/update/#recap","title":"Recap","text":"<p>Using <code>.model_dump(exclude_unset=True)</code> in SQLDev models (and Pydantic models) we can easily update data correctly, even in the edge cases. \ud83d\ude0e</p>"},{"location":"tutorial/relationship-attributes/","title":"Relationship Attributes - Intro","text":"<p>In the previous chapters we discussed how to manage databases with tables that have relationships by using fields (columns) with foreign keys pointing to other columns.</p> <p>And then we read the data together with <code>select()</code> and using <code>.where()</code> or <code>.join()</code> to connect it.</p> <p>Now we will see how to use Relationship Attributes, an extra feature of SQLDev (and SQLAlchemy), to work with the data in the database in a much more familiar way, and closer to normal Python code.</p> <p>Info</p> <p>When I say \"relationship\" I mean the standard dictionary term, of data related to other data.</p> <p>I'm not using the term \"relation\" that is the technical, academical, SQL term for a single table.</p> <p>And using those relationship attributes is where a tool like SQLDev really shines. \u2728</p>"},{"location":"tutorial/relationship-attributes/back-populates/","title":"Relationship back_populates","text":"<p>Now you know how to use the relationship attributes to manipulate connected data in the database! \ud83c\udf89</p> <p>Let's now take a small step back and review how we defined those <code>Relationship()</code> attributes again, let's clarify that <code>back_populates</code> argument. \ud83e\udd13</p>"},{"location":"tutorial/relationship-attributes/back-populates/#relationship-with-back_populates","title":"Relationship with <code>back_populates</code>","text":"<p>So, what is that <code>back_populates</code> argument in each <code>Relationship()</code>?</p> <p>The value is a string with the name of the attribute in the other model class.</p> <p></p> <p>That tells SQLDev that if something changes in this model, it should change that attribute in the other model, and it will work even before committing with the session (that would force a refresh of the data).</p> <p>Let's understand that better with an example.</p>"},{"location":"tutorial/relationship-attributes/back-populates/#an-incomplete-relationship","title":"An Incomplete Relationship","text":"<p>Let's see how that works by writing an incomplete version first, without <code>back_populates</code>:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship()\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship()\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship()\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship()\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship()\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship()\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship()\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship()\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship()\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship()\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/relationship-attributes/back-populates/#read-data-objects","title":"Read Data Objects","text":"<p>Now, we will get the Spider-Boy hero and, independently, the Preventers team using two <code>select</code>s.</p> <p>As you already know how this works, I won't separate that in a select <code>statement</code>, <code>results</code>, etc. Let's use the shorter form in a single call:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship()\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship()\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship()\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship()\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship()\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship()\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Tip</p> <p>When writing your own code, this is probably the style you will use most often, as it's shorter, more convenient, and you still get all the power of autocompletion and inline errors.</p>"},{"location":"tutorial/relationship-attributes/back-populates/#print-the-data","title":"Print the Data","text":"<p>Now, let's print the current Spider-Boy, the current Preventers team, and particularly, the current Preventers list of heroes:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship()\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship()\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship()\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship()\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship()\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship()\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Up to this point, it's all good. \ud83d\ude0a</p> <p>In particular, the result of printing <code>preventers_team.heroes</code> is:</p> <pre><code>Preventers Team Heroes: [\n        Hero(name='Rusty-Man', age=48, id=2, secret_name='Tommy Sharp', team_id=2),\n        Hero(name='Spider-Boy', age=None, id=3, secret_name='Pedro Parqueador', team_id=2),\n        Hero(name='Tarantula', age=32, id=6, secret_name='Natalia Roman-on', team_id=2),\n        Hero(name='Dr. Weird', age=36, id=7, secret_name='Steve Weird', team_id=2),\n        Hero(name='Captain North America', age=93, id=8, secret_name='Esteban Rogelios', team_id=2)\n]\n</code></pre> <p>Notice that we have Spider-Boy there.</p>"},{"location":"tutorial/relationship-attributes/back-populates/#update-objects-before-committing","title":"Update Objects Before Committing","text":"<p>Now let's update Spider-Boy, removing him from the team by setting <code>hero_spider_boy.team = None</code> and then let's print this object again:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n\n        # Code here omitted \ud83d\udc48\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n\n        # Code here omitted \ud83d\udc48\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n\n        # Code here omitted \ud83d\udc48\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship()\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship()\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship()\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship()\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship()\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship()\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>The first important thing is, we haven't committed the hero yet, so accessing the list of heroes would not trigger an automatic refresh.</p> <p>But in our code, in this exact point in time, we already said that Spider-Boy is no longer part of the Preventers. \ud83d\udd25</p> <p>Tip</p> <p>We could revert that later by not committing the session, but that's not what we are interested in here.</p> <p>Here, at this point in the code, in memory, the code expects Preventers to not include Spider-Boy.</p> <p>The output of printing <code>hero_spider_boy</code> without team is:</p> <pre><code>Spider-Boy without team: name='Spider-Boy' age=None id=3 secret_name='Pedro Parqueador' team_id=2 team=None\n</code></pre> <p>Cool, the team is set to <code>None</code>, the <code>team_id</code> attribute still has the team ID until we save it. But that's okay as we are now working mainly with the relationship attributes and the objects. \u2705</p> <p>But now, what happens when we print the <code>preventers_team.heroes</code>?</p> <pre><code>Preventers Team Heroes again: [\n        Hero(name='Rusty-Man', age=48, id=2, secret_name='Tommy Sharp', team_id=2),\n        Hero(name='Spider-Boy', age=None, id=3, secret_name='Pedro Parqueador', team_id=2, team=None),\n        Hero(name='Tarantula', age=32, id=6, secret_name='Natalia Roman-on', team_id=2),\n        Hero(name='Dr. Weird', age=36, id=7, secret_name='Steve Weird', team_id=2),\n        Hero(name='Captain North America', age=93, id=8, secret_name='Esteban Rogelios', team_id=2)\n]\n</code></pre> <p>Oh, no! \ud83d\ude31 Spider-Boy is still listed there!</p>"},{"location":"tutorial/relationship-attributes/back-populates/#commit-and-print","title":"Commit and Print","text":"<p>Now, if we commit it and print again:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n\n        # Code here omitted \ud83d\udc48\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n\n        # Code here omitted \ud83d\udc48\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n\n        # Code here omitted \ud83d\udc48\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship()\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship()\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship()\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship()\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship()\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship()\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>When we access <code>preventers_team.heroes</code> after the <code>commit</code>, that triggers a refresh, so we get the latest list, without Spider-Boy, so that's fine again:</p> <pre><code>INFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age, hero.team_id AS hero_team_id\nFROM hero\nWHERE ? = hero.team_id\n2021-08-13 11:15:24,658 INFO sqlalchemy.engine.Engine [cached since 0.1924s ago] (2,)\n\nPreventers Team Heroes after commit: [\n        Hero(name='Rusty-Man', age=48, id=2, secret_name='Tommy Sharp', team_id=2),\n        Hero(name='Tarantula', age=32, id=6, secret_name='Natalia Roman-on', team_id=2),\n        Hero(name='Dr. Weird', age=36, id=7, secret_name='Steve Weird', team_id=2),\n        Hero(name='Captain North America', age=93, id=8, secret_name='Esteban Rogelios', team_id=2)\n]\n</code></pre> <p>There's no Spider-Boy after committing, so that's good. \ud83d\ude0a</p> <p>But we still have that inconsistency in that previous point above.</p> <p>If we use the objects before committing, we could end up having errors. \ud83d\ude14</p> <p>Let's fix that. \ud83e\udd13</p>"},{"location":"tutorial/relationship-attributes/back-populates/#fix-it-using-back_populates","title":"Fix It Using <code>back_populates</code>","text":"<p>That's what <code>back_populates</code> is for. \u2728</p> <p>Let's add it back:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>And we can keep the rest of the code the same:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n\n        # Code here omitted \ud83d\udc48\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n\n        # Code here omitted \ud83d\udc48\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n\n        # Code here omitted \ud83d\udc48\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Tip</p> <p>This is the same section where we updated <code>hero_spider_boy.team</code> to <code>None</code> but we haven't committed that change yet.</p> <p>The same section that caused a problem before.</p>"},{"location":"tutorial/relationship-attributes/back-populates/#review-the-result","title":"Review the Result","text":"<p>This time, SQLDev (actually SQLAlchemy) will be able to notice the change, and automatically update the list of heroes in the team, even before we commit.</p> <p>That second print would output:</p> <pre><code>Preventers Team Heroes again: [\n        Hero(name='Rusty-Man', age=48, id=2, secret_name='Tommy Sharp', team_id=2),\n        Hero(name='Tarantula', age=32, id=6, secret_name='Natalia Roman-on', team_id=2),\n        Hero(name='Dr. Weird', age=36, id=7, secret_name='Steve Weird', team_id=2),\n        Hero(name='Captain North America', age=93, id=8, secret_name='Esteban Rogelios', team_id=2)\n]\n</code></pre> <p>Notice that now Spider-Boy is not there, we fixed it with <code>back_populates</code>! \ud83c\udf89</p>"},{"location":"tutorial/relationship-attributes/back-populates/#the-value-of-back_populates","title":"The Value of <code>back_populates</code>","text":"<p>Now that you know why <code>back_populates</code> is there, let's review the exact value again.</p> <p>It's quite simple code, it's just a string, but it might be confusing to think exactly what string should go there:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>The string in <code>back_populates</code> is the name of the attribute in the other model, that will reference the current model.</p> <p></p> <p>So, in the class <code>Team</code>, we have an attribute <code>heroes</code> and we declare it with <code>Relationship(back_populates=\"team\")</code>.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>The string in <code>back_populates=\"team\"</code> refers to the attribute <code>team</code> in the class <code>Hero</code> (the other class).</p> <p>And, in the class <code>Hero</code>, we declare an attribute <code>team</code>, and we declare it with <code>Relationship(back_populates=\"heroes\")</code>.</p> <p>So, the string <code>\"heroes\"</code> refers to the attribute <code>heroes</code> in the class <code>Team</code>.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        hero_spider_boy = session.exec(\n            select(Hero).where(Hero.name == \"Spider-Boy\")\n        ).one()\n\n        preventers_team = session.exec(\n            select(Team).where(Team.name == \"Preventers\")\n        ).one()\n\n        print(\"Hero Spider-Boy:\", hero_spider_boy)\n        print(\"Preventers Team:\", preventers_team)\n        print(\"Preventers Team Heroes:\", preventers_team.heroes)\n\n        hero_spider_boy.team = None\n\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes again:\", preventers_team.heroes)\n\n        session.add(hero_spider_boy)\n        session.commit()\n        print(\"After committing\")\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy after commit:\", hero_spider_boy)\n\n        print(\"Preventers Team Heroes after commit:\", preventers_team.heroes)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Tip</p> <p>Each relationship attribute points to the other one, in the other model, using <code>back_populates</code>.</p> <p>Although it's simple code, it can be confusing to think about \ud83d\ude35, because the same line has concepts related to both models in multiple places:</p> <ul> <li>Just by being in the current model, the line has something to do with the current model.</li> <li>The name of the attribute is about the other model.</li> <li>The type annotation is about the other model.</li> <li>And the <code>back_populates</code> refers to an attribute in the other model, that points to the current model.</li> </ul>"},{"location":"tutorial/relationship-attributes/back-populates/#a-mental-trick-to-remember-back_populates","title":"A Mental Trick to Remember <code>back_populates</code>","text":"<p>A mental trick you can use to remember is that the string in <code>back_populates</code> is always about the current model class you are editing. \ud83e\udd13</p> <p>So, if you are in the class <code>Hero</code>, the value of <code>back_populates</code> for any relationship attribute connecting to any other table (to any other model, it could be <code>Team</code>, <code>Weapon</code>, <code>Powers</code>, etc) will still always refer to this same class.</p> <p>So, <code>back_populates</code> would most probably be something like <code>\"hero\"</code> or <code>\"heroes\"</code>.</p> <p></p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n    weapon_id: int | None = Field(default=None, foreign_key=\"weapon.id\")\n    weapon: Weapon | None = Relationship(back_populates=\"hero\")\n\n    powers: list[Power] = Relationship(back_populates=\"hero\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n    weapon_id: Optional[int] = Field(default=None, foreign_key=\"weapon.id\")\n    weapon: Optional[Weapon] = Relationship(back_populates=\"hero\")\n\n    powers: list[Power] = Relationship(back_populates=\"hero\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n    weapon_id: Optional[int] = Field(default=None, foreign_key=\"weapon.id\")\n    weapon: Optional[Weapon] = Relationship(back_populates=\"hero\")\n\n    powers: List[Power] = Relationship(back_populates=\"hero\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, SQLDev, create_engine\n\n\nclass Weapon(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n\n    hero: \"Hero\" = Relationship(back_populates=\"weapon\")\n\n\nclass Power(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n\n    hero_id: int = Field(foreign_key=\"hero.id\")\n    hero: \"Hero\" = Relationship(back_populates=\"powers\")\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n    weapon_id: int | None = Field(default=None, foreign_key=\"weapon.id\")\n    weapon: Weapon | None = Relationship(back_populates=\"hero\")\n\n    powers: list[Power] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef main():\n    create_db_and_tables()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, SQLDev, create_engine\n\n\nclass Weapon(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n\n    hero: \"Hero\" = Relationship(back_populates=\"weapon\")\n\n\nclass Power(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n\n    hero_id: int = Field(foreign_key=\"hero.id\")\n    hero: \"Hero\" = Relationship(back_populates=\"powers\")\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n    weapon_id: Optional[int] = Field(default=None, foreign_key=\"weapon.id\")\n    weapon: Optional[Weapon] = Relationship(back_populates=\"hero\")\n\n    powers: list[Power] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef main():\n    create_db_and_tables()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, SQLDev, create_engine\n\n\nclass Weapon(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n\n    hero: \"Hero\" = Relationship(back_populates=\"weapon\")\n\n\nclass Power(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n\n    hero_id: int = Field(foreign_key=\"hero.id\")\n    hero: \"Hero\" = Relationship(back_populates=\"powers\")\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n    weapon_id: Optional[int] = Field(default=None, foreign_key=\"weapon.id\")\n    weapon: Optional[Weapon] = Relationship(back_populates=\"hero\")\n\n    powers: List[Power] = Relationship(back_populates=\"hero\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef main():\n    create_db_and_tables()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/","title":"Cascade Delete Relationships","text":"<p>What happens if we delete a team that has a relationship with heroes?</p> <p>Should those heroes be automatically deleted too? That's called a \"cascade\", because the initial deletion causes a cascade of other deletions.</p> <p>Should their <code>team_id</code> instead be set to <code>NULL</code> in the database?</p> <p>Let's see how to configure that with SQLDev.</p> <p>Info</p> <p>This feature, including <code>cascade_delete</code>, <code>ondelete</code>, and <code>passive_deletes</code>, is available since SQLDev version <code>0.0.21</code>.</p>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#initial-heroes-and-teams","title":"Initial Heroes and Teams","text":"<p>Let's say that we have these teams and heroes.</p>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#team-table","title":"Team Table","text":"id name headquarters 1 Z-Force Sister Margaret's Bar 2 Preventers Sharp Tower 3 Wakaland Wakaland Capital City"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#hero-table","title":"Hero Table","text":"id name secret_name age team_id 1 Deadpond Dive WIlson 1 2 Rusty-Man Tommy Sharp 48 2 3 Spider-Boy Pedro Parqueador 2 4 Black Lion Trevor Challa 35 3 5 Princess Sure-E Sure-E 3"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#visual-teams-and-heroes","title":"Visual Teams and Heroes","text":"<p>We could visualize them like this:</p> <pre><code>flowchart TB\n    subgraph \"Z-Force\"\n        d(\"Deadpond\")\n    end\n    subgraph \"Preventers\"\n        r(\"Rusty-Man\")\n        s(\"Spider-Boy\")\n    end\n    subgraph \"Wakaland\"\n        b(\"Black Lion\")\n        p(\"Princess Sure-E\")\n    end</code></pre>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#delete-a-team-with-heroes","title":"Delete a Team with Heroes","text":"<p>When we delete a team, we have to do something with the associated heroes.</p> <p>By default, their foreign key pointing to the team will be set to <code>NULL</code> in the database.</p> <p>But let's say we want the associated heroes to be automatically deleted.</p> <p>For example, we could delete the team <code>Wakaland</code>:</p> <pre><code>flowchart TB\n    subgraph zforce[\"Z-Force\"]\n        d(\"Deadpond\")\n    end\n    subgraph preventers[\"Preventers\"]\n        r(\"Rusty-Man\")\n        s(\"Spider-Boy\")\n    end\n    subgraph wakaland[\"Wakaland\"]\n        b(\"Black Lion\")\n        p(\"Princess Sure-E\")\n    end\n      style wakaland fill:#fee,stroke:#900</code></pre> <p>And we would want the heroes <code>Black Lion</code> and <code>Princess Sure-E</code> to be automatically deleted too.</p> <p>So we would end up with these teams and heroes:</p> <pre><code>flowchart TB\n    subgraph zforce[\"Team Z-Force\"]\n        d(\"Deadpond\")\n    end\n    subgraph preventers[\"Team Preventers\"]\n        r(\"Rusty-Man\")\n        s(\"Spider-Boy\")\n    end</code></pre>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#configure-automatic-deletion","title":"Configure Automatic Deletion","text":"<p>There are two places where this automatic deletion is configured:</p> <ul> <li>in Python code</li> <li>in the database</li> </ul>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#delete-in-python-with-cascade_delete","title":"Delete in Python with <code>cascade_delete</code>","text":"<p>When creating a <code>Relationship()</code>, we can set <code>cascade_delete=True</code>.</p> <p>This configures SQLDev to automatically delete the related records (heroes) when the initial one is deleted (a team).</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", cascade_delete=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", cascade_delete=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\", cascade_delete=True)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", cascade_delete=True)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", ondelete=\"CASCADE\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion not found:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E not found:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", cascade_delete=True)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"CASCADE\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion not found:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E not found:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\", cascade_delete=True)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"CASCADE\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion not found:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E not found:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>With this configuration, when we delete a team, SQLDev (actually SQLAlchemy) will:</p> <ul> <li>Make sure the objects for the related records are loaded, in this case, the <code>heroes</code>. If they are not loaded, it will send a <code>SELECT</code> query to the database to get them.</li> <li>Send a <code>DELETE</code> query to the database including each related record (each hero).</li> <li>Finally, delete the initial record (the team) with another <code>DELETE</code> query.</li> </ul> <p>This way, the internal Python code will take care of deleting the related records, by emitting the necessary SQL queries for each of them.</p> <p>Tip</p> <p>The <code>cascade_delete</code> parameter is set in the <code>Relationship()</code>, on the model that doesn't have a foreign key.</p> <p>Technical Details</p> <p>Setting <code>cascade_delete=True</code> in the <code>Relationship()</code> will configure SQLAlchemy to use <code>cascade=\"all, delete-orphan\"</code>, which is the most common and useful configuration when wanting to cascade deletes.</p> <p>You can read more about it in the SQLAlchemy docs.</p>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#delete-in-the-database-with-ondelete","title":"Delete in the Database with <code>ondelete</code>","text":"<p>In the previous section we saw that using <code>cascade_delete</code> handles automatic deletions from the Python code.</p> <p>But what happens if someone interacts with the database directly, not using our code, and deletes a team with SQL?</p> <p>For those cases, we can configure the database to automatically delete the related records with the <code>ondelete</code> parameter in <code>Field()</code>.</p>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#ondelete-options","title":"<code>ondelete</code> Options","text":"<p>The <code>ondelete</code> parameter will set a SQL <code>ON DELETE</code> in the foreign key column in the database.</p> <p><code>ondelete</code> can have these values:</p> <ul> <li><code>CASCADE</code>: Automatically delete this record (hero) when the related one (team) is deleted.</li> <li><code>SET NULL</code>: Set this foreign key (<code>hero.team_id</code>) field to <code>NULL</code> when the related record is deleted.</li> <li><code>RESTRICT</code>: Prevent the deletion of this record (hero) if there is a foreign key value by raising an error.</li> </ul>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#set-ondelete-to-cascade","title":"Set <code>ondelete</code> to <code>CASCADE</code>","text":"<p>If we want to configure the database to automatically delete the related records when the parent is deleted, we can set <code>ondelete=\"CASCADE\"</code>.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", cascade_delete=True)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", ondelete=\"CASCADE\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", cascade_delete=True)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"CASCADE\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\", cascade_delete=True)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"CASCADE\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", cascade_delete=True)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", ondelete=\"CASCADE\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion not found:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E not found:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", cascade_delete=True)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"CASCADE\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion not found:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E not found:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\", cascade_delete=True)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"CASCADE\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion not found:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E not found:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Now, when we create the tables in the database, the <code>team_id</code> column in the <code>Hero</code> table will have an <code>ON DELETE CASCADE</code> in its definition at the database level.</p> <p>This will configure the database to automatically delete the records (heroes) when the related record (team) is deleted.</p> <p>Tip</p> <p>The <code>ondelete</code> parameter is set in the <code>Field()</code>, on the model that has a foreign key.</p>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#using-cascade_delete-or-ondelete","title":"Using <code>cascade_delete</code> or <code>ondelete</code>","text":"<p>At this point, you might be wondering if you should use <code>cascade_delete</code> or <code>ondelete</code>. The answer is: both! \ud83e\udd13</p> <p>The <code>ondelete</code> will configure the database, in case someone interacts with it directly.</p> <p>But <code>cascade_delete</code> is still needed to tell SQLAlchemy that it should delete the Python objects in memory.</p>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#foreign-key-constraint-support","title":"Foreign Key Constraint Support","text":"<p>Some databases don't support foreign key constraints.</p> <p>For example, SQLite doesn't support them by default. They have to be manually enabled with a custom SQL command:</p> <pre><code>PRAGMA foreign_keys = ON;\n</code></pre> <p>So, in general is a good idea to have both <code>cascade_delete</code> and <code>ondelete</code> configured.</p> <p>Tip</p> <p>You will learn more about how to disable the default automatic SQLDev (SQLAlchemy) behavior and only rely on the database down below, in the section about <code>passive_deletes</code>.</p>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#cascade_delete-on-relationship-and-ondelete-on-field","title":"<code>cascade_delete</code> on <code>Relationship()</code> and <code>ondelete</code> on <code>Field()</code>","text":"<p>Just a note to remember... \ud83e\udd13</p> <ul> <li><code>ondelete</code> is put on the <code>Field()</code> with a foreign key. On the \"many\" side in \"one-to-many\" relationships.</li> </ul> <pre><code>class Hero(SQLDev, table=True):\n    ...\n\n    team_id: int Field(foreign_key=\"team.id\", ondelete=\"CASCADE\")\n</code></pre> <ul> <li><code>cascade_delete</code> is put on the <code>Relationship()</code>. Normally on the \"one\" side in \"one-to-many\" relationships, the side without a foreign key.</li> </ul> <pre><code>class Team(SQLDev, table=True):\n    ...\n\n    heroes: list[Hero] = Relationship(cascade_delete=True)\n</code></pre>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#remove-a-team-and-its-heroes","title":"Remove a Team and its Heroes","text":"<p>Now, when we delete a team, we don't need to do anything else, it's automatically going to delete its heroes.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", cascade_delete=True)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", ondelete=\"CASCADE\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion not found:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E not found:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", cascade_delete=True)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"CASCADE\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion not found:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E not found:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\", cascade_delete=True)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"CASCADE\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion not found:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E not found:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#confirm-heroes-are-deleted","title":"Confirm Heroes are Deleted","text":"<p>We can confirm that after deleting the team <code>Wakaland</code>, the heroes <code>Black Lion</code> and <code>Princess Sure-E</code> are also deleted.</p> <p>If we try to select them from the database, we will no longer find them.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion not found:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E not found:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion not found:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E not found:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion not found:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E not found:\", hero)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", cascade_delete=True)\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\", ondelete=\"CASCADE\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion not found:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E not found:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", cascade_delete=True)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"CASCADE\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion not found:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E not found:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\", cascade_delete=True)\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"CASCADE\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion not found:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E not found:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#run-the-program-with-cascade_deletetrue-and-ondeletecascade","title":"Run the Program with <code>cascade_delete=True</code> and <code>ondelete=\"CASCADE\"</code>","text":"<p>We can confirm everything is working by running the program.</p> <pre><code>$ python app.py\n\n// Some boilerplate and previous output omitted \ud83d\ude09\n\n// The team table is created as before\nCREATE TABLE team (\n        id INTEGER NOT NULL,\n        name VARCHAR NOT NULL,\n        headquarters VARCHAR NOT NULL,\n        PRIMARY KEY (id)\n)\n\n// The hero table is created with the ON DELETE CASCADE \ud83c\udf89\n// In SQLite, it also includes REFERENCES team (id), this is needed by SQLite to work with the ON DELETE CASCADE properly.\n// SQLAlchemy takes care of setting it up for us to make sure it works \ud83e\udd13\nCREATE TABLE hero (\n        id INTEGER NOT NULL,\n        name VARCHAR NOT NULL,\n        secret_name VARCHAR NOT NULL,\n        age INTEGER,\n        team_id INTEGER,\n        PRIMARY KEY (id),\n        FOREIGN KEY(team_id) REFERENCES team (id) ON DELETE CASCADE\n)\n\n// We select the team Wakaland\nINFO Engine SELECT team.id, team.name, team.headquarters\nFROM team\nWHERE team.name = ?\nINFO Engine [generated in 0.00014s] ('Wakaland',)\n\n// Then, because of cascade_delete, right before deleting Wakaland, SQLAlchemy loads the heroes\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age, hero.team_id AS hero_team_id\nFROM hero\nWHERE ? = hero.team_id\nINFO Engine [generated in 0.00020s] (3,)\n\n// Next, before deleting the Wakaland team, it sends a DELETE statement including each related hero: Black Lion and Princess Sure-E, with IDs 4 and 5\nINFO Engine DELETE FROM hero WHERE hero.id = ?\nINFO Engine [generated in 0.00022s] [(4,), (5,)]\n\n// After that, it will send the delete for the team Wakaland with ID 3\nINFO Engine DELETE FROM team WHERE team.id = ?\nINFO Engine [generated in 0.00017s] (3,)\n\n// Print the deleted team\nDeleted team: name='Wakaland' id=3 headquarters='Wakaland Capital City'\n\n// Finally, we try to select the heroes from Wakaland, Black Lion and Princess Sure-E and print them, but they are now deleted\nBlack Lion not found: None\nPrincess Sure-E not found: None\n</code></pre>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#ondelete-with-set-null","title":"<code>ondelete</code> with <code>SET NULL</code>","text":"<p>We can configure the database to set the foreign key (the <code>team_id</code> in the <code>hero</code> table) to <code>NULL</code> when the related record (in the <code>team</code> table) is deleted.</p> <p>In this case, the side with <code>Relationship()</code> won't have <code>cascade_delete</code>, but the side with <code>Field()</code> and a <code>foreign_key</code> will have <code>ondelete=\"SET NULL\"</code>.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"SET NULL\"\n    )\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"SET NULL\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"SET NULL\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"SET NULL\"\n    )\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"SET NULL\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"SET NULL\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>The configuration above is setting the <code>team_id</code> column from the <code>Hero</code> table to have an <code>ON DELETE SET NULL</code>.</p> <p>This way, when someone deletes a team from the database using SQL directly, the database will go to the heroes for that team and set <code>team_id</code> to <code>NULL</code> (if the database supports it).</p> <p>Tip</p> <p>The foreign key should allow <code>None</code> values (<code>NULL</code> in the database), otherwise you would end up having an Integrity Error by violating the <code>NOT NULL</code> constraint.</p> <p>So <code>team_id</code> needs to have a type with <code>None</code>, like:</p> <pre><code>team_id: int | None\n</code></pre>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#not-using-ondeleteset-null","title":"Not Using <code>ondelete=\"SET NULL\"</code>","text":"<p>What happens if you don't use <code>ondelete=\"SET NULL\"</code>, don't set anything on <code>cascade_delete</code>, and delete a team?</p> <p>The default behavior is that SQLDev (actually SQLAlchemy) will go to the heroes and set their <code>team_id</code> to <code>NULL</code> from the Python code.</p> <p>So, by default, those <code>team_id</code> fields will be set to <code>NULL</code>.</p> <p>But if someone goes to the database and manually deletes a team, the heroes could end up with a <code>team_id</code> pointing to a non-existing team.</p> <p>Adding the <code>ondelete=\"SET NULL\"</code> configures the database itself to also set those fields to <code>NULL</code>.</p> <p>But if you delete a team from code, by default, SQLDev (actually SQLAlchemy) will update those <code>team_id</code> fields to <code>NULL</code> even before the database <code>SET NULL</code> takes effect.</p>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#removing-a-team-with-set-null","title":"Removing a Team with <code>SET NULL</code>","text":"<p>Removing a team has the same code as before, the only thing that changes is the configuration underneath in the database.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"SET NULL\"\n    )\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"SET NULL\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"SET NULL\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>The result would be these tables.</p>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#team-table-after-set-null","title":"Team Table after <code>SET NULL</code>","text":"id name headquarters 1 Z-Force Sister Margaret's Bar 2 Preventers Sharp Tower"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#hero-table-after-set-null","title":"Hero Table after <code>SET NULL</code>","text":"id name secret_name age team_id 1 Deadpond Dive WIlson 1 2 Rusty-Man Tommy Sharp 48 2 3 Spider-Boy Pedro Parqueador 2 4 Black Lion Trevor Challa 35 NULL 5 Princess Sure-E Sure-E NULL"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#visual-teams-and-heroes-after-set-null","title":"Visual Teams and Heroes after <code>SET NULL</code>","text":"<p>We could visualize them like this:</p> <pre><code>flowchart TB\n    subgraph \"Z-Force\"\n        d(\"Deadpond\")\n    end\n    subgraph \"Preventers\"\n        r(\"Rusty-Man\")\n        s(\"Spider-Boy\")\n    end\n    b(\"Black Lion\")\n    p(\"Princess Sure-E\")</code></pre>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#run-the-program-with-set-null","title":"Run the program with <code>SET NULL</code>","text":"<p>Let's confirm it all works by running the program now:</p> <pre><code>$ python app.py\n\n// Some boilerplate and previous output omitted \ud83d\ude09\n\n// The hero table is created with the ON DELETE SET NULL \ud83c\udf89\n// In SQLite, it also includes: REFERENCES team (id). This REFERENCES is needed by SQLite to work with the ON DELETE CASCADE properly.\n// SQLDev with SQLAlchemy takes care of setting it up for us to make sure it works \ud83e\udd13\nCREATE TABLE hero (\n        id INTEGER NOT NULL,\n        name VARCHAR NOT NULL,\n        secret_name VARCHAR NOT NULL,\n        age INTEGER,\n        team_id INTEGER,\n        PRIMARY KEY (id),\n        FOREIGN KEY(team_id) REFERENCES team (id) ON DELETE SET NULL\n)\n\n// We select the team Wakaland\nINFO Engine SELECT team.id, team.name, team.headquarters\nFROM team\nWHERE team.id = ?\nINFO Engine [generated in 0.00010s] (3,)\nTeam Wakaland: id=3 name='Wakaland' headquarters='Wakaland Capital City'\n\n// Then, right before deleting Wakaland, the heroes are loaded automatically\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age, hero.team_id AS hero_team_id\nFROM hero\nWHERE ? = hero.team_id\nINFO Engine [generated in 0.00020s] (3,)\n\n// Next, before deleting the Wakaland team, it sends an UPDATE statement including each related hero: Black Lion and Princess Sure-E, with IDs 4 and 5, to set their team_id to NULL. This is not the SET NULL we added, this is just the default SQLDev (SQLAlchemy) behavior.\nINFO Engine UPDATE hero SET team_id=? WHERE hero.id = ?\nINFO Engine [generated in 0.00009s] [(None, 4), (None, 5)]\n\n// After that, it will send the delete for the team Wakaland with ID 3\nINFO Engine DELETE FROM team WHERE team.id = ?\nINFO Engine [generated in 0.00017s] (3,)\n\n// Print the deleted team\nDeleted team: name='Wakaland' id=3 headquarters='Wakaland Capital City'\n\n// Finally, we select the heroes Black Lion and Princess Sure-E and print them, they no longer have a team\nBlack Lion has no team: age=35 id=4 name='Black Lion' secret_name='Trevor Challa' team_id=None\nPrincess Sure-E has no team: age=None id=5 name='Princess Sure-E' secret_name='Sure-E' team_id=None\n</code></pre> <p>The team <code>Wakaland</code> was deleted and all of its heroes were left without a team, or in other words, with their <code>team_id</code> set to <code>NULL</code>, but still kept in the database! \ud83e\udd13</p>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#let-the-database-handle-it-with-passive_deletes","title":"Let the Database Handle it with <code>passive_deletes</code>","text":"<p>In the previous examples we configured <code>ondelete</code> with <code>CASCADE</code> and <code>SET NULL</code> to configure the database to handle the deletion of related records automatically. But we actually never used that functionality ourselves, because SQLDev (SQLAlchemy) by default loads the related records and deletes them or updates them with NULL before sending the <code>DELETE</code> for the team.</p> <p>If you know your database would be able to correctly handle the deletes or updates on its own, just with <code>ondelete=\"CASCADE\"</code> or <code>ondelete=\"SET NULL\"</code>, you can use <code>passive_deletes=\"all\"</code> in the <code>Relationship()</code> to tell SQLDev (actually SQLAlchemy) to not delete or update those records (for heroes) before sending the <code>DELETE</code> for the team.</p>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#enable-foreign-key-support-in-sqlite","title":"Enable Foreign Key Support in SQLite","text":"<p>To be able to test this out with SQLite, we first need to enable foreign key support.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"SET NULL\"\n    )\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"SET NULL\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"SET NULL\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Info</p> <p>You can learn more about SQLite, foreign keys, and this SQL command on the SQLAlchemy docs.</p>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#use-passive_deletesall","title":"Use <code>passive_deletes=\"all\"</code>","text":"<p>Now let's update the table model for <code>Team</code> to use <code>passive_deletes=\"all\"</code> in the <code>Relationship()</code> for heroes.</p> <p>We will also use <code>ondelete=\"SET NULL\"</code> in the <code>Hero</code> model table, in the foreign key <code>Field()</code> for the <code>team_id</code> to make the database set those fields to <code>NULL</code> automatically.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"SET NULL\"\n    )\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"SET NULL\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"SET NULL\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"SET NULL\"\n    )\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"SET NULL\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"SET NULL\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#run-the-program-with-passive_deletes","title":"Run the Program with <code>passive_deletes</code>","text":"<p>Now, if we run the program, we will see that SQLDev (SQLAlchemy) is no longer loading and updating the heroes, it just sends the <code>DELETE</code> for the team.</p> <pre><code>$ python app.py\n\n// Some boilerplate and previous output omitted \ud83d\ude09\n\n// The hero table is created with the ON DELETE SET NULL as before\nCREATE TABLE hero (\n        id INTEGER NOT NULL,\n        name VARCHAR NOT NULL,\n        secret_name VARCHAR NOT NULL,\n        age INTEGER,\n        team_id INTEGER,\n        PRIMARY KEY (id),\n        FOREIGN KEY(team_id) REFERENCES team (id) ON DELETE SET NULL\n)\n\n// For SQLite, we also send the custom command to enable foreign key support\nINFO Engine PRAGMA foreign_keys=ON\n\n// We select and print the team Wakaland\nTeam Wakaland: id=3 name='Wakaland' headquarters='Wakaland Capital City'\n\n// We won't see another SELECT for the heroes, nor an UPDATE or DELETE. SQLDev (with SQLAlchemy) won't try to load and update (or delete) the related records for heroes, it will just send the DELETE for the team right away.\nINFO Engine DELETE FROM team WHERE team.id = ?\nINFO Engine [generated in 0.00013s] (3,)\n\n// At this point, because we enabled foreign key support for SQLite, the database will take care of updating the records for heroes automatically, setting their team_id to NULL\n\n// Print the deleted team\nDeleted team: name='Wakaland' id=3 headquarters='Wakaland Capital City'\n\n// Finally, we select the heroes Black Lion and Princess Sure-E and print them, they no longer have a team\nBlack Lion has no team: age=35 id=4 name='Black Lion' secret_name='Trevor Challa' team_id=None\nPrincess Sure-E has no team: age=None id=5 name='Princess Sure-E' secret_name='Sure-E' team_id=None\n</code></pre>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#ondelete-with-restrict","title":"<code>ondelete</code> with <code>RESTRICT</code>","text":"<p>We can also configure the database to prevent the deletion of a record (a team) if there are related records (heroes).</p> <p>In this case, when someone attempts to delete a team with heroes in it, the database will raise an error.</p> <p>And because this is configured in the database, it will happen even if someone interacts with the database directly using SQL (if the database supports it).</p> <p>Tip</p> <p>For SQLite, this also needs enabling foreign key support.</p>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#enable-foreign-key-support-in-sqlite-for-restrict","title":"Enable Foreign Key Support in SQLite for <code>RESTRICT</code>","text":"<p>As <code>ondelete=\"RESTRICT\"</code> is mainly a database-level constraint, let's enable foreign key support in SQLite first to be able to test it.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"RESTRICT\"\n    )\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"RESTRICT\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"RESTRICT\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#use-ondeleterestrict","title":"Use <code>ondelete=\"RESTRICT\"</code>","text":"<p>Let's set <code>ondelete=\"RESTRICT\"</code> in the foreign key <code>Field()</code> for the <code>team_id</code> in the <code>Hero</code> model table.</p> <p>And in the <code>Team</code> model table, we will use <code>passive_deletes=\"all\"</code> in the <code>Relationship()</code> for heroes, this way the default behavior of setting foreign keys from deleted models to <code>NULL</code> will be disabled, and when we try to delete a team with heroes, the database will raise an error.</p> <p>Tip</p> <p>Notice that we don't set <code>cascade_delete</code> in the <code>Team</code> model table.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"RESTRICT\"\n    )\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"RESTRICT\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"RESTRICT\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"RESTRICT\"\n    )\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"RESTRICT\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"RESTRICT\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    delete_team()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#run-the-program-with-restrict-see-the-error","title":"Run the Program with <code>RESTRICT</code>, See the Error","text":"<p>Now, if we run the program and try to delete a team with heroes, we will see an error.</p> <pre><code>$ python app.py\n\n// Some boilerplate and previous output omitted \ud83d\ude09\n\n// The hero table is created with the ON DELETE RESTRICT\nCREATE TABLE hero (\n        id INTEGER NOT NULL,\n        name VARCHAR NOT NULL,\n        secret_name VARCHAR NOT NULL,\n        age INTEGER,\n        team_id INTEGER,\n        PRIMARY KEY (id),\n        FOREIGN KEY(team_id) REFERENCES team (id) ON DELETE RESTRICT\n)\n\n// Now, when we reach the point of deleting a team with heroes, we will see an error\nTraceback (most recent call last):\n     File \"/home/user/code...\n\nsqlite3.IntegrityError: FOREIGN KEY constraint failed\n\n// More error output here...\n\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) FOREIGN KEY constraint failed\n[SQL: DELETE FROM team WHERE team.id = ?]\n[parameters: (3,)]\n</code></pre> <p>Great! The database didn't let us commit the mistake of deleting a team with heroes. \ud83e\udd13</p> <p>Tip</p> <p>If you want to test if the <code>PRAGMA foreign_keys=ON</code> is necessary, comment that line and run it again, you will not see an error. \ud83d\ude31</p> <p>The same with <code>passive_deletes=\"all\"</code>, if you comment that line, SQLDev (SQLAlchemy) will load and update the heroes before deleting the team, set their foreign key <code>team_id</code> to <code>NULL</code> and the constraint won't work as expected, you will not see an error. \ud83d\ude05</p>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#update-heroes-before-deleting-the-team","title":"Update Heroes Before Deleting the Team","text":"<p>After having the <code>ondelete=\"RESTRICT\"</code> in place, SQLite configured to support foreign keys, and <code>passive_deletes=\"all\"</code> in the <code>Relationship()</code>, if we try to delete a team with heroes, we will see an error.</p> <p>If we want to delete the team, we need to update the heroes first and set their <code>team_id</code> to <code>None</code> (or <code>NULL</code> in the database).</p> <p>By calling the method <code>.clear()</code> from a list, we remove all its items. So, by calling <code>team.heroes.clear()</code> and saving that to the database, we disassociate the heroes from the team, that will set their <code>team_id</code> to <code>None</code>.</p> <p>Tip</p> <p>Calling <code>team.heroes.clear()</code> is very similar to what SQLDev (actually SQLAlchemy) would have done if we didn't have <code>passive_deletes=\"all\"</code> configured.</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef remove_team_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        team.heroes.clear()\n        session.add(team)\n        session.commit()\n        session.refresh(team)\n        print(\"Team with removed heroes:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef remove_team_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        team.heroes.clear()\n        session.add(team)\n        session.commit()\n        session.refresh(team)\n        print(\"Team with removed heroes:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef remove_team_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        team.heroes.clear()\n        session.add(team)\n        session.commit()\n        session.refresh(team)\n        print(\"Team with removed heroes:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"RESTRICT\"\n    )\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef remove_team_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        team.heroes.clear()\n        session.add(team)\n        session.commit()\n        session.refresh(team)\n        print(\"Team with removed heroes:\", team)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    remove_team_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"RESTRICT\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef remove_team_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        team.heroes.clear()\n        session.add(team)\n        session.commit()\n        session.refresh(team)\n        print(\"Team with removed heroes:\", team)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    remove_team_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select, text\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\", passive_deletes=\"all\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(\n        default=None, foreign_key=\"team.id\", ondelete=\"RESTRICT\"\n    )\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n    with engine.connect() as connection:\n        connection.execute(text(\"PRAGMA foreign_keys=ON\"))  # for SQLite only\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n\ndef remove_team_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        team.heroes.clear()\n        session.add(team)\n        session.commit()\n        session.refresh(team)\n        print(\"Team with removed heroes:\", team)\n\n\ndef delete_team():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Wakaland\")\n        team = session.exec(statement).one()\n        session.delete(team)\n        session.commit()\n        print(\"Deleted team:\", team)\n\n\ndef select_deleted_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Black Lion\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Black Lion has no team:\", hero)\n\n        statement = select(Hero).where(Hero.name == \"Princess Sure-E\")\n        result = session.exec(statement)\n        hero = result.first()\n        print(\"Princess Sure-E has no team:\", hero)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    remove_team_heroes()\n    delete_team()\n    select_deleted_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#run-the-program-deleting-heroes-first","title":"Run the Program Deleting Heroes First","text":"<p>Now, if we run the program and delete the heroes first, we will be able to delete the team without any issues.</p> <pre><code>$ python app.py\n\n// Some boilerplate and previous output omitted \ud83d\ude09\n\n// The hero table is created with the ON DELETE RESTRICT\nCREATE TABLE hero (\n        id INTEGER NOT NULL,\n        name VARCHAR NOT NULL,\n        secret_name VARCHAR NOT NULL,\n        age INTEGER,\n        team_id INTEGER,\n        PRIMARY KEY (id),\n        FOREIGN KEY(team_id) REFERENCES team (id) ON DELETE RESTRICT\n)\n\n// We manually disassociate the heroes from the team\nINFO Engine UPDATE hero SET team_id=? WHERE hero.id = ?\nINFO Engine [generated in 0.00008s] [(None, 4), (None, 5)]\n\n// We print the team from which we removed heroes\nTeam with removed heroes: name='Wakaland' id=3 headquarters='Wakaland Capital City'\n\n// Now we can delete the team\nINFO Engine DELETE FROM team WHERE team.id = ?\nINFO Engine [generated in 0.00008s] (3,)\nINFO Engine COMMIT\nDeleted team: name='Wakaland' id=3 headquarters='Wakaland Capital City'\n\n// The heroes Black Lion and Princess Sure-E are no longer associated with the team\nBlack Lion has no team: secret_name='Trevor Challa' name='Black Lion' team_id=None age=35 id=4\nPrincess Sure-E has no team: secret_name='Sure-E' name='Princess Sure-E' team_id=None age=None id=5\n</code></pre>"},{"location":"tutorial/relationship-attributes/cascade-delete-relationships/#conclusion","title":"Conclusion","text":"<p>In many cases, you don't really need to configure anything. \ud83d\ude0e</p> <p>In some cases, when you want to cascade the delete of a record to its related records automatically (delete a team with its heroes), you can:</p> <ul> <li>Use <code>cascade_delete=True</code> in the <code>Relationship()</code> on the side without a foreign key</li> <li>And use <code>ondelete=\"CASCADE\"</code> in the <code>Field()</code> with the foreign key</li> </ul> <p>That will cover most of the use cases. \ud83d\ude80</p> <p>And if you need something else, you can refer the additional options described above. \ud83e\udd13</p>"},{"location":"tutorial/relationship-attributes/create-and-update-relationships/","title":"Create and Update Relationships","text":"<p>Let's see now how to create data with relationships using these new relationship attributes. \u2728</p>"},{"location":"tutorial/relationship-attributes/create-and-update-relationships/#create-instances-with-fields","title":"Create Instances with Fields","text":"<p>Let's check the old code we used to create some heroes and teams:</p> Python 3.10+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>There are several things to notice here.</p> <p>First, we create some <code>Team</code> instance objects. We want to use the IDs of these teams when creating the <code>Hero</code> instances, in the <code>team_id</code> field.</p> <p>But model instances don't have an ID generated by the database until we <code>add</code> and <code>commit</code> them to the session. Before that, they are just <code>None</code>, and we want to use the actual IDs.</p> <p>So, we have to <code>add</code> them and <code>commit</code> the session first, before we start creating the <code>Hero</code> instances, to be able to use their IDs.</p> <p>Then, we use those IDs when creating the <code>Hero</code> instances. We <code>add</code> the new heroes to the session, and then we <code>commit</code> them.</p> <p>So, we are committing twice. And we have to remember to <code>add</code> some things first, and then <code>commit</code>, and do all that in the right order, otherwise we could end up using a <code>team.id</code> that is currently <code>None</code> because it hasn't been saved.</p> <p>This is the first area where these relationship attributes can help. \ud83e\udd13</p>"},{"location":"tutorial/relationship-attributes/create-and-update-relationships/#create-instances-with-relationship-attributes","title":"Create Instances with Relationship Attributes","text":"<p>Now let's do all that, but this time using the new, shiny <code>Relationship</code> attributes:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Now we can create the <code>Team</code> instances and pass them directly to the new <code>team</code> argument when creating the <code>Hero</code> instances, as <code>team=team_preventers</code> instead of <code>team_id=team_preventers.id</code>.</p> <p>And thanks to SQLAlchemy and how it works underneath, these teams don't even need to have an ID yet, but because we are assigning the whole object to each hero, those teams will be automatically created in the database, the automatic ID will be generated, and will be set in the <code>team_id</code> column for each of the corresponding hero rows.</p> <p>In fact, now we don't even have to put the teams explicitly in the session with <code>session.add(team)</code>, because these <code>Team</code> instances are already associated with heroes that we do <code>add</code> to the session.</p> <p>SQLAlchemy knows that it also has to include those teams in the next commit to be able to save the heroes correctly.</p> <p>And then, as you can see, we only have to do one <code>commit()</code>.</p>"},{"location":"tutorial/relationship-attributes/create-and-update-relationships/#assign-a-relationship","title":"Assign a Relationship","text":"<p>The same way we could assign an integer with a <code>team.id</code> to a <code>hero.team_id</code>, we can also assign the <code>Team</code> instance to the <code>hero.team</code>:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n\n        # Previous code here omitted \ud83d\udc48\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n\n        # Previous code here omitted \ud83d\udc48\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n\n        # Previous code here omitted \ud83d\udc48\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/relationship-attributes/create-and-update-relationships/#create-a-team-with-heroes","title":"Create a Team with Heroes","text":"<p>Before, we created some <code>Team</code> instances and passed them in the <code>team=</code> argument when creating <code>Hero</code> instances.</p> <p>We could also create the <code>Hero</code> instances first, and then pass them in the <code>heroes=</code> argument that takes a list, when creating a <code>Team</code> instance:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n\n        # Previous code here omitted \ud83d\udc48\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n\n        # Previous code here omitted \ud83d\udc48\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n\n        # Previous code here omitted \ud83d\udc48\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Here we create two heroes first, Black Lion and Princess Sure-E, and then we pass them in the <code>heroes</code> argument.</p> <p>Notice that, the same as before, we only have to <code>add</code> the <code>Team</code> instance to the session, and because the heroes are connected to it, they will be automatically saved too when we <code>commit</code>.</p>"},{"location":"tutorial/relationship-attributes/create-and-update-relationships/#include-relationship-objects-in-the-many-side","title":"Include Relationship Objects in the Many Side","text":"<p>We said before that this is a many-to-one relationship, because there can be many heroes that belong to one team.</p> <p>We can also connect data with these relationship attributes on the many side.</p> <p>As the attribute <code>team.heroes</code> behaves like a list, we can simply append to it.</p> <p>Let's create some more heroes and add them to the <code>team_preventers.heroes</code> list attribute:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n\n        # Previous code here omitted \ud83d\udc48\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n\n        # Previous code here omitted \ud83d\udc48\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef create_heroes():\n    with Session(engine) as session:\n\n        # Previous code here omitted \ud83d\udc48\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>The attribute <code>team_preventers.heroes</code> behaves like a list. But it's a special type of list, because when we modify it adding heroes to it, SQLDev (actually SQLAlchemy) keeps track of the necessary changes to be done in the database.</p> <p>Then we <code>add()</code> the team to the session and <code>commit()</code> it.</p> <p>And in the same way as before, we don't even have to <code>add()</code> the independent heroes to the session, because they are connected to the team.</p>"},{"location":"tutorial/relationship-attributes/create-and-update-relationships/#recap","title":"Recap","text":"<p>We can use common Python objects and attributes to create and update data connections with these relationship attributes. \ud83d\ude0e</p> <p>Next we'll see how to use these relationship attributes to read connected data. \ud83e\udd1d</p>"},{"location":"tutorial/relationship-attributes/define-relationships-attributes/","title":"Define Relationships Attributes","text":"<p>Now we are finally in one of the most exciting parts of SQLDev.</p> <p>Relationship Attributes. \u2728</p> <p>We currently have a <code>team</code> table:</p> idnameheadquarters 1PreventersSharp Tower 2Z-ForceSister Margaret's Bar <p>And a <code>hero</code> table:</p> idnamesecret_nameageteam_id 1DeadpondDive Wilsonnull2 2Rusty-ManTommy Sharp481 3Spider-BoyPedro Parqueadornull1 <p>Now that you know how these tables work underneath and how the model classes represent them, it's time to add a little convenience that will make many operations in code simpler.</p>"},{"location":"tutorial/relationship-attributes/define-relationships-attributes/#declare-relationship-attributes","title":"Declare Relationship Attributes","text":"<p>Up to now, we have only used the <code>team_id</code> column to connect the tables when querying with <code>select()</code>:</p> Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.7+ <pre><code>from sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n        session.add(team_preventers)\n        session.add(team_z_force)\n        session.commit()\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team_id=team_z_force.id\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\",\n            secret_name=\"Tommy Sharp\",\n            age=48,\n            team_id=team_preventers.id,\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>This is a plain field like all the others, all representing a column in the table.</p> <p>But now let's add a couple of new special attributes to these model classes, let's add <code>Relationship</code> attributes.</p> <p>First, import <code>Relationship</code> from <code>sqldev</code>:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Next, use that <code>Relationship</code> to declare a new attribute in the model classes:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/relationship-attributes/define-relationships-attributes/#what-are-these-relationship-attributes","title":"What Are These Relationship Attributes","text":"<p>These new attributes are not the same as fields, they don't represent a column directly in the database, and their value is not a singular value like an integer. Their value is the actual entire object that is related.</p> <p>So, in the case of a <code>Hero</code> instance, if you call <code>hero.team</code>, you will get the entire <code>Team</code> instance object that this hero belongs to. \u2728</p> <p>For example, you could check if a <code>hero</code> belongs to any <code>team</code> (if <code>.team</code> is not <code>None</code>) and then print the team's <code>name</code>:</p> <pre><code>if hero.team:\n    print(hero.team.name)\n</code></pre>"},{"location":"tutorial/relationship-attributes/define-relationships-attributes/#optional-relationship-attributes","title":"Optional Relationship Attributes","text":"<p>Notice that in the <code>Hero</code> class, the type annotation for <code>team</code> is <code>Optional[Team]</code>.</p> <p>This means that this attribute could be <code>None</code>, or it could be a full <code>Team</code> object.</p> <p>This is because the related <code>team_id</code> could also be <code>None</code> (or <code>NULL</code> in the database).</p> <p>If it was required for a <code>Hero</code> instance to belong to a <code>Team</code>, then the <code>team_id</code> would be <code>int</code> instead of <code>Optional[int]</code>, its <code>Field</code> would be <code>Field(foreign_key=\"team.id\")</code> instead of <code>Field(default=None, foreign_key=\"team.id\")</code> and the <code>team</code> attribute would be a <code>Team</code> instead of <code>Optional[Team]</code>.</p>"},{"location":"tutorial/relationship-attributes/define-relationships-attributes/#relationship-attributes-with-lists","title":"Relationship Attributes With Lists","text":"<p>And in the <code>Team</code> class, the <code>heroes</code> attribute is annotated as a list of <code>Hero</code> objects, because that's what it will have.</p> <p>SQLDev (actually SQLAlchemy) is smart enough to know that the relationship is established by the <code>team_id</code>, as that's the foreign key that points from the <code>hero</code> table to the <code>team</code> table, so we don't have to specify that explicitly here.</p> <p>Tip</p> <p>There's a couple of things we'll check again in some of the next chapters, about the <code>List[\"Hero\"]</code> and the <code>back_populates</code>.</p> <p>But for now, let's first see how to use these relationship attributes.</p>"},{"location":"tutorial/relationship-attributes/define-relationships-attributes/#next-steps","title":"Next Steps","text":"<p>Now let's see some real examples of how to use these new relationship attributes in the next chapters. \u2728</p>"},{"location":"tutorial/relationship-attributes/read-relationships/","title":"Read Relationships","text":"<p>Now that we know how to connect data using relationship Attributes, let's see how to get and read the objects from a relationship.</p>"},{"location":"tutorial/relationship-attributes/read-relationships/#select-a-hero","title":"Select a Hero","text":"<p>First, add a function <code>select_heroes()</code> where we get a hero to start working with, and add that function to the <code>main()</code> function:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n# Previous code here omitted \ud83d\udc48\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n# Previous code here omitted \ud83d\udc48\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n# Previous code here omitted \ud83d\udc48\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        statement = select(Team).where(Team.id == hero_spider_boy.team_id)\n        result = session.exec(statement)\n        team = result.first()\n        print(\"Spider-Boy's team:\", team)\n\n        print(\"Spider-Boy's team again:\", hero_spider_boy.team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        statement = select(Team).where(Team.id == hero_spider_boy.team_id)\n        result = session.exec(statement)\n        team = result.first()\n        print(\"Spider-Boy's team:\", team)\n\n        print(\"Spider-Boy's team again:\", hero_spider_boy.team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        statement = select(Team).where(Team.id == hero_spider_boy.team_id)\n        result = session.exec(statement)\n        team = result.first()\n        print(\"Spider-Boy's team:\", team)\n\n        print(\"Spider-Boy's team again:\", hero_spider_boy.team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/relationship-attributes/read-relationships/#select-the-related-team-old-way","title":"Select the Related Team - Old Way","text":"<p>Now that we have a hero, we can get the team this hero belongs to.</p> <p>With what we have learned up to now, we could use a <code>select()</code> statement, then execute it with <code>session.exec()</code>, and then get the <code>.first()</code> result, for example:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        statement = select(Team).where(Team.id == hero_spider_boy.team_id)\n        result = session.exec(statement)\n        team = result.first()\n        print(\"Spider-Boy's team:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        statement = select(Team).where(Team.id == hero_spider_boy.team_id)\n        result = session.exec(statement)\n        team = result.first()\n        print(\"Spider-Boy's team:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        statement = select(Team).where(Team.id == hero_spider_boy.team_id)\n        result = session.exec(statement)\n        team = result.first()\n        print(\"Spider-Boy's team:\", team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        statement = select(Team).where(Team.id == hero_spider_boy.team_id)\n        result = session.exec(statement)\n        team = result.first()\n        print(\"Spider-Boy's team:\", team)\n\n        print(\"Spider-Boy's team again:\", hero_spider_boy.team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        statement = select(Team).where(Team.id == hero_spider_boy.team_id)\n        result = session.exec(statement)\n        team = result.first()\n        print(\"Spider-Boy's team:\", team)\n\n        print(\"Spider-Boy's team again:\", hero_spider_boy.team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        statement = select(Team).where(Team.id == hero_spider_boy.team_id)\n        result = session.exec(statement)\n        team = result.first()\n        print(\"Spider-Boy's team:\", team)\n\n        print(\"Spider-Boy's team again:\", hero_spider_boy.team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/relationship-attributes/read-relationships/#get-relationship-team-new-way","title":"Get Relationship Team - New Way","text":"<p>But now that we have the relationship attributes, we can just access them, and SQLDev (actually SQLAlchemy) will go and fetch the corresponding data from the database, and make it available in the attribute. \u2728</p> <p>So, the highlighted block above, has the same results as the block below:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        # Code from the previous example omitted \ud83d\udc48\n\n        print(\"Spider-Boy's team again:\", hero_spider_boy.team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        # Code from the previous example omitted \ud83d\udc48\n\n        print(\"Spider-Boy's team again:\", hero_spider_boy.team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        # Code from the previous example omitted \ud83d\udc48\n\n        print(\"Spider-Boy's team again:\", hero_spider_boy.team)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        statement = select(Team).where(Team.id == hero_spider_boy.team_id)\n        result = session.exec(statement)\n        team = result.first()\n        print(\"Spider-Boy's team:\", team)\n\n        print(\"Spider-Boy's team again:\", hero_spider_boy.team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        statement = select(Team).where(Team.id == hero_spider_boy.team_id)\n        result = session.exec(statement)\n        team = result.first()\n        print(\"Spider-Boy's team:\", team)\n\n        print(\"Spider-Boy's team again:\", hero_spider_boy.team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        statement = select(Team).where(Team.id == hero_spider_boy.team_id)\n        result = session.exec(statement)\n        team = result.first()\n        print(\"Spider-Boy's team:\", team)\n\n        print(\"Spider-Boy's team again:\", hero_spider_boy.team)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Tip</p> <p>The automatic data fetching will work as long as the starting object (in this case the <code>Hero</code>) is associated with an open session.</p> <p>For example, here, inside a <code>with</code> block with a <code>Session</code> object.</p>"},{"location":"tutorial/relationship-attributes/read-relationships/#get-a-list-of-relationship-objects","title":"Get a List of Relationship Objects","text":"<p>And the same way, when we are working on the many side of the one-to-many relationship, we can get a list of of the related objects just by accessing the relationship attribute:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        hero_spider_boy.team = None\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        hero_spider_boy.team = None\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        hero_spider_boy.team = None\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>That would print a list with all the heroes in the Preventers team:</p> <pre><code>$ python app.py\n\n// Automatically fetch the heroes\nINFO Engine SELECT hero.id AS hero_id, hero.name AS hero_name, hero.secret_name AS hero_secret_name, hero.age AS hero_age, hero.team_id AS hero_team_id\nFROM hero\nWHERE ? = hero.team_id\nINFO Engine [cached since 0.8774s ago] (2,)\n\n// Print the list of Preventers\nPreventers heroes: [\n    Hero(name='Rusty-Man', age=48, id=2, secret_name='Tommy Sharp', team_id=2),\n    Hero(name='Spider-Boy', age=None, id=3, secret_name='Pedro Parqueador', team_id=2),\n    Hero(name='Tarantula', age=32, id=6, secret_name='Natalia Roman-on', team_id=2),\n    Hero(name='Dr. Weird', age=36, id=7, secret_name='Steve Weird', team_id=2),\n    Hero(name='Captain North America', age=93, id=8, secret_name='Esteban Rogelios', team_id=2)\n]\n</code></pre>"},{"location":"tutorial/relationship-attributes/read-relationships/#recap","title":"Recap","text":"<p>With relationship attributes you can use the power of common Python objects to easily access related data from the database. \ud83d\ude0e</p>"},{"location":"tutorial/relationship-attributes/remove-relationships/","title":"Remove Relationships","text":"<p>Now let's say that Spider-Boy tells Rusty-Man something like:</p> <p>I don't feel so good Mr. Sharp</p> <p>And then for some reason needs to leave the Preventers for some years. \ud83d\ude2d</p> <p>We can remove the relationship by setting it to <code>None</code>, the same as with the <code>team_id</code>, it also works with the new relationship attribute <code>.team</code>:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        hero_spider_boy.team = None\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        hero_spider_boy.team = None\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        hero_spider_boy.team = None\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        hero_spider_boy.team = None\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        hero_spider_boy.team = None\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        hero_spider_boy.team = None\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>And of course, we should remember to add this <code>update_heroes()</code> function to <code>main()</code> so that it runs when we call this program from the command line:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code># Code above omitted \ud83d\udc46\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        hero_spider_boy.team = None\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        hero_spider_boy.team = None\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine, select\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n        session.refresh(hero_spider_boy)\n        print(\"Updated hero:\", hero_spider_boy)\n\n        hero_black_lion = Hero(name=\"Black Lion\", secret_name=\"Trevor Challa\", age=35)\n        hero_sure_e = Hero(name=\"Princess Sure-E\", secret_name=\"Sure-E\")\n        team_wakaland = Team(\n            name=\"Wakaland\",\n            headquarters=\"Wakaland Capital City\",\n            heroes=[hero_black_lion, hero_sure_e],\n        )\n        session.add(team_wakaland)\n        session.commit()\n        session.refresh(team_wakaland)\n        print(\"Team Wakaland:\", team_wakaland)\n\n        hero_tarantula = Hero(name=\"Tarantula\", secret_name=\"Natalia Roman-on\", age=32)\n        hero_dr_weird = Hero(name=\"Dr. Weird\", secret_name=\"Steve Weird\", age=36)\n        hero_cap = Hero(\n            name=\"Captain North America\", secret_name=\"Esteban Rogelios\", age=93\n        )\n\n        team_preventers.heroes.append(hero_tarantula)\n        team_preventers.heroes.append(hero_dr_weird)\n        team_preventers.heroes.append(hero_cap)\n        session.add(team_preventers)\n        session.commit()\n        session.refresh(hero_tarantula)\n        session.refresh(hero_dr_weird)\n        session.refresh(hero_cap)\n        print(\"Preventers new hero:\", hero_tarantula)\n        print(\"Preventers new hero:\", hero_dr_weird)\n        print(\"Preventers new hero:\", hero_cap)\n\n\ndef select_heroes():\n    with Session(engine) as session:\n        statement = select(Team).where(Team.name == \"Preventers\")\n        result = session.exec(statement)\n        team_preventers = result.one()\n\n        print(\"Preventers heroes:\", team_preventers.heroes)\n\n\ndef update_heroes():\n    with Session(engine) as session:\n        statement = select(Hero).where(Hero.name == \"Spider-Boy\")\n        result = session.exec(statement)\n        hero_spider_boy = result.one()\n\n        hero_spider_boy.team = None\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_spider_boy)\n        print(\"Spider-Boy without team:\", hero_spider_boy)\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n    select_heroes()\n    update_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"tutorial/relationship-attributes/remove-relationships/#recap","title":"Recap","text":"<p>This chapter was too short for a recap, wasn't it? \ud83e\udd14</p> <p>Anyway, relationship attributes make it easy and intuitive to work with relationships stored in the database. \ud83c\udf89</p>"},{"location":"tutorial/relationship-attributes/type-annotation-strings/","title":"Type annotation strings","text":""},{"location":"tutorial/relationship-attributes/type-annotation-strings/#about-the-string-in-listhero","title":"About the String in <code>List[\"Hero\"]</code>","text":"<p>In the first Relationship attribute, we declare it with <code>List[\"Hero\"]</code>, putting the <code>Hero</code> in quotes instead of just normally there:</p> Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n# Code below omitted \ud83d\udc47\n</code></pre> \ud83d\udc40 Full file preview Python 3.10+Python 3.9+Python 3.7+ <pre><code>from sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: int | None = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: int | None = Field(default=None, index=True)\n\n    team_id: int | None = Field(default=None, foreign_key=\"team.id\")\n    team: Team | None = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: list[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <pre><code>from typing import List, Optional\n\nfrom sqldev import Field, Relationship, Session, SQLDev, create_engine\n\n\nclass Team(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    headquarters: str\n\n    heroes: List[\"Hero\"] = Relationship(back_populates=\"team\")\n\n\nclass Hero(SQLDev, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    name: str = Field(index=True)\n    secret_name: str\n    age: Optional[int] = Field(default=None, index=True)\n\n    team_id: Optional[int] = Field(default=None, foreign_key=\"team.id\")\n    team: Optional[Team] = Relationship(back_populates=\"heroes\")\n\n\nsqlite_file_name = \"database.db\"\nsqlite_url = f\"sqlite:///{sqlite_file_name}\"\n\nengine = create_engine(sqlite_url, echo=True)\n\n\ndef create_db_and_tables():\n    SQLDev.metadata.create_all(engine)\n\n\ndef create_heroes():\n    with Session(engine) as session:\n        team_preventers = Team(name=\"Preventers\", headquarters=\"Sharp Tower\")\n        team_z_force = Team(name=\"Z-Force\", headquarters=\"Sister Margaret's Bar\")\n\n        hero_deadpond = Hero(\n            name=\"Deadpond\", secret_name=\"Dive Wilson\", team=team_z_force\n        )\n        hero_rusty_man = Hero(\n            name=\"Rusty-Man\", secret_name=\"Tommy Sharp\", age=48, team=team_preventers\n        )\n        hero_spider_boy = Hero(name=\"Spider-Boy\", secret_name=\"Pedro Parqueador\")\n        session.add(hero_deadpond)\n        session.add(hero_rusty_man)\n        session.add(hero_spider_boy)\n        session.commit()\n\n        session.refresh(hero_deadpond)\n        session.refresh(hero_rusty_man)\n        session.refresh(hero_spider_boy)\n\n        print(\"Created hero:\", hero_deadpond)\n        print(\"Created hero:\", hero_rusty_man)\n        print(\"Created hero:\", hero_spider_boy)\n\n        hero_spider_boy.team = team_preventers\n        session.add(hero_spider_boy)\n        session.commit()\n\n\ndef main():\n    create_db_and_tables()\n    create_heroes()\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>What's that about? Can't we just write it normally as <code>List[Hero]</code>?</p> <p>By that point, in that line in the code, the Python interpreter doesn't know of any class <code>Hero</code>, and if we put it just there, it would try to find it unsuccessfully, and then fail. \ud83d\ude2d</p> <p>But by putting it in quotes, in a string, the interpreter sees it as just a string with the text <code>\"Hero\"</code> inside.</p> <p>But the editor and other tools can see that the string is actually a type annotation inside, and provide all the autocompletion, type checks, etc. \ud83c\udf89</p> <p>And of course, SQLDev can also understand it in the string correctly. \u2728</p> <p>That is actually part of Python, it's the current official solution to handle it.</p> <p>Info</p> <p>There's a lot of work going on in Python itself to make that simpler and more intuitive, and find ways to make it possible to not wrap the class in a string.</p>"}]}